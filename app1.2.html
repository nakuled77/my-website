<!DOCTYPE html>
<html lang="en">
<head>
<!-- ðŸ› DEBUG CONSOLE (Eruda) - Enable for mobile debugging, disable for production -->
<!-- <script src="https://cdn.jsdelivr.net/npm/eruda"></script> -->
<!-- <script>eruda.init();</script> -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HelpBuddy - Service Marketplace</title>
    <link rel="manifest" href="/site.webmanifest">
    <!-- Apple Touch Icons -->
<link rel="apple-touch-icon" sizes="72x72" href="/icon-72x72.png">
<link rel="apple-touch-icon" sizes="96x96" href="/icon-96x96.png">
<link rel="apple-touch-icon" sizes="128x128" href="/icon-128x128.png">
<link rel="apple-touch-icon" sizes="144x144" href="/icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/icon-152x152.png">
<link rel="apple-touch-icon" sizes="192x192" href="/icon-192x192.png">
<!-- PWA Meta Tags -->
<meta name="theme-color" content="#ffffff">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="HelpBuddy">
<meta name="description" content="Connect with local service providers in your area">
<!-- Favicon -->
<link rel="icon" type="image/x-icon" href="/favicon.ico">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.min.js"></script>
    
    <!-- ==================== FIREBASE SDK FOR PUSH NOTIFICATIONS ==================== -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-messaging-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script> <!-- ðŸ†• ADD THIS LINE -->
    
<style>

body.dark-theme {
    background-color: #1a1a2e !important;
}

body.dark-theme .dashboard-container,
body.dark-theme .main-content {
    background-color: #1a1a2e !important;
}

/* Dark Theme - Container and Main Elements */
body.dark-theme .container {
    background-color: #1a1a2e !important;
    color: #e0e0e0 !important;
}

/* Dark Theme - User Dropdown Menu */
body.dark-theme .user-dropdown {
    background: #2d2d44 !important;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5) !important;
}

body.dark-theme .dropdown-item {
    color: #e0e0e0 !important;
    background: #2d2d44 !important;
}

body.dark-theme .dropdown-item:hover {
    background: #3a3a5c !important;
    color: #667eea !important;
}

body.dark-theme .dropdown-separator {
    background: #667eea !important;
}

/* Dark Theme - Modals */
body.dark-theme .modal-content {
    background: #2d2d44 !important;
    color: #e0e0e0 !important;
}

body.dark-theme .modal-header {
    border-bottom: 2px solid #3a3a5c !important;
}

body.dark-theme .modal-title {
    color: #e0e0e0 !important;
}

body.dark-theme .close-btn {
    color: #999 !important;
}

body.dark-theme .close-btn:hover {
    color: #e0e0e0 !important;
}

/* Dark Theme - Request Details Panels */
body.dark-theme .request-details {
    background: #2d2d44 !important;
    border-top: 1px solid #3a3a5c !important;
}

body.dark-theme .request-card {
    background: #2d2d44 !important;
    border-color: #3a3a5c !important;
}

body.dark-theme .request-card:hover {
    border-color: #667eea !important;
    background: #3a3a5c !important;
}

body.dark-theme .request-title-compact {
    color: #667eea !important;
}

body.dark-theme .request-summary {
    color: #b0b0b0 !important;
}

body.dark-theme .request-description {
    color: #b0b0b0 !important;
}

body.dark-theme .request-location {
    color: #b0b0b0 !important;
}

/* Dark Theme - Form Elements */
body.dark-theme input,
body.dark-theme select,
body.dark-theme textarea {
    background: #3a3a5c !important;
    color: #e0e0e0 !important;
    border-color: #4a4a6c !important;
}

body.dark-theme input:focus,
body.dark-theme select:focus,
body.dark-theme textarea:focus {
    background: #3a3a5c !important;
    border-color: #667eea !important;
}

body.dark-theme label {
    color: #b0b0b0 !important;
}

/* Dark Theme - Provider/Profile Cards */
body.dark-theme .provider-card {
    background: #3a3a5c !important;
}

body.dark-theme .provider-name {
    color: #e0e0e0 !important;
}

body.dark-theme .provider-info {
    color: #b0b0b0 !important;
}

body.dark-theme .profile-info {
    background: #3a3a5c !important;
}

body.dark-theme .profile-info p {
    color: #b0b0b0 !important;
}

body.dark-theme .profile-details {
    color: #b0b0b0 !important;
}

body.dark-theme .profile-modal-content {
    background: #2d2d44 !important;
}

/* Dark Theme - Section Headers */
body.dark-theme h2,
body.dark-theme h3 {
    color: #e0e0e0 !important;
}

body.dark-theme .section-inner {
    color: #e0e0e0 !important;
}

/* Dark Theme - Empty States */
body.dark-theme .empty-state {
    color: #999 !important;
}

body.dark-theme .empty-state-text {
    color: #b0b0b0 !important;
}

/* Dark Theme - Chat Elements */
body.dark-theme .chat-container {
    background: #2d2d44 !important;
}

body.dark-theme .chat-messages {
    background: #1a1a2e !important;
}

body.dark-theme .message.received .message-bubble {
    background: #3a3a5c !important;
    color: #e0e0e0 !important;
}

body.dark-theme .chat-input-area {
    background: #2d2d44 !important;
    border-top: 1px solid #3a3a5c !important;
}

body.dark-theme .chat-input-wrapper textarea {
    background: #3a3a5c !important;
    color: #e0e0e0 !important;
}

/* Dark Theme - Template Modal */
body.dark-theme .template-modal-content {
    background: #2d2d44 !important;
}

body.dark-theme .template-modal-title {
    color: #e0e0e0 !important;
}

body.dark-theme .template-category-block {
    border-color: #3a3a5c !important;
}

body.dark-theme .template-category-items {
    background: #3a3a5c !important;
}

body.dark-theme .template-option {
    color: #b0b0b0 !important;
    border-bottom: 1px solid #4a4a6c !important;
}

body.dark-theme .template-option:hover {
    background: #4a4a6c !important;
    color: #e0e0e0 !important;
}

/* Dark Theme - Autocomplete Suggestions */
body.dark-theme .autocomplete-suggestions {
    background: #2d2d44 !important;
    border-color: #3a3a5c !important;
}

body.dark-theme .suggestion-item {
    color: #e0e0e0 !important;
    border-bottom: 1px solid #3a3a5c !important;
}

body.dark-theme .suggestion-item:hover {
    background: #3a3a5c !important;
    color: #667eea !important;
}

/* Dark Theme - Success Popup */
body.dark-theme .success-popup-content {
    background: #2d2d44 !important;
}

body.dark-theme .success-popup-message {
    color: #b0b0b0 !important;
}

/* Dark Theme - Warranty Form */
body.dark-theme .warranty-form {
    background: #3a3a5c !important;
    border-color: #4a4a6c !important;
}

body.dark-theme .warranty-form h3 {
    color: #e0e0e0 !important;
}

body.dark-theme .warranty-option label {
    background: #2d2d44 !important;
    color: #b0b0b0 !important;
    border-color: #4a4a6c !important;
}

/* Dark Theme - Meta Info */
body.dark-theme .meta-item {
    color: #b0b0b0 !important;
}

body.dark-theme .request-title {
    color: #e0e0e0 !important;
}

body.dark-theme .request-meta {
    color: #b0b0b0 !important;
}

body.dark-theme .char-counter {
    color: #999 !important;
}

/* Dark Theme - Better Form Input Visibility */
body.dark-theme input[type="text"],
body.dark-theme input[type="email"],
body.dark-theme input[type="password"],
body.dark-theme input[type="tel"],
body.dark-theme input[type="number"] {
    background: #3a3a5c !important;
    color: #ffffff !important;
    border: 2px solid #4a4a6c !important;
}

body.dark-theme input::placeholder {
    color: #888 !important;
    opacity: 1 !important;
}

/* Dark Theme - Select Dropdowns */
body.dark-theme select {
    background: #3a3a5c !important;
    color: #ffffff !important;
    border: 2px solid #4a4a6c !important;
}

body.dark-theme select option {
    background: #2d2d44 !important;
    color: #ffffff !important;
}

/* Dark Theme - Textarea */
body.dark-theme textarea {
    background: #3a3a5c !important;
    color: #ffffff !important;
    border: 2px solid #4a4a6c !important;
}

/* Dark Theme - Service Cards in Provider Settings */
body.dark-theme .service-card,
body.dark-theme [class*="service-"] {
    background: #3a3a5c !important;
    color: #ffffff !important;
    border: 2px solid #4a4a6c !important;
}

/* Dark Theme - Service Names/Labels */
body.dark-theme .service-name,
body.dark-theme .service-label,
body.dark-theme [class*="service"] label {
    color: #ffffff !important;
}

/* Dark Theme - Any white text elements that need to be visible */
body.dark-theme .form-group label {
    color: #e0e0e0 !important;
    font-weight: 600 !important;
}

/* Dark Theme - Provider Settings specific */
body.dark-theme #providerSettings,
body.dark-theme .provider-settings {
    background: #2d2d44 !important;
    color: #e0e0e0 !important;
}

body.dark-theme #providerSettings input,
body.dark-theme .provider-settings input {
    background: #3a3a5c !important;
    color: #ffffff !important;
}

/* Dark Theme - Checkbox/Radio labels */
body.dark-theme .checkbox-group label,
body.dark-theme .urgency-label {
    color: #e0e0e0 !important;
}

body.dark-theme .checkbox-group input:checked + label {
    color: #667eea !important;
}

/* Dark Theme - All text inside cards should be white */
body.dark-theme .provider-card *,
body.dark-theme .service-card *,
body.dark-theme .request-card * {
    color: inherit !important;
}

body.dark-theme .provider-card,
body.dark-theme .service-card {
    color: #ffffff !important;
}

/* Dark Theme - Specific fix for service rows */
body.dark-theme .row input,
body.dark-theme .row select,
body.dark-theme .row textarea {
    background: #3a3a5c !important;
    color: #ffffff !important;
    border: 2px solid #4a4a6c !important;
}

/* ========================================
   Provider Profile - Dropdown Width Fixes
   ======================================== */

/* Fix 1: Work Area Dropdown - Prevent overflow (TOO WIDE issue) */
#providerSettings select,
.provider-settings select,
select[id*="radius"],
select[name*="radius"] {
    width: 100% !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
}

/* Dropdown options should also be contained */
#providerSettings select option,
.provider-settings select option {
    width: 100% !important;
    max-width: 100% !important;
}

/* Dark Theme - Ensure all form text is visible */
body.dark-theme form,
body.dark-theme .form-group {
    color: #e0e0e0 !important;
}

/* Dark Theme - Input focus states (better visibility) */
body.dark-theme input:focus,
body.dark-theme select:focus,
body.dark-theme textarea:focus {
    background: #3a3a5c !important;
    color: #ffffff !important;
    border-color: #667eea !important;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3) !important;
}

/* Dark Theme - Disabled inputs */
body.dark-theme input:disabled,
body.dark-theme select:disabled,
body.dark-theme textarea:disabled {
    background: #2d2d44 !important;
    color: #666 !important;
    border-color: #3a3a5c !important;
    opacity: 0.6 !important;
}

/* Dark Theme - Auto-filled inputs (browser autofill) */
body.dark-theme input:-webkit-autofill,
body.dark-theme input:-webkit-autofill:hover,
body.dark-theme input:-webkit-autofill:focus {
    -webkit-text-fill-color: #ffffff !important;
    -webkit-box-shadow: 0 0 0px 1000px #3a3a5c inset !important;
    box-shadow: 0 0 0px 1000px #3a3a5c inset !important;
    border: 2px solid #667eea !important;
}

/* ==========================================
   DARK THEME - PROVIDER SETTINGS (EXACT FIX)
   ========================================== */

/* Target the provider settings container specifically */
body.dark-theme #providerSettings {
    background-color: #2d2d44 !important;
}

/* Target all text inside provider settings */
body.dark-theme #providerSettings h1,
body.dark-theme #providerSettings h2,
body.dark-theme #providerSettings h3,
body.dark-theme #providerSettings label {
    color: #ffffff !important;
}

/* Target service list container */
body.dark-theme #currentServicesList {
    background-color: transparent !important;
}

/* Target all divs with form-group inside provider settings */
body.dark-theme #providerSettings .form-group {
    background-color: transparent !important;
}

body.dark-theme #providerSettings .form-group label {
    color: #ffffff !important;
}

/* Target ALL inputs inside provider settings */
body.dark-theme #providerSettings input {
    background-color: #3a3a5c !important;
    color: #ffffff !important;
    border: 2px solid #4a4a6c !important;
}

/* Target ALL selects inside provider settings */
body.dark-theme #providerSettings select {
    background-color: #3a3a5c !important;
    color: #ffffff !important;
    border: 2px solid #4a4a6c !important;
}

body.dark-theme #providerSettings select option {
    background-color: #2d2d44 !important;
    color: #ffffff !important;
}

/* Input focus state */
body.dark-theme #providerSettings input:focus,
body.dark-theme #providerSettings select:focus {
    border-color: #667eea !important;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3) !important;
}

/* Placeholder text */
body.dark-theme #providerSettings input::placeholder {
    color: #999 !important;
}

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: #1a1a2e;
    min-height: 100vh;
    padding: 20px;
}

body.light-theme {
    background: #f5f5f5;
}
        .container { 
    background: white; 
    border-radius: 0; 
    padding: 0 40px 40px 40px;
    max-width: 100%; 
    margin: 0; 
    box-shadow: none; 
}
        .dashboard-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #f0f0f0; }
        .header-left { display: flex; align-items: center; gap: 15px; }
        .logo-container { display: flex; align-items: center; gap: 10px; font-size: 28px; font-weight: 700; color: #667eea; }
        .user-menu { position: relative; }
        .user-button { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 10px 20px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: all 0.2s; }
        .user-button:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3); }
        .user-dropdown { position: absolute; top: 100%; right: 0; margin-top: 10px; background: white; border-radius: 12px; box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15); min-width: 180px; display: none; z-index: 1000; overflow: hidden; }
        .user-dropdown.active { display: block; animation: dropdownSlide 0.2s ease-out; }
        /* Auto-uppercase for address fields */
.uppercase-input {
    text-transform: uppercase;
}
        @media (max-width: 480px) {
            .dashboard-header { margin-bottom: 15px; padding-bottom: 12px; }
            .header-left { gap: 10px; }
            .logo-container { font-size: 22px; }
            .user-button { padding: 8px 12px; font-size: 12px; }
            .user-dropdown { min-width: 160px; }
        }
        @keyframes dropdownSlide { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .dropdown-item { 
    padding: 12px 20px; 
    cursor: pointer; 
    transition: all 0.2s; 
    display: flex; 
    align-items: center; 
    gap: 10px; 
    font-size: 14px; 
    font-weight: 500; 
    color: #333; 
}
        .dropdown-item:hover { background: #f8f9fa; color: #667eea; }
	.dropdown-separator { 
    height: 2px; 
    background: #667eea; 
    margin: 8px 0; 
}
	h1 { color: #667eea; text-align: center; margin-bottom: 10px; font-size: 2.5em; }
        h2 { color: #333; margin-bottom: 20px; font-size: 1.5em; }
        h3 { color: #667eea; margin: 20px 0 15px; font-size: 1.2em; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; color: #555; font-weight: 500; font-size: 14px; }
        input, select, textarea { width: 100%; padding: 12px 15px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 15px; transition: all 0.3s; font-family: inherit; }
        textarea { resize: vertical; min-height: 100px; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }
        /* Password visibility toggle styles */
.password-wrapper {
    position: relative;
    display: flex;
    align-items: center;
}

.password-wrapper input {
    width: 100%;
    padding-right: 45px;
}

.password-toggle-btn {
    position: absolute;
    right: 12px;
    background: none;
    border: none;
    cursor: pointer;
    font-size: 20px;
    color: #666;
    padding: 5px;
    display: flex;
    align-items: center;
    transition: color 0.3s;
    line-height: 1;
}

.password-toggle-btn:hover {
    color: #667eea;
}
	.btn { padding: 14px 24px; background: #128C7E; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
	.btn:hover { background: #0d6b5f; transform: translateY(-1px); box-shadow: 0 2px 8px rgba(18, 140, 126, 0.3); }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; background: #95a5a6; }
        .btn-full { width: 100%; }
        .btn-secondary { background: #34495e; margin-left: 10px; }
        .btn-respond { background: #128C7E; padding: 8px 16px; font-size: 14px; }
        .btn-select { background: #128C7E; padding: 8px 16px; font-size: 14px; }
        .btn-view-profile { background: #34495e; padding: 8px 16px; font-size: 14px; }
        .btn-cancel { background: #e74c3c; padding: 8px 16px; font-size: 14px; }
        .btn-edit { background: #34495e; padding: 8px 16px; font-size: 14px; color: white; }
        .btn-chat { background: #128C7E; padding: 8px 16px; font-size: 14px; }
        /* Chat button with unread badge */
.chat-btn-wrapper {
    position: relative;
    display: inline-block;
}

.chat-unread-badge {
    position: absolute;
    top: -6px;
    right: -6px;
    min-width: 18px;
    height: 18px;
    background: #dc3545;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: 700;
    color: white;
    padding: 0 5px;
    box-shadow: 0 2px 6px rgba(220, 53, 69, 0.5);
    border: 2px solid white;
    z-index: 10;
}
	.btn-complete { background: #27ae60; padding: 10px 20px; font-size: 14px; }
        .btn-contact { background: #34495e; padding: 10px 20px; font-size: 14px; }
        
        @media (max-width: 480px) {
            .btn { padding: 10px 16px; font-size: 13px; border-radius: 6px; }
            .btn-full { width: 100%; margin-top: 10px; }
            .btn-secondary { margin-left: 0; margin-top: 8px; width: 100%; }
            .btn-respond, .btn-select, .btn-view-profile, .btn-cancel, .btn-edit, .btn-chat { padding: 6px 10px; font-size: 11px; }
            .btn-complete, .btn-contact { padding: 8px 14px; font-size: 12px; }
        }
        .error { background: #fee; border: 1px solid #fcc; color: #c33; padding: 12px; border-radius: 8px; margin-bottom: 20px; font-size: 14px; }
        .success { background: #efe; border: 1px solid #cfc; color: #3c3; padding: 12px; border-radius: 8px; margin-bottom: 20px; font-size: 14px; }
        /* Success Popup Overlay */
.success-popup-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.7);
    z-index: 9999999;
    display: none;
    align-items: center;
    justify-content: center;
}

.success-popup-overlay.active {
    display: flex;
}

.success-popup-content {
    background: white;
    padding: 40px;
    border-radius: 20px;
    text-align: center;
    max-width: 400px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    animation: popupSlideIn 0.3s ease-out;
}

@keyframes popupSlideIn {
    from {
        opacity: 0;
        transform: scale(0.8) translateY(-20px);
    }
    to {
        opacity: 1;
        transform: scale(1) translateY(0);
    }
}

.success-popup-icon {
    font-size: 64px;
    margin-bottom: 20px;
}

.success-popup-title {
    font-size: 24px;
    font-weight: 700;
    color: #28a745;
    margin-bottom: 15px;
}

.success-popup-message {
    font-size: 16px;
    color: #555;
    line-height: 1.6;
}
	.info { background: #e3f2fd; border: 1px solid #90caf9; color: #1976d2; padding: 12px; border-radius: 8px; margin-bottom: 20px; font-size: 14px; }
        .hidden { display: none; }
	/* Chat View Overlay */
#chatView {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 100000;
    background: white;
}
#chatView.hidden {
    display: none;
}

	.hidden-for-unregistered { display: none !important; }
        .profile-info { background: #f5f5f5; padding: 20px; border-radius: 10px; margin-bottom: 20px; text-align: left; }
        .profile-info p { margin-bottom: 10px; color: #555; }
        .row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .checkbox-group { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; }
        .checkbox-group input { width: auto; }
        .required { color: #e74c3c; }
        .char-counter { font-size: 12px; color: #999; text-align: right; margin-top: 5px; }
        .urgency-group { display: flex; gap: 15px; flex-wrap: wrap; }
        .urgency-option { flex: 1; min-width: 150px; }
        .urgency-option input[type="radio"] { display: none; }
        .urgency-label { display: block; padding: 12px 20px; border: 2px solid #e0e0e0; border-radius: 8px; text-align: center; cursor: pointer; transition: all 0.3s; }
        .urgency-option input[type="radio"]:checked + .urgency-label { border-color: #667eea; background: #f0f4ff; font-weight: 600; }
        .urgency-label:hover { border-color: #667eea; }
        .request-card { background: white; border: 2px solid #e0e0e0; border-radius: 12px; padding: 16px; margin-bottom: 12px; transition: all 0.3s; cursor: pointer; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05); }
        .request-card:hover { box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); border-color: #667eea; transform: translateY(-2px); }
        .request-card.compact { 
    padding: 18px 20px; 
    margin-bottom: 24px; 
    background: #ffffff; 
    border: 3px solid #d0d0d0; 
    border-radius: 14px;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
}
.request-card.compact:last-child { margin-bottom: 0; }
        .request-card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
        .request-card-main { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; }
        .request-card-left { flex: 1; min-width: 200px; }
        .request-card-right { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
        /* DESKTOP LAYOUT - MY RESPONSES (applies when NOT on mobile) */
#myResponsesList .request-card-main {
    display: flex !important;
    justify-content: space-between !important;
    align-items: center !important;
    gap: 10px !important;
}

#myResponsesList .request-card-left {
    flex: 1 !important;
    min-width: 200px !important;
}

#myResponsesList .request-card-right {
    display: flex !important;
    gap: 8px !important;
    flex-wrap: wrap !important;
    align-items: center !important;
    margin-left: 20px !important;
}
/* Desktop: request-summary should display inline */
#myResponsesList .request-summary {
    display: flex !important;
    flex-wrap: wrap !important;
    gap: 8px !important;
    align-items: center !important;
}

/* Hide Button 2 (desktop button in request-card-right) on BOTH desktop and mobile */
#openRequestsList .request-card-right,
#activeRequestsList .request-card-right {
    display: none !important;
}

/* Desktop: Force button to extreme right - COMPLETE */
div#openRequestsList div.request-card-left div.request-summary:nth-of-type(1),
div#activeRequestsList div.request-card-left div.request-summary:nth-of-type(1) {
    display: flex !important;
    flex-direction: row !important;
    align-items: center !important;
    justify-content: flex-start !important;
    width: 100% !important;
    gap: 0 !important;
}

div#openRequestsList div.request-card-left div.request-summary:nth-of-type(1) > button.btn-select-mobile,
div#activeRequestsList div.request-card-left div.request-summary:nth-of-type(1) > button.btn-select-mobile {
    margin-left: auto !important;
    flex-shrink: 0 !important;
    order: 999 !important;
}
#openRequestsList .request-card-left .request-summary:nth-of-type(1) .btn-select-mobile,
#activeRequestsList .request-card-left .request-summary:nth-of-type(1) .btn-select-mobile {
    margin-left: auto !important;
    flex-shrink: 0 !important;
}
        @media (max-width: 480px) {
            .request-card.compact { 
                padding: 12px 14px; 
                margin-bottom: 16px; 
                border: 2px solid #d0d0d0;
                border-radius: 10px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            }

		/* Mobile section headers - show on mobile */
.mobile-section-header {
    display: block !important;
}
            .request-card-main { flex-direction: column; align-items: flex-start; gap: 8px; }
            .request-card-left { min-width: 100%; }
            .request-card-right { width: 100%; justify-content: space-between; gap: 6px; }
        }
        .request-title-compact { 
    font-size: 16px; 
    font-weight: 600; 
    color: #667eea; /* ðŸ‘ˆ CHANGED: Purple theme color */
    margin-bottom: 8px; 
    line-height: 1.3;
    cursor: pointer;
    padding: 8px 12px;
    border-radius: 8px;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 8px;
    margin: -8px -12px 8px -12px;
}

.request-title-compact:hover {
    background: rgba(102, 126, 234, 0.1); /* ðŸ‘ˆ CHANGED: Stronger purple background */
    color: #5568d3; /* ðŸ‘ˆ NEW: Darker purple on hover */
}

.request-title-compact:hover {
    background: rgba(102, 126, 234, 0.05);
}

.request-title-text {
    flex: 1;
}

.request-chevron {
    font-size: 14px;
    transition: transform 0.3s ease;
    color: #667eea;
    font-weight: bold;
}

.request-chevron.expanded {
    transform: rotate(180deg);
}
        /* Urgency bubble indicator */
.urgency-bubble {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    display: inline-block;
    margin-right: 8px;
    flex-shrink: 0;
}

.urgency-bubble.urgent {
    background: #dc3545;
}

.urgency-bubble.normal {
    background: #ffc107;
}

.urgency-bubble.low {
    background: #28a745;
}

/* Clickable request title */
.request-title-clickable {
    color: #667eea;
    font-weight: 600;
    cursor: pointer;
    text-decoration: none;
    transition: all 0.2s;
    display: inline-flex;
    align-items: center;
}

.request-title-clickable:hover {
    color: #5568d3;
    text-decoration: underline;
}
	.request-summary { font-size: 13px; color: #666; line-height: 1.4; }
        .request-details { margin-top: 12px; padding-top: 12px; border-top: 1px solid #f0f0f0; display: none; }
        .request-details.expanded { display: block; animation: slideDown 0.3s ease-out; }
        @keyframes slideDown { from { opacity: 0; max-height: 0; } to { opacity: 1; max-height: 500px; } }
        .expand-btn { background: none; border: none; color: #667eea; font-size: 12px; font-weight: 600; cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: all 0.2s; }
        .expand-btn:hover { background: #f0f4ff; }
        .notification-badge { background: #dc3545; color: white; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 700; display: inline-flex; align-items: center; gap: 4px; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .urgent-indicator { background: #dc3545; color: white; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 700; display: inline-flex; align-items: center; gap: 4px; }
        .info-badge { background: #17a2b8; color: white; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600; display: inline-flex; align-items: center; gap: 4px; }
        .action-btn-compact { padding: 8px 14px; font-size: 13px; border-radius: 6px; font-weight: 600; }
        .section-summary { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; margin-bottom: 16px; }
        .stat-badge { background: #f0f4ff; color: #667eea; padding: 8px 14px; border-radius: 8px; font-size: 13px; font-weight: 600; border: 1px solid #d0d9ff; }
        .request-title { font-size: 18px; font-weight: 600; color: #333; margin-bottom: 5px; }
        .request-meta { display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 15px; }
        .meta-item { font-size: 13px; color: #666; }
        .status-badge { display: inline-block; padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .status-open { background: #d4edda; color: #155724; }
        .status-in-progress { background: #cce5ff; color: #004085; }
        .status-completed { background: #d4edda; color: #155724; }
        .urgency-urgent { color: #dc3545; font-weight: 600; }
        .urgency-normal { color: #ffc107; font-weight: 600; }
        .urgency-low { color: #28a745; font-weight: 600; }
        .request-description { color: #555; margin-bottom: 15px; line-height: 1.5; }
        .request-location { font-size: 14px; color: #666; margin-bottom: 15px; }
        .request-actions { display: flex; gap: 10px; flex-wrap: wrap; }
        .response-badge { display: inline-block; background: #007bff; color: white; padding: 8px 16px; border-radius: 20px; font-size: 13px; font-weight: 600; margin-bottom: 10px; }
        .distance-badge { display: inline-block; background: #17a2b8; color: white; padding: 6px 12px; border-radius: 20px; font-size: 12px; }
        .empty-state { text-align: center; padding: 60px 20px; color: #999; }
        .empty-state-icon { font-size: 64px; margin-bottom: 20px; }
        .empty-state-text { font-size: 18px; margin-bottom: 30px; }
        .request-limit-warning { background: #fff3cd; border: 1px solid #ffc107; color: #856404; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center; font-weight: 500; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .collapsible-section { margin-bottom: 25px; }
        .section-toggle { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 12px; padding: 18px 24px; width: 100%; text-align: left; cursor: pointer; font-size: 16px; font-weight: 700; display: flex; justify-content: space-between; align-items: center; transition: all 0.3s; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3); }
        .section-toggle:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4); }
        .section-toggle:active { transform: translateY(0); }
        .section-toggle-left { display: flex; align-items: center; gap: 12px; flex: 1; }
        .section-toggle-right { 
    display: flex; 
    align-items: center; 
    gap: 8px;
    flex-wrap: nowrap;
    justify-content: flex-end;
}
        .toggle-icon { font-size: 20px; transition: transform 0.3s; }
        .toggle-icon.expanded { transform: rotate(180deg); }
        .section-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
        .section-content.expanded { max-height: 5000px; transition: max-height 0.5s ease-in; }
        .section-inner { padding: 20px 0 0 0; }
        .sub-tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
.sub-tab { 
    background: white; 
    border: 2px solid #e0e0e0; 
    color: #666; 
    padding: 14px 14px 10px 14px; 
    border-radius: 10px; 
    cursor: pointer; 
    font-weight: 600; 
    font-size: 13px; 
    transition: all 0.3s;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    flex: 1;
    min-width: 0;
    position: relative;
    justify-content: center;
    line-height: 1.4;
}

.sub-tab > span:first-child {
    line-height: 1.5;
    white-space: nowrap;
    overflow: visible;
    text-overflow: clip;
    width: 100%;
    text-align: center;
    padding-top: 2px;
}

/* Badge row container - holds count + message badges side by side */
.sub-tab-badges {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    flex-wrap: nowrap;
}

.sub-tab .count-badge {
    margin-top: 0;
}

.sub-tab .badge-container {
    margin-top: 0;
}

.sub-tab:hover { 
    border-color: #4285F4; 
    color: #4285F4; 
    transform: translateY(-2px);
    box-shadow: 0 2px 8px rgba(66, 133, 244, 0.2);
}

.sub-tab.active { 
    background: #4285F4; 
    border-color: #4285F4; 
    color: white;
    box-shadow: 0 4px 12px rgba(66, 133, 244, 0.3);
}

.sub-tab.active .count-badge {
    background: rgba(255, 255, 255, 0.3);
    color: white;
}
        .section-toggle { 
    background: linear-gradient(135deg, #4285F4 0%, #34A853 100%); 
    color: white; 
    border: none; 
    border-radius: 12px; 
    padding: 18px 24px; 
    width: 100%; 
    text-align: left; 
    cursor: pointer; 
    font-size: 16px; 
    font-weight: 700; 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    transition: all 0.3s; 
    box-shadow: 0 4px 12px rgba(66, 133, 244, 0.3); 
}

.section-toggle:hover { 
    transform: translateY(-2px); 
    box-shadow: 0 6px 16px rgba(66, 133, 244, 0.4); 
}

.count-badge { 
    background: #4285F4; 
    color: white; 
    padding: 4px 10px; 
    border-radius: 12px; 
    font-size: 11px; 
    font-weight: 700;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 24px;
    height: 24px;
    text-align: center;
    flex-shrink: 0;
}

.sub-tab .count-badge {
    background: rgba(66, 133, 244, 0.15);
    color: #4285F4;
}

.sub-tab.active .count-badge {
    background: rgba(255, 255, 255, 0.3);
    color: white;
}

/* Chat Bubble Badge Container */
.badge-container {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    position: relative;
    flex-shrink: 0;
}

/* The Chat Bubble Icon */
.chat-bubble-icon {
    width: 30px;
    height: 30px;
    background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
    border-radius: 50% 50% 50% 0;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    box-shadow: 0 2px 8px rgba(37, 211, 102, 0.4);
    flex-shrink: 0;
    transform: rotate(-45deg);
}

/* White dots inside bubble (optional decorative element) */
.chat-bubble-icon::before {
    content: 'ðŸ’¬';
    position: absolute;
    font-size: 16px;
    transform: rotate(45deg);
    filter: brightness(0) invert(1);
}

/* Red Badge (number circle) */
.unread-badge {
    position: absolute;
    top: -4px;
    right: -4px;
    min-width: 18px;
    height: 18px;
    background: #dc3545;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: 700;
    color: white;
    padding: 0 5px;
    box-shadow: 0 2px 6px rgba(220, 53, 69, 0.5);
    border: 2px solid white;
    z-index: 10;
}
	.two-column { 
    display: block; /* Changed from 'grid' to 'block' */
    margin-top: 30px; 
}
        .loading { text-align: center; padding: 40px; color: #667eea; }
        .spinner { border: 3px solid #f3f3f3; border-top: 3px solid #667eea; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .notification-count { background: #dc3545; color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .autocomplete-suggestions { position: absolute; background: white; border: 2px solid #e0e0e0; border-top: none; border-radius: 0 0 8px 8px; max-height: 200px; overflow-y: auto; z-index: 1000; display: none; box-shadow: 0 4px 12px rgba(0,0,0,0.1); width: calc(100% - 4px); margin-top: -2px; }
        .autocomplete-suggestions.active { display: block; }
        .suggestion-item { padding: 12px 15px; cursor: pointer; transition: background 0.2s; font-size: 14px; color: #333; border-bottom: 1px solid #f0f0f0; }
        .suggestion-item:last-child { border-bottom: none; }
        .suggestion-item:hover { background: #f0f4ff; color: #667eea; }
        .suggestion-item.loading { text-align: center; color: #999; font-style: italic; }
	.modal { 
    display: none; 
    position: fixed; 
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100%; 
    background: rgba(0,0,0,0.5); 
    z-index: 99999; 
    align-items: center; 
    justify-content: center; 
}
.modal.active { 
    display: flex !important; 
    visibility: visible !important;
}

/* Rating Modal - Above chat */
#ratingModal.active {
    z-index: 100001 !important;
}
        .modal-content { background: white; border-radius: 20px; padding: 30px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-title { font-size: 24px; font-weight: 600; color: #333; }
        .close-btn { background: none; border: none; font-size: 24px; cursor: pointer; color: #999; }
        .close-btn:hover { color: #333; }
        .provider-card { background: #f5f5f5; border-radius: 12px; padding: 15px; margin-bottom: 15px; }
        .provider-name { font-size: 16px; font-weight: 600; color: #333; margin-bottom: 8px; }
        .provider-info { font-size: 13px; color: #666; margin-bottom: 8px; }
        .rating-display { font-size: 14px; color: #667eea; font-weight: 600; margin-bottom: 12px; }
        .provider-actions { display: flex; gap: 10px; flex-wrap: wrap; }
        .profile-modal-content { background: white; border-radius: 12px; padding: 20px; }
        .profile-modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .profile-details { color: #555; line-height: 1.8; }
        .profile-details p { margin-bottom: 10px; }
        /* Chat Styles */
        .chat-container { display: flex; flex-direction: column; height: calc(100vh - 100px); max-height: 700px; background: #ECE5DD; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); }
        .chat-header { background: #128C7E; color: white; padding: 16px 20px; border-radius: 0; display: flex; justify-content: space-between; align-items: center; }
        .chat-header-left { flex: 1; display: flex; flex-direction: column; }
        .chat-partner-name { font-size: 18px; font-weight: 600; margin-bottom: 4px; letter-spacing: 0; }
        .chat-status { font-size: 13px; opacity: 0.9; font-weight: 400; }
        
        @media (max-width: 480px) {
            .chat-container { border-radius: 0; height: calc(100vh - 80px); }
            .chat-header { padding: 12px 16px; }
            .chat-partner-name { font-size: 16px; margin-bottom: 3px; }
            .chat-status { font-size: 12px; }
        }
        .chat-messages { flex: 1; overflow-y: auto; padding: 16px 12px; background: #ECE5DD; display: flex; flex-direction: column; gap: 8px; }
        .message { display: flex; flex-direction: column; animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .message.sent { align-items: flex-end; }
        .message.received { align-items: flex-start; }
        .message-bubble { max-width: 65%; padding: 14px 18px; border-radius: 18px; word-wrap: break-word; line-height: 1.4; font-size: 15px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06); }
        .message.sent .message-bubble { background: #DCF8C6; color: #000; border-radius: 8px 8px 0 8px; font-weight: 400; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); border: none; }
        .message.received .message-bubble { background: #FFFFFF; color: #000; border: none; border-radius: 8px 8px 8px 0; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
        .message-time { font-size: 12px; color: #999; margin-top: 6px; padding: 0 6px; }
        .message-image { max-width: 100%; max-height: 280px; border-radius: 12px; margin-top: 10px; cursor: pointer; transition: transform 0.2s; }
        .message-image:hover { transform: scale(1.02); }
        .empty-chat-state { display: flex; align-items: center; justify-content: center; height: 100%; color: #999; text-align: center; padding: 20px; }
        .empty-chat-state-icon { font-size: 48px; margin-bottom: 12px; }
        .empty-chat-state-text { font-size: 16px; color: #666; }
        
        .chat-templates { background: #f0f2f5; padding: 16px; border-top: 2px solid #e8e8e8; max-height: 220px; overflow-y: auto; }
        .template-category { margin-bottom: 12px; }
        .template-category:last-child { margin-bottom: 0; }
        .template-category-title { font-weight: 700; color: #667eea; font-size: 13px; cursor: pointer; user-select: none; padding: 10px 12px; background: white; border-radius: 8px; transition: all 0.2s; display: flex; align-items: center; justify-content: space-between; border-left: 4px solid #667eea; }
        .template-category-title:hover { background: #e9ecef; transform: translateX(2px); }
        .template-items { margin-top: 8px; margin-left: 0; display: none; padding: 0 8px; }
        .template-items.open { display: flex; flex-direction: column; gap: 6px; animation: expandDown 0.2s ease-out; }
        @keyframes expandDown { from { opacity: 0; max-height: 0; } to { opacity: 1; max-height: 500px; } }
        .template-item { padding: 10px 14px; background: white; border-radius: 8px; margin-bottom: 0; font-size: 13px; cursor: pointer; transition: all 0.2s; border-left: 3px solid transparent; color: #555; font-weight: 500; line-height: 1.3; }
        .template-item:hover { background: #667eea; color: white; border-left-color: #764ba2; transform: translateX(4px); box-shadow: 0 2px 6px rgba(102, 126, 234, 0.2); }
        
        .chat-input-area { background: #F0F0F0; padding: 12px 16px; border-top: 1px solid #ddd; border-radius: 0; }
        .privacy-notice { background: linear-gradient(135deg, #fff8e1 0%, #fffbf0 100%); padding: 14px 16px; border-radius: 10px; font-size: 13px; color: #7d5d00; margin-bottom: 16px; border-left: 4px solid #ffc107; display: none; gap: 10px; align-items: flex-start; }
.privacy-notice.show { display: flex; }
.privacy-notice strong { color: #5d4700; font-weight: 700; }
.privacy-info-icon { 
    width: 20px; 
    height: 20px; 
    border-radius: 50%; 
    background: #667eea; 
    color: white; 
    display: inline-flex; 
    align-items: center; 
    justify-content: center; 
    font-weight: 700; 
    font-size: 14px; 
    cursor: pointer; 
    margin-left: 8px; 
    transition: all 0.2s;
}
.privacy-info-icon:hover { background: #764ba2; transform: scale(1.1); }
.chat-action-buttons { display: flex; gap: 10px; margin-bottom: 16px; flex-wrap: wrap; }
        .chat-action-buttons .btn { padding: 10px 16px; font-size: 13px; font-weight: 600; border-radius: 8px; transition: all 0.2s; }
        .contact-request-card { background: linear-gradient(135deg, #fff8e1 0%, #fffbf0 100%); padding: 16px; border-radius: 12px; margin: 10px 0; border-left: 4px solid #ffc107; }
.contact-request-title { font-weight: 700; color: #5d4700; margin-bottom: 10px; font-size: 14px; }
.contact-approval-buttons { display: flex; gap: 10px; margin-top: 12px; }
.btn-approve { background: #28a745; color: white; padding: 8px 16px; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 13px; }
.btn-approve:hover { background: #218838; }
.btn-decline { background: #dc3545; color: white; padding: 8px 16px; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 13px; }
.btn-decline:hover { background: #c82333; }
.contact-status-approved { background: #d4edda; border-left-color: #28a745; color: #155724; }
.contact-status-declined { background: #f8d7da; border-left-color: #dc3545; color: #721c24; }
.contact-details-card { background: #e3f2fd; padding: 14px; border-radius: 10px; margin-top: 10px; border-left: 4px solid #2196f3; }
.contact-details-card p { margin: 6px 0; font-size: 13px; color: #0d47a1; }
	.contact-details-card p { margin: 6px 0; font-size: 13px; color: #0d47a1; }

.contact-icon-btn {
    background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 10px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s;
    margin: 15px 10px;
    box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
    width: calc(100% - 20px);
    justify-content: center;
}
.contact-icon-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(33, 150, 243, 0.4);
}
.contact-details-card.collapsed {
    display: none;
}

/* Z-INDEX HIERARCHY FIX - CORRECTED */
/* Response Modal - Base level */
#responsesModal,
.modal {
    z-index: 99999 !important;
}
/* Chat View - Above response modal */
#chatView {
    z-index: 100000 !important;
}
/* Rating Modal - Above everything including chat */
#ratingModal {
    z-index: 100001 !important;
}

/* Contact Details Modal - MUST BE ABOVE CHAT VIEW */
#contactDetailsModal {
    z-index: 100002 !important;
}

/* Profile Modal - Above chat view */
#profileModal,
.profile-modal {
    z-index: 100001 !important;
}
	.chat-input-wrapper { display: flex; gap: 8px; align-items: center; }
        .chat-input-wrapper textarea { flex: 1; min-height: 42px; max-height: 120px; padding: 10px 14px; border: none; border-radius: 21px; font-family: inherit; font-size: 15px; resize: none; background: white; transition: all 0.2s; }
        .chat-input-wrapper textarea:focus { outline: none; box-shadow: 0 0 2px rgba(0, 0, 0, 0.1); }
        .chat-input-wrapper .btn { padding: 12px 24px; font-size: 14px; font-weight: 600; border-radius: 8px; }
.file-input-label { background: #6c757d; color: white; padding: 11px 13px; border-radius: 8px; cursor: pointer; font-size: 18px; display: inline-flex; align-items: center; justify-content: center; transition: all 0.2s; min-width: 48px; }
.file-input-label:hover { background: #5a6268; transform: scale(1.05); }
.plus-button { background: #6c757d; color: white; padding: 11px 13px; border-radius: 8px; cursor: pointer; font-size: 20px; display: inline-flex; align-items: center; justify-content: center; transition: all 0.2s; min-width: 48px; border: none; }
.plus-button:hover { background: #5a6268; transform: scale(1.05); }
.template-button { display: inline-flex; }
.template-button.hide { display: none; }
.btn-send { display: none; padding: 12px; min-width: 48px; background: #128C7E; border-radius: 50%; }
.btn-send.show { display: inline-flex; align-items: center; justify-content: center; }
.btn-send:hover { background: #0d6b5f; }
        
        /* Warranty Form */
        .warranty-form { background: linear-gradient(135deg, #f0f4ff 0%, #f8f9fa 100%); padding: 18px; border-radius: 12px; margin-top: 16px; border: 2px solid #e8ecff; }
        .warranty-form h3 { margin-top: 0; margin-bottom: 16px; color: #333; font-size: 15px; font-weight: 700; }
        .warranty-options { display: flex; gap: 10px; flex-wrap: wrap; }
        .warranty-option { flex: 1; min-width: 110px; }
        .warranty-option input[type="radio"] { display: none; }
        .warranty-option label { display: block; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; text-align: center; cursor: pointer; transition: all 0.2s; font-weight: 600; font-size: 13px; color: #555; }
        .warranty-option input[type="radio"]:checked + label { border-color: #667eea; background: linear-gradient(135deg, #f0f4ff 0%, #e9ecff 100%); color: #667eea; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2); }
        .warranty-form .btn { margin-top: 16px; font-size: 14px; }
        
/* Template Modal Styles */
        .template-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 100000; align-items: center; justify-content: center; }
        .template-modal.active { display: flex; }
        .template-modal-content { background: white; border-radius: 16px; padding: 24px; width: 90%; max-width: 500px; max-height: 70vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        .template-modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .template-modal-title { font-size: 20px; font-weight: 700; color: #333; }
        .template-close-btn { background: none; border: none; font-size: 28px; cursor: pointer; color: #999; transition: color 0.2s; }
        .template-close-btn:hover { color: #333; }
        .template-categories { display: flex; flex-direction: column; gap: 16px; }
        .template-category-block { border: 1.5px solid #e8e8e8; border-radius: 12px; overflow: hidden; }
        .template-category-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 14px 16px; cursor: pointer; font-weight: 600; font-size: 14px; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; user-select: none; }
        .template-category-header:hover { background: linear-gradient(135deg, #764ba2 0%, #667eea 100%); }
        .template-category-items { display: none; background: #f9f9f9; }
        .template-category-items.open { display: flex; flex-direction: column; }
        .template-option { padding: 12px 16px; border-bottom: 1px solid #e8e8e8; cursor: pointer; transition: all 0.2s; font-size: 13px; color: #555; line-height: 1.4; }
        .template-option:last-child { border-bottom: none; }
        .template-option:hover { background: #e9ecef; color: #333; padding-left: 20px; }
        .template-button { background: #667eea; color: white; border: none; padding: 10px 14px; border-radius: 8px; cursor: pointer; font-size: 18px; display: inline-flex; align-items: center; justify-content: center; transition: all 0.2s; min-width: 44px; height: 44px; }
        .template-button:hover { background: #764ba2; transform: scale(1.05); }

/* Rating Modal Styles */
        .rating-stars { display: flex; justify-content: center; gap: 10px; margin: 20px 0; }
        .star { font-size: 48px; cursor: pointer; transition: all 0.2s; color: #ddd; user-select: none; }
        .star:hover { transform: scale(1.2); }
        .star.selected { color: #ffc107; }
        .star.hovered { color: #ffc107; }

        /* Mobile Responsive */
        @media (max-width: 768px) { 
            body { padding: 0; background: white; }
            .container { border-radius: 0; padding: 12px; box-shadow: none; }
            h1 { font-size: 1.8em; display: block; margin-bottom: 20px; }
            .logo-container { font-size: 18px; }
            .dashboard-header { margin-bottom: 20px; padding-bottom: 15px; }
            .user-button { padding: 8px 16px; font-size: 13px; }
            .row { grid-template-columns: 1fr; } 
            .two-column { grid-template-columns: 1fr; gap: 20px; }
            .section-toggle { padding: 14px 16px; font-size: 14px; border-radius: 8px; }
            .count-badge { font-size: 11px; padding: 3px 8px; }
            .request-card.compact { padding: 14px 16px; margin-bottom: 12px; }
            .request-title-compact { font-size: 15px; }
            .request-summary { font-size: 12px; }
            .request-card-right { width: 100%; justify-content: flex-start; margin-top: 10px; }
            .btn { padding: 11px 20px; font-size: 14px; }
            .action-btn-compact { padding: 8px 12px; font-size: 12px; }
            .btn-secondary { margin-left: 0; margin-top: 10px; }
            .request-actions { flex-direction: column; }
            .urgency-group { flex-direction: column; gap: 10px; }
            .urgency-option { min-width: 100%; }
            .urgency-label { padding: 14px; font-size: 14px; }
            .sub-tabs { gap: 8px; }
            .sub-tab { padding: 8px 14px; font-size: 13px; }
            .modal-content { max-width: 95%; padding: 20px; border-radius: 12px; }
            .modal-title { font-size: 18px; }
            .chat-container { height: calc(100vh - 60px); max-height: none; border-radius: 0; }
            .chat-header { padding: 14px 16px; }
            .chat-partner-name { font-size: 16px; }
            .chat-status { font-size: 12px; }
            .chat-messages { padding: 16px 12px; gap: 8px; }
            .message-bubble { max-width: 80%; padding: 10px 14px; font-size: 14px; }
            .chat-input-area { padding: 12px; }
            .chat-input-wrapper { gap: 8px; }
            .chat-input-wrapper textarea { min-height: 44px; font-size: 14px; padding: 10px 12px; }
            .chat-input-wrapper .btn { padding: 11px 20px; font-size: 14px; }
            .file-input-label { min-width: 44px; padding: 11px; }
            .template-button { min-width: 44px; height: 44px; }
            .privacy-notice { padding: 10px 12px; font-size: 12px; margin-bottom: 12px; }
            .contact-request-card { padding: 12px; font-size: 12px; }
            .contact-approval-buttons { flex-direction: column; }
            .btn-approve, .btn-decline { width: 100%; }
            .warranty-options { flex-direction: column; }
            .warranty-option { min-width: 100%; }
            .provider-card { padding: 14px; }
            .provider-actions { flex-direction: column; }
            .provider-actions .btn { width: 100%; }
            .star { font-size: 40px; }#myResponsesList .request-summary {
        display: flex !important;
        flex-wrap: wrap !important;
        gap: 8px !important;
        align-items: center !important;
    }
    
   /* MY RESPONSES - Mobile layout (mobile only) */
#myResponsesList .request-card {
    padding: 14px !important;
}

#myResponsesList .request-card-main {
    display: block !important;
}

#myResponsesList .request-title-compact {
    width: 100% !important;
    margin-bottom: 12px !important;
}

#myResponsesList .request-card-left {
    display: block !important;
}

/* MY RESPONSES: Force chat button to extreme right - STRONGEST */
div#myResponsesList div.request-card-left div.request-summary:nth-of-type(1) {
    display: flex !important;
    flex-direction: row !important;
    align-items: center !important;
    justify-content: flex-start !important;
    width: 100% !important;
    gap: 0 !important;
    margin-bottom: 8px !important;
}

/* Status badge stays left */
div#myResponsesList div.request-card-left div.request-summary:nth-of-type(1) > span.status-badge {
    flex-shrink: 1 !important;
    white-space: nowrap !important;
}

/* Chat button to extreme right - UNBREAKABLE */
div#myResponsesList div.request-card-left div.request-summary:nth-of-type(1) > div.chat-btn-wrapper,
div#myResponsesList div.request-card-left div.request-summary:nth-of-type(1) > button.btn-chat {
    margin-left: auto !important;
    flex-shrink: 0 !important;
    order: 999 !important;
}

/* Remove the spacer span if it exists (it's not needed anymore) */
#myResponsesList .request-card-left .request-summary:nth-of-type(1) > span[style*="flex"] {
    display: none !important;
}

/* Warranty badge - Row 2: Full width */
#myResponsesList .request-card-left .request-summary:nth-of-type(2) {
    display: block !important;
    margin-bottom: 8px !important;
}

/* User info - Row 3: Full width */
#myResponsesList .request-card-left .request-summary:nth-of-type(3) {
    display: block !important;
}

#myResponsesList .btn-chat {
    margin: 0 !important;
    padding: 8px 12px !important;
    white-space: nowrap !important;
    font-size: 13px !important;
}

#myResponsesList .chat-btn-wrapper {
    display: flex !important;
    align-items: center !important;
}

/* WORK OPPORTUNITIES - Mobile layout (mobile only) */
#nearbyRequestsList .request-card {
    padding: 14px !important;
}

#nearbyRequestsList .request-card-main {
    display: block !important;
}

#nearbyRequestsList .request-title-compact {
    width: 100% !important;
    margin-bottom: 12px !important;
}

#nearbyRequestsList .request-card-left {
    display: block !important;
}

/* First request-summary row (badges) - keep inline */
#nearbyRequestsList .request-card-left .request-summary:nth-of-type(1) {
    display: flex !important;
    flex-wrap: wrap !important;
    gap: 8px !important;
    align-items: center !important;
    margin-bottom: 8px !important;
}

/* Second request-summary row (user info) - full width */
#nearbyRequestsList .request-card-left .request-summary:nth-of-type(2) {
    display: block !important;
    margin-bottom: 8px !important;
}

/* Respond button - moves to Row 1, extreme right */
#nearbyRequestsList .request-card-right {
    display: block !important;
    width: 100% !important;
    margin-top: -40px !important;
    text-align: right !important;
}

#nearbyRequestsList .btn-respond {
    margin: 0 !important;
    padding: 8px 12px !important;
    white-space: nowrap !important;
    font-size: 13px !important;
}

/* OPEN REQUESTS & ACTIVE REQUESTS - Mobile layout (mobile only) */
#openRequestsList .request-card,
#activeRequestsList .request-card {
    padding: 14px !important;
}

/* MOBILE: Hide Button 2 (desktop button in request-card-right) */
#openRequestsList .request-card-right,
#activeRequestsList .request-card-right {
    display: none !important;
}

#openRequestsList .request-card-main,
#activeRequestsList .request-card-main {
    display: block !important;
}

#openRequestsList .request-title-compact,
#activeRequestsList .request-title-compact {
    width: 100% !important;
    margin-bottom: 12px !important;
}

#openRequestsList .request-card-left,
#activeRequestsList .request-card-left {
    display: block !important;
}

/* First request-summary - Row 1: Status badge ONLY */
#openRequestsList .request-card-left .request-summary:nth-of-type(1),
#activeRequestsList .request-card-left .request-summary:nth-of-type(1) {
    display: flex !important;
    align-items: center !important;
    flex-wrap: nowrap !important;
    gap: 0 !important;
    margin-bottom: 8px !important;
    width: 100% !important;
    justify-content: space-between !important;
}

/* Status badge - stays on left */
#openRequestsList .request-card-left .request-summary:nth-of-type(1) .status-badge,
#activeRequestsList .request-card-left .request-summary:nth-of-type(1) .status-badge {
    flex-shrink: 1 !important;
    white-space: nowrap !important;
}

/* Button 1 - move to extreme right on mobile */
#openRequestsList .request-card-left .request-summary:nth-of-type(1) .btn-select-mobile,
#activeRequestsList .request-card-left .request-summary:nth-of-type(1) .btn-select-mobile {
    margin-left: auto !important;
    flex-shrink: 0 !important;
}

/* Second request-summary - Row 2: Responses badge (if exists) */
#openRequestsList .request-card-left .request-summary:nth-of-type(2),
#activeRequestsList .request-card-left .request-summary:nth-of-type(2) {
    display: block !important;
    margin-bottom: 8px !important;
}

/* Third request-summary - Row 3: Warranty badge (if exists) */
#openRequestsList .request-card-left .request-summary:nth-of-type(3),
#activeRequestsList .request-card-left .request-summary:nth-of-type(3) {
    display: block !important;
    margin-bottom: 8px !important;
}

/* Fourth request-summary - Row 4: Location/timestamp */
#openRequestsList .request-card-left .request-summary:nth-of-type(4),
#activeRequestsList .request-card-left .request-summary:nth-of-type(4) {
    display: block !important;
}

/* View Responses button - extreme right */
#openRequestsList .btn-select,
#activeRequestsList .btn-select {
    margin: 0 !important;
    padding: 8px 12px !important;
    white-space: nowrap !important;
    font-size: 13px !important;
}

/* Chat button with unread badge */
#openRequestsList .chat-btn-wrapper,
#activeRequestsList .chat-btn-wrapper {
    display: inline-flex !important;
    position: relative !important;
    align-items: center !important;
    margin-left: 8px !important;
}

#openRequestsList .btn-chat,
#activeRequestsList .btn-chat {
    margin: 0 !important;
    padding: 8px 12px !important;
    white-space: nowrap !important;
    font-size: 13px !important;
}

/* Dashboard logo mobile size */
.mobile-section-header {
    display: block !important;
}	
#dashboardView > div:first-child { 
    padding: 10px 0 8px 0 !important; 
    margin-bottom: 12px !important; 
}
}
/* Language Toggle Button */
.language-toggle {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    border-radius: 25px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 600;
    color: white;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
    width: fit-content;
    margin: 0 auto;
}

.language-toggle:hover {
    background: linear-gradient(135deg, #5568d3 0%, #5a3d7a 100%);
    transform: none;
    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.5);
}


.language-toggle-track {
    width: 50px;
    height: 26px;
    background: rgba(255, 255, 255, 0.3);
    border-radius: 13px;
    position: relative;
    transition: all 0.3s ease;
}

.language-toggle-thumb {
    width: 22px;
    height: 22px;
    background: white;
    border-radius: 50%;
    position: absolute;
    top: 2px;
    left: 2px;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;
    font-weight: 700;
    color: #667eea;
}

.language-toggle.hindi .language-toggle-thumb {
    left: 26px;
}

.language-toggle-label {
    font-size: 13px;
    min-width: 45px;
}

/* Auth page language toggle (for login/signup) */
.auth-language-toggle {
    position: absolute;
    top: 20px;
    right: 20px;
    z-index: 100;
}

.auth-page-container {
    position: relative;
}

/* Mobile-responsive transactions modal */
@media (max-width: 480px) {
    #transactionsModal .transactions-summary {
        padding: 12px !important;
        gap: 8px !important;
    }
    
    #transactionsModal .transactions-summary .credit-amount {
        font-size: 28px !important;  /* Reduced from ~48px */
    }
    
    #transactionsModal .transactions-summary .credit-label {
        font-size: 11px !important;  /* Smaller label */
    }
    
    #transactionsModal .modal-header h2 {
        font-size: 16px !important;  /* Smaller title */
    }
    
    #transactionsModal .transactions-list {
        max-height: 55vh !important;  /* More space for list */
    }
}

/* Logout - Red rounded badge style (NOT full width) */
.dropdown-item[onclick*="Logout"] {
    background: transparent !important;
    display: flex !important;
    justify-content: center !important;
    align-items: center !important;
    padding: 12px 20px !important;
}

.dropdown-item[onclick*="Logout"] span {
    background: #dc3545 !important;
    color: white !important;
    padding: 8px 20px !important;
    border-radius: 20px !important;
    font-weight: 600 !important;
    display: inline-block !important;
}

.dropdown-item[onclick*="Logout"]:hover span {
    background: #c82333 !important;
}

/* Dark theme compatibility */
body.dark-theme .dropdown-item[onclick*="Logout"] {
    background: transparent !important;
}

body.dark-theme .dropdown-item[onclick*="Logout"] span {
    background: #dc3545 !important;
    color: white !important;
}

/* Status badges - Better visibility in dark theme */
body.dark-theme .status-badge {
    background: #0d6efd !important;
    color: white !important;
    font-weight: 600 !important;
    padding: 6px 12px !important;
    border-radius: 12px !important;
}

/* Specific status colors for dark theme */
body.dark-theme .status-open {
    background: #198754 !important;
    color: white !important;
}

body.dark-theme .status-in-progress {
    background: #0d6efd !important;
    color: white !important;
}

body.dark-theme .status-completed {
    background: #198754 !important;
    color: white !important;
}

/* Alternative: If your status uses different class names */
body.dark-theme span[class*="status"] {
    background: #0d6efd !important;
    color: white !important;
    font-weight: 600 !important;
}

/* Service Category Accordion Styles */
.service-category {
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  margin-bottom: 8px;
  overflow: hidden;
}

.service-category-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  background: #f9fafb;
  cursor: pointer;
  transition: background 0.2s;
}

.service-category-header:hover {
  background: #f3f4f6;
}

.service-category-header .category-icon {
  font-size: 1.5rem;
  margin-right: 12px;
}

.service-category-header .category-title {
  flex: 1;
  font-weight: 600;
  color: #1f2937;
}

.service-category-header .expand-icon {
  transition: transform 0.3s;
}

.subcategory-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 16px 10px 48px;
  border-top: 1px solid #f3f4f6;
  cursor: pointer;
  transition: background 0.2s;
}

.subcategory-item:hover {
  background: #eff6ff;
}

.subcategory-item.selected {
  background: #dbeafe;
}

.subcategory-item .subcategory-name {
  flex: 1;
  color: #374151;
}

.info-bubble {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: #3b82f6;
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  font-weight: bold;
  cursor: pointer;
  position: relative;
}

.info-bubble:hover {
  background: #2563eb;
}

.info-tooltip {
  position: fixed;
  background: #1f2937;
  color: #fff;
  padding: 10px 14px;
  border-radius: 8px;
  font-size: 12px;
  width: 220px;
  max-height: 200px;
  overflow-y: auto;
  z-index: 10000;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  display: none;
  pointer-events: none;
}

.info-bubble:hover .info-tooltip {
  display: block;
}

.info-tooltip::after {
  content: '';
  position: absolute;
  right: -6px;
  top: 50%;
  transform: translateY(-50%);
  border-width: 6px;
  border-style: solid;
  border-color: transparent transparent transparent #1f2937;
  pointer-events: none;
}

.info-tooltip ul {
  margin: 0;
  padding-left: 16px;
}

.info-tooltip li {
  margin-bottom: 4px;
}

/* Service Selection Dropdown Styles */
.service-dropdown-trigger {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid #ddd;
    border-radius: 8px;
    background: white;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 15px;
    color: #333;
    transition: all 0.3s ease;
}

.service-dropdown-trigger:hover {
    border-color: #667eea;
    background: #f8f9ff;
}

.service-dropdown-trigger.active {
    border-color: #667eea;
    background: #f0f4ff;
}

.service-dropdown-trigger .placeholder {
    color: #999;
}

.service-dropdown-trigger .selected-service {
    color: #667eea;
    font-weight: 600;
}

.service-dropdown-trigger .dropdown-arrow {
    font-size: 12px;
    color: #667eea;
    transition: transform 0.3s ease;
}

.service-dropdown-trigger.active .dropdown-arrow {
    transform: rotate(180deg);
}

/* Hide accordion by default */
#serviceAccordion {
    display: none;
    margin-top: 10px;
    max-height: 400px;
    overflow-y: auto;
    border: 2px solid #667eea;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
}

#serviceAccordion.show {
    display: block;
}

/* Category behavior when dropdown is open */
#serviceAccordion .service-category.hidden {
    display: none;
}

/* Selected state for subcategory */
.subcategory-item.selected {
    background: #667eea;
    color: white;
}

.subcategory-item.selected .subcategory-name {
    color: white;
    font-weight: 600;
}

.subcategory-item.selected .info-bubble {
    background: white;
    color: #667eea;
}

/* Provider Profile - Add Service Section */
.provider-add-service-section {
    margin-top: 20px;
    padding: 20px;
    background: #f8f9ff;
    border-radius: 10px;
    border: 2px dashed #667eea;
}

.provider-add-service-header {
    font-size: 16px;
    font-weight: 600;
    color: #667eea;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.provider-service-add-row {
    display: flex;
    gap: 10px;
    align-items: stretch;
    position: relative;
}

.provider-service-dropdown-container {
    flex: 1;
    position: relative;
}

.provider-service-dropdown-trigger {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid #ddd;
    border-radius: 8px;
    background: white;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 14px;
    color: #333;
    transition: all 0.3s ease;
    min-height: 46px;
}

.provider-service-dropdown-trigger:hover {
    border-color: #667eea;
    background: #f8f9ff;
}

.provider-service-dropdown-trigger.active {
    border-color: #667eea;
    background: #f0f4ff;
}

.provider-service-dropdown-trigger .placeholder {
    color: #999;
}

.provider-service-dropdown-trigger .selected-service {
    color: #667eea;
    font-weight: 600;
}

.provider-service-dropdown-trigger .dropdown-arrow {
    font-size: 12px;
    color: #667eea;
    transition: transform 0.3s ease;
}

.provider-service-dropdown-trigger.active .dropdown-arrow {
    transform: rotate(180deg);
}

/* Upward opening accordion */
#providerServiceAccordion {
    display: none;
    position: absolute;
    bottom: 100%;
    left: 0;
    right: 0;
    margin-bottom: 10px;
    max-height: 400px;
    overflow-y: auto;
    border: 2px solid #667eea;
    border-radius: 8px;
    background: white;
    box-shadow: 0 -4px 12px rgba(102, 126, 234, 0.15);
    z-index: 1000;
}

#providerServiceAccordion.show {
    display: block;
}

/* Category behavior when dropdown is open */
#providerServiceAccordion .service-category.hidden {
    display: none;
}

/* Selected state for subcategory in provider dropdown */
#providerServiceAccordion .subcategory-item.selected {
    background: #667eea;
    color: white;
}

#providerServiceAccordion .subcategory-item.selected .subcategory-name {
    color: white;
    font-weight: 600;
}

#providerServiceAccordion .subcategory-item.selected .info-bubble {
    background: white;
    color: #667eea;
}

.provider-add-service-btn {
    padding: 12px 24px;
    background: #667eea;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    font-size: 14px;
    white-space: nowrap;
    transition: all 0.3s ease;
    min-height: 46px;
}

.provider-add-service-btn:hover {
    background: #5568d3;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

.provider-add-service-btn:disabled {
    background: #ccc;
    cursor: not-allowed;
    transform: none;
}

/* Service Category Content - Show/Hide Logic */
.service-category-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-out;
    padding: 0;
}

/* =============================================================================
   SIGNUP SERVICE ACCORDION - Checkbox-based Multi-Select
   ============================================================================= */

/* Signup accordion container - always visible, not a dropdown */
#signupServiceAccordion {
    border: 2px solid #e5e7eb;
    border-radius: 12px;
    overflow: hidden;
    background: white;
}

/* Signup category styling */
#signupServiceAccordion .service-category {
    border-bottom: 1px solid #e5e7eb;
    margin-bottom: 0;
}

#signupServiceAccordion .service-category:last-child {
    border-bottom: none;
}

/* Signup category header */
#signupServiceAccordion .service-category-header {
    background: #f9fafb;
    padding: 14px 16px;
    cursor: pointer;
    transition: background 0.2s;
}

#signupServiceAccordion .service-category-header:hover {
    background: #f3f4f6;
}

#signupServiceAccordion .category-icon {
    font-size: 20px;
    margin-right: 12px;
}

#signupServiceAccordion .category-title {
    flex: 1;
    font-weight: 600;
    color: #1f2937;
    font-size: 15px;
}

#signupServiceAccordion .expand-icon {
    font-size: 14px;
    color: #6b7280;
    transition: transform 0.3s;
}

/* Signup category content - hidden by default */
#signupServiceAccordion .service-category-content {
    display: none;
    background: white;
    padding: 0;
}

#signupServiceAccordion .service-category.expanded .service-category-content {
    display: block;
    padding: 8px 0;
}

#signupServiceAccordion .service-category.expanded .expand-icon {
    transform: rotate(180deg);
}

/* Signup subcategory items with checkboxes */
#signupServiceAccordion .subcategory-item {
    display: flex;
    align-items: center;
    padding: 12px 16px 12px 48px;
    border-bottom: 1px solid #f3f4f6;
    cursor: pointer;
    transition: background 0.2s;
}

#signupServiceAccordion .subcategory-item:last-child {
    border-bottom: none;
}

#signupServiceAccordion .subcategory-item:hover {
    background: #f9fafb;
}

/* Checkbox styling */
#signupServiceAccordion .signup-service-checkbox {
    width: 18px;
    height: 18px;
    margin-right: 12px;
    cursor: pointer;
    flex-shrink: 0;
    accent-color: #667eea;
}

/* Subcategory name */
#signupServiceAccordion .subcategory-name {
    flex: 1;
    font-size: 14px;
    font-weight: 500;
    color: #374151;
    cursor: pointer;
    margin: 0;
}

/* Info bubble in signup accordion */
#signupServiceAccordion .info-bubble {
    width: 20px;
    height: 20px;
    background: #3b82f6;
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: bold;
    cursor: help;
    flex-shrink: 0;
    margin-left: 8px;
}

#signupServiceAccordion .info-bubble:hover {
    background: #2563eb;
}

/* Highlight selected/checked items */
#signupServiceAccordion .signup-service-checkbox:checked + label.subcategory-name {
    color: #667eea;
    font-weight: 600;
}

#signupServiceAccordion .subcategory-item:has(.signup-service-checkbox:checked) {
    background: #eff6ff;
    border-left: 3px solid #667eea;
}

/* =============================================================================
   DARK THEME - SIGNUP SERVICE ACCORDION
   ============================================================================= */

/* Dark theme: Signup accordion background */
body.dark-theme #signupServiceAccordion {
    background: #2d2d44;
    border-color: #4a4a6c;
}

body.dark-theme #signupServiceAccordion .service-category {
    border-bottom-color: #4a4a6c;
}

/* Dark theme: Category header */
body.dark-theme #signupServiceAccordion .service-category-header {
    background: #3a3a5c;
}

body.dark-theme #signupServiceAccordion .service-category-header:hover {
    background: #4a4a6c;
}

body.dark-theme #signupServiceAccordion .category-title {
    color: #ffffff !important;
}

body.dark-theme #signupServiceAccordion .category-icon,
body.dark-theme #signupServiceAccordion .expand-icon {
    color: #e0e0e0 !important;
}

/* Dark theme: Category content */
body.dark-theme #signupServiceAccordion .service-category-content {
    background: #2d2d44;
}

/* Dark theme: Subcategory items */
body.dark-theme #signupServiceAccordion .subcategory-item {
    border-bottom-color: #4a4a6c;
}

body.dark-theme #signupServiceAccordion .subcategory-item:hover {
    background: #3a3a5c;
}

body.dark-theme #signupServiceAccordion .subcategory-name {
    color: #f0f0f0 !important;
}

/* Dark theme: Checked items */
body.dark-theme #signupServiceAccordion .subcategory-item:has(.signup-service-checkbox:checked) {
    background: #1e3a5f;
    border-left-color: #667eea;
}

body.dark-theme #signupServiceAccordion .signup-service-checkbox:checked + label.subcategory-name {
    color: #93b5ff !important;
}

/* Dark theme: Info bubble - keep blue for visibility */
body.dark-theme #signupServiceAccordion .info-bubble {
    background: #3b82f6 !important;
    color: white !important;
}

.service-category.expanded .service-category-content {
    max-height: 500px;
    padding: 10px 0;
}

/* Expand icon rotation */
.service-category-header .expand-icon {
    transition: transform 0.3s ease;
}

.service-category.expanded .expand-icon {
    transform: rotate(180deg);
}

/* Make sure subcategory items are visible when category is expanded */
#providerServiceAccordion .service-category.expanded .subcategory-item {
    display: flex;
}

/* =============================================================================
   DARK THEME HINDI TEXT VISIBILITY FIXES
   Add this CSS to your existing stylesheet or in a <style> tag in index.html
   ============================================================================= */

/* Light Theme: Service dropdown should have DARK text */
.service-dropdown-trigger,
.service-dropdown-trigger.active {
    color: #333333; /* Dark text for light theme */
}

/* Dark Theme: Service dropdown should have BRIGHT text */
body.dark-theme .service-dropdown-trigger,
body.dark-theme .service-dropdown-trigger.active {
    color: #ffffff !important; /* White text for dark theme */
}

/* Light Theme: Category headers should have DARK text */
.service-category-header,
.service-category-header span {
    color: #1f2937 !important; /* Dark text for light theme */
}

.service-category-header .category-icon,
.service-category-header .expand-icon {
    color: #1f2937 !important; /* Dark icons for light theme */
}

.service-category-header .category-title {
    color: #1f2937 !important; /* Dark title for light theme */
}

/* Dark Theme: Category headers should have BRIGHT text */
body.dark-theme .service-category-header,
body.dark-theme .service-category-header span {
    color: #e8e8e8 !important; /* Light gray for category headers */
}

body.dark-theme .service-category-header .category-icon,
body.dark-theme .service-category-header .expand-icon {
    color: #ffffff !important; /* White icons for dark theme */
}

body.dark-theme .service-category-header .category-title {
    color: #ffffff !important; /* White title for dark theme */
}

/* Light Theme: Subcategory items should have DARK text */
.subcategory-item,
.subcategory-item span,
.subcategory-name {
    color: #374151 !important; /* Dark gray for subcategory text in light theme */
}

/* Dark Theme: Subcategory items should have BRIGHT text */
body.dark-theme .subcategory-item,
body.dark-theme .subcategory-item span,
body.dark-theme .subcategory-name {
    color: #f0f0f0 !important; /* Bright light gray for subcategory text in dark theme */
}

/* Info bubble - Blue background and white icon for BOTH themes */
.info-bubble {
    background-color: #3b82f6 !important; /* Blue background for both themes */
    color: #ffffff !important; /* White icon/text for both themes */
}

/* Keep the same blue in dark theme too */
body.dark-theme .info-bubble {
    background-color: #3b82f6 !important; /* Same blue in dark theme */
    color: #ffffff !important; /* White icon/text */
}

    </style>
</head>
<body>
    <div class="container">
        <h1 id="appLogo">ðŸ› ï¸ HelpBuddy</h1>
        
       <!-- Login View -->
<div id="loginView" class="hidden auth-page-container">
<!-- Language Toggle for Login Page -->
<div class="auth-language-toggle">
    <button class="language-toggle" onclick="toggleLanguage();" id="loginLangToggle">
        <span class="language-toggle-label" id="loginLangLabel">EN</span>
        <div class="language-toggle-track">
            <div class="language-toggle-thumb" id="loginLangThumb">EN</div>
        </div>
        <span class="language-toggle-label" id="loginLangAlt">à¤¹à¤¿à¤‚à¤¦à¥€</span>
    </button>
</div>
<h2 data-i18n="welcome_back">Welcome Back</h2>
    <div id="loginError" class="error hidden"></div>

    <form id="loginForm">
        <div class="form-group">
            <label><span data-i18n="email">Email</span> <span class="required">*</span></label>
            <input type="email" id="loginEmail" required>
        </div>
        <div class="form-group">
    <label><span data-i18n="password">Password</span> <span class="required">*</span></label>
    <div class="password-wrapper">
        <input type="password" id="loginPassword" required>
        <button type="button" class="password-toggle-btn" onclick="togglePasswordVisibility('loginPassword', this)">
            <span class="eye-icon">ðŸ‘ï¸â€ðŸ—¨ï¸</span>
        </button>
    </div>
</div>
        <button type="submit" class="btn btn-full"><span data-i18n="login">Login</span></button>
        <div style="text-align: center; margin-top: 20px; font-size: 14px;">
    <a href="#" onclick="showSignup(); return false;" style="color: #667eea; text-decoration: none; font-weight: 500;"><span data-i18n="sign_up_link">Sign up for new user registration</span></a>
    <span style="margin: 0 10px; color: #ccc;">|</span>
    <a href="#" onclick="openForgotPasswordModal(); return false;" style="color: #667eea; text-decoration: none; font-weight: 500;"><span data-i18n="forgot_password">Forgot Password?</span></a>
    <span style="margin: 0 10px; color: #ccc;">|</span>
    <a href="#" onclick="openGetHelpModal(); return false;" style="color: #667eea; text-decoration: none; font-weight: 500;"><span data-i18n="get_help">Get Help</span></a>
</div>
    </form>
<!-- Footer for Login Page -->
    <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #e0e0e0; text-align: center; font-size: 12px; color: #666;">
        <div style="margin-bottom: 10px;">
            <a href="#" onclick="showTerms(); return false;" style="color: #667eea; text-decoration: none; font-weight: 500;">ðŸ“œ <span data-i18n="terms_conditions">Terms & Conditions</span></a>
            <span style="margin: 0 8px; color: #ccc;">|</span>
            <a href="#" onclick="showPrivacy(); return false;" style="color: #667eea; text-decoration: none; font-weight: 500;">ðŸ”’ <span data-i18n="privacy_policy">Privacy Policy</span></a>
        </div>
        <div style="margin-bottom: 8px; color: #888;">
            ðŸ“§ Contact: <a href="mailto:helpbuddy.assist@gmail.com" style="color: #667eea; text-decoration: underline; cursor: pointer; font-weight: 500;">helpbuddy.assist@gmail.com</a>
        </div>
        <div style="color: #999;">
            Â© 2025 HelpBuddy
        </div>
    </div>
</div>

        <!-- Signup View -->
<div id="signupView" class="hidden auth-page-container">
<!-- Language Toggle for Signup Page -->
<div class="auth-language-toggle">
    <button class="language-toggle" onclick="toggleLanguage();" id="signupLangToggle">
        <span class="language-toggle-label" id="signupLangLabel">EN</span>
        <div class="language-toggle-track">
            <div class="language-toggle-thumb" id="signupLangThumb">EN</div>
        </div>
        <span class="language-toggle-label" id="signupLangAlt">à¤¹à¤¿à¤‚à¤¦à¥€</span>
    </button>
</div>
    <h2 data-i18n="create_account">Create Account</h2>    
            <div id="signupError" class="error hidden"></div>

            <div id="signupInfo" class="info hidden"></div>
            <form id="signupForm">
                <div class="form-group">
                    <label><span data-i18n="full_name">Full Name</span> <span class="required">*</span></label>
                    <input type="text" id="signupName" required>
                </div>
                <div class="form-group">
                    <label><span data-i18n="email">Email</span> <span class="required">*</span></label>
                    <input type="email" id="signupEmail" required>
                </div>
                <div class="form-group">
    <label><span data-i18n="phone_number">Phone Number</span> <span class="required">*</span></label>
    <input type="tel" id="signupPhone" pattern="[0-9]{10}" required 
       oninput="validatePhoneInput(this)">
    <div id="signupPhoneError" style="color: #dc3545; font-size: 12px; margin-top: 5px; display: none;">Enter correct number</div>
</div>
                <div class="form-group">
    <label><span data-i18n="password">Password</span> <span class="required">*</span></label>
    <div class="password-wrapper">
        <input type="password" id="signupPassword" minlength="6" required>
        <button type="button" class="password-toggle-btn" onclick="togglePasswordVisibility('signupPassword', this)">
            <span class="eye-icon">ðŸ‘ï¸â€ðŸ—¨ï¸</span>
        </button>
    </div>
</div>
                <h3>ðŸ“ <span data-i18n="address_details">Address Details</span></h3>
                <div class="form-group">
                    <label data-i18n="house_number">House Number</label>
                    <input type="text" id="houseNumber" class="uppercase-input">
                </div>
                <div class="form-group">
                    <label><span data-i18n="area_name">Area Name</span> <span class="required">*</span></label>
                    <input type="text" id="areaName" required class="uppercase-input">
                </div>
                <div class="form-group">
                    <label data-i18n="landmark">Landmark</label>
                    <input type="text" id="landmark" class="uppercase-input">
                </div>
                <div class="row">
                    <div class="form-group">
    <label><span data-i18n="city">City</span> <span class="required">*</span></label>
    <input type="text" id="city" placeholder="Type your city name..." required autocomplete="off" class="uppercase-input">
    <div id="citySuggestions" class="autocomplete-suggestions"></div>
</div>
                    <div class="form-group">
    <label><span data-i18n="state">State</span> <span class="required">*</span></label>
    <select id="state" required>
        <option value="" data-i18n="select_state">Select State/Union Territory</option>
        <option value="Andhra Pradesh">Andhra Pradesh</option>
        <option value="Arunachal Pradesh">Arunachal Pradesh</option>
        <option value="Assam">Assam</option>
        <option value="Bihar">Bihar</option>
        <option value="Chhattisgarh">Chhattisgarh</option>
        <option value="Goa">Goa</option>
        <option value="Gujarat">Gujarat</option>
        <option value="Haryana">Haryana</option>
        <option value="Himachal Pradesh">Himachal Pradesh</option>
        <option value="Jharkhand">Jharkhand</option>
        <option value="Karnataka">Karnataka</option>
        <option value="Kerala">Kerala</option>
        <option value="Madhya Pradesh">Madhya Pradesh</option>
        <option value="Maharashtra">Maharashtra</option>
        <option value="Manipur">Manipur</option>
        <option value="Meghalaya">Meghalaya</option>
        <option value="Mizoram">Mizoram</option>
        <option value="Nagaland">Nagaland</option>
        <option value="Odisha">Odisha</option>
        <option value="Punjab">Punjab</option>
        <option value="Rajasthan">Rajasthan</option>
        <option value="Sikkim">Sikkim</option>
        <option value="Tamil Nadu">Tamil Nadu</option>
        <option value="Telangana">Telangana</option>
        <option value="Tripura">Tripura</option>
        <option value="Uttar Pradesh">Uttar Pradesh</option>
        <option value="Uttarakhand">Uttarakhand</option>
        <option value="West Bengal">West Bengal</option>
        <option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
        <option value="Chandigarh">Chandigarh</option>
        <option value="Dadra and Nagar Haveli and Daman and Diu">Dadra and Nagar Haveli and Daman and Diu</option>
        <option value="National Capital Territory of Delhi">National Capital Territory of Delhi</option>
        <option value="Jammu and Kashmir">Jammu and Kashmir</option>
        <option value="Ladakh">Ladakh</option>
        <option value="Lakshadweep">Lakshadweep</option>
        <option value="Puducherry">Puducherry</option>
    </select>
</div>
                </div>
                <div class="form-group">
                    <label><span data-i18n="pin_code">PIN Code</span> <span class="required">*</span></label>
                    <input type="text" id="pinCode" pattern="[0-9]{6}" required>
                </div>
	<!-- Referral Code Field (Add AFTER PIN Code, BEFORE isProvider checkbox) -->
<div class="form-group" style="margin-top: 20px; padding: 15px; background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border-radius: 8px; border-left: 4px solid #4caf50;">
    <label style="color: #2e7d32; font-weight: 600;">ðŸŽ <span data-i18n="referral_code">Referral Code</span> <span style="font-weight: normal; color: #666;">(Optional)</span></label>
    <input type="text" id="signupReferralCode" placeholder="e.g., REF-ABC123" 
           style="text-transform: uppercase; letter-spacing: 2px; font-weight: 600; border: 2px solid #4caf50;">
    <div style="margin-top: 8px; font-size: 12px; color: #666;">
        <span data-i18n="referral_code_hint">Have a referral code? Enter it to get bonus credits!</span>
    </div>
</div>

                <div class="checkbox-group">
                    <input type="checkbox" id="isProvider" onchange="toggleProviderFieldsSignup()">
                    <label for="isProvider" style="margin: 0;"><span data-i18n="i_want_to_provide">I want to provide services</span></label>
                </div>
                
                <div id="signupProviderFields" class="hidden">
                    <h3>ðŸ”§ <span data-i18n="provider_settings">Provider Settings</span></h3>
                    <div class="form-group">
                        <label><span data-i18n="service_radius">Service Radius</span> <span class="required">*</span></label>
                        <select id="signupRadius">
                            <option value="2">2 km</option>
                            <option value="5">5 km</option>
                            <option value="10" selected>10 km</option>
                            <option value="15">15 km</option>
                            <option value="20">20 km</option>
                            <option value="30">30 km</option>
                            <option value="50">50 km</option>
                        </select>
                    </div>
                       
                    <div class="form-group">
    <label><span data-i18n="services_i_provide">Services I Provide</span> <span class="required">*</span></label>
    <input type="hidden" id="signupServicesSelected" value="">
    <div id="signupServiceAccordion" class="border rounded-lg">
        
        <!-- Electrician -->
        <div class="service-category" data-category="electrician">
            <div class="service-category-header">
                <span class="category-icon">ðŸ”Œ</span>
                <span class="category-title" data-i18n="electrician">Electrician</span>
                <span class="expand-icon">â–¼</span>
            </div>
            <div class="service-category-content">
                <div class="subcategory-item signup-service-item" data-value="electrician_installation">
                    <input type="checkbox" class="signup-service-checkbox" id="signup_electrician_installation" value="electrician_installation">
                    <label for="signup_electrician_installation" class="subcategory-name" data-i18n="elec_installation">Installation Services</label>
                    <div class="info-bubble">i
                        <div class="info-tooltip" data-i18n="elec_installation_examples">Fan installation, Light fitting, Switch/socket installation, Geyser connection, Doorbell installation, Appliance wiring</div>
                    </div>
                </div>
                <div class="subcategory-item signup-service-item" data-value="electrician_repair">
                    <input type="checkbox" class="signup-service-checkbox" id="signup_electrician_repair" value="electrician_repair">
                    <label for="signup_electrician_repair" class="subcategory-name" data-i18n="elec_repair">Repair Services</label>
                    <div class="info-bubble">i
                        <div class="info-tooltip" data-i18n="elec_repair_examples">Fan not working, Switchboard issues, Light flickering, Short circuit, MCB tripping, Power socket problems</div>
                    </div>
                </div>
                <div class="subcategory-item signup-service-item" data-value="electrician_wiring">
                    <input type="checkbox" class="signup-service-checkbox" id="signup_electrician_wiring" value="electrician_wiring">
                    <label for="signup_electrician_wiring" class="subcategory-name" data-i18n="elec_wiring">New House Wiring / Rewiring</label>
                    <div class="info-bubble">i
                        <div class="info-tooltip" data-i18n="elec_wiring_examples">Complete house wiring, Old wiring replacement, Distribution board setup, Under-construction electrical work, Adding new circuits</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Plumber -->
        <div class="service-category" data-category="plumber">
            <div class="service-category-header">
                <span class="category-icon">ðŸš°</span>
                <span class="category-title" data-i18n="plumber">Plumber</span>
                <span class="expand-icon">â–¼</span>
            </div>
            <div class="service-category-content">
                <div class="subcategory-item signup-service-item" data-value="plumber_installation">
                    <input type="checkbox" class="signup-service-checkbox" id="signup_plumber_installation" value="plumber_installation">
                    <label for="signup_plumber_installation" class="subcategory-name" data-i18n="plumb_installation">Installation Services</label>
                    <div class="info-bubble">i
                        <div class="info-tooltip" data-i18n="plumb_installation_examples">Tap/faucet installation, Bathroom fitting, Kitchen sink setup, Water tank installation, Motor/pump installation, Pipeline laying</div>
                    </div>
                </div>
                <div class="subcategory-item signup-service-item" data-value="plumber_repair">
                    <input type="checkbox" class="signup-service-checkbox" id="signup_plumber_repair" value="plumber_repair">
                    <label for="signup_plumber_repair" class="subcategory-name" data-i18n="plumb_repair">Repair Services</label>
                    <div class="info-bubble">i
                        <div class="info-tooltip" data-i18n="plumb_repair_examples">Tap leaking, Pipe leakage, Toilet flush problems, Drain blockage, Basin clogged, Water overflow issues</div>
                    </div>
                </div>
                <div class="subcategory-item signup-service-item" data-value="plumber_new_work">
                    <input type="checkbox" class="signup-service-checkbox" id="signup_plumber_new_work" value="plumber_new_work">
                    <label for="signup_plumber_new_work" class="subcategory-name" data-i18n="plumb_new_work">New House Plumbing Work</label>
                    <div class="info-bubble">i
                        <div class="info-tooltip" data-i18n="plumb_new_work_examples">Complete bathroom plumbing, Kitchen plumbing setup, Drainage system, Water supply lines, Under-construction plumbing work</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- AC Services -->
        <div class="service-category" data-category="ac_services">
            <div class="service-category-header">
                <span class="category-icon">â„ï¸</span>
                <span class="category-title" data-i18n="ac_services">AC Services</span>
                <span class="expand-icon">â–¼</span>
            </div>
            <div class="service-category-content">
                <div class="subcategory-item signup-service-item" data-value="ac_installation">
                    <input type="checkbox" class="signup-service-checkbox" id="signup_ac_installation" value="ac_installation">
                    <label for="signup_ac_installation" class="subcategory-name" data-i18n="ac_installation">AC Installation</label>
                    <div class="info-bubble">i
                        <div class="info-tooltip" data-i18n="ac_installation_examples">New AC installation, AC uninstall & reinstall, Indoor/outdoor unit mounting, Piping & drainage setup, AC shifting</div>
                    </div>
                </div>
                <div class="subcategory-item signup-service-item" data-value="ac_repair_service">
                    <input type="checkbox" class="signup-service-checkbox" id="signup_ac_repair_service" value="ac_repair_service">
                    <label for="signup_ac_repair_service" class="subcategory-name" data-i18n="ac_repair_service">AC Repair & Servicing</label>
                    <div class="info-bubble">i
                        <div class="info-tooltip" data-i18n="ac_repair_examples">AC not cooling, AC cleaning, Filter cleaning, Strange noise, Water leakage, Compressor issues</div>
                    </div>
                </div>
                <div class="subcategory-item signup-service-item" data-value="ac_gas_filling">
                    <input type="checkbox" class="signup-service-checkbox" id="signup_ac_gas_filling" value="ac_gas_filling">
                    <label for="signup_ac_gas_filling" class="subcategory-name" data-i18n="ac_gas_filling">AC Gas Filling</label>
                    <div class="info-bubble">i
                        <div class="info-tooltip" data-i18n="ac_gas_examples">Gas refilling, Low cooling due to gas, Gas leak repair, Pressure check, Cooling performance issues</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Carpenter -->
        <div class="service-category" data-category="carpenter">
            <div class="service-category-header">
                <span class="category-icon">ðŸ”¨</span>
                <span class="category-title" data-i18n="carpenter">Carpenter</span>
                <span class="expand-icon">â–¼</span>
            </div>
            <div class="service-category-content">
                <div class="subcategory-item signup-service-item" data-value="carpenter_repair">
                    <input type="checkbox" class="signup-service-checkbox" id="signup_carpenter_repair" value="carpenter_repair">
                    <label for="signup_carpenter_repair" class="subcategory-name" data-i18n="carp_repair">Furniture Repair</label>
                    <div class="info-bubble">i
                        <div class="info-tooltip" data-i18n="carp_repair_examples">Bed repair, Chair/sofa fixing, Table repair, Drawer problems, Hinge replacement, Furniture polish touch-up</div>
                    </div>
                </div>
                <div class="subcategory-item signup-service-item" data-value="carpenter_custom">
                    <input type="checkbox" class="signup-service-checkbox" id="signup_carpenter_custom" value="carpenter_custom">
                    <label for="signup_carpenter_custom" class="subcategory-name" data-i18n="carp_custom">Furniture Making (Custom Work)</label>
                    <div class="info-bubble">i
                        <div class="info-tooltip" data-i18n="carp_custom_examples">Custom wardrobe, Study table, TV unit, Shoe rack, Kitchen cabinets, Bookshelves</div>
                    </div>
                </div>
                <div class="subcategory-item signup-service-item" data-value="carpenter_door_window">
                    <input type="checkbox" class="signup-service-checkbox" id="signup_carpenter_door_window" value="carpenter_door_window">
                    <label for="signup_carpenter_door_window" class="subcategory-name" data-i18n="carp_door_window">Door & Window Work</label>
                    <div class="info-bubble">i
                        <div class="info-tooltip" data-i18n="carp_door_examples">Door installation/repair, Window frame work, Door lock fitting, Handles & latches, Sliding door tracks, Kitchen cabinet doors</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Painter -->
        <div class="service-category" data-category="painter">
            <div class="service-category-header">
                <span class="category-icon">ðŸŽ¨</span>
                <span class="category-title" data-i18n="painter">Painter</span>
                <span class="expand-icon">â–¼</span>
            </div>
            <div class="service-category-content">
                <div class="subcategory-item signup-service-item" data-value="painter_house">
                    <input type="checkbox" class="signup-service-checkbox" id="signup_painter_house" value="painter_house">
                    <label for="signup_painter_house" class="subcategory-name" data-i18n="paint_house">House / Building Painting</label>
                    <div class="info-bubble">i
                        <div class="info-tooltip" data-i18n="paint_house_examples">Room painting, Full house painting, Exterior wall painting, Ceiling painting, Balcony painting, Boundary wall painting</div>
                    </div>
                </div>
                <div class="subcategory-item signup-service-item" data-value="painter_furniture">
                    <input type="checkbox" class="signup-service-checkbox" id="signup_painter_furniture" value="painter_furniture">
                    <label for="signup_painter_furniture" class="subcategory-name" data-i18n="paint_furniture">Furniture & Wood Painting</label>
                    <div class="info-bubble">i
                        <div class="info-tooltip" data-i18n="paint_furniture_examples">Door painting, Window frames, Wooden furniture, Cupboard painting, Railing painting, Wood varnish work</div>
                    </div>
                </div>
                <div class="subcategory-item signup-service-item" data-value="painter_texture">
                    <input type="checkbox" class="signup-service-checkbox" id="signup_painter_texture" value="painter_texture">
                    <label for="signup_painter_texture" class="subcategory-name" data-i18n="paint_texture">Texture & Decorative Painting</label>
                    <div class="info-bubble">i
                        <div class="info-tooltip" data-i18n="paint_texture_examples">Textured walls, Designer finishes, Kids room designs, Stencil art, Accent walls, Special effects</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cleaner -->
        <div class="service-category" data-category="cleaner">
            <div class="service-category-header">
                <span class="category-icon">ðŸ§¹</span>
                <span class="category-title" data-i18n="cleaner">Cleaner</span>
                <span class="expand-icon">â–¼</span>
            </div>
            <div class="service-category-content">
                <div class="subcategory-item signup-service-item" data-value="cleaner_house">
                    <input type="checkbox" class="signup-service-checkbox" id="signup_cleaner_house" value="cleaner_house">
                    <label for="signup_cleaner_house" class="subcategory-name" data-i18n="clean_house">House Cleaning</label>
                    <div class="info-bubble">i
                        <div class="info-tooltip" data-i18n="clean_house_examples">Room cleaning, Kitchen deep clean, Bathroom cleaning, Floor mopping, Balcony cleaning, Full house cleaning</div>
                    </div>
                </div>
                <div class="subcategory-item signup-service-item" data-value="cleaner_upholstery">
                    <input type="checkbox" class="signup-service-checkbox" id="signup_cleaner_upholstery" value="cleaner_upholstery">
                    <label for="signup_cleaner_upholstery" class="subcategory-name" data-i18n="clean_upholstery">Sofa, Carpet & Upholstery Cleaning</label>
                    <div class="info-bubble">i
                        <div class="info-tooltip" data-i18n="clean_upholstery_examples">Sofa cleaning, Carpet shampooing, Mattress cleaning, Curtain cleaning, Chair upholstery, Fabric deep cleaning</div>
                    </div>
                </div>
                <div class="subcategory-item signup-service-item" data-value="cleaner_vehicle">
                    <input type="checkbox" class="signup-service-checkbox" id="signup_cleaner_vehicle" value="cleaner_vehicle">
                    <label for="signup_cleaner_vehicle" class="subcategory-name" data-i18n="clean_vehicle">Vehicle Cleaning</label>
                    <div class="info-bubble">i
                        <div class="info-tooltip" data-i18n="clean_vehicle_examples">Car washing, Bike cleaning, Car interior cleaning, Vehicle detailing, Dashboard cleaning, Seat shampooing</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Appliance Repair -->
        <div class="service-category" data-category="appliance_repair">
            <div class="service-category-header">
                <span class="category-icon">ðŸ”§</span>
                <span class="category-title" data-i18n="appliance_repair">Appliance Repair</span>
                <span class="expand-icon">â–¼</span>
            </div>
            <div class="service-category-content">
                <div class="subcategory-item signup-service-item" data-value="appliance_washing">
                    <input type="checkbox" class="signup-service-checkbox" id="signup_appliance_washing" value="appliance_washing">
                    <label for="signup_appliance_washing" class="subcategory-name" data-i18n="app_washing">Washing Machine</label>
                    <div class="info-bubble">i
                        <div class="info-tooltip" data-i18n="app_washing_examples">Not spinning, Water not draining, Not starting, Making noise, Door not closing, Drum problems</div>
                    </div>
                </div>
                <div class="subcategory-item signup-service-item" data-value="appliance_refrigerator">
                    <input type="checkbox" class="signup-service-checkbox" id="signup_appliance_refrigerator" value="appliance_refrigerator">
                    <label for="signup_appliance_refrigerator" class="subcategory-name" data-i18n="app_refrigerator">Refrigerator</label>
                    <div class="info-bubble">i
                        <div class="info-tooltip" data-i18n="app_refrigerator_examples">Not cooling, Freezer issues, Strange noise, Water leakage, Ice formation, Door seal problems</div>
                    </div>
                </div>
                <div class="subcategory-item signup-service-item" data-value="appliance_tv">
                    <input type="checkbox" class="signup-service-checkbox" id="signup_appliance_tv" value="appliance_tv">
                    <label for="signup_appliance_tv" class="subcategory-name" data-i18n="app_tv">TV / LED</label>
                    <div class="info-bubble">i
                        <div class="info-tooltip" data-i18n="app_tv_examples">No display, Screen flickering, No sound, Lines on screen, Remote not working, HDMI port issues</div>
                    </div>
                </div>
                <div class="subcategory-item signup-service-item" data-value="appliance_geyser">
                    <input type="checkbox" class="signup-service-checkbox" id="signup_appliance_geyser" value="appliance_geyser">
                    <label for="signup_appliance_geyser" class="subcategory-name" data-i18n="app_geyser">Geyser / Water Heater</label>
                    <div class="info-bubble">i
                        <div class="info-tooltip" data-i18n="app_geyser_examples">Not heating water, Thermostat issues, Leaking water, Gas ignition problem, Heating element fault, Pilot light issues</div>
                    </div>
                </div>
                <div class="subcategory-item signup-service-item" data-value="appliance_ro">
                    <input type="checkbox" class="signup-service-checkbox" id="signup_appliance_ro" value="appliance_ro">
                    <label for="signup_appliance_ro" class="subcategory-name" data-i18n="app_ro">RO / Water Purifier</label>
                    <div class="info-bubble">i
                        <div class="info-tooltip" data-i18n="app_ro_examples">Not purifying, Low water flow, Filter change, TDS issues, Leaking, Motor not working</div>
                    </div>
                </div>
                <div class="subcategory-item signup-service-item" data-value="appliance_microwave">
                    <input type="checkbox" class="signup-service-checkbox" id="signup_appliance_microwave" value="appliance_microwave">
                    <label for="signup_appliance_microwave" class="subcategory-name" data-i18n="app_microwave">Microwave / Oven</label>
                    <div class="info-bubble">i
                        <div class="info-tooltip" data-i18n="app_microwave_examples">Not heating, Turntable not rotating, Door latch broken, Display issues, Strange sounds, Sparking inside</div>
                    </div>
                </div>
                <div class="subcategory-item signup-service-item" data-value="appliance_other">
                    <input type="checkbox" class="signup-service-checkbox" id="signup_appliance_other" value="appliance_other">
                    <label for="signup_appliance_other" class="subcategory-name" data-i18n="app_other">Other Small Appliances</label>
                    <div class="info-bubble">i
                        <div class="info-tooltip" data-i18n="app_other_examples">Fan repair, Mixer not working, Grinder issues, Iron problems, Cooler pump, Water pump, Chimney repair</div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <small style="color: #999; font-size: 12px; margin-top: 8px; display: block;"><span data-i18n="select_at_least_one_service">* Select at least one service you provide</span></small>
</div>
                </div>

		<!-- âœ… Terms & Conditions Checkbox - ADD THIS -->
<div class="checkbox-group" style="margin-top: 30px; margin-bottom: 20px; padding: 15px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107;">
    <input type="checkbox" id="acceptTerms" required style="width: 20px !important; height: 20px !important; margin: 0 10px 0 0 !important; cursor: pointer !important; flex-shrink: 0 !important;">
    <label for="acceptTerms" style="margin: 0 !important; cursor: pointer !important; flex: 1 !important; line-height: 1.6 !important; color: #856404; font-weight: 500;">
        <span data-i18n="i_agree_to">I agree to the</span> 
        <a href="#" onclick="showTerms(); return false;" style="color: #667eea; text-decoration: underline; font-weight: 700;"><span data-i18n="terms_conditions">Terms & Conditions</span></a>
        <span data-i18n="and">and</span> 
        <a href="#" onclick="showPrivacy(); return false;" style="color: #667eea; text-decoration: underline; font-weight: 700;"><span data-i18n="privacy_policy">Privacy Policy</span></a>
        <span class="required">*</span>
    </label>
</div>
                
                <button type="submit" class="btn btn-full"><span data-i18n="sign_up">Sign Up</span></button>
                <button type="button" class="btn btn-secondary btn-full" onclick="showLogin()"><span data-i18n="back_to_login">Back to Login</span></button>
            </form>
            
            <!-- Footer for Signup Page -->
            <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #e0e0e0; text-align: center; font-size: 12px; color: #666;">
                <div style="margin-bottom: 10px;">
                    <a href="#" onclick="showTerms(); return false;" style="color: #667eea; text-decoration: none; font-weight: 500;">ðŸ“œ <span data-i18n="terms_conditions">Terms & Conditions</span></a>
                    <span style="margin: 0 8px; color: #ccc;">|</span>
                    <a href="#" onclick="showPrivacy(); return false;" style="color: #667eea; text-decoration: none; font-weight: 500;">ðŸ”’ <span data-i18n="privacy_policy">Privacy Policy</span></a>
                </div>
                <div style="margin-bottom: 8px; color: #888;">
                    ðŸ“§ <span data-i18n="contact">Contact</span>: <a href="mailto:helpbuddy.assist@gmail.com" style="color: #667eea; text-decoration: underline; cursor: pointer; font-weight: 500;">helpbuddy.assist@gmail.com</a>
                </div>
                <div style="color: #999;">
                    Â© 2025 HelpBuddy
                </div>
            </div>

        </div>

<!-- Password Reset View -->
<div id="passwordResetView" class="hidden">
    <h2>ðŸ”‘ <span data-i18n="reset_your_password">Reset Your Password</span></h2>
    <div id="passwordResetError" class="error hidden"></div>
    <div id="passwordResetInfo" class="info hidden"></div>
    
    <form id="passwordResetForm">
        <div class="form-group">
            <label><span data-i18n="new_password">New Password</span> <span class="required">*</span></label>
            <div class="password-wrapper">
                <input type="password" id="newPassword" required minlength="6" data-i18n-placeholder="enter_new_password_placeholder">
                <button type="button" class="password-toggle-btn" onclick="togglePasswordVisibility('newPassword', this)">
                    <span class="eye-icon">ðŸ‘ï¸â€ðŸ—¨ï¸</span>
                </button>
            </div>
        </div>
        
        <div class="form-group">
            <label><span data-i18n="confirm_new_password">Confirm New Password</span> <span class="required">*</span></label>
            <div class="password-wrapper">
                <input type="password" id="confirmNewPassword" required minlength="6" data-i18n-placeholder="reenter_new_password_placeholder">
                <button type="button" class="password-toggle-btn" onclick="togglePasswordVisibility('confirmNewPassword', this)">
                    <span class="eye-icon">ðŸ‘ï¸â€ðŸ—¨ï¸</span>
                </button>
            </div>
        </div>
        
        <button type="submit" class="btn btn-full" id="resetPasswordBtn">ðŸ”’ <span data-i18n="reset_password_btn">Reset Password</span></button>
    </form>
    
    <!-- Footer -->
    <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #e0e0e0; text-align: center; font-size: 12px; color: #666;">
        <div style="color: #999;">Â© 2025 HelpBuddy</div>
    </div>
</div>

<!-- Terms & Conditions View -->
<div id="termsView" class="hidden">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding: 20px 20px 0 20px;">
        <h2 style="margin: 0; color: #667eea; font-size: 24px;"><span data-i18n="terms_conditions">Terms & Conditions</span></h2>
        <button class="btn btn-secondary" onclick="closeTermsView()" style="margin: 0;">â† <span data-i18n="back">Back</span></button>
    </div>
    
    <div style="padding: 0 20px 40px 20px; max-width: 900px; margin: 0 auto;">
        <p style="color: #999; font-size: 14px; margin-bottom: 30px;"><span data-i18n="last_updated">Last Updated</span>: October 26, 2025</p>
        
        <div style="line-height: 1.8; color: #333;">
            <h3 style="color: #667eea; margin-top: 30px; margin-bottom: 15px;">1. <span data-i18n="terms_introduction">INTRODUCTION</span></h3>
            <p><span data-i18n="terms_intro_welcome">Welcome to HelpBuddy ("Platform", "Service", "we", "us", or "our"). HelpBuddy is operated by</span> <strong>Surender Singh Grewal</strong>, <span data-i18n="terms_intro_based">based in Bhiwani, Haryana, India.</span></p>
            <p><span data-i18n="terms_intro_agree">By accessing or using HelpBuddy, you agree to be bound by these Terms and Conditions ("Terms"). If you do not agree to these Terms, please do not use our Platform.</span></p>
            
            <h3 style="color: #667eea; margin-top: 30px; margin-bottom: 15px;">2. <span data-i18n="terms_definitions">DEFINITIONS</span></h3>
            <p><strong>"<span data-i18n="def_user">User</span>"</strong> <span data-i18n="def_user_desc">means any person who accesses or uses the Platform.</span></p>
            <p><strong>"<span data-i18n="def_seeker">Seeker</span>"</strong> <span data-i18n="def_seeker_desc">means a User who posts service requests.</span></p>
            <p><strong>"<span data-i18n="def_provider">Provider</span>"</strong> <span data-i18n="def_provider_desc">means a User who responds to service requests and offers services.</span></p>
            <p><strong>"<span data-i18n="def_service_request">Service Request</span>"</strong> <span data-i18n="def_service_request_desc">means a request for services posted by a Seeker on the Platform.</span></p>
            
            <h3 style="color: #667eea; margin-top: 30px; margin-bottom: 15px;">3. <span data-i18n="terms_platform_role">PLATFORM ROLE AND LIMITATIONS</span></h3>
            <p><strong><span data-i18n="terms_intermediary_status">3.1 Intermediary Status:</span></strong> <span data-i18n="terms_intermediary_desc">HelpBuddy is ONLY a connection platform. We:</span></p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>âŒ <span data-i18n="terms_not_employ">Do NOT employ service providers</span></li>
                <li>âŒ <span data-i18n="terms_not_guarantee">Do NOT guarantee service quality, timeliness, or completion</span></li>
                <li>âŒ <span data-i18n="terms_not_payments">Do NOT handle payments between Seekers and Providers</span></li>
                <li>âŒ <span data-i18n="terms_not_verify">Do NOT verify credentials, licenses, or qualifications of Providers</span></li>
                <li>âŒ <span data-i18n="terms_not_background">Do NOT perform background checks on Users</span></li>
                <li>âŒ <span data-i18n="terms_not_disputes">Are NOT responsible for disputes between Users</span></li>
            </ul>
            
            <p><strong><span data-i18n="terms_no_liability">3.2 No Liability:</span></strong> <span data-i18n="terms_no_liability_desc">We are not liable for any loss, damage, injury, or dispute arising from services arranged through our Platform. All transactions and interactions are solely between Seekers and Providers.</span></p>
            
                        <h3 style="color: #667eea; margin-top: 30px; margin-bottom: 15px;">4. <span data-i18n="terms_user_responsibilities">USER RESPONSIBILITIES</span></h3>
            <p><strong><span data-i18n="terms_for_all_users">4.1 For All Users:</span></strong></p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>âœ… <span data-i18n="terms_must_be_18">You must be at least 18 years old to use this Platform</span></li>
                <li>âœ… <span data-i18n="terms_provide_accurate">You must provide accurate and truthful information</span></li>
                <li>âœ… <span data-i18n="terms_account_security">You are responsible for maintaining account security</span></li>
                <li>âœ… <span data-i18n="terms_comply_laws">You must comply with all applicable laws and regulations</span></li>
                <li>âœ… <span data-i18n="terms_no_illegal">You must not misuse the Platform for illegal activities</span></li>
            </ul>
            
            <p><strong><span data-i18n="terms_for_seekers">4.2 For Seekers:</span></strong></p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>âœ… <span data-i18n="terms_seeker_verify">YOU are responsible for verifying Provider credentials and qualifications</span></li>
                <li>âœ… <span data-i18n="terms_seeker_negotiate">YOU are responsible for negotiating prices and payment terms</span></li>
                <li>âœ… <span data-i18n="terms_seeker_inspect">YOU are responsible for inspecting completed work</span></li>
                <li>âœ… <span data-i18n="terms_seeker_resolve">YOU must resolve disputes directly with Providers</span></li>
            </ul>
            
            <p><strong><span data-i18n="terms_for_providers">4.3 For Providers:</span></strong></p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>âœ… <span data-i18n="terms_provider_contractor">YOU confirm you are an independent contractor, NOT our employee</span></li>
                <li>âœ… <span data-i18n="terms_provider_insurance">YOU are responsible for your own insurance, licenses, and permits</span></li>
                <li>âœ… <span data-i18n="terms_provider_quality">YOU are responsible for work quality and customer satisfaction</span></li>
                <li>âœ… <span data-i18n="terms_provider_warranty">YOU must honor any warranties you offer to Seekers</span></li>
                <li>âœ… <span data-i18n="terms_provider_taxes">YOU are responsible for your own taxes and legal compliance</span></li>
            </ul>
            
            <h3 style="color: #667eea; margin-top: 30px; margin-bottom: 15px;">5. <span data-i18n="terms_payment">PAYMENT AND PRICING</span></h3>
            <p><strong>5.1 Direct Payment:</strong> All payments are made directly between Seekers and Providers. HelpBuddy does NOT process, hold, or facilitate payments.</p>
            <p><strong>5.2 Platform Usage:</strong> HelpBuddy is currently FREE to use for both Seekers and Providers. We reserve the right to introduce paid features in the future with advance notice.</p>
            <p><strong>5.3 Pricing Disputes:</strong> Any disputes regarding pricing, payments, or refunds must be resolved directly between Seeker and Provider. We are not involved in payment disputes.</p>
            
            <h3 style="color: #667eea; margin-top: 30px; margin-bottom: 15px;">6. <span data-i18n="terms_prohibited">PROHIBITED CONDUCT</span></h3>
            <p>Users must NOT:</p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>âŒ Post false, misleading, or fraudulent information</li>
                <li>âŒ Harass, threaten, or abuse other Users</li>
                <li>âŒ Share inappropriate or offensive content</li>
                <li>âŒ Attempt to bypass Platform features or security measures</li>
                <li>âŒ Use the Platform for any illegal activities</li>
                <li>âŒ Spam or send unsolicited commercial messages</li>
                <li>âŒ Create multiple accounts to manipulate the system</li>
            </ul>
            
            <h3 style="color: #667eea; margin-top: 30px; margin-bottom: 15px;">7. <span data-i18n="terms_content">CONTENT AND INTELLECTUAL PROPERTY</span></h3>
            <p><strong>7.1 Your Content:</strong> You retain ownership of content you post (service requests, messages, reviews). By posting, you grant us a license to display and distribute your content on the Platform.</p>
            <p><strong>7.2 Our Content:</strong> The HelpBuddy name, logo, design, and Platform features are our intellectual property. You may not copy, modify, or reproduce them without permission.</p>
            
            <h3 style="color: #667eea; margin-top: 30px; margin-bottom: 15px;">8. <span data-i18n="terms_privacy_data">PRIVACY AND DATA PROTECTION</span></h3>
            <p>Your use of HelpBuddy is also governed by our Privacy Policy. By using the Platform, you consent to our collection and use of your data as described in the Privacy Policy.</p>
            <p>We comply with the Information Technology Act, 2000 and related Indian data protection laws.</p>
            
            <h3 style="color: #667eea; margin-top: 30px; margin-bottom: 15px;">9. <span data-i18n="terms_termination">ACCOUNT TERMINATION</span></h3>
            <p><strong>9.1 By You:</strong> You may delete your account at any time through the Platform settings.</p>
            <p><strong>9.2 By Us:</strong> We reserve the right to suspend or terminate your account if you:</p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>Violate these Terms</li>
                <li>Engage in fraudulent or illegal activities</li>
                <li>Receive multiple complaints from other Users</li>
                <li>Abuse or misuse the Platform</li>
            </ul>
            
            <h3 style="color: #667eea; margin-top: 30px; margin-bottom: 15px;">10. <span data-i18n="terms_liability">LIMITATION OF LIABILITY</span></h3>
            <p><strong><span data-i18n="important">IMPORTANT</span>:</strong> To the maximum extent permitted by law:</p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>HelpBuddy provides the Platform "AS IS" without warranties of any kind</li>
                <li>We are NOT liable for any damages arising from your use of the Platform</li>
                <li>Our total liability to you shall not exceed â‚¹10,000 (Ten Thousand Rupees)</li>
                <li>We are NOT liable for Provider conduct, service quality, or disputes</li>
                <li>We are NOT liable for any property damage, injury, or financial loss</li>
            </ul>
            
            <h3 style="color: #667eea; margin-top: 30px; margin-bottom: 15px;">11. <span data-i18n="terms_dispute">DISPUTE RESOLUTION</span></h3>
            <p><strong>11.1 User Disputes:</strong> Disputes between Seekers and Providers must be resolved directly between the parties. We may provide contact information but do not mediate disputes.</p>
            <p><strong>11.2 Disputes with Platform:</strong> Any disputes with HelpBuddy shall be resolved through arbitration in Bhiwani, Haryana, India, in accordance with the Arbitration and Conciliation Act, 1996.</p>
            
            <h3 style="color: #667eea; margin-top: 30px; margin-bottom: 15px;">12. <span data-i18n="terms_governing_law">GOVERNING LAW</span></h3>
            <p>These Terms are governed by the laws of India. The courts of Bhiwani, Haryana shall have exclusive jurisdiction over any disputes.</p>
            
            <h3 style="color: #667eea; margin-top: 30px; margin-bottom: 15px;">13. <span data-i18n="terms_changes">CHANGES TO TERMS</span></h3>
            <p>We reserve the right to modify these Terms at any time. Changes will be posted on this page with an updated "Last Updated" date. Your continued use of the Platform after changes constitutes acceptance of the new Terms.</p>
            
            <h3 style="color: #667eea; margin-top: 30px; margin-bottom: 15px;">14. <span data-i18n="terms_contact">CONTACT INFORMATION</span></h3>
            <p>For questions or concerns about these Terms, contact us at:</p>
            <p><strong><span data-i18n="email">Email</span>:</strong> helpbuddy.support@gmail.com</p>
            <p><strong><span data-i18n="location">Location</span>:</strong> Bhiwani, Haryana, India</p>
            
            <h3 style="color: #667eea; margin-top: 30px; margin-bottom: 15px;">15. <span data-i18n="terms_severability">SEVERABILITY</span></h3>
            <p>If any provision of these Terms is found to be invalid or unenforceable, the remaining provisions shall continue in full force and effect.</p>
            
            <h3 style="color: #667eea; margin-top: 30px; margin-bottom: 15px;">16. <span data-i18n="terms_acknowledgment">ACKNOWLEDGMENT</span></h3>
            <p>By using HelpBuddy, you acknowledge that you have read, understood, and agree to be bound by these Terms and Conditions.</p>
            
            <div style="background: #f0f4ff; padding: 20px; border-radius: 10px; margin-top: 40px; border-left: 4px solid #667eea;">
                <p style="margin: 0; font-weight: 600; color: #333;">âš ï¸ <span data-i18n="important_reminder">IMPORTANT REMINDER</span>:</p>
                <p style="margin: 10px 0 0 0; color: #555;"><span data-i18n="terms_reminder_text">HelpBuddy is a connection platform ONLY. We do not employ service providers, guarantee service quality, or handle payments. You are responsible for verifying credentials, negotiating terms, and resolving disputes directly with other users.</span></p>
            </div>
        </div>
    </div>
</div>

<!-- Privacy Policy View -->
<div id="privacyView" class="hidden">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding: 20px 20px 0 20px;">
        <h2 style="margin: 0; color: #667eea; font-size: 24px;"><span data-i18n="privacy_policy">Privacy Policy</span></h2>
        <button class="btn btn-secondary" onclick="closePrivacyView()" style="margin: 0;">â† <span data-i18n="back">Back</span></button>
    </div>
    
    <div style="padding: 0 20px 40px 20px; max-width: 900px; margin: 0 auto;">
        <p style="color: #999; font-size: 14px; margin-bottom: 30px;"><span data-i18n="last_updated">Last Updated</span>: October 26, 2025</p>
        
        <div style="line-height: 1.8; color: #333;">
            <h3 style="color: #667eea; margin-top: 30px; margin-bottom: 15px;">1. <span data-i18n="privacy_introduction">INTRODUCTION</span></h3>
            <p>Welcome to HelpBuddy's Privacy Policy. This policy describes how <strong>Surender Singh Grewal</strong> ("we", "us", "our") collects, uses, stores, and protects your personal information when you use the HelpBuddy platform.</p>
            <p>We are committed to protecting your privacy and handling your data in an open and transparent manner. This Privacy Policy complies with the Information Technology Act, 2000 and related Indian data protection laws.</p>
            <p><strong>By using HelpBuddy, you consent to the data practices described in this policy.</strong></p>
            
            <h3 style="color: #667eea; margin-top: 30px; margin-bottom: 15px;">2. <span data-i18n="privacy_info_collect">INFORMATION WE COLLECT</span></h3>
            <p><strong>2.1 Information You Provide Directly:</strong></p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>âœ… <strong>Account Information:</strong> Name, email address, phone number, password</li>
                <li>âœ… <strong>Profile Information:</strong> Profile photo, address (house number, area, landmark, city, state, PIN code)</li>
                <li>âœ… <strong>Service Information:</strong> Services you provide (if you're a provider), service radius, service requests you post</li>
                <li>âœ… <strong>Communication Data:</strong> Messages, photos, and other content you share through our chat system</li>
                <li>âœ… <strong>Feedback:</strong> Ratings, reviews, and feedback you provide about other users or the platform</li>
            </ul>
            
            <p><strong>2.2 Information Collected Automatically:</strong></p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>ðŸ“ <strong>Location Data:</strong> GPS coordinates derived from your address for matching you with nearby service requests</li>
                <li>ðŸ•’ <strong>Usage Data:</strong> How you interact with the platform (timestamps, features used)</li>
                <li>ðŸ’» <strong>Device Information:</strong> Browser type, device type, IP address</li>
            </ul>
            
            <h3 style="color: #667eea; margin-top: 30px; margin-bottom: 15px;">3. <span data-i18n="privacy_how_use">HOW WE USE YOUR INFORMATION</span></h3>
            <p>We use your information for the following purposes:</p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>âœ… <strong>Platform Functionality:</strong> To create and manage your account, match seekers with providers, enable communication</li>
                <li>âœ… <strong>Service Delivery:</strong> To show your service requests to nearby providers, display your responses to seekers</li>
                <li>âœ… <strong>Communication:</strong> To send you notifications about responses, messages, and platform updates</li>
                <li>âœ… <strong>Safety & Security:</strong> To prevent fraud, abuse, and maintain platform integrity</li>
                <li>âœ… <strong>Improvement:</strong> To analyze usage patterns and improve our services</li>
                <li>âœ… <strong>Legal Compliance:</strong> To comply with legal obligations and enforce our Terms & Conditions</li>
            </ul>
            
            <h3 style="color: #667eea; margin-top: 30px; margin-bottom: 15px;">4. <span data-i18n="privacy_how_share">HOW WE SHARE YOUR INFORMATION</span></h3>
            <p><strong>4.1 With Other Users:</strong></p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>ðŸ“‹ <strong>Service Requests:</strong> Your name, general location (city/area), and request details are visible to providers in your area</li>
                <li>ðŸ‘¤ <strong>Provider Profiles:</strong> Your name, services offered, ratings, and general location are visible to seekers</li>
                <li>ðŸ”’ <strong>Contact Information:</strong> Your phone number and full address are ONLY shared after BOTH parties explicitly approve contact sharing</li>
                <li>ðŸ’¬ <strong>Chat Messages:</strong> Only visible to the parties involved in that specific conversation</li>
            </ul>
            
            <p><strong>4.2 We Do NOT Sell Your Data:</strong></p>
            <p>We do not sell, rent, or trade your personal information to third parties for marketing purposes.</p>
            
            <p><strong>4.3 Legal Requirements:</strong></p>
            <p>We may disclose your information if required by law, court order, or government authority, or to protect our rights, safety, or property.</p>
            
            <h3 style="color: #667eea; margin-top: 30px; margin-bottom: 15px;">5. <span data-i18n="privacy_storage">DATA STORAGE AND SECURITY</span></h3>
            <p><strong>5.1 Where We Store Your Data:</strong></p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>ðŸ—„ï¸ Your data is stored securely on Supabase cloud servers</li>
                <li>ðŸŒ Data may be stored outside India but is protected by international security standards</li>
                <li>ðŸ“¸ Profile photos are stored as Base64-encoded data in our database</li>
            </ul>
            
            <p><strong>5.2 Security Measures:</strong></p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>ðŸ” Passwords are encrypted and never stored in plain text</li>
                <li>ðŸ”’ Secure HTTPS connection for all data transmission</li>
                <li>ðŸ›¡ï¸ Access controls to limit who can view your data</li>
                <li>âš ï¸ However, no system is 100% secure. We cannot guarantee absolute security of your data</li>
            </ul>
            
            <h3 style="color: #667eea; margin-top: 30px; margin-bottom: 15px;">6. <span data-i18n="privacy_retention">DATA RETENTION</span></h3>
            <p><strong>How Long We Keep Your Data:</strong></p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>âœ… <strong>Active Accounts:</strong> We retain your data as long as your account is active</li>
                <li>âœ… <strong>Service History:</strong> Request history, chat logs, and ratings are retained for platform integrity and dispute resolution</li>
                <li>âœ… <strong>Deleted Accounts:</strong> When you delete your account, we remove your personal information within 90 days, except data required for legal compliance</li>
            </ul>
            
            <h3 style="color: #667eea; margin-top: 30px; margin-bottom: 15px;">7. <span data-i18n="privacy_your_rights">YOUR RIGHTS AND CHOICES</span></h3>
            <p>You have the following rights regarding your data:</p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>ðŸ‘ï¸ <strong>Access:</strong> You can view and edit your profile information at any time</li>
                <li>âœï¸ <strong>Correction:</strong> You can update incorrect information through your profile settings</li>
                <li>ðŸ—‘ï¸ <strong>Deletion:</strong> You can delete your account at any time (contact us at helpbuddy.support@gmail.com)</li>
                <li>ðŸš« <strong>Restriction:</strong> You can stop providing services or hide your profile from searches</li>
                <li>ðŸ“¤ <strong>Data Portability:</strong> You can request a copy of your data by contacting us</li>
            </ul>
            
            <h3 style="color: #667eea; margin-top: 30px; margin-bottom: 15px;">8. <span data-i18n="privacy_cookies">COOKIES AND TRACKING</span></h3>
            <p><strong>8.1 What We Use:</strong></p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>ðŸª We use browser storage (session storage) to keep you logged in</li>
                <li>ðŸ“Š We do NOT use third-party tracking cookies or analytics at this time</li>
                <li>ðŸ”’ No advertising cookies or remarketing pixels</li>
            </ul>
            
            <h3 style="color: #667eea; margin-top: 30px; margin-bottom: 15px;">9. <span data-i18n="privacy_children">CHILDREN'S PRIVACY</span></h3>
            <p>HelpBuddy is NOT intended for users under 18 years of age. We do not knowingly collect information from children under 18. If we discover that a child under 18 has provided us with personal information, we will delete it immediately.</p>
            
            <h3 style="color: #667eea; margin-top: 30px; margin-bottom: 15px;">10. <span data-i18n="privacy_third_party">THIRD-PARTY SERVICES</span></h3>
            <p><strong>Services We Use:</strong></p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>ðŸ—„ï¸ <strong>Supabase:</strong> For database and authentication (subject to their privacy policy)</li>
                <li>ðŸ—ºï¸ <strong>OpenStreetMap Nominatim:</strong> For geocoding addresses (subject to their terms)</li>
            </ul>
            <p>These third-party services have their own privacy policies. We encourage you to review them.</p>
            
            <h3 style="color: #667eea; margin-top: 30px; margin-bottom: 15px;">11. <span data-i18n="privacy_changes">CHANGES TO THIS PRIVACY POLICY</span></h3>
            <p>We may update this Privacy Policy from time to time. Changes will be posted on this page with an updated "Last Updated" date. Significant changes will be notified through the platform or via email.</p>
            <p><strong>Your continued use of HelpBuddy after changes constitutes acceptance of the updated policy.</strong></p>
            
            <h3 style="color: #667eea; margin-top: 30px; margin-bottom: 15px;">12. <span data-i18n="privacy_legal">LEGAL COMPLIANCE</span></h3>
            <p>This Privacy Policy complies with:</p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>ðŸ“œ Information Technology Act, 2000</li>
                <li>ðŸ“œ Information Technology (Reasonable Security Practices and Procedures and Sensitive Personal Data or Information) Rules, 2011</li>
                <li>ðŸ“œ Other applicable Indian data protection laws</li>
            </ul>
            
            <h3 style="color: #667eea; margin-top: 30px; margin-bottom: 15px;">13. <span data-i18n="privacy_contact">CONTACT US</span></h3>
            <p>If you have questions, concerns, or requests regarding your privacy or this policy, please contact us at:</p>
            <p><strong>ðŸ“§ <span data-i18n="email">Email</span>:</strong> helpbuddy.support@gmail.com</p>
            <p><strong>ðŸ“ <span data-i18n="location">Location</span>:</strong> Bhiwani, Haryana, India</p>
            <p><strong>ðŸ‘¤ <span data-i18n="data_controller">Data Controller</span>:</strong> Surender Singh Grewal</p>
            
            <h3 style="color: #667eea; margin-top: 30px; margin-bottom: 15px;">14. <span data-i18n="privacy_grievance">GRIEVANCE OFFICER</span></h3>
            <p>In accordance with the Information Technology Act, 2000, if you have any grievances related to privacy:</p>
            <p><strong><span data-i18n="contact">Contact</span>:</strong> Surender Singh Grewal</p>
            <p><strong><span data-i18n="email">Email</span>:</strong> helpbuddy.support@gmail.com</p>
            <p><strong><span data-i18n="response_time">Response Time</span>:</strong> We aim to respond to all privacy concerns within 30 days</p>
            
            <div style="background: #f0f4ff; padding: 20px; border-radius: 10px; margin-top: 40px; border-left: 4px solid #667eea;">
                <p style="margin: 0; font-weight: 600; color: #333;">ðŸ”’ <span data-i18n="your_privacy_matters">YOUR PRIVACY MATTERS</span></p>
                <p style="margin: 10px 0 0 0; color: #555;"><span data-i18n="privacy_matters_text">We are committed to protecting your privacy and being transparent about how we use your data. Your trust is important to us, and we work hard to maintain it.</span></p>
            </div>
        </div>
    </div>
</div>

        <!-- Dashboard View -->
<div id="dashboardView" class="hidden">
<!-- App Logo Header (Dashboard Only) -->
<div id="dashboardHeader" style="text-align: center; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
    <h1 style="margin: 0; color: white; font-size: 28px; font-weight: bold;">
        ðŸ› ï¸ HelpBuddy
    </h1>
</div>
    <!-- Row 2: Create Request (LEFT) + User Profile (MIDDLE) + Profile Photo/Back (RIGHT) -->
<div id="dashboardHeader" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding: 20px 20px 0 20px;">
    <!-- LEFT: Toggle Button + Language Button + Create Request Button -->
    <div style="display: flex; align-items: center; gap: 15px;">
        <button id="modeToggleBtn" class="btn" onclick="toggleDashboardMode()" style="margin: 0; display: flex; align-items: center; gap: 8px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            <span id="modeToggleIcon">ðŸ”§</span>
            <span id="modeToggleText">Provider</span>
            <span style="opacity: 0.7;">â†”ï¸</span>
        </button>
    </div>
    
    <!-- MIDDLE: User Profile (for dashboard) -->
    <div class="user-menu" style="display: flex; align-items: center; gap: 12px;">
        <img id="headerUserPhoto" src="" alt="Profile" style="width: 50px; height: 50px; border-radius: 50%; object-fit: cover; border: 3px solid #667eea; display: none; cursor: pointer;" onclick="if(this.src) openImagePreview(this.src)">
        <div id="headerUserPhotoPlaceholder" style="width: 50px; height: 50px; border-radius: 50%; background: rgba(102, 126, 234, 0.2); display: flex; align-items: center; justify-content: center; font-size: 28px; border: 2px solid #667eea;">ðŸ‘¤</div>
        <button class="user-button" onclick="toggleUserDropdown()">
            <span id="headerUsername">User</span>
            <span>â–¼</span>
        </button>
<div class="user-dropdown" id="userDropdown">
    <!-- Group 1: Language Toggle (Top) -->
    <div class="dropdown-item language-toggle" onclick="toggleLanguage(); event.stopPropagation();">
        <span class="language-label" id="dropdownLangLabel">EN</span>
        <div class="language-toggle-track" id="dropdownLangTrack">
            <div class="language-toggle-thumb" id="dropdownLangThumb"></div>
        </div>
        <span class="language-label" id="dropdownLangLabelHi">à¤¹à¤¿</span>
    </div>
   
    <!-- Theme Toggle -->
<div style="display: flex; align-items: center; gap: 8px; padding: 8px 20px; justify-content: center;">
    â˜€ï¸
    <label style="position: relative; width: 44px; height: 22px;">
        <input type="checkbox" id="themeToggle" onchange="toggleTheme()" style="opacity: 0; width: 0; height: 0;">
        <span style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; border-radius: 22px; transition: 0.3s;"></span>
    </label>
    ðŸŒ™
</div>

    <div class="dropdown-separator"></div>
    
    <!-- Group 2: Account & Actions -->
    <div class="dropdown-item" onclick="showEditProfile(); toggleUserDropdown();">
        ðŸ‘¤ <span data-i18n="profile">Profile</span>
    </div>
    <div class="dropdown-item" onclick="openReferralModal(); toggleUserDropdown();">
        ðŸŽ <span data-i18n="refer_and_earn">Refer & Earn</span>
    </div>
    <div class="dropdown-item" onclick="showTransactionsModal(); toggleUserDropdown();">
        ðŸ’³ <span data-i18n="transactions">Transactions</span>
    </div>
    <div class="dropdown-item" onclick="openGetHelpModalForLoggedInUser(); toggleUserDropdown();">
        â“ <span data-i18n="need_help">Need Help</span>
    </div>
    <div class="dropdown-separator"></div>
    
    <!-- Group 3: Legal & Feedback -->
    <div class="dropdown-item" onclick="showTermsFromDropdown(); toggleUserDropdown();">
        ðŸ“œ <span data-i18n="terms_conditions">Terms & Conditions</span>
    </div>
    <div class="dropdown-item" onclick="showPrivacyFromDropdown(); toggleUserDropdown();">
        ðŸ”’ <span data-i18n="privacy_policy">Privacy Policy</span>
    </div>
    <div class="dropdown-item" onclick="openFeedbackModal(); toggleUserDropdown();">
        ðŸ’¬ <span data-i18n="send_feedback">Send Feedback</span>
    </div>
    <div class="dropdown-separator"></div>
    
    <!-- Group 4: Exit -->
    <div class="dropdown-item" onclick="handleLogout()">
        ðŸšª <span data-i18n="logout">Logout</span>
    </div>
</div>

    </div>

<!-- Refer & Earn Modal -->
<div id="referralModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; display: none; align-items: center; justify-content: center;">
    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; max-width: 450px; width: 90%; padding: 25px; color: white; box-shadow: 0 20px 60px rgba(0,0,0,0.3); position: relative;">
        <!-- Close Button -->
        <button onclick="closeReferralModal()" style="position: absolute; top: 15px; right: 15px; background: rgba(255,255,255,0.2); border: none; color: white; width: 32px; height: 32px; border-radius: 50%; font-size: 18px; cursor: pointer;">âœ•</button>
        
        <h3 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px; color: white; font-size: 22px;">
            ðŸŽ <span data-i18n="refer_and_earn">Refer & Earn</span>
        </h3>
        
        <!-- Your Referral Code -->
        <div style="background: rgba(255,255,255,0.15); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
            <div style="font-size: 12px; opacity: 0.9; margin-bottom: 5px;" data-i18n="your_referral_code">Your Referral Code</div>
            <div style="display: flex; align-items: center; gap: 10px;">
                <span id="modalReferralCode" style="font-size: 24px; font-weight: 700; letter-spacing: 3px;">---</span>
                <button type="button" onclick="copyReferralCode()" style="background: white; color: #667eea; border: none; padding: 8px 15px; border-radius: 8px; font-weight: 600; cursor: pointer;">ðŸ“‹ Copy</button>
                <button type="button" onclick="shareReferralCode()" style="background: #25D366; color: white; border: none; padding: 8px 15px; border-radius: 8px; font-weight: 600; cursor: pointer;">ðŸ“¤ Share</button>
            </div>
        </div>
        
        <!-- Referral Stats -->
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 15px;">
            <div style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px; text-align: center;">
                <div style="font-size: 24px; font-weight: 700;" id="modalTotalReferrals">0</div>
                <div style="font-size: 11px; opacity: 0.9;" data-i18n="total_referrals">Total Referrals</div>
            </div>
            <div style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px; text-align: center;">
                <div style="font-size: 24px; font-weight: 700;" id="modalVerifiedReferrals">0</div>
                <div style="font-size: 11px; opacity: 0.9;" data-i18n="verified">Verified</div>
            </div>
            <div style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px; text-align: center;">
                <div style="font-size: 24px; font-weight: 700;" id="modalReferralCredits">0</div>
                <div style="font-size: 11px; opacity: 0.9;" data-i18n="credits_earned">Credits Earned</div>
            </div>
        </div>
        
        <!-- Bonus Info -->
        <div style="font-size: 12px; opacity: 0.9; text-align: center;">
            âœ¨ <span data-i18n="referral_bonus_info">Earn +25 credits when they verify email, +50 when they complete first request!</span>
        </div>
    </div>
</div>


<!-- Transactions Modal -->
<div id="transactionsModal" class="hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; display: none; align-items: center; justify-content: center;">
    <div style="background: white; border-radius: 20px; max-width: 600px; width: 90%; max-height: 80vh; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
        <!-- Header -->
        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; display: flex; justify-content: space-between; align-items: center;">
            <h2 style="margin: 0; font-size: 20px;">ðŸ’³ <span data-i18n="transactions">Transactions</span></h2>
            <button onclick="closeTransactionsModal()" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 36px; height: 36px; border-radius: 50%; font-size: 18px; cursor: pointer;">âœ•</button>
        </div>
        
        <!-- Summary -->
        <div id="transactionsSummary" style="background: #f8f9fa; padding: 15px 20px; display: flex; gap: 15px; flex-wrap: wrap; border-bottom: 1px solid #e0e0e0;">
            <div style="flex: 1; min-width: 100px; text-align: center; padding: 10px; background: white; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                <div style="font-size: 24px; font-weight: 700; color: #28a745;" id="totalCredits">0</div>
                <div style="font-size: 12px; color: #666;">Available</div>
            </div>
            <div style="flex: 1; min-width: 100px; text-align: center; padding: 10px; background: white; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                <div style="font-size: 24px; font-weight: 700; color: #ffc107;" id="pendingCredits">0</div>
                <div style="font-size: 12px; color: #666;">Pending</div>
            </div>
        </div>
        
        <!-- Transactions List -->
        <div id="transactionsList" style="padding: 20px; overflow-y: auto; max-height: calc(80vh - 200px);">
            <div style="text-align: center; color: #999; padding: 40px;">Loading...</div>
        </div>
    </div>
</div>

    
    <!-- Profile Photo (LEFT) + Back Button (RIGHT) - for edit profile page -->
<div id="profileHeaderSection" style="display: none; justify-content: space-between; align-items: center; width: 100%;">
    <div style="display: flex; align-items: center; gap: 15px;">
        <img id="headerProfilePhotoLarge" src="" alt="Profile" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 4px solid #667eea; display: none;">
        <div id="headerProfilePhotoLargePlaceholder" style="width: 80px; height: 80px; border-radius: 50%; background: #e0e0e0; display: flex; align-items: center; justify-content: center; font-size: 48px; color: #999;">ðŸ‘¤</div>
    </div>
    <button class="btn btn-secondary" onclick="smartBack()" style="margin: 0;">â† Back</button>
</div>
</div>
    
    <div class="two-column">
    <!-- LEFT COLUMN: SEEKER SECTION -->
    <div id="seekerSection">
        <!-- Mobile-only Seeker Header -->
        
        
                <div id="requestLimitWarning" class="request-limit-warning hidden">âš ï¸ <span data-i18n="max_requests_reached">Maximum 5 open requests reached</span></div>

	<button class="btn" onclick="showCreateRequestForm()" id="createRequestBtn" style="margin: 0 0 20px 0;">+ <span data-i18n="create_request">Create Request</span></button>
        <!-- SECTION 1: OPEN REQUESTS -->
        <div class="collapsible-section">
            <button class="section-toggle" onclick="toggleSection('openRequests')">
    <div class="section-toggle-left">
        <span>ðŸ“‹ <span data-i18n="open_requests">OPEN REQUESTS</span></span>
        <span class="count-badge" id="openRequestsTotal">0</span>
        <span class="info-badge hidden" style="background: #dc3545; color: white;" id="openRequestsNewResponses">ðŸ†• 0</span>
        <div class="badge-container hidden" id="openRequestsUnread" style="display: none;">
            <div class="chat-bubble-icon"></div>
            <span class="unread-badge">0</span>
        </div>
    </div>
    <div class="section-toggle-right">
        <span class="toggle-icon" id="openRequestsIcon">â–¼</span>
    </div>
</button>
            <div class="section-content" id="openRequestsContent">
        <div class="section-inner">
            <div class="sub-tabs">
                <button class="sub-tab active" onclick="filterMyRequests('no_response')">
                    <span data-i18n="no_response">No Response</span>
                    <div class="sub-tab-badges">
                        <span class="count-badge" id="noResponseCount">0</span>
                    </div>
                </button>
                <button class="sub-tab" onclick="filterMyRequests('negotiating')">
    <span data-i18n="negotiating">Negotiating</span>
    <div class="sub-tab-badges">
        <span class="count-badge" id="negotiatingCount">0</span>
        <span class="info-badge" style="background: #dc3545; color: white;" id="negotiatingNewResponses">ðŸ†• 0</span>
        <div class="badge-container hidden" id="negotiatingUnread" style="display: none;">
            <div class="chat-bubble-icon"></div>
            <span class="unread-badge">0</span>
        </div>
    </div>
</button>
            </div>
            <div id="openRequestsList"></div>
        </div>
    </div>
</div>

        <!-- SECTION 2: ACTIVE REQUESTS -->
<div class="collapsible-section">
    <button class="section-toggle" onclick="toggleSection('activeRequests')">
    <div class="section-toggle-left">
        <span>ðŸ”„ <span data-i18n="active_requests">ACTIVE REQUESTS</span></span>
        <span class="count-badge" id="activeRequestsTotal">0</span>
        <div class="badge-container hidden" id="activeRequestsUnreadBadge" style="display: none;">
            <div class="chat-bubble-icon"></div>
            <span class="unread-badge">0</span>
        </div>
    </div>
    <div class="section-toggle-right">
        <span class="toggle-icon" id="activeRequestsIcon">â–¼</span>
    </div>
</button>
            <div class="section-content" id="activeRequestsContent">
    <div class="section-inner">
        <div class="sub-tabs">
            <button class="sub-tab active" onclick="filterActiveRequests('in_progress')">
                <span data-i18n="in_progress">In Progress</span>
        <div class="sub-tab-badges">
            <span class="count-badge" id="inProgressCount">0</span>
            <div class="badge-container hidden" id="inProgressUnread" style="display: none;">
                <div class="chat-bubble-icon"></div>
                <span class="unread-badge">0</span>
            </div>
        </div>
    </button>
	<button class="sub-tab" onclick="filterActiveRequests('pending_completion')">
    <span data-i18n="review">Review</span>
    <div class="sub-tab-badges">
        <span class="count-badge" id="pendingCompletionCount">0</span>
        <div class="badge-container hidden" id="pendingCompletionUnread" style="display: none;">
            <div class="chat-bubble-icon"></div>
            <span class="unread-badge">0</span>
        </div>
    </div>
</button>
    <button class="sub-tab" onclick="filterActiveRequests('completed')">
        <span data-i18n="completed">Completed</span>
        <div class="sub-tab-badges">
            <span class="count-badge" id="completedCount">0</span>
            <div class="badge-container hidden" id="completedUnread" style="display: none;">
                <div class="chat-bubble-icon"></div>
                <span class="unread-badge">0</span>
            </div>
        </div>
    </button>
</div>
                    <div id="activeRequestsList"></div>
                </div>
            </div>
        </div>
    </div>


    <!-- RIGHT COLUMN: PROVIDER SECTION -->
<div id="providerSection" class="hidden">
    <!-- Mobile-only Provider Header -->
    

<!-- SECTION 1: OPEN REQUESTS (Provider) -->
<div class="collapsible-section">
    <button class="section-toggle" onclick="toggleSection('providerOpenRequests')">
    <div class="section-toggle-left">
        <span>ðŸ“‹ <span data-i18n="open_requests">OPEN REQUESTS</span></span>
        <span class="count-badge" id="providerOpenRequestsTotal">0</span>
        <div class="badge-container hidden" id="providerOpenRequestsUnread" style="display: none;">
            <div class="chat-bubble-icon"></div>
            <span class="unread-badge">0</span>
        </div>
    </div>
    <div class="section-toggle-right">
        <span class="toggle-icon" id="providerOpenRequestsIcon">â–¼</span>
    </div>
</button>
    <div class="section-content" id="providerOpenRequestsContent">
        <div class="section-inner">
            <div id="providerOpenRequestsList"></div>
        </div>
    </div>
</div>
    
    <div class="collapsible-section">
    <button class="section-toggle" onclick="toggleSection('myResponses')">
        <div class="section-toggle-left">
            <span>ðŸ”„ <span data-i18n="active_requests">ACTIVE REQUESTS</span></span>
            <span class="count-badge" id="myResponsesTotal">0</span>
        <div class="badge-container hidden" id="myResponsesNew" style="display: none;">
            <div class="chat-bubble-icon"></div>
            <span class="unread-badge">0</span>
        </div>
    </div>
    <div class="section-toggle-right">
        <span class="toggle-icon" id="myResponsesIcon">â–¼</span>
    </div>
</button>
            <div class="section-content" id="myResponsesContent">
                <div class="section-inner">
                    <div id="myResponsesList"></div>
                </div>
            </div>
        </div>
        
        <div class="collapsible-section">
            <button class="section-toggle" onclick="toggleSection('availableWork')">
                <div class="section-toggle-left">
                    <span>ðŸ’¼ <span data-i18n="work_opportunities">WORK OPPORTUNITIES</span></span>
                    <span class="count-badge" id="availableWorkTotal">0</span>
                    <span class="new-badge hidden" id="availableWorkNew" style="display: none;">ðŸ†• 0</span>
                </div>
                <div class="section-toggle-right">
                    <span class="toggle-icon" id="availableWorkIcon">â–¼</span>
                </div>
            </button>
            <div class="section-content" id="availableWorkContent">
                <div class="section-inner">
                    <div class="sub-tabs" id="urgencyTabs">
                        <!-- Tabs will be dynamically generated -->
                    </div>
                    <div id="nearbyRequestsList"></div>
                </div>
            </div>
        </div>
    </div>

</div>

            <div id="createRequestView" class="hidden">
    <!-- Header with Back Button on Right -->
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding: 20px 20px 0 20px;">
        <h2 style="margin: 0; color: #667eea; font-size: 24px;"><span data-i18n="create_service_request">Create Service Request</span></h2>
        <button class="btn btn-secondary" onclick="showDashboard()" style="margin: 0;">â† <span data-i18n="back">Back</span></button>
    </div>
    
    <div id="createRequestError" class="error hidden"></div>
    <div id="createRequestInfo" class="info hidden"></div>
    
    <form id="createRequestForm">
        <div class="mb-4">
  <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="serviceType">Service Type</label>
  <input type="hidden" id="serviceType" name="serviceType" required>
  <input type="hidden" id="serviceSubtype" name="serviceSubtype">
  
  <!-- Dropdown Trigger Button -->
  <div class="service-dropdown-trigger" id="serviceDropdownTrigger">
    <span class="placeholder" data-i18n="select_service_type">Select Service Type</span>
    <span class="dropdown-arrow">â–¼</span>
  </div>
  
  <!-- Accordion (Hidden by default) -->
  <div id="serviceAccordion" class="border rounded-lg">
    
    <!-- Electrician -->
    <div class="service-category" data-category="electrician">
      <div class="service-category-header">
        <span class="category-icon">ðŸ”Œ</span>
        <span class="category-title" data-i18n="electrician">Electrician</span>
        <span class="expand-icon">â–¼</span>
      </div>
      <div class="service-category-content">
        <div class="subcategory-item" data-value="electrician_installation">
          <span class="subcategory-name" data-i18n="elec_installation">Installation Services</span>
          <div class="info-bubble">i
            <div class="info-tooltip" data-i18n="elec_installation_examples">Fan installation, Light fitting, Switch/socket installation, Geyser connection, Doorbell installation, Appliance wiring</div>
          </div>
        </div>
        <div class="subcategory-item" data-value="electrician_repair">
          <span class="subcategory-name" data-i18n="elec_repair">Repair Services</span>
          <div class="info-bubble">i
            <div class="info-tooltip" data-i18n="elec_repair_examples">Fan not working, Switchboard issues, Light flickering, Short circuit, MCB tripping, Power socket problems</div>
          </div>
        </div>
        <div class="subcategory-item" data-value="electrician_wiring">
          <span class="subcategory-name" data-i18n="elec_wiring">New House Wiring / Rewiring</span>
          <div class="info-bubble">i
            <div class="info-tooltip" data-i18n="elec_wiring_examples">Complete house wiring, Old wiring replacement, Distribution board setup, Under-construction electrical work, Adding new circuits</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Plumber -->
    <div class="service-category" data-category="plumber">
      <div class="service-category-header">
        <span class="category-icon">ðŸš°</span>
        <span class="category-title" data-i18n="plumber">Plumber</span>
        <span class="expand-icon">â–¼</span>
      </div>
      <div class="service-category-content">
        <div class="subcategory-item" data-value="plumber_installation">
          <span class="subcategory-name" data-i18n="plumb_installation">Installation Services</span>
          <div class="info-bubble">i
            <div class="info-tooltip" data-i18n="plumb_installation_examples">Tap/faucet installation, Bathroom fitting, Kitchen sink setup, Water tank installation, Motor/pump installation, Pipeline laying</div>
          </div>
        </div>
        <div class="subcategory-item" data-value="plumber_repair">
          <span class="subcategory-name" data-i18n="plumb_repair">Repair Services</span>
          <div class="info-bubble">i
            <div class="info-tooltip" data-i18n="plumb_repair_examples">Tap leaking, Pipe leakage, Toilet flush problems, Drain blockage, Basin clogged, Water overflow issues</div>
          </div>
        </div>
        <div class="subcategory-item" data-value="plumber_new_work">
          <span class="subcategory-name" data-i18n="plumb_new_work">New House Plumbing Work</span>
          <div class="info-bubble">i
            <div class="info-tooltip" data-i18n="plumb_new_work_examples">Complete bathroom plumbing, Kitchen plumbing setup, Drainage system, Water supply lines, Under-construction plumbing work</div>
          </div>
        </div>
      </div>
    </div>

    <!-- AC Services -->
    <div class="service-category" data-category="ac_repair">
      <div class="service-category-header">
        <span class="category-icon">â„ï¸</span>
        <span class="category-title" data-i18n="ac_services">AC Services</span>
        <span class="expand-icon">â–¼</span>
      </div>
      <div class="service-category-content">
        <div class="subcategory-item" data-value="ac_installation">
          <span class="subcategory-name" data-i18n="ac_installation">AC Installation</span>
          <div class="info-bubble">i
            <div class="info-tooltip" data-i18n="ac_installation_examples">New AC installation, AC uninstall & reinstall, Indoor/outdoor unit mounting, Piping & drainage setup, AC shifting</div>
          </div>
        </div>
        <div class="subcategory-item" data-value="ac_repair_service">
          <span class="subcategory-name" data-i18n="ac_repair_service">AC Repair & Servicing</span>
          <div class="info-bubble">i
            <div class="info-tooltip" data-i18n="ac_repair_examples">AC not cooling, AC cleaning, Filter cleaning, Strange noise, Water leakage, Compressor issues</div>
          </div>
        </div>
        <div class="subcategory-item" data-value="ac_gas_filling">
          <span class="subcategory-name" data-i18n="ac_gas_filling">AC Gas Filling</span>
          <div class="info-bubble">i
            <div class="info-tooltip" data-i18n="ac_gas_examples">Gas refilling, Low cooling due to gas, Gas leak repair, Pressure check, Cooling performance issues</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Carpenter -->
    <div class="service-category" data-category="carpenter">
      <div class="service-category-header">
        <span class="category-icon">ðŸ”¨</span>
        <span class="category-title" data-i18n="carpenter">Carpenter</span>
        <span class="expand-icon">â–¼</span>
      </div>
      <div class="service-category-content">
        <div class="subcategory-item" data-value="carpenter_repair">
          <span class="subcategory-name" data-i18n="carp_repair">Furniture Repair</span>
          <div class="info-bubble">i
            <div class="info-tooltip" data-i18n="carp_repair_examples">Bed repair, Chair/sofa fixing, Table repair, Drawer problems, Hinge replacement, Furniture polish touch-up</div>
          </div>
        </div>
        <div class="subcategory-item" data-value="carpenter_custom">
          <span class="subcategory-name" data-i18n="carp_custom">Furniture Making (Custom Work)</span>
          <div class="info-bubble">i
            <div class="info-tooltip" data-i18n="carp_custom_examples">Custom wardrobe, Study table, TV unit, Shoe rack, Kitchen cabinets, Bookshelves</div>
          </div>
        </div>
        <div class="subcategory-item" data-value="carpenter_door_window">
          <span class="subcategory-name" data-i18n="carp_door_window">Door & Window Work</span>
          <div class="info-bubble">i
            <div class="info-tooltip" data-i18n="carp_door_examples">Door installation/repair, Window frame work, Door lock fitting, Handles & latches, Sliding door tracks, Kitchen cabinet doors</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Painter -->
    <div class="service-category" data-category="painter">
      <div class="service-category-header">
        <span class="category-icon">ðŸŽ¨</span>
        <span class="category-title" data-i18n="painter">Painter</span>
        <span class="expand-icon">â–¼</span>
      </div>
      <div class="service-category-content">
        <div class="subcategory-item" data-value="painter_house">
          <span class="subcategory-name" data-i18n="paint_house">House / Building Painting</span>
          <div class="info-bubble">i
            <div class="info-tooltip" data-i18n="paint_house_examples">Room painting, Full house painting, Exterior wall painting, Ceiling painting, Balcony painting, Boundary wall painting</div>
          </div>
        </div>
        <div class="subcategory-item" data-value="painter_furniture">
          <span class="subcategory-name" data-i18n="paint_furniture">Furniture & Wood Painting</span>
          <div class="info-bubble">i
            <div class="info-tooltip" data-i18n="paint_furniture_examples">Door painting, Window frames, Wooden furniture, Cupboard painting, Railing painting, Wood varnish work</div>
          </div>
        </div>
        <div class="subcategory-item" data-value="painter_texture">
          <span class="subcategory-name" data-i18n="paint_texture">Texture & Decorative Painting</span>
          <div class="info-bubble">i
            <div class="info-tooltip" data-i18n="paint_texture_examples">Textured walls, Designer finishes, Kids room designs, Stencil art, Accent walls, Special effects</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Cleaner -->
    <div class="service-category" data-category="cleaner">
      <div class="service-category-header">
        <span class="category-icon">ðŸ§¹</span>
        <span class="category-title" data-i18n="cleaner">Cleaner</span>
        <span class="expand-icon">â–¼</span>
      </div>
      <div class="service-category-content">
        <div class="subcategory-item" data-value="cleaner_house">
          <span class="subcategory-name" data-i18n="clean_house">House Cleaning</span>
          <div class="info-bubble">i
            <div class="info-tooltip" data-i18n="clean_house_examples">Room cleaning, Kitchen deep clean, Bathroom cleaning, Floor mopping, Balcony cleaning, Full house cleaning</div>
          </div>
        </div>
        <div class="subcategory-item" data-value="cleaner_upholstery">
          <span class="subcategory-name" data-i18n="clean_upholstery">Sofa, Carpet & Upholstery Cleaning</span>
          <div class="info-bubble">i
            <div class="info-tooltip" data-i18n="clean_upholstery_examples">Sofa cleaning, Carpet shampooing, Mattress cleaning, Curtain cleaning, Chair upholstery, Fabric deep cleaning</div>
          </div>
        </div>
        <div class="subcategory-item" data-value="cleaner_vehicle">
          <span class="subcategory-name" data-i18n="clean_vehicle">Vehicle Cleaning</span>
          <div class="info-bubble">i
            <div class="info-tooltip" data-i18n="clean_vehicle_examples">Car washing, Bike cleaning, Car interior cleaning, Vehicle detailing, Dashboard cleaning, Seat shampooing</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Appliance Repair -->
    <div class="service-category" data-category="appliance_repair">
      <div class="service-category-header">
        <span class="category-icon">ðŸ”§</span>
        <span class="category-title" data-i18n="appliance_repair">Appliance Repair</span>
        <span class="expand-icon">â–¼</span>
      </div>
      <div class="service-category-content">
        <div class="subcategory-item" data-value="appliance_washing">
          <span class="subcategory-name" data-i18n="app_washing">Washing Machine</span>
          <div class="info-bubble">i
            <div class="info-tooltip" data-i18n="app_washing_examples">Not spinning, Water not draining, Not starting, Making noise, Door not closing, Drum problems</div>
          </div>
        </div>
        <div class="subcategory-item" data-value="appliance_refrigerator">
          <span class="subcategory-name" data-i18n="app_refrigerator">Refrigerator</span>
          <div class="info-bubble">i
            <div class="info-tooltip" data-i18n="app_refrigerator_examples">Not cooling, Freezer issues, Strange noise, Water leakage, Ice formation, Door seal problems</div>
          </div>
        </div>
        <div class="subcategory-item" data-value="appliance_tv">
          <span class="subcategory-name" data-i18n="app_tv">TV / LED</span>
          <div class="info-bubble">i
            <div class="info-tooltip" data-i18n="app_tv_examples">No display, Screen flickering, No sound, Lines on screen, Remote not working, HDMI port issues</div>
          </div>
        </div>
        <div class="subcategory-item" data-value="appliance_geyser">
          <span class="subcategory-name" data-i18n="app_geyser">Geyser / Water Heater</span>
          <div class="info-bubble">i
            <div class="info-tooltip" data-i18n="app_geyser_examples">Not heating water, Thermostat issues, Leaking water, Gas ignition problem, Heating element fault, Pilot light issues</div>
          </div>
        </div>
        <div class="subcategory-item" data-value="appliance_ro">
          <span class="subcategory-name" data-i18n="app_ro">RO / Water Purifier</span>
          <div class="info-bubble">i
            <div class="info-tooltip" data-i18n="app_ro_examples">Not purifying, Low water flow, Filter change, TDS issues, Leaking, Motor not working</div>
          </div>
        </div>
        <div class="subcategory-item" data-value="appliance_microwave">
          <span class="subcategory-name" data-i18n="app_microwave">Microwave / Oven</span>
          <div class="info-bubble">i
            <div class="info-tooltip" data-i18n="app_microwave_examples">Not heating, Turntable not rotating, Door latch broken, Display issues, Strange sounds, Sparking inside</div>
          </div>
        </div>
        <div class="subcategory-item" data-value="appliance_other">
          <span class="subcategory-name" data-i18n="app_other">Other Small Appliances</span>
          <div class="info-bubble">i
            <div class="info-tooltip" data-i18n="app_other_examples">Fan repair, Mixer not working, Grinder issues, Iron problems, Cooler pump, Water pump, Chimney repair</div>
          </div>
        </div>
      </div>
    </div>

  </div>
  <p id="selectedServiceDisplay" class="mt-2 text-sm text-blue-600 font-medium" style="display:none;"></p>
</div>
        
        <div class="form-group">
            <label><span data-i18n="title">Title</span> <span class="required">*</span></label>
            <input type="text" id="requestTitle" required minlength="10" maxlength="100">
            <div class="char-counter"><span id="titleCounter">0</span>/100</div>
        </div>
        
        <div class="form-group">
            <label><span data-i18n="description">Description</span> <span class="required">*</span></label>
            <textarea id="requestDescription" required minlength="20" maxlength="500"></textarea>
            <div class="char-counter"><span id="descCounter">0</span>/500</div>
        </div>
        
        <div class="form-group">
            <label><span data-i18n="urgency">Urgency</span> <span class="required">*</span></label>
            <div class="urgency-group">
                <div class="urgency-option">
                    <input type="radio" name="urgency" id="urgentRadio" value="urgent" required>
                    <label for="urgentRadio" class="urgency-label">ðŸ”´ <span data-i18n="urgent">Urgent</span></label>
                </div>
                <div class="urgency-option">
                    <input type="radio" name="urgency" id="normalRadio" value="normal" required>
                    <label for="normalRadio" class="urgency-label">ðŸŸ¡ <span data-i18n="normal">Normal</span></label>
                </div>
                <div class="urgency-option">
                    <input type="radio" name="urgency" id="lowRadio" value="low" required>
                    <label for="lowRadio" class="urgency-label">ðŸŸ¢ <span data-i18n="low">Low</span></label>
                </div>
            </div>
        </div>
        
        <div class="checkbox-group">
            <input type="checkbox" id="differentLocation" onchange="toggleLocationFields()">
            <label for="differentLocation" style="margin: 0;"><span data-i18n="use_different_location">Use different location for this service</span></label>
        </div>
        
        <div id="customLocationFields" class="hidden">
            <div class="form-group">
                <label><span data-i18n="area_name">Area Name</span> <span class="required">*</span></label>
                <input type="text" id="customAreaName">
            </div>
            <div class="form-group">
                <label><span data-i18n="landmark">Landmark</span></label>
                <input type="text" id="customLandmark">
            </div>
            <div class="row">
                <div class="form-group">
                    <label><span data-i18n="city">City</span> <span class="required">*</span></label>
                    <input type="text" id="customCity" placeholder="Type to search city..." autocomplete="off">
                    <div id="customCitySuggestions" class="autocomplete-suggestions"></div>
                </div>
                <div class="form-group">
                    <label><span data-i18n="state">State</span> <span class="required">*</span></label>
                    <select id="customState">
                        <option value="" data-i18n="select_state">Select State</option>
                        <option value="Andhra Pradesh">Andhra Pradesh</option>
                        <option value="Karnataka">Karnataka</option>
                        <option value="Maharashtra">Maharashtra</option>
                        <!-- Add all other states here -->
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label><span data-i18n="pin_code">PIN Code</span> <span class="required">*</span></label>
                <input type="text" id="customPinCode" pattern="[0-9]{6}">
            </div>
        </div>
        
        <!-- âœ… THIS IS THE MISSING SUBMIT BUTTON -->
        <button type="submit" class="btn btn-full" id="submitRequestBtn"><span data-i18n="create_request">Create Request</span></button>
    </form>
</div> <!-- âœ… CLOSES createRequestView -->

    
<!-- Edit Request View -->
        <div id="editRequestView" class="hidden">
            <button class="btn btn-secondary" onclick="window.history.back()">â† <span data-i18n="back">Back</span></button>
            <h2 style="margin-top: 20px;"><span data-i18n="edit_service_request">Edit Service Request</span></h2>
            <div id="editRequestError" class="error hidden"></div>
            <div id="editRequestInfo" class="info hidden"></div>
            <form id="editRequestForm">
                <input type="hidden" id="editRequestId">
                
                <div class="form-group">
                    <label><span data-i18n="service_type">Service Type</span> <span class="required">*</span></label>
                    <select id="editServiceType" disabled>
                        <option value="" data-i18n="select_service">Select Service</option>
                        <option value="electrician">ðŸ”§ <span data-i18n="electrician">Electrician</span></option>
                        <option value="plumber">ðŸš° <span data-i18n="plumber">Plumber</span></option>
                        <option value="ac_repair">â„ï¸ <span data-i18n="ac_repair">AC Repair</span></option>
                        <option value="carpenter">ðŸ”¨ <span data-i18n="carpenter">Carpenter</span></option>
                        <option value="painter">ðŸŽ¨ <span data-i18n="painter">Painter</span></option>
                        <option value="cleaner">ðŸ§¹ <span data-i18n="cleaner">Cleaner</span></option>
                    </select>
                    <small style="color: #999; font-size: 12px;"><span data-i18n="service_type_cannot_change">Service type cannot be changed after creation</span></small>
                </div>
                
                <div class="form-group">
                    <label><span data-i18n="title">Title</span> <span class="required">*</span></label>
                    <input type="text" id="editRequestTitle" required minlength="10" maxlength="100">
                    <div class="char-counter"><span id="editTitleCounter">0</span>/100</div>
                </div>
                
                <div class="form-group">
                    <label><span data-i18n="description">Description</span> <span class="required">*</span></label>
                    <textarea id="editRequestDescription" required minlength="20" maxlength="500"></textarea>
                    <div class="char-counter"><span id="editDescCounter">0</span>/500</div>
                </div>
                
                <div class="form-group">
                    <label><span data-i18n="urgency">Urgency</span> <span class="required">*</span></label>
                    <div class="urgency-group">
                        <div class="urgency-option">
                            <input type="radio" name="editUrgency" id="editUrgentRadio" value="urgent" required>
                            <label for="editUrgentRadio" class="urgency-label">ðŸ”´ <span data-i18n="urgent">Urgent</span></label>
                        </div>
                        <div class="urgency-option">
                            <input type="radio" name="editUrgency" id="editNormalRadio" value="normal" required>
                            <label for="editNormalRadio" class="urgency-label">ðŸŸ¡ <span data-i18n="normal">Normal</span></label>
                        </div>
                        <div class="urgency-option">
                            <input type="radio" name="editUrgency" id="editLowRadio" value="low" required>
                            <label for="editLowRadio" class="urgency-label">ðŸŸ¢ <span data-i18n="low">Low</span></label>
                        </div>
                    </div>
                </div>
                
                <h3>ðŸ“ <span data-i18n="service_location">Service Location</span></h3>
                <div style="background: #f0f4ff; padding: 15px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #667eea;">
                    <p style="color: #333; font-size: 14px; margin-bottom: 8px; font-weight: 600;">ðŸ“ <span data-i18n="current_location">Current Location</span>:</p>
                    <p style="color: #555; font-size: 14px; line-height: 1.6;" id="currentLocationText"></p>
                    <p style="color: #999; font-size: 12px; margin-top: 10px; font-style: italic;">
                        â„¹ï¸ <span data-i18n="location_cannot_change">Location and service type cannot be changed after request creation. If you need to change these, please cancel this request and create a new one.</span>
                    </p>
                </div>
                
                <button type="submit" class="btn btn-full" id="updateRequestBtn">ðŸ’¾ <span data-i18n="update_request">Update Request</span></button>            </form>
        </div>


<!-- Edit Profile View -->
<div id="editProfileView" class="hidden">
    <!-- Header Section with Profile Photo and Back Button -->
    <div style="padding: 0 20px; margin-bottom: 30px;">
    <!-- Row 1: Heading + Back Button -->
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; gap: 10px;">
    <h2 style="margin: 0; color: #667eea; font-size: 20px; white-space: nowrap; flex-shrink: 0;"><span data-i18n="edit_profile">Edit Profile</span></h2>
    <button class="btn btn-secondary" onclick="smartBack()" style="margin: 0 !important; padding: 6px 12px !important; font-size: 13px !important; white-space: nowrap; min-height: auto !important; line-height: 1.2 !important; border-radius: 6px !important; flex-shrink: 0 !important; width: auto !important;">â† <span data-i18n="back">Back</span></button>
</div>
    
    <!-- Row 2: Subheading -->
    <h3 style="margin: 0 0 20px 0; color: #333; font-size: 18px;">ðŸ‘¤ <span data-i18n="personal_information">Personal Information</span></h3>
    
    <!-- Row 3: Profile Photo + Stats (Full Width) -->
    <div style="display: flex; align-items: flex-start; gap: 15px; width: 100%;">
        <!-- Profile Photo -->
        <div style="flex-shrink: 0;">
            <img id="currentProfilePhoto" src="" alt="Profile" style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 4px solid #667eea; display: none; cursor: pointer;" onclick="if(this.src) openImagePreview(this.src)">
            <div id="noProfilePhoto" style="width: 120px; height: 120px; border-radius: 50%; background: #e0e0e0; display: flex; align-items: center; justify-content: center; font-size: 48px; color: #999;">ðŸ‘¤</div>
        </div>
        
        <!-- Stats Container (Stretches to Fill) -->
        <div id="profileStatsContainer" style="flex: 1; display: flex; flex-direction: column; gap: 8px;">
            <!-- Stats will be inserted here -->
        </div>
    </div>
</div>
    
    <div id="editProfileError" class="error hidden"></div>
    <div id="editProfileInfo" class="info hidden"></div>
    
    <form id="editProfileForm">
        <div class="form-group">
            <label><span data-i18n="change_profile_photo">Change Profile Photo</span></label>
            <input type="file" id="editPhoto" accept="image/*">
            <small style="color: #999; font-size: 12px;"><span data-i18n="max_size_2mb">Max size: 2MB. Leave empty to keep current photo</span></small>
        </div>

        <div class="form-group">
            <label><span data-i18n="full_name">Full Name</span> <span class="required">*</span></label>
            <input type="text" id="editName" required>
        </div>

        <div class="form-group">
            <label><span data-i18n="phone_number">Phone Number</span> <span class="required">*</span></label>
            <input type="tel" id="editPhone" maxlength="10" pattern="[6-9][0-9]{9}" required 
                   oninput="validatePhoneInput(this)" title="Enter correct number">
            <div id="editPhoneError" style="color: #dc3545; font-size: 12px; margin-top: 5px; display: none;"><span data-i18n="enter_correct_number">Enter correct number</span></div>
        </div>

	        <div class="form-group">
            <label><span data-i18n="email_id">Email ID</span></label>
            <input type="email" id="editEmail" readonly style="background-color: #f5f5f5; cursor: not-allowed;">
        </div>


        <h3>ðŸ“ <span data-i18n="address_details">Address Details</span></h3>
        <div class="form-group">
            <label><span data-i18n="house_number">House Number</span></label>
            <input type="text" id="editHouseNumber">
        </div>

        <div class="form-group">
            <label><span data-i18n="area_name">Area Name</span> <span class="required">*</span></label>
            <input type="text" id="editAreaName" required>
        </div>

        <div class="form-group">
            <label><span data-i18n="landmark">Landmark</span></label>
            <input type="text" id="editLandmark">
        </div>

        <div class="form-group">
            <label><span data-i18n="city">City</span> <span class="required">*</span></label>
            <input type="text" id="editCity" placeholder="Type your city name..." required autocomplete="off">
            <div id="editCitySuggestions" class="autocomplete-suggestions"></div>
        </div>

        <div class="form-group">
            <label><span data-i18n="state">State</span> <span class="required">*</span></label>
            <select id="editState" required>
                <option value="" data-i18n="select_state">Select State/Union Territory</option>
                <option value="Andhra Pradesh">Andhra Pradesh</option>
                <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                <option value="Assam">Assam</option>
                <option value="Bihar">Bihar</option>
                <option value="Chhattisgarh">Chhattisgarh</option>
                <option value="Goa">Goa</option>
                <option value="Gujarat">Gujarat</option>
                <option value="Haryana">Haryana</option>
                <option value="Himachal Pradesh">Himachal Pradesh</option>
                <option value="Jharkhand">Jharkhand</option>
                <option value="Karnataka">Karnataka</option>
                <option value="Kerala">Kerala</option>
                <option value="Madhya Pradesh">Madhya Pradesh</option>
                <option value="Maharashtra">Maharashtra</option>
                <option value="Manipur">Manipur</option>
                <option value="Meghalaya">Meghalaya</option>
                <option value="Mizoram">Mizoram</option>
                <option value="Nagaland">Nagaland</option>
                <option value="Odisha">Odisha</option>
                <option value="Punjab">Punjab</option>
                <option value="Rajasthan">Rajasthan</option>
                <option value="Sikkim">Sikkim</option>
                <option value="Tamil Nadu">Tamil Nadu</option>
                <option value="Telangana">Telangana</option>
                <option value="Tripura">Tripura</option>
                <option value="Uttar Pradesh">Uttar Pradesh</option>
                <option value="Uttarakhand">Uttarakhand</option>
                <option value="West Bengal">West Bengal</option>
                <option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
                <option value="Chandigarh">Chandigarh</option>
                <option value="Dadra and Nagar Haveli and Daman and Diu">Dadra and Nagar Haveli and Daman and Diu</option>
                <option value="National Capital Territory of Delhi">National Capital Territory of Delhi</option>
                <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                <option value="Ladakh">Ladakh</option>
                <option value="Lakshadweep">Lakshadweep</option>
                <option value="Puducherry">Puducherry</option>
            </select>
        </div>

        <div class="form-group">
            <label><span data-i18n="pin_code">PIN Code</span> <span class="required">*</span></label>
            <input type="text" id="editPinCode" pattern="[0-9]{6}" required>
        </div>
	        
        <h3>ðŸ”§ <span data-i18n="provider_settings">Provider Settings</span></h3>
        <div style="margin-bottom: 20px;">
            <button type="button" class="btn" id="toggleProviderBtn" onclick="toggleProviderStatus()" style="width: 100%;">
                <span id="providerStatusText" data-i18n="loading">Loading...</span>
            </button>
        </div>
        
        <div id="providerSettings" class="hidden">
            <div class="form-group">
                <label><span data-i18n="service_radius">Service Radius</span> <span class="required">*</span></label>
                <select id="editRadius">
                    <option value="2">2 km</option>
                    <option value="5">5 km</option>
                    <option value="10">10 km</option>
                    <option value="15">15 km</option>
                    <option value="20">20 km</option>
                    <option value="30">30 km</option>
                    <option value="50">50 km</option>
                </select>
            </div>
            
<div class="form-group">
    <label><span data-i18n="your_services">Your Services</span></label>
    <div id="currentServicesList" style="margin-bottom: 20px;"></div>
    
    <!-- Add New Service Section -->
    <div class="provider-add-service-section">
        <div class="provider-add-service-header">
            <span data-i18n="add_new_service">Add New Service</span>
        </div>
        
        <div class="provider-service-add-row">
            <!-- Dropdown Container -->
            <div class="provider-service-dropdown-container">
                <!-- Hidden inputs -->
                <input type="hidden" id="newServiceSelect" value="">
                <input type="hidden" id="newServiceSubtype" value="">
                
                <!-- Dropdown Trigger -->
                <div class="provider-service-dropdown-trigger" id="providerServiceDropdownTrigger">
                    <span class="placeholder" data-i18n="select_service_to_add">Select Service to Add</span>
                    <span class="dropdown-arrow">â–¼</span>
                </div>
                
                <!-- Accordion (Opens Upward) -->
                <div id="providerServiceAccordion" class="border rounded-lg">
    
    <!-- Electrician -->
    <div class="service-category" data-category="electrician">
        <div class="service-category-header">
            <span class="category-icon">ðŸ”Œ</span>
            <span class="category-title" data-i18n="electrician">Electrician</span>
            <span class="expand-icon">â–¼</span>
        </div>
        <div class="service-category-content">
            <div class="subcategory-item" data-value="electrician_installation">
                <span class="subcategory-name" data-i18n="elec_installation">Installation Services</span>
                <div class="info-bubble">i
                    <div class="info-tooltip" data-i18n="elec_installation_examples">Fan installation, Light fitting, Switch/socket installation, Geyser connection, Doorbell installation, Appliance wiring</div>
                </div>
            </div>
            <div class="subcategory-item" data-value="electrician_repair">
                <span class="subcategory-name" data-i18n="elec_repair">Repair Services</span>
                <div class="info-bubble">i
                    <div class="info-tooltip" data-i18n="elec_repair_examples">Fan not working, Switchboard issues, Light flickering, Short circuit, MCB tripping, Power socket problems</div>
                </div>
            </div>
            <div class="subcategory-item" data-value="electrician_wiring">
                <span class="subcategory-name" data-i18n="elec_wiring">New House Wiring / Rewiring</span>
                <div class="info-bubble">i
                    <div class="info-tooltip" data-i18n="elec_wiring_examples">Complete house wiring, Old wiring replacement, Distribution board setup, Under-construction electrical work, Adding new circuits</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Plumber -->
    <div class="service-category" data-category="plumber">
        <div class="service-category-header">
            <span class="category-icon">ðŸš°</span>
            <span class="category-title" data-i18n="plumber">Plumber</span>
            <span class="expand-icon">â–¼</span>
        </div>
        <div class="service-category-content">
            <div class="subcategory-item" data-value="plumber_installation">
                <span class="subcategory-name" data-i18n="plumb_installation">Installation Services</span>
                <div class="info-bubble">i
                    <div class="info-tooltip" data-i18n="plumb_installation_examples">Tap/faucet installation, Bathroom fitting, Kitchen sink setup, Water tank installation, Motor/pump installation, Pipeline laying</div>
                </div>
            </div>
            <div class="subcategory-item" data-value="plumber_repair">
                <span class="subcategory-name" data-i18n="plumb_repair">Repair Services</span>
                <div class="info-bubble">i
                    <div class="info-tooltip" data-i18n="plumb_repair_examples">Tap leaking, Pipe leakage, Toilet flush problems, Drain blockage, Basin clogged, Water overflow issues</div>
                </div>
            </div>
            <div class="subcategory-item" data-value="plumber_new_work">
                <span class="subcategory-name" data-i18n="plumb_new_work">New House Plumbing Work</span>
                <div class="info-bubble">i
                    <div class="info-tooltip" data-i18n="plumb_new_work_examples">Complete bathroom plumbing, Kitchen plumbing setup, Drainage system, Water supply lines, Under-construction plumbing work</div>
                </div>
            </div>
        </div>
    </div>

    <!-- AC Services -->
    <div class="service-category" data-category="ac_services">
        <div class="service-category-header">
            <span class="category-icon">â„ï¸</span>
            <span class="category-title" data-i18n="ac_services">AC Services</span>
            <span class="expand-icon">â–¼</span>
        </div>
        <div class="service-category-content">
            <div class="subcategory-item" data-value="ac_installation">
                <span class="subcategory-name" data-i18n="ac_installation">AC Installation</span>
                <div class="info-bubble">i
                    <div class="info-tooltip" data-i18n="ac_installation_examples">New AC installation, AC uninstall & reinstall, Indoor/outdoor unit mounting, Piping & drainage setup, AC shifting</div>
                </div>
            </div>
            <div class="subcategory-item" data-value="ac_repair_service">
                <span class="subcategory-name" data-i18n="ac_repair_service">AC Repair & Servicing</span>
                <div class="info-bubble">i
                    <div class="info-tooltip" data-i18n="ac_repair_examples">AC not cooling, AC cleaning, Filter cleaning, Strange noise, Water leakage, Compressor issues</div>
                </div>
            </div>
            <div class="subcategory-item" data-value="ac_gas_filling">
                <span class="subcategory-name" data-i18n="ac_gas_filling">AC Gas Filling</span>
                <div class="info-bubble">i
                    <div class="info-tooltip" data-i18n="ac_gas_examples">Gas refilling, Low cooling due to gas, Gas leak repair, Pressure check, Cooling performance issues</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Carpenter -->
    <div class="service-category" data-category="carpenter">
        <div class="service-category-header">
            <span class="category-icon">ðŸ”¨</span>
            <span class="category-title" data-i18n="carpenter">Carpenter</span>
            <span class="expand-icon">â–¼</span>
        </div>
        <div class="service-category-content">
            <div class="subcategory-item" data-value="carpenter_repair">
                <span class="subcategory-name" data-i18n="carp_repair">Furniture Repair</span>
                <div class="info-bubble">i
                    <div class="info-tooltip" data-i18n="carp_repair_examples">Bed repair, Chair/sofa fixing, Table repair, Drawer problems, Hinge replacement, Furniture polish touch-up</div>
                </div>
            </div>
            <div class="subcategory-item" data-value="carpenter_custom">
                <span class="subcategory-name" data-i18n="carp_custom">Furniture Making (Custom Work)</span>
                <div class="info-bubble">i
                    <div class="info-tooltip" data-i18n="carp_custom_examples">Custom wardrobe, Study table, TV unit, Shoe rack, Kitchen cabinets, Bookshelves</div>
                </div>
            </div>
            <div class="subcategory-item" data-value="carpenter_door_window">
                <span class="subcategory-name" data-i18n="carp_door_window">Door & Window Work</span>
                <div class="info-bubble">i
                    <div class="info-tooltip" data-i18n="carp_door_examples">Door installation/repair, Window frame work, Door lock fitting, Handles & latches, Sliding door tracks, Kitchen cabinet doors</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Painter -->
    <div class="service-category" data-category="painter">
        <div class="service-category-header">
            <span class="category-icon">ðŸŽ¨</span>
            <span class="category-title" data-i18n="painter">Painter</span>
            <span class="expand-icon">â–¼</span>
        </div>
        <div class="service-category-content">
            <div class="subcategory-item" data-value="painter_house">
                <span class="subcategory-name" data-i18n="paint_house">House / Building Painting</span>
                <div class="info-bubble">i
                    <div class="info-tooltip" data-i18n="paint_house_examples">Room painting, Full house painting, Exterior wall painting, Ceiling painting, Balcony painting, Boundary wall painting</div>
                </div>
            </div>
            <div class="subcategory-item" data-value="painter_furniture">
                <span class="subcategory-name" data-i18n="paint_furniture">Furniture & Wood Painting</span>
                <div class="info-bubble">i
                    <div class="info-tooltip" data-i18n="paint_furniture_examples">Door painting, Window frames, Wooden furniture, Cupboard painting, Railing painting, Wood varnish work</div>
                </div>
            </div>
            <div class="subcategory-item" data-value="painter_texture">
                <span class="subcategory-name" data-i18n="paint_texture">Texture & Decorative Painting</span>
                <div class="info-bubble">i
                    <div class="info-tooltip" data-i18n="paint_texture_examples">Textured walls, Designer finishes, Kids room designs, Stencil art, Accent walls, Special effects</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cleaner -->
    <div class="service-category" data-category="cleaner">
        <div class="service-category-header">
            <span class="category-icon">ðŸ§¹</span>
            <span class="category-title" data-i18n="cleaner">Cleaner</span>
            <span class="expand-icon">â–¼</span>
        </div>
        <div class="service-category-content">
            <div class="subcategory-item" data-value="cleaner_house">
                <span class="subcategory-name" data-i18n="clean_house">House Cleaning</span>
                <div class="info-bubble">i
                    <div class="info-tooltip" data-i18n="clean_house_examples">Room cleaning, Kitchen deep clean, Bathroom cleaning, Floor mopping, Balcony cleaning, Full house cleaning</div>
                </div>
            </div>
            <div class="subcategory-item" data-value="cleaner_upholstery">
                <span class="subcategory-name" data-i18n="clean_upholstery">Sofa, Carpet & Upholstery Cleaning</span>
                <div class="info-bubble">i
                    <div class="info-tooltip" data-i18n="clean_upholstery_examples">Sofa cleaning, Carpet shampooing, Mattress cleaning, Curtain cleaning, Chair upholstery, Fabric deep cleaning</div>
                </div>
            </div>
            <div class="subcategory-item" data-value="cleaner_vehicle">
                <span class="subcategory-name" data-i18n="clean_vehicle">Vehicle Cleaning</span>
                <div class="info-bubble">i
                    <div class="info-tooltip" data-i18n="clean_vehicle_examples">Car washing, Bike cleaning, Car interior cleaning, Vehicle detailing, Dashboard cleaning, Seat shampooing</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Appliance Repair -->
    <div class="service-category" data-category="appliance_repair">
        <div class="service-category-header">
            <span class="category-icon">ðŸ”§</span>
            <span class="category-title" data-i18n="appliance_repair">Appliance Repair</span>
            <span class="expand-icon">â–¼</span>
        </div>
        <div class="service-category-content">
            <div class="subcategory-item" data-value="appliance_washing">
                <span class="subcategory-name" data-i18n="app_washing">Washing Machine</span>
                <div class="info-bubble">i
                    <div class="info-tooltip" data-i18n="app_washing_examples">Not spinning, Water not draining, Not starting, Making noise, Door not closing, Drum problems</div>
                </div>
            </div>
            <div class="subcategory-item" data-value="appliance_refrigerator">
                <span class="subcategory-name" data-i18n="app_refrigerator">Refrigerator</span>
                <div class="info-bubble">i
                    <div class="info-tooltip" data-i18n="app_refrigerator_examples">Not cooling, Freezer issues, Strange noise, Water leakage, Ice formation, Door seal problems</div>
                </div>
            </div>
            <div class="subcategory-item" data-value="appliance_tv">
                <span class="subcategory-name" data-i18n="app_tv">TV / LED</span>
                <div class="info-bubble">i
                    <div class="info-tooltip" data-i18n="app_tv_examples">No display, Screen flickering, No sound, Lines on screen, Remote not working, HDMI port issues</div>
                </div>
            </div>
            <div class="subcategory-item" data-value="appliance_geyser">
                <span class="subcategory-name" data-i18n="app_geyser">Geyser / Water Heater</span>
                <div class="info-bubble">i
                    <div class="info-tooltip" data-i18n="app_geyser_examples">Not heating water, Thermostat issues, Leaking water, Gas ignition problem, Heating element fault, Pilot light issues</div>
                </div>
            </div>
            <div class="subcategory-item" data-value="appliance_ro">
                <span class="subcategory-name" data-i18n="app_ro">RO / Water Purifier</span>
                <div class="info-bubble">i
                    <div class="info-tooltip" data-i18n="app_ro_examples">Not purifying, Low water flow, Filter change, TDS issues, Leaking, Motor not working</div>
                </div>
            </div>
            <div class="subcategory-item" data-value="appliance_microwave">
                <span class="subcategory-name" data-i18n="app_microwave">Microwave / Oven</span>
                <div class="info-bubble">i
                    <div class="info-tooltip" data-i18n="app_microwave_examples">Not heating, Turntable not rotating, Door latch broken, Display issues, Strange sounds, Sparking inside</div>
                </div>
            </div>
            <div class="subcategory-item" data-value="appliance_other">
                <span class="subcategory-name" data-i18n="app_other">Other Small Appliances</span>
                <div class="info-bubble">i
                    <div class="info-tooltip" data-i18n="app_other_examples">Fan repair, Mixer not working, Grinder issues, Iron problems, Cooler pump, Water pump, Chimney repair</div>
                </div>
            </div>
        </div>
    </div>

</div>
                <!-- End of accordion -->
            </div>
            <!-- End of dropdown container -->
            
            <!-- Add Service Button -->
            <button type="button" class="provider-add-service-btn" id="providerAddServiceBtn" onclick="addProviderService()">
                âœ… <span data-i18n="add_service">Add Service</span>
            </button>
        </div>
        <!-- End of add row -->
    </div>
    <!-- End of add service section -->
</div>
        </div>
        
        <button type="submit" class="btn btn-full" id="saveProfileBtn">ðŸ’¾ <span data-i18n="save_changes">Save Changes</span></button>
    </form>
</div>

        <!-- Chat View -->
        <div id="chatView" class="hidden">
            <div class="chat-container">
                <div class="chat-header" style="display: flex; justify-content: space-between; align-items: center;">
    <!-- EXTREME LEFT: Back Button with < symbol -->
    <button onclick="smartBack()" style="background: none; border: none; color: white; padding: 4px; font-size: 24px; font-weight: bold; cursor: pointer; line-height: 1; margin: 0; min-width: auto;">&lt;</button>

    
    <!-- LEFT: Profile Photo + Username (adjacent to back button) -->
    <div style="display: flex; align-items: center; gap: 12px; cursor: pointer; flex: 1; margin-left: 12px;" onclick="openChatPartnerProfile()">
        <img id="chatPartnerPhoto" src="" alt="" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover; border: 2px solid white; display: none; cursor: pointer;">
        <div id="chatPartnerPhotoPlaceholder" style="width: 40px; height: 40px; border-radius: 50%; background: rgba(255,255,255,0.3); display: flex; align-items: center; justify-content: center; font-size: 20px;">ðŸ‘¤</div>
        <div class="chat-header-left">
            <div class="chat-partner-name" id="chatPartnerName"><span data-i18n="chat">Chat</span></div>
            <div class="chat-status"><span data-i18n="request_status">Request Status</span>: <span id="chatRequestStatus" data-i18n="in_progress">In Progress</span></div>
        </div>
    </div>
    
    <!-- RIGHT: Contact Details Symbol (only visible when activated) -->
<button id="contactDetailsHeaderBtn" onclick="openContactDetailsModal()" style="display: none; background: none; border: none; color: #ff3333 !important; padding: 4px; font-size: 24px; cursor: pointer; line-height: 1; margin: 0; transform: rotate(135deg);">ðŸ“ž</button>


</div>

                
                <div class="chat-messages" id="chatMessages">
                    <!-- Messages will be loaded here -->
                </div>
                
                                
                <div class="chat-input-area">
                    <div class="privacy-notice" id="privacyNotice">
                        ðŸ”’ <strong><span data-i18n="privacy_protected">Privacy Protected</span>:</strong> <span data-i18n="privacy_notice_text">Phone numbers and addresses are hidden until both parties agree to share contact information.</span>
                    </div>
                    
                    <div class="chat-action-buttons">
    <button class="btn btn-contact" onclick="requestContactSharing()">
        ðŸ“ž <span data-i18n="request_contact_sharing">Request Contact Sharing</span>
        <span class="privacy-info-icon" onclick="event.stopPropagation(); togglePrivacyNotice()">!</span>
    </button>
    
    <!-- PROVIDER: Mark Complete Button -->
    <button class="btn btn-complete" id="markCompleteBtn" onclick="showWarrantyForm()" style="display: none;">âœ… <span data-i18n="mark_work_complete">Mark Work Complete</span></button>
    
    <!-- SEEKER: Accept/Reject Buttons (only visible when completion requested) -->
    <button class="btn btn-complete" id="acceptCompletionBtn" onclick="acceptCompletion()" style="display: none;">âœ… <span data-i18n="accept_completion">Accept Completion</span></button>
    <button class="btn btn-cancel" id="rejectCompletionBtn" onclick="rejectCompletion()" style="display: none;">âŒ <span data-i18n="reject_continue_work">Reject & Continue Work</span></button>
</div>

<div id="warrantyForm" class="warranty-form hidden">
    <h3><span data-i18n="select_warranty_period">Select Warranty Period</span></h3>
    
    <!-- NEW: Keep Existing Warranty Option (shown only for reactivated requests) -->
    <div id="keepExistingWarrantyOption" class="warranty-option" style="display: none; margin-bottom: 12px;">
        <input type="radio" name="warranty" id="warrantyExisting" value="existing">
        <label for="warrantyExisting" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; border-color: #28a745;">
            ðŸ”„ <span id="keepExistingWarrantyText">Keep Existing Warranty</span>
        </label>
    </div>
    
    <!-- NEW: Separator for new warranty options -->
    <div id="newWarrantyDivider" style="display: none; text-align: center; margin: 12px 0; color: #666; font-size: 13px;">
        â€” OR provide new warranty â€”
    </div>
    
    <div class="warranty-options">
        <div class="warranty-option">
            <input type="radio" name="warranty" id="warranty0" value="0">
            <label for="warranty0"><span data-i18n="no_warranty">No Warranty</span></label>
        </div>
        <div class="warranty-option">
            <input type="radio" name="warranty" id="warranty15" value="15">
            <label for="warranty15"><span data-i18n="15_days">15 Days</span></label>
        </div>
        <div class="warranty-option">
            <input type="radio" name="warranty" id="warranty30" value="30">
            <label for="warranty30"><span data-i18n="1_month">1 Month</span></label>
        </div>
        <div class="warranty-option">
            <input type="radio" name="warranty" id="warranty90" value="90">
            <label for="warranty90"><span data-i18n="3_months">3 Months</span></label>
        </div>
        <div class="warranty-option">
            <input type="radio" name="warranty" id="warranty180" value="180">
            <label for="warranty180"><span data-i18n="6_months">6 Months</span></label>
        </div>
        <div class="warranty-option">
            <input type="radio" name="warranty" id="warranty365" value="365">
            <label for="warranty365"><span data-i18n="1_year">1 Year</span></label>
        </div>
    </div>
    <button class="btn" onclick="completeWork()"><span data-i18n="send_completion_request">Send Completion Request</span></button>
</div>
                    <div class="chat-input-wrapper">
                        <button class="plus-button" onclick="showAttachmentOptions()" title="Attach">+</button>
                        <textarea id="chatMessageInput" data-i18n-placeholder="type_your_message" placeholder="Type your message..." rows="2" oninput="toggleSendButton()"></textarea>
                        <button class="template-button" id="templateBtn" onclick="openTemplateModal()" title="Quick Templates">ðŸ“‹</button>
                        <button class="btn btn-send" id="sendBtn" onclick="sendMessage()">âž¤</button>
                    </div>
		<input type="file" id="photoInput" accept="image/*" style="display: none;" onchange="handlePhotoUpload(event)">
                </div>
            </div>
        </div>


                <!-- Responses Modal -->
<div id="responsesModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title" style="flex: 1; text-align: left;">ðŸ‘¥ <span data-i18n="providers_who_responded">Providers Who Responded</span></h2>
            <button class="close-btn" onclick="closeResponsesModal()" style="color: #dc3545; font-weight: bold;">Ã—</button>
        </div>
        <div id="responsesList"></div>
    </div>
</div>

        <!-- Provider Profile Modal -->
        <div id="profileModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">ðŸ‘¤ <span data-i18n="provider_profile">Provider Profile</span></h2>
                    <button class="close-btn" onclick="closeProfileModal()">Ã—</button>
                </div>
                <div id="profileContent"></div>
            </div>
        </div>
<!-- Template Modal -->
        <div id="templateModal" class="template-modal">
            <div class="template-modal-content">
                <div class="template-modal-header">
                    <h2 class="template-modal-title">ðŸ“‹ <span data-i18n="quick_templates">Quick Templates</span></h2>
                    <button class="template-close-btn" onclick="closeTemplateModal()">Ã—</button>
                </div>
                <div class="template-categories" id="templateCategoriesContainer"></div>
            </div>
        </div>

<!-- Rating Modal -->
        <div id="ratingModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">â­ <span data-i18n="rate_provider">Rate Provider</span></h2>
                    <button class="close-btn" onclick="closeRatingModal()">Ã—</button>
                </div>
                <div id="ratingModalContent">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <p style="font-size: 16px; color: #555; margin-bottom: 10px;"><span data-i18n="how_was_experience">How was your experience with</span> <strong id="ratingProviderName"></strong>?</p>
                        <p style="font-size: 14px; color: #999;"><span data-i18n="rating_helps_others">Your rating helps others make better decisions</span></p>
                    </div>
                    
                    <div class="rating-stars" id="ratingStars">
                        <span class="star" data-rating="1" onclick="selectRating(1)">â˜†</span>
                        <span class="star" data-rating="2" onclick="selectRating(2)">â˜†</span>
                        <span class="star" data-rating="3" onclick="selectRating(3)">â˜†</span>
                        <span class="star" data-rating="4" onclick="selectRating(4)">â˜†</span>
                        <span class="star" data-rating="5" onclick="selectRating(5)">â˜†</span>
                    </div>
                    
                    <div style="text-align: center; margin: 15px 0;">
                        <span id="ratingText" style="font-size: 18px; font-weight: 600; color: #667eea;" data-i18n="select_rating">Select Rating</span>
                    </div>
                    
                    <div class="form-group">
                        <label><span data-i18n="review_optional">Review (Optional)</span></label>
                        <textarea id="ratingReview" data-i18n-placeholder="share_your_experience" placeholder="Share your experience with others..." rows="4" maxlength="500"></textarea>
                        <div class="char-counter"><span id="reviewCounter">0</span>/500</div>
                    </div>
                    
                    <div id="ratingError" class="error hidden"></div>
                    
                    <button class="btn btn-full" onclick="submitRating()" id="submitRatingBtn"><span data-i18n="submit_rating">Submit Rating</span></button>
                </div>
            </div>
        </div>

	<!-- Feedback Modal -->
<div id="feedbackModal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h2 class="modal-title">ðŸ’¬ <span data-i18n="send_feedback">Send Feedback</span></h2>
            <button class="close-btn" onclick="closeFeedbackModal()">Ã—</button>
        </div>
        <div style="padding: 20px;">
            <p style="color: #666; margin-bottom: 20px; line-height: 1.6;">
                <span data-i18n="feedback_intro">Help us improve HelpBuddy! Share your suggestions, report bugs, or request new features. Your feedback helps us serve you better.</span>
            </p>
            
            <div class="form-group">
                <label><span data-i18n="feedback_type">Feedback Type</span> <span class="required">*</span></label>
                <select id="feedbackType" required>
                    <option value="" data-i18n="select_type">Select Type</option>
                    <option value="bug">ðŸ› <span data-i18n="bug_report">Bug Report</span></option>
                    <option value="feature">âœ¨ <span data-i18n="feature_request">Feature Request</span></option>
                    <option value="improvement">ðŸ”§ <span data-i18n="improvement_suggestion">Improvement Suggestion</span></option>
                    <option value="complaint">ðŸ˜ž <span data-i18n="complaint">Complaint</span></option>
                    <option value="praise">ðŸŽ‰ <span data-i18n="appreciation">Appreciation</span></option>
                    <option value="other">ðŸ’­ <span data-i18n="other">Other</span></option>
                </select>
            </div>
            
            <div class="form-group">
                <label><span data-i18n="your_feedback">Your Feedback</span> <span class="required">*</span></label>
                <textarea id="feedbackMessage" rows="6" maxlength="1000" required data-i18n-placeholder="describe_feedback" placeholder="Please describe your feedback in detail. Be specific so we can help you better."></textarea>
                <div class="char-counter"><span id="feedbackCounter">0</span>/1000</div>
            </div>
            
            <div class="form-group">
                <label><span data-i18n="your_email">Your Email</span></label>
                <input type="email" id="feedbackEmail" data-i18n-placeholder="email_reach_out" placeholder="We'll reach out if we need more details" readonly>
                <small style="color: #999; font-size: 12px;"><span data-i18n="using_registered_email">Using your registered email</span></small>
            </div>
            
            <div id="feedbackError" class="error hidden"></div>
            <div id="feedbackSuccess" class="success hidden"></div>
            
            <button class="btn btn-full" onclick="submitFeedback()" id="submitFeedbackBtn">
                ðŸ“¤ <span data-i18n="send_feedback">Send Feedback</span>
            </button>
        </div>
    </div>
</div>

        <!-- Contact Details Modal -->
<div id="contactDetailsModal" class="modal">
    <div class="modal-content" style="max-width: 500px;">
        <div style="display: flex; justify-content: flex-end; padding: 15px 15px 0 15px;">
            <button onclick="closeContactDetailsModal()" style="background: none; border: none; color: #dc3545; font-size: 36px; font-weight: bold; cursor: pointer; line-height: 1; padding: 0;">Ã—</button>
        </div>
        <div id="contactDetailsModalContent" style="padding: 0 20px 20px 20px;">
            <!-- Contact details will be loaded here -->
        </div>
    </div>
</div>

<!-- Loading View -->

        <!-- Loading View -->
        <div id="loadingView" class="loading">
            <div class="spinner"></div>
            <p data-i18n="loading">Loading...</p>
        </div>
    </div>


    <script>

const translations = {
  en: {
    // ============================================================
    // SECTION 1: GENERAL APP & BRANDING
    // ============================================================
    app_name: "HelpBuddy",
    
    // ============================================================
    // SECTION 2: USER ROLES & IDENTITY
    // ============================================================
    seeker: "Seeker",
provider: "Provider",
seeker_mode: "Seeker",
provider_mode: "Provider",
    
    // ============================================================
    // SECTION 3: AUTHENTICATION - LOGIN PAGE
    // ============================================================
    welcome_back: "Welcome Back",
    email: "Email",
    password: "Password",
    login: "Login",
    forgot_password: "Forgot Password?",
    get_help: "Get Help",
    sign_up_link: "Sign up for new user registration",
    dont_have_account: "Don't have an account?",
    invalid_credentials: "Invalid email or password",
    
    // ============================================================
    // SECTION 4: AUTHENTICATION - SIGNUP PAGE
    // ============================================================
    create_account: "Create Account",
    full_name: "Full Name",
    phone_number: "Phone Number",
    enter_correct_number: "Enter correct number",
    invalid_phone: "Please enter a valid phone number",
    house_number: "House Number",
    area_name: "Area Name",
    landmark: "Landmark",
    city: "City",
    state: "State",
    pin_code: "PIN Code",
    select_state: "Select State/Union Territory",
    address_details: "Address Details",
    i_want_to_provide: "I want to provide services",
    provider_settings: "Provider Settings",
    service_radius: "Service Radius",
    services_i_provide: "Services I Provide",
    i_agree_to: "I agree to the",
    and: "and",
    sign_up: "Sign Up",
    back_to_login: "Back to Login",
    already_have_account: "Already have an account?",
    email_registered: "Email already registered",
    
    // ============================================================
    // SECTION 5: SERVICE CATEGORIES (All Services)
    // ============================================================
    select_service: "Select Service",
    select_service_to_add: "Select Service to Add",
    add_service: "Add Service",
    add_new_service: "Add New Service",
    electrician: "Electrician",
    plumber: "Plumber",
    ac_services: "AC Services",
    carpenter: "Carpenter",
    painter: "Painter",
    cleaner: "Cleaner",
    appliance_repair: "Appliance Repair",
    no_services_listed: "No services listed",
    please_select_service: "Please select a service to add",
    
    // ============================================================
    // SECTION 6: EMAIL VERIFICATION
    // ============================================================
    email_verification_required: "Email Verification Required",
    verify_email_message: "Please verify your email to create requests and respond to work opportunities",
    check_inbox: "Check your inbox",
    resend_email: "Resend Email",
    verification_sent: "Verification email sent",
    check_spam: "Check your spam folder",
    please_verify_email: "Please verify your email",
    verify_email: "Verify Email",
    verify_email_before_responding: "Please verify your email before responding to requests.\n\nCheck your inbox for the verification email.",
    account_created_verify_email: "Account created! Please check your email to verify your account before logging in.",
    
    // ============================================================
    // SECTION 7: PASSWORD RESET
    // ============================================================
    reset_password: "Reset Password",
    new_password: "New Password",
    confirm_new_password: "Confirm New Password",
    reset_password_btn: "Reset Password",
    please_enter_email: "Please enter your email address",
    please_enter_valid_email: "Please enter a valid email address",
    password_reset_email_sent: "If this email is registered, a password reset link has been sent. Please check your inbox (and spam folder).",
    send_reset_link: "Send Reset Link",
    reset_password_intro: "Enter your registered email address and we'll send you a link to reset your password.",
    email_address: "Email Address",
    
    // ============================================================
    // SECTION 8: DASHBOARD HEADER & NAVIGATION
    // ============================================================
    profile: "Profile",
    send_feedback: "Send Feedback",
    need_help: "Need Help",
    terms_conditions: "Terms & Conditions",
    privacy_policy: "Privacy Policy",
    logout: "Logout",
    back: "Back",
    contact: "Contact",
    
    // ============================================================
    // SECTION 9: DASHBOARD SECTIONS (Main Tab Headings)
    // ============================================================
    open_requests: "OPEN REQUESTS",
    active_requests: "ACTIVE REQUESTS",
    my_responses: "MY RESPONSES",
    work_opportunities: "WORK OPPORTUNITIES",
    
    // ============================================================
    // SECTION 10: DASHBOARD SUB-TABS (Filter Categories)
    // ============================================================
    no_response: "No Response",
    negotiating: "Negotiating",
    in_progress: "In Progress",
    waiting: "Waiting",
    review: "Review",
    completed: "Completed",
    available_work: "Available Work",
    missed_opportunities: "Missed Opportunities",
    deselected: "DESELECTED",
    reactivated: "REACTIVATED",
    
    // ============================================================
    // SECTION 11: CREATE REQUEST FORM
    // ============================================================
    create_service_request: "Create Service Request",
    service_type: "Service Type",
    title: "Title",
    description: "Description",
    urgency: "Urgency",
    urgent: "Urgent",
    normal: "Normal",
    low: "Low",
    use_different_location: "Check this if service is needed at a different address",
    create_request: "Create Request",
    max_requests_reached: "Maximum 5 open requests reached",
    service_type_cannot_change: "Service type cannot be changed after creation",
    location_cannot_change: "Location and service type cannot be changed after request creation. If you need to change these, please cancel this request and create a new one.",
    update_request: "Update Request",
    creating: "Creating...",
    creating_request: "Creating request...",
    
    // ============================================================
    // SECTION 12: EDIT REQUEST FORM
    // ============================================================
    edit_service_request: "Edit Service Request",
    current_location: "Current Location",
    cannot_edit_after_responses: "Cannot edit request after providers have responded. Please cancel and create a new request.",
    only_open_requests_editable: "Only open requests can be edited.",
    request_updated_success: "Request updated successfully!",
    
    // ============================================================
    // SECTION 13: PROFILE & SETTINGS
    // ============================================================
    edit_profile: "Edit Profile",
    personal_information: "Personal Information",
    change_profile_photo: "Change Profile Photo",
    max_size_2mb: "Max size: 2MB. Leave empty to keep current photo",
    email_id: "Email ID",
    providing_services: "Providing Services",
    not_providing: "Not Providing Services",
    click_to_stop: "Click to Stop",
    click_to_start: "Click to Start",
    remove: "Remove",
    save_changes: "Save Changes",
    rating: "Rating",
    total_requests: "Total Requests Created",
    completed_services: "Completed Services",
    member_since: "Member Since",
    error_loading_profile: "Error loading profile",
    profile_updated: "Profile updated successfully!",
    service_added: "Service added successfully!",
    service_removed: "Service removed successfully!",
    confirm_remove_service: "Remove this service? This will permanently delete it from your profile.",
    saving: "Saving...",
    photo_size_error: "Profile photo size should be less than 2MB",
    uploading_photo: "Uploading new profile photo...",
    updating_location: "Updating location...",
    saving_profile: "Saving profile...",
    no_services_added_update_profile: "You haven't added any services yet. Please update your profile to add services.",
    
    // ============================================================
    // SECTION 14: CHAT INTERFACE
    // ============================================================
    chat: "Chat",
    view_chat: "View Chat",
    type_your_message: "Type your message...",
    send: "Send",
    attach: "Attach",
    quick_templates: "Quick Templates",
    shared_photo: "Shared a photo",
    no_messages_yet: "No messages yet. Start the conversation!",
    request_status: "Request Status",
    
    // ============================================================
    // SECTION 15: CONTACT SHARING (Privacy & Permissions)
    // ============================================================
    request_contact_sharing: "Request Contact Sharing",
    privacy_protected: "Privacy Protected",
    privacy_notice_text: "Phone numbers and addresses are hidden until both parties agree to share contact information.",
    contact_sharing_request: "Contact Sharing Request",
    approve: "Approve",
    decline: "Decline",
    approved: "Approved",
    declined: "Declined",
    contact_visible: "Contact details are now visible to both parties",
    phone: "Phone",
    contact_info_visible_note: "This information is visible because both parties approved contact sharing",
    contact_shared_after_agreement: "Phone number and full contact details will be shared after both parties agree to connect.",
    
    // ============================================================
    // SECTION 16: WORK COMPLETION & WARRANTY
    // ============================================================
    mark_work_complete: "Mark Work Complete",
    mark_complete: "Mark Work Complete",
    select_warranty_period: "Select Warranty Period",
    select_warranty: "Select Warranty Period",
    no_warranty: "No Warranty",
    days_15: "15 Days",      // âœ… KEEP THIS
month_1: "1 Month",      // âœ… KEEP THIS
months_3: "3 Months",    // âœ… KEEP THIS
months_6: "6 Months",    // âœ… KEEP THIS
year_1: "1 Year",        // âœ… KEEP THIS
    confirm_completion: "Confirm Completion",
    accept_completion: "Accept Completion",
    reject_continue_work: "Reject & Continue Work",
    reject_continue: "Reject & Continue Work",
    completion_request: "Work Completion Request",
    warranty_offered: "Warranty offered",
    warranty_left: "days warranty left",
    warranty_expires_today: "Warranty expires today",
    warranty_expired: "Warranty expired",
    no_warranty_offered: "No warranty offered",
    days_warranty_offered: "day(s) warranty offered",
    days_warranty: "day(s) warranty",
    
    // ============================================================
    // SECTION 17: PROVIDER RESPONSES & SELECTION
    // ============================================================
    providers_who_responded: "Providers Who Responded",
    providers_responded: "Providers Who Responded",
    view_profile: "View Profile",
    select_provider: "Select Provider",
    respond: "Respond",
    responded: "Responded",
    no_ratings: "No ratings yet",
    km_away: "km away",
    away: "Away",
    response: "Response",
    responses: "Responses",
    new_badge: "NEW",
    selected: "SELECTED",
    pending: "PENDING",
    pending_approval: "PENDING APPROVAL",
    checking: "Checking...",
    already_responded: "You have already responded to this request!",
    response_sent_success: "Response sent successfully! The seeker will see your response and can chat with you.",
    
    // ============================================================
    // SECTION 18: REQUEST STATUS BADGES
    // ============================================================
    status_open: "OPEN",
    status_in_progress: "IN PROGRESS",
    status_completed: "COMPLETED",
    status_pending: "PENDING",
    status_pending_approval: "PENDING APPROVAL",
    status_readonly: "READ-ONLY",
    status_assigned_other: "ASSIGNED TO ANOTHER PROVIDER",
    status_warranty_expired: "WARRANTY EXPIRED",
    // ADD THESE NEW KEYS:
    full_address: "Full Address",
    service_label: "Service",
    urgency_label: "Urgency",
    keep_existing_warranty: "Keep Existing Warranty",
    days_remaining: "days remaining",
    or_provide_new_warranty: "OR provide new warranty",

    
    // ============================================================
    // SECTION 19: BUTTONS & ACTIONS
    // ============================================================
    btn_create_request: "Create Request",
    btn_edit_request: "Edit Request",
    btn_cancel_request: "Cancel Request",
    btn_view_responses: "View Responses",
    btn_change_provider: "Change Provider",
    btn_reactivate: "Reactivate",
    btn_back: "Back",
    btn_close: "Close",
    btn_save: "Save",
    btn_update: "Update",
    btn_submit: "Submit",
    btn_continue: "Continue",
    btn_skip: "Skip",
    
    // ============================================================
    // SECTION 20: EMPTY STATES (When No Data Available)
    // ============================================================
    no_requests_yet: "No service requests yet",
    no_responses_yet: "No responses yet",
    no_work_available: "No work opportunities available",
    no_messages_yet: "No messages yet",
    no_open_requests: "No open requests",
    no_open_requests_yet: "No open requests yet",
    no_completed_requests: "No completed requests",
    no_in_progress_requests: "No in progress requests",
    no_waiting_requests: "No waiting requests",
    no_reactivated_requests: "No reactivated requests",
    no_urgency_requests: "No {urgency} requests available",
    create_first_request: "Create Your First Request",
    respond_to_start: "Respond to nearby requests to start!",
    
    // ============================================================
    // SECTION 21: SYSTEM MESSAGES (Chat Notifications)
    // ============================================================
    sys_contact_approved: "Contact sharing approved!",
    sys_contact_declined: "Contact sharing request declined",
    sys_work_accepted: "Work completion accepted by customer",
    sys_work_rejected: "Work completion rejected",
    sys_request_completed: "Request is now completed",
    sys_deselected: "You have been deselected for this request",
    sys_request_open_again: "Request is open again",
    sys_reactivated: "Seeker has reactivated this request",
    
    // ============================================================
    // SECTION 22: LOCATION & TIME
    // ============================================================
    location: "Location",
    full_address: "Full Address",
    distance: "Distance",
    km: "km",
    just_now: "Just now",
    minutes_ago: "minutes ago",
    hours_ago: "hours ago",
    days_ago: "days ago",
    weeks_ago: "weeks ago",
    locating_address: "Locating your address...",
    finding_location: "Finding service location...",
    
    // ============================================================
    // SECTION 23: RATING & REVIEW SYSTEM
    // ============================================================
    rate_provider: "Rate Provider",
    how_was_experience: "How was your experience with",
    experience_with: "How was your experience with",
    rating_helps_others: "Your rating helps others make better decisions",
    rating_helps: "Your rating helps others make better decisions",
    select_rating: "Select Rating",
    poor: "Poor",
    fair: "Fair",
    good: "Good",
    very_good: "Very Good",
    excellent: "Excellent",
    review_optional: "Review (Optional)",
    share_your_experience: "Share your experience with others",
    share_experience: "Share your experience with others",
    submit_rating: "Submit Rating",
    recent_reviews: "Recent Reviews",
    ratings: "Ratings",
    rating: "Rating",
    review: "Review",
    reviews: "Reviews",
    please_select_rating: "Please select a rating",
    submitting: "Submitting...",
    rating_submitted: "Rating submitted successfully!",
    click_to_view_full_size: "Click to view full size",
    click_photo_to_view: "Click photo to view full size",
    
    // ============================================================
    // SECTION 24: NOTIFICATIONS - SUCCESS MESSAGES
    // ============================================================
    request_created: "Request created successfully!",
    response_sent: "Response sent successfully!",
    provider_selected: "Provider selected!",
    provider_selected_success: "Provider selected! Opening chat...",
    work_completed: "Work completion accepted!",
    request_cancelled_success: "Request cancelled successfully and removed from all providers",
    
    // ============================================================
    // SECTION 25: NOTIFICATIONS - ERROR MESSAGES
    // ============================================================
    error: "Error",
    error_loading_responses: "Error loading responses",
    error_loading_contact: "Error loading contact details",
    error_submitting_feedback: "Error submitting feedback",
    error_submitting_request: "Error submitting request",
    max_requests_error: "Maximum 5 open requests reached",
    
    // ============================================================
    // SECTION 26: CONFIRMATION DIALOGS
    // ============================================================
    confirm_cancel_request: "Are you sure you want to cancel this request?",
    confirm_logout: "Are you sure you want to logout?",
    permanent_delete: "This will permanently delete the request",
    change_provider_confirm: "Change Provider?",
    change_provider_warning: "This will:\nâ€¢ Deselect the current provider\nâ€¢ Move request back to 'Open' status\nâ€¢ Notify current provider they were deselected\nâ€¢ Reactivate chats with other providers\n\nDo you want to continue?",
    provider_changed_success: "Provider changed successfully!\n\nThe request is now open again and other providers have been notified.",
    reactivate_confirm: "Reactivate this request?",
    reactivate_warning: "The provider will be notified that you need service again within the warranty period. The same process will repeat.",
    request_not_found: "Request not found",
    request_reactivated_success: "Request reactivated! The provider will be notified.",
    select_provider_confirm: "Select this provider? This will change request status to 'In Progress' and open chat.",
    
    // ============================================================
    // SECTION 27: FEEDBACK SYSTEM
    // ============================================================
    send_feedback_title: "Send Feedback",
    help_improve: "Help us improve HelpBuddy!",
    feedback_intro: "Help us improve HelpBuddy! Share your suggestions, report bugs, or request new features. Your feedback helps us serve you better.",
    feedback_type: "Feedback Type",
    bug_report: "Bug Report",
    feature_request: "Feature Request",
    improvement_suggestion: "Improvement Suggestion",
    improvement: "Improvement Suggestion",
    complaint: "Complaint",
    appreciation: "Appreciation",
    other: "Other",
    your_feedback: "Your Feedback",
    feedback_detail: "Please describe your feedback in detail",
    describe_feedback: "Please describe your feedback in detail. Be specific so we can help you better.",
    your_email: "Your Email",
    email_reach_out: "We'll reach out if we need more details",
    using_registered_email: "Using your registered email",
    please_select_feedback_type: "Please select feedback type",
    feedback_min_length: "Please provide at least 10 characters of feedback",
    sending: "Sending...",
    feedback_success_message_part1: "We will contact you at",
    feedback_success_message_part2: "soon.",
    
    // ============================================================
    // SECTION 28: HELP & SUPPORT SYSTEM
    // ============================================================
    get_help_title: "Get Help",
    find_answers: "Find answers to common problems below",
    faq_intro: "Find answers to common problems below. If you don't find what you're looking for, you can contact our support team.",
    still_need_help: "Still need help? Contact Support",
    cant_login: "Can't Login",
    cant_login_solution: "Make sure your email and password are correct. Password is case-sensitive. If you recently signed up, check if you've verified your email address.",
    email_not_received: "Email Verification Not Received",
    email_not_received_solution: "Check your spam/junk folder. The verification email is sent from HelpBuddy. If you still don't see it, try signing up again or contact support.",
    forgot_password_help: "Forgot Password",
    forgot_password_solution: "Click on 'Forgot Password?' link on the login page. Enter your registered email to receive password reset instructions.",
    slow_loading: "Page Loading Slowly",
    slow_loading_solution: "Try refreshing the page (Ctrl+R or Cmd+R). Clear your browser cache and cookies. Check your internet connection. Try using a different browser.",
    account_issues: "Account Issues",
    account_issues_solution: "If your account is locked or suspended, contact support with your registered email. For profile update issues, try logging out and logging back in.",
    email_already_registered: "Email Already Registered",
    email_already_registered_solution: "This email is already in use. Try logging in instead. If you forgot your password, use the 'Forgot Password?' option. If someone else used your email, contact support immediately.",
    issue_type: "Issue Type",
    select_issue_type: "Select Issue Type",
    describe_your_problem: "Describe Your Problem",
    describe_problem_intro: "Describe your problem below and we'll get back to you as soon as possible.",
    describe_problem_placeholder: "Please describe your problem in detail...",
    email_placeholder: "your.email@example.com",
    send_help_request: "Send Help Request",
    please_select_issue_type: "Please select an issue type",
    help_message_min_length: "Please describe your problem (at least 10 characters)",
    please_provide_email: "Please provide your email address",
    help_request_success_part1: "We will contact you at",
    help_request_success_part2: "soon.",
    request_sent_successfully: "Request Sent Successfully!",
    help_request_received: "We've received your help request and will contact you soon.",
    back_to_faq: "Back to FAQ",
    
    // ============================================================
    // SECTION 29: TERMS & CONDITIONS (Legal Page)
    // ============================================================
    last_updated: "Last Updated",
    terms_introduction: "INTRODUCTION",
    terms_definitions: "DEFINITIONS",
    terms_platform_role: "PLATFORM ROLE AND LIMITATIONS",
    terms_user_responsibilities: "USER RESPONSIBILITIES",
    terms_payment: "PAYMENT AND PRICING",
    terms_prohibited: "PROHIBITED CONDUCT",
    terms_content: "CONTENT AND INTELLECTUAL PROPERTY",
    terms_privacy_data: "PRIVACY AND DATA PROTECTION",
    terms_termination: "ACCOUNT TERMINATION",
    terms_liability: "LIMITATION OF LIABILITY",
    terms_dispute: "DISPUTE RESOLUTION",
    terms_governing_law: "GOVERNING LAW",
    terms_changes: "CHANGES TO TERMS",
    terms_contact: "CONTACT INFORMATION",
    terms_severability: "SEVERABILITY",
    terms_acknowledgment: "ACKNOWLEDGMENT",
    important: "IMPORTANT",
    important_reminder: "IMPORTANT REMINDER",
    terms_reminder_text: "HelpBuddy is a connection platform ONLY. We do not employ service providers, guarantee service quality, or handle payments. You are responsible for verifying credentials, negotiating terms, and resolving disputes directly with other users.",
    
    // ============================================================
    // SECTION 30: PRIVACY POLICY (Legal Page)
    // ============================================================
    privacy_introduction: "INTRODUCTION",
    privacy_info_collect: "INFORMATION WE COLLECT",
    privacy_how_use: "HOW WE USE YOUR INFORMATION",
    privacy_how_share: "HOW WE SHARE YOUR INFORMATION",
    privacy_storage: "DATA STORAGE AND SECURITY",
    privacy_retention: "DATA RETENTION",
    privacy_your_rights: "YOUR RIGHTS AND CHOICES",
    privacy_cookies: "COOKIES AND TRACKING",
    privacy_children: "CHILDREN'S PRIVACY",
    privacy_third_party: "THIRD-PARTY SERVICES",
    privacy_changes: "CHANGES TO THIS PRIVACY POLICY",
    privacy_legal: "LEGAL COMPLIANCE",
    privacy_contact: "CONTACT US",
    privacy_grievance: "GRIEVANCE OFFICER",
    your_privacy_matters: "YOUR PRIVACY MATTERS",
    privacy_matters_text: "We are committed to protecting your privacy and being transparent about how we use your data. Your trust is important to us, and we work hard to maintain it.",
    data_controller: "Data Controller",
    response_time: "Response Time",
    
    // ============================================================
    // SECTION 31: MISCELLANEOUS (Common UI Elements)
    // ============================================================
    required: "Required",
    optional: "Optional",
    loading: "Loading...",
    please_wait: "Please wait...",
    retry: "Retry",
    cancel: "Cancel",
    confirm: "Confirm",
    yes: "Yes",
    no: "No",
    ok: "OK",
    done: "Done",
    next: "Next",
    previous: "Previous",
    search: "Search",
    filter: "Filter",
    sort: "Sort",
    all: "All",
    none: "None",
    select: "Select",
    selected_count: "selected",
    clear: "Clear",
    reset: "Reset",
    apply: "Apply",
    more: "More",
    less: "Less",
    show_all: "Show All",
    hide: "Hide",
    expand: "Expand",
    collapse: "Collapse",
    
    // ============================================================
    // SECTION 32: PROVIDER PROFILE DISPLAY
    // ============================================================
    name: "Name",
    services: "Services",
    services_provided: "Services Provided",
    address: "Address",
    note: "Note",
    
    // ============================================================
    // SECTION 33: REQUEST & SERVICE COUNT (Pluralization)
    // ============================================================
    request: "Request",
    requests: "Requests",
    service: "Service",
    
    // ============================================================
    // SECTION 34: LOCATION & GPS
    // ============================================================
    gps_not_supported_message: "GPS not supported by your browser",
    location_required_gps_alert: "Unable to locate address automatically. We'll need to use your GPS location. Please allow location access when prompted.",
    location_access_denied_header: "Location Access Denied",
    gps_permission_denied_message: "\n\nâŒ You denied location access. Please enable location in your browser settings:\n1. Click the lock icon in address bar\n2. Allow location access\n3. Refresh the page and try again",
    gps_signal_unavailable: "\n\nâŒ GPS signal unavailable. Please:\n1. Make sure location services are enabled on your device\n2. Try moving to an open area with better GPS signal\n3. Refresh and try again",
    gps_timeout_message: "\n\nâŒ GPS location took too long. Please:\n1. Check your internet connection\n2. Enable location services\n3. Try again",
    

    select_service_type: "Select Service Type",
    please_select_service_type: "Please select a service type",

    // ============================================================
// SECTION 16: SERVICE TYPE TRANSLATIONS
// ============================================================
// Electrician
electrician_installation: "Electrician - Installation Services",
electrician_repair: "Electrician - Repair Services",
electrician_wiring: "Electrician - New House Wiring/Rewiring",

// Plumber
plumber_installation: "Plumber - Installation Services",
plumber_repair: "Plumber - Repair Services",
plumber_new_work: "Plumber - New House Plumbing Work",

// AC Services
ac_installation: "AC - Installation",
ac_repair_service: "AC - Repair & Servicing",
ac_gas_filling: "AC - Gas Filling",

// Carpenter
carpenter_repair: "Carpenter - Furniture Repair",
carpenter_custom: "Carpenter - Furniture Making (Custom Work)",
carpenter_door_window: "Carpenter - Door & Window Work",

// Painter
painter_house: "Painter - House/Building Painting",
painter_furniture: "Painter - Furniture & Wood Painting",
painter_texture: "Painter - Texture & Decorative Painting",

// Cleaner
cleaner_house: "Cleaner - House Cleaning",
cleaner_upholstery: "Cleaner - Sofa, Carpet & Upholstery Cleaning",
cleaner_vehicle: "Cleaner - Vehicle Cleaning",

// Appliance Repair
appliance_washing: "Appliance Repair - Washing Machine",
appliance_refrigerator: "Appliance Repair - Refrigerator",
appliance_tv: "Appliance Repair - TV/LED",
appliance_geyser: "Appliance Repair - Geyser/Water Heater",
appliance_ro: "Appliance Repair - RO/Water Purifier",
appliance_microwave: "Appliance Repair - Microwave/Oven",
appliance_other: "Appliance Repair - Other Small Appliances",

// Short form service names (used in display)
elec_installation: "Installation Services",
elec_repair: "Repair Services",
elec_wiring: "New House Wiring/Rewiring",

plumb_installation: "Installation Services",
plumb_repair: "Repair Services",
plumb_new_work: "New House Plumbing Work",

ac_installation: "AC Installation",
ac_repair_service: "AC Repair & Servicing",
ac_gas_filling: "AC Gas Filling",

carp_repair: "Furniture Repair",
carp_custom: "Furniture Making (Custom Work)",
carp_door_window: "Door & Window Work",

paint_house: "House/Building Painting",
paint_furniture: "Furniture & Wood Painting",
paint_texture: "Texture & Decorative Painting",

clean_house: "House Cleaning",
clean_upholstery: "Sofa, Carpet & Upholstery Cleaning",
clean_vehicle: "Vehicle Cleaning",

app_washing: "Washing Machine",
app_refrigerator: "Refrigerator",
app_tv: "TV/LED",
app_geyser: "Geyser/Water Heater",
app_ro: "RO/Water Purifier",
app_microwave: "Microwave/Oven",
app_other: "Other Small Appliances",

// ============================================================
// SECTION 17: CONTACT SHARING CONFIRMATION MESSAGES
// ============================================================
confirm_request_contact_sharing: "Do you want to request contact information sharing? The other party will need to approve before details are visible.",
confirm_share_contact_info: "Do you want to share your contact information with this person? Your phone number and address will become visible to them.",
contact_info_shared_success: "Contact information shared successfully! Details are now visible to both parties.",

// ============================================================
// SECTION 18: SERVICE EXAMPLES (Tooltips)
// ============================================================

// Electrician Examples
elec_installation_examples: "Fan installation, Light fitting, Switch/socket installation, Geyser connection, Doorbell installation, Appliance wiring",
elec_repair_examples: "Fan not working, Switchboard issues, Light flickering, Short circuit, MCB tripping, Power socket problems",
elec_wiring_examples: "Complete house wiring, Old wiring replacement, Distribution board setup, Under-construction electrical work, Adding new circuits",

// Plumber Examples
plumb_installation_examples: "Tap/faucet installation, Bathroom fitting, Kitchen sink setup, Water tank installation, Motor/pump installation, Pipeline laying",
plumb_repair_examples: "Tap leaking, Pipe leakage, Toilet flush problems, Drain blockage, Basin clogged, Water overflow issues",
plumb_new_work_examples: "Complete bathroom plumbing, Kitchen plumbing setup, Drainage system, Water supply lines, Under-construction plumbing work",

// AC Services Examples
ac_installation_examples: "New AC installation, AC uninstall & reinstall, Indoor/outdoor unit mounting, Piping & drainage setup, AC shifting",
ac_repair_examples: "AC not cooling, AC cleaning, Filter cleaning, Strange noise, Water leakage, Compressor issues",
ac_gas_examples: "Gas refilling, Low cooling due to gas, Gas leak repair, Pressure check, Cooling performance issues",

// Carpenter Examples
carp_repair_examples: "Bed repair, Chair/sofa fixing, Table repair, Drawer problems, Hinge replacement, Furniture polish touch-up",
carp_custom_examples: "Custom wardrobe, Study table, TV unit, Shoe rack, Kitchen cabinets, Bookshelves",
carp_door_examples: "Door installation/repair, Window frame work, Door lock fitting, Handles & latches, Sliding door tracks, Kitchen cabinet doors",

// Painter Examples
paint_house_examples: "Room painting, Full house painting, Exterior wall painting, Ceiling painting, Balcony painting, Boundary wall painting",
paint_furniture_examples: "Door painting, Window frames, Wooden furniture, Cupboard painting, Railing painting, Wood varnish work",
paint_texture_examples: "Textured walls, Designer finishes, Kids room designs, Stencil art, Accent walls, Special effects",

// Cleaner Examples
clean_house_examples: "Room cleaning, Kitchen deep clean, Bathroom cleaning, Floor mopping, Balcony cleaning, Full house cleaning",
clean_upholstery_examples: "Sofa cleaning, Carpet shampooing, Mattress cleaning, Curtain cleaning, Chair upholstery, Fabric deep cleaning",
clean_vehicle_examples: "Car washing, Bike cleaning, Car interior cleaning, Vehicle detailing, Dashboard cleaning, Seat shampooing",

// Appliance Repair Examples
app_washing_examples: "Not spinning, Water not draining, Not starting, Making noise, Door not closing, Drum problems",
app_refrigerator_examples: "Not cooling, Freezer issues, Strange noise, Water leakage, Ice formation, Door seal problems",
app_tv_examples: "No display, Screen flickering, No sound, Lines on screen, Remote not working, HDMI port issues",
app_geyser_examples: "Not heating water, Thermostat issues, Leaking water, Gas ignition problem, Heating element fault, Pilot light issues",
app_ro_examples: "Not purifying, Low water flow, Filter change, TDS issues, Leaking, Motor not working",
app_microwave_examples: "Not heating, Turntable not rotating, Door latch broken, Display issues, Strange sounds, Sparking inside",
app_other_examples: "Fan repair, Mixer not working, Grinder issues, Iron problems, Cooler pump, Water pump, Chimney repair",

// Seeker Templates
'templates.seeker.initial_contact.title': 'ðŸ’¬ Initial Contact',
'templates.seeker.initial_contact.item1': 'Hi! Can you provide more details about the service?',
'templates.seeker.initial_contact.item2': 'What is your availability for this work?',
'templates.seeker.initial_contact.item3': 'Can you share your experience with similar work?',

'templates.seeker.scheduling.title': 'ðŸ“… Scheduling',
'templates.seeker.scheduling.item1': 'When can you start the work?',
'templates.seeker.scheduling.item2': 'How long will it take to complete?',
'templates.seeker.scheduling.item3': 'Can you come today or tomorrow?',

'templates.seeker.pricing.title': 'ðŸ’° Pricing',
'templates.seeker.pricing.item1': 'What will be the estimated cost?',
'templates.seeker.pricing.item2': 'Do you charge for inspection/visit?',
'templates.seeker.pricing.item3': 'Is this price negotiable?',

'templates.seeker.additional_info.title': 'â„¹ï¸ Additional Info',
'templates.seeker.additional_info.item1': 'Do you have the necessary tools and equipment?',
'templates.seeker.additional_info.item2': 'Will you provide materials or should I arrange them?',
'templates.seeker.additional_info.item3': 'Can you share photos of previous work?',
'templates.seeker.additional_info.item4': 'Do you offer any warranty on your work?',

'templates.seeker.contact_finalization.title': 'ðŸ¤ Contact & Finalization',
'templates.seeker.contact_finalization.item1': 'Let\'s finalize this deal. Can we exchange contact details?',
'templates.seeker.contact_finalization.item2': 'I\'d like to proceed with you. When can we meet?',
'templates.seeker.contact_finalization.item3': 'Sounds good! Please share your contact number.',

// Provider Templates
'templates.provider.response.title': 'ðŸ‘‹ Response',
'templates.provider.response.item1': 'Hi! I\'m available and interested in this work.',
'templates.provider.response.item2': 'I have experience in this type of work. Happy to help!',
'templates.provider.response.item3': 'I can start immediately. Let me know if you\'d like to proceed.',

'templates.provider.pricing.title': 'ðŸ’° Pricing',
'templates.provider.pricing.item1': 'The estimated cost will be around â‚¹XXX.',
'templates.provider.pricing.item2': 'I can provide a detailed quote after inspection.',
'templates.provider.pricing.item3': 'No charges for initial visit and inspection.',

'templates.provider.information_requests.title': 'â„¹ï¸ Information Requests',
'templates.provider.information_requests.item1': 'Can you share more details or photos of the problem?',
'templates.provider.information_requests.item2': 'What is your preferred time for the visit?',
'templates.provider.information_requests.item3': 'Are there any specific requirements I should know about?',

'templates.provider.contact_finalization.title': 'ðŸ¤ Contact & Finalization',
'templates.provider.contact_finalization.item1': 'I\'m ready to start. Can we exchange contact details?',
'templates.provider.contact_finalization.item2': 'Please share your address so I can visit.',
'templates.provider.contact_finalization.item3': 'Let\'s finalize the schedule. Here\'s my contact number.',

'templates.provider.service_completion.title': 'âœ… Service Completion',
'templates.provider.service_completion.item1': 'Work completed successfully. Please check and confirm.',
'templates.provider.service_completion.item2': 'Everything is done. Let me know if you need any adjustments.',
'templates.provider.service_completion.item3': 'The service is complete. Feel free to contact me during warranty period.',

'sys_selected': 'ðŸŽ‰ Congratulations! You have been selected for this service request',
'sys_selected_description': 'The customer has chosen you to complete this work. Please proceed with the service and keep the customer updated on your progress.',

// Provider Stopped Service - Read-Only Chat
read_only_provider_stopped: "Provider has stopped providing this service. Please select another provider.",
status_readonly_provider_stopped: "Provider Stopped Service",
service_no_longer_available: "Service No Longer Available",

// System notification messages (for chat)
provider_stopped_notification: "{providerName} has stopped providing {serviceName} and cannot complete your request. Please select another provider.",

  },
  
  // ============================================================
  // ============================================================
  // HINDI TRANSLATIONS (à¤¹à¤¿à¤‚à¤¦à¥€ à¤…à¤¨à¥à¤µà¤¾à¤¦)
  // ============================================================
  // ============================================================
  
  hi: {
    // ============================================================
    // SECTION 1: GENERAL APP & BRANDING
    // ============================================================
    app_name: "HelpBuddy",
    
    // ============================================================
    // SECTION 2: USER ROLES & IDENTITY
    // ============================================================
    seeker: "à¤‰à¤ªà¤­à¥‹à¤•à¥à¤¤à¤¾",
    provider: "à¤¸à¥‡à¤µà¤¾ à¤ªà¥à¤°à¤¦à¤¾à¤¤à¤¾",
    seeker_mode: "à¤‰à¤ªà¤­à¥‹à¤•à¥à¤¤à¤¾",
    provider_mode: "à¤¸à¥‡à¤µà¤¾ à¤ªà¥à¤°à¤¦à¤¾à¤¤à¤¾",
    
    // ============================================================
    // SECTION 3: AUTHENTICATION - LOGIN PAGE
    // ============================================================
    welcome_back: "à¤†à¤ªà¤•à¤¾ à¤¸à¥à¤µà¤¾à¤—à¤¤ à¤¹à¥ˆ",
    email: "Email",
    password: "Password",
    login: "à¤¦à¤¾à¤–à¤¿à¤² à¤¹à¥‹à¤‚",
    forgot_password: "Password à¤­à¥‚à¤² à¤—à¤?",
    get_help: "à¤®à¤¦à¤¦ à¤šà¤¾à¤¹à¤¿à¤",
    sign_up_link: "à¤¨à¤ à¤–à¤¾à¤¤à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤¸à¤¾à¤‡à¤¨ à¤…à¤ª à¤•à¤°à¥‡à¤‚",
    dont_have_account: "à¤–à¤¾à¤¤à¤¾ à¤¨à¤¹à¥€à¤‚ à¤¹à¥ˆ?",
    invalid_credentials: "Email à¤¯à¤¾ Password à¤—à¤²à¤¤ à¤¹à¥ˆ",
    
    // ============================================================
    // SECTION 4: AUTHENTICATION - SIGNUP PAGE
    // ============================================================
    create_account: "à¤¨à¤¯à¤¾ à¤–à¤¾à¤¤à¤¾ à¤¬à¤¨à¤¾à¤à¤‚",
    full_name: "à¤ªà¥‚à¤°à¤¾ à¤¨à¤¾à¤®",
    phone_number: "à¤®à¥‹à¤¬à¤¾à¤‡à¤² à¤¨à¤‚à¤¬à¤°",
    enter_correct_number: "à¤¸à¤¹à¥€ à¤¨à¤‚à¤¬à¤° à¤¡à¤¾à¤²à¥‡à¤‚",
    invalid_phone: "à¤¸à¤¹à¥€ à¤®à¥‹à¤¬à¤¾à¤‡à¤² à¤¨à¤‚à¤¬à¤° à¤¡à¤¾à¤²à¥‡à¤‚",
    house_number: "à¤˜à¤° à¤¨à¤‚à¤¬à¤°",
    area_name: "à¤®à¥‹à¤¹à¤²à¥à¤²à¤¾/ à¤‡à¤²à¤¾à¤•à¤¾",
    landmark: "à¤•à¥‹à¤ˆ à¤¨à¤¿à¤¶à¤¾à¤¨à¥€",
    city: "à¤¶à¤¹à¤°",
    state: "à¤°à¤¾à¤œà¥à¤¯",
    pin_code: "PIN à¤•à¥‹à¤¡",
    select_state: "à¤°à¤¾à¤œà¥à¤¯ à¤šà¥à¤¨à¥‡à¤‚",
    address_details: "à¤ªà¤¤à¥‡ à¤•à¥€ à¤œà¤¾à¤¨à¤•à¤¾à¤°à¥€",
    i_want_to_provide: "à¤®à¥ˆà¤‚ à¤¸à¥‡à¤µà¤¾ à¤¦à¥‡à¤¨à¤¾ à¤šà¤¾à¤¹à¤¤à¤¾ à¤¹à¥‚à¤‚",
    provider_settings: "à¤¸à¥‡à¤µà¤¾ à¤ªà¥à¤°à¤¦à¤¾à¤¤à¤¾ à¤•à¥€ à¤¸à¥‡à¤Ÿà¤¿à¤‚à¤—",
    service_radius: "à¤•à¤¾à¤® à¤•à¤°à¤¨à¥‡ à¤•à¤¾ à¤•à¥à¤·à¥‡à¤¤à¥à¤° ",
    services_i_provide: "à¤®à¥ˆà¤‚ à¤¯à¥‡ à¤¸à¥‡à¤µà¤¾à¤à¤‚ à¤¦à¥‡à¤¤à¤¾ à¤¹à¥‚à¤‚",
    i_agree_to: "à¤®à¥ˆà¤‚ à¤®à¤¾à¤¨à¤¤à¤¾ à¤¹à¥‚à¤‚",
    and: "à¤”à¤°",
    sign_up: "à¤¨à¤¯à¤¾ à¤–à¤¾à¤¤à¤¾ à¤¬à¤¨à¤¾à¤à¤‚",
    back_to_login: "à¤²à¥‰à¤—à¤¿à¤¨ à¤ªà¤° à¤œà¤¾à¤à¤‚",
    already_have_account: "à¤†à¤ªà¤•à¤¾ à¤–à¤¾à¤¤à¤¾ à¤ªà¤¹à¤²à¥‡ à¤¸à¥‡ à¤¹à¥ˆ?",
    email_registered: "à¤¯à¥‡ Email à¤ªà¤¹à¤²à¥‡ à¤¸à¥‡ à¤¹à¥ˆ",
    
    // ============================================================
    // SECTION 5: SERVICE CATEGORIES (All Services)
    // ============================================================
    select_service: "à¤¸à¥‡à¤µà¤¾ à¤šà¥à¤¨à¥‡à¤‚",
    select_service_to_add: "à¤œà¥‹à¤¡à¤¼à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤¸à¥‡à¤µà¤¾ à¤šà¥à¤¨à¥‡à¤‚",
    add_service: "à¤¸à¥‡à¤µà¤¾ à¤œà¥‹à¤¡à¤¼à¥‡à¤‚",
    add_new_service: "à¤¨à¤ˆ à¤¸à¥‡à¤µà¤¾ à¤œà¥‹à¤¡à¤¼à¥‡à¤‚",
    electrician: "à¤¬à¤¿à¤œà¤²à¥€ à¤®à¤¿à¤¸à¥à¤¤à¥à¤°à¥€ ",
    plumber: "à¤ªà¤¾à¤¨à¥€ à¤«à¤¿à¤Ÿà¤¿à¤‚à¤— ( à¤ªà¥à¤²à¤‚à¤¬à¤° )",
    ac_services: "AC à¤•à¤¾ à¤•à¤¾à¤®",
    carpenter: "à¤²à¤•à¥œà¥€ à¤•à¤¾à¤°à¥€à¤—à¤° ( à¤¬à¤¢à¤¼à¤ˆ )",
    painter: "à¤ªà¥‡à¤‚à¤Ÿà¤°",
    cleaner: "à¤¸à¤«à¤¾à¤ˆ à¤µà¤¾à¤²à¤¾",
    appliance_repair: "à¤‰à¤ªà¤•à¤°à¤£à¥‹à¤‚ à¤•à¥€ à¤®à¤°à¤®à¥à¤®à¤¤",
    no_services_listed: "à¤•à¥‹à¤ˆ à¤¸à¥‡à¤µà¤¾ à¤¨à¤¹à¥€à¤‚",
    please_select_service: "à¤•à¥ƒà¤ªà¤¯à¤¾ à¤œà¥‹à¤¡à¤¼à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤à¤• à¤¸à¥‡à¤µà¤¾ à¤šà¥à¤¨à¥‡à¤‚",
    
    // ============================================================
    // SECTION 6: EMAIL VERIFICATION
    // ============================================================
    email_verification_required: "Email à¤œà¤¾à¤‚à¤š à¤œà¤°à¥‚à¤°à¥€ à¤¹à¥ˆ",
    verify_email_message: "à¤à¤ª à¤‡à¤¸à¥à¤¤à¥‡à¤®à¤¾à¤² à¤•à¥‡ à¤²à¤¿à¤ Email à¤œà¤¾à¤‚à¤š à¤œà¤°à¥‚à¤°à¥€ à¤¹à¥ˆ",
    check_inbox: "à¤…à¤ªà¤¨à¤¾ Inbox à¤¦à¥‡à¤–à¥‡à¤‚",
    resend_email: "Email à¤¦à¥‹à¤¬à¤¾à¤°à¤¾ à¤­à¥‡à¤œà¥‡à¤‚",
    verification_sent: "à¤œà¤¾à¤‚à¤š à¤•à¥‡ à¤²à¤¿à¤ Email à¤­à¥‡à¤œà¤¾ à¤—à¤¯à¤¾ à¤¹à¥ˆ",
    check_spam: "Spam folder à¤­à¥€ à¤¦à¥‡à¤–à¥‡à¤‚",
    please_verify_email: "à¤•à¥ƒà¤ªà¤¾ Email à¤¸à¤¤à¥à¤¯à¤¾à¤ªà¤¿à¤¤ à¤•à¤°à¥‡à¤‚",
    verify_email: "Email à¤¸à¤¤à¥à¤¯à¤¾à¤ªà¤¿à¤¤ à¤•à¤°à¥‡à¤‚",
    verify_email_before_responding: "à¤…à¤¨à¥à¤°à¥‹à¤§ à¤•à¤¾ à¤œà¤µà¤¾à¤¬ à¤¦à¥‡à¤¨à¥‡ à¤¸à¥‡ à¤ªà¤¹à¤²à¥‡ à¤…à¤ªà¤¨à¤¾ Email à¤¸à¤¤à¥à¤¯à¤¾à¤ªà¤¿à¤¤ à¤•à¤°à¥‡à¤‚à¥¤\n\nðŸ“§ à¤…à¤ªà¤¨à¤¾ Inbox à¤¦à¥‡à¤–à¥‡à¤‚à¥¤",
    account_created_verify_email: "à¤–à¤¾à¤¤à¤¾ à¤¬à¤¨ à¤—à¤¯à¤¾! à¤²à¥‰à¤—à¤¿à¤¨ à¤•à¤°à¤¨à¥‡ à¤¸à¥‡ à¤ªà¤¹à¤²à¥‡ à¤…à¤ªà¤¨à¤¾ Email à¤¸à¤¤à¥à¤¯à¤¾à¤ªà¤¿à¤¤ à¤•à¤°à¥‡à¤‚à¥¤",
    
    // ============================================================
    // SECTION 7: PASSWORD RESET
    // ============================================================
    reset_password: "Password à¤¦à¥à¤¬à¤¾à¤°à¤¾ à¤¬à¤¨à¤¾à¤¯à¥‡",
    new_password: "à¤¨à¤¯à¤¾ Password",
    confirm_new_password: "à¤¨à¤ Password à¤•à¥€ à¤ªà¥à¤·à¥à¤Ÿà¤¿ à¤•à¤°à¥‡à¤‚",
    reset_password_btn: "Password à¤°à¥€à¤¸à¥‡à¤Ÿ à¤•à¤°à¥‡à¤‚",
    please_enter_email: "à¤•à¥ƒà¤ªà¤¯à¤¾ à¤…à¤ªà¤¨à¤¾ Email ID à¤¦à¤°à¥à¤œ à¤•à¤°à¥‡à¤‚",
    please_enter_valid_email: "à¤•à¥ƒà¤ªà¤¯à¤¾ à¤à¤• à¤®à¤¾à¤¨à¥à¤¯ Email ID à¤¦à¤°à¥à¤œ à¤•à¤°à¥‡à¤‚",
    password_reset_email_sent: "à¤¯à¤¦à¤¿ à¤¯à¤¹ Email à¤ªà¤‚à¤œà¥€à¤•à¥ƒà¤¤ à¤¹à¥ˆ, à¤¤à¥‹ Password à¤°à¥€à¤¸à¥‡à¤Ÿ à¤²à¤¿à¤‚à¤• à¤­à¥‡à¤œà¤¾ à¤—à¤¯à¤¾ à¤¹à¥ˆà¥¤ à¤•à¥ƒà¤ªà¤¯à¤¾ à¤…à¤ªà¤¨à¤¾ Inbox (à¤”à¤° Spam folder) à¤œà¤¾à¤‚à¤šà¥‡à¤‚à¥¤",
    send_reset_link: "à¤°à¥€à¤¸à¥‡à¤Ÿ à¤²à¤¿à¤‚à¤• à¤­à¥‡à¤œà¥‡à¤‚",
    reset_password_intro: "à¤…à¤ªà¤¨à¤¾ à¤ªà¤‚à¤œà¥€à¤•à¥ƒà¤¤ Email à¤ªà¤¤à¤¾ à¤¦à¤°à¥à¤œ à¤•à¤°à¥‡à¤‚ à¤”à¤° à¤¹à¤® à¤†à¤ªà¤•à¥‹ Password à¤°à¥€à¤¸à¥‡à¤Ÿ à¤²à¤¿à¤‚à¤• à¤­à¥‡à¤œà¥‡à¤‚à¤—à¥‡à¥¤",
    email_address: "Email à¤ªà¤¤à¤¾",
    
    // ============================================================
    // SECTION 8: DASHBOARD HEADER & NAVIGATION
    // ============================================================
    profile: "à¤®à¥‡à¤°à¥€ à¤œà¤¾à¤¨à¤•à¤¾à¤°à¥€",
    send_feedback: "à¤°à¤¾à¤¯ à¤¦à¥‡à¤‚",
    need_help: "à¤®à¤¦à¤¦ à¤šà¤¾à¤¹à¤¿à¤",
    terms_conditions: "à¤¨à¤¿à¤¯à¤® à¤”à¤° à¤¶à¤°à¥à¤¤à¥‡à¤‚",
    privacy_policy: "à¤—à¥‹à¤ªà¤¨à¥€à¤¯à¤¤à¤¾ à¤¨à¥€à¤¤à¤¿",
    logout: "à¤¬à¤¾à¤¹à¤° à¤¨à¤¿à¤•à¤²à¥‡à¤‚",
    back: "à¤µà¤¾à¤ªà¤¸",
    contact: "à¤¸à¤‚à¤ªà¤°à¥à¤•",
    
    // ============================================================
    // SECTION 9: DASHBOARD SECTIONS (Main Tab Headings)
    // ============================================================
    open_requests: "à¤–à¥à¤²à¥‡ à¤…à¤¨à¥à¤°à¥‹à¤§à¤‚",
    active_requests: "à¤¸à¤•à¥à¤°à¤¿à¤¯ à¤…à¤¨à¥à¤°à¥‹à¤§",
    my_responses: "à¤®à¥‡à¤°à¥‡ à¤œà¤µà¤¾à¤¬",
    work_opportunities: "à¤•à¤¾à¤®  à¤•à¥‡ à¤…à¤µà¤¸à¤° ",
    
    // ============================================================
    // SECTION 10: DASHBOARD SUB-TABS (Filter Categories)
    // ============================================================
    no_response: "à¤¬à¤¿à¤¨à¤¾ à¤ªà¥à¤°à¤¤à¤¿à¤•à¥à¤°à¤¿à¤¯à¤¾",
    negotiating: "à¤¬à¤¾à¤¤à¤šà¥€à¤¤ à¤œà¤¾à¤°à¥€",
    in_progress: "à¤•à¤¾à¤°à¥à¤¯ à¤ªà¥à¤°à¤—à¤¤à¤¿ à¤®à¥‡à¤‚",
    waiting: "à¤¸à¤®à¥€à¤•à¥à¤·à¤¾ à¤¬à¤¾à¤•à¤¿",
    review: "à¤¸à¤®à¥€à¤•à¥à¤·à¤¾ à¤•à¤°à¥‡à¤‚",
    completed: "à¤•à¤¾à¤°à¥à¤¯ à¤ªà¥‚à¤°à¥à¤£",
    available_work: "à¤•à¤¾à¤® à¤‰à¤ªà¤²à¤¬à¥à¤§",
    missed_opportunities: "à¤›à¥‚à¤Ÿ à¤—à¤¯à¤¾",
    deselected: "à¤¹à¤Ÿà¤¾à¤¯à¤¾ à¤—à¤¯à¤¾",
    reactivated: "à¤«à¤¿à¤° à¤¸à¥‡ à¤–à¥à¤²à¤¾",
    
    // ============================================================
    // SECTION 11: CREATE REQUEST FORM
    // ============================================================
    create_service_request: "à¤¸à¥‡à¤µà¤¾ à¤•à¥‡ à¤²à¤¿à¤ à¤…à¤¨à¥à¤°à¥‹à¤§ à¤•à¤°à¥‡à¤‚",
    service_type: "à¤•à¤¿à¤¸ à¤•à¤¾à¤® à¤•à¥€ à¤œà¤°à¥‚à¤°à¤¤ à¤¹à¥ˆ",
    title: "à¤•à¤¾à¤® à¤•à¤¾ à¤¶à¥€à¤°à¥à¤·à¤•",
    description: "à¤•à¤¾à¤® à¤•à¥€ à¤ªà¥‚à¤°à¥€ à¤œà¤¾à¤¨à¤•à¤¾à¤°à¥€",
    urgency: "à¤œà¤°à¥‚à¤°à¤¤",
    urgent: "à¤¬à¤¹à¥à¤¤ à¤œà¤°à¥‚à¤°à¥€",
    normal: "à¤œà¤°à¥‚à¤°à¥€",
    low: "à¤¸à¤¾à¤®à¤¾à¤¨à¥à¤¯",
    use_different_location: "à¤…à¤—à¤° à¤¸à¥‡à¤µà¤¾ à¤•à¤¿à¤¸à¥€ à¤…à¤¨à¥à¤¯ à¤ªà¤¤à¥‡ à¤ªà¤° à¤šà¤¾à¤¹à¤¿à¤ à¤¤à¥‹ à¤‡à¤¸à¥‡ à¤Ÿà¤¿à¤• à¤•à¤°à¥‡à¤‚",
    create_request: "à¤¨à¤ à¤…à¤¨à¥à¤°à¥‹à¤§ à¤•à¤°à¥‡à¤‚",
    max_requests_reached: "5 à¤¸à¥‡ à¤œà¥à¤¯à¤¾à¤¦à¤¾ à¤–à¥à¤²à¥‡ à¤…à¤¨à¥à¤°à¥‹à¤§ à¤¨à¤¹à¥€à¤‚ à¤¹à¥‹ à¤¸à¤•à¤¤à¥‡",
    service_type_cannot_change: "à¤…à¤¬ à¤¸à¥‡à¤µà¤¾ à¤•à¤¾ à¤ªà¥à¤°à¤•à¤¾à¤° à¤¨à¤¹à¥€à¤‚ à¤¬à¤¦à¤²à¤¾ à¤œà¤¾ à¤¸à¤•à¤¤à¤¾",
    location_cannot_change: "à¤…à¤¬ à¤¸à¥‡à¤µà¤¾ à¤•à¤¾ à¤¸à¥à¤¥à¤¾à¤¨ à¤µ à¤ªà¥à¤°à¤•à¤¾à¤° à¤¨à¤¹à¥€à¤‚ à¤¬à¤¦à¤²à¤¾ à¤œà¤¾ à¤¸à¤•à¤¤à¤¾à¥¤ à¤‡à¤¨à¥à¤¹à¥‡à¤‚ à¤¬à¤¦à¤²à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤, à¤•à¥ƒà¤ªà¤¯à¤¾ à¤¯à¤¹ à¤…à¤¨à¥à¤°à¥‹à¤§ à¤°à¤¦à¥à¤¦ à¤•à¤°à¥‡à¤‚ à¤”à¤° à¤¨à¤¯à¤¾ à¤¬à¤¨à¤¾à¤à¤‚à¥¤",
    update_request: "à¤…à¤¨à¥à¤°à¥‹à¤§ à¤…à¤ªà¤¡à¥‡à¤Ÿ à¤•à¤°à¥‡à¤‚",
    creating: "à¤¬à¤¨à¤¾ à¤°à¤¹à¥‡ à¤¹à¥ˆà¤‚...",
    creating_request: "à¤…à¤¨à¥à¤°à¥‹à¤§ à¤¬à¤¨à¤¾ à¤°à¤¹à¥‡ à¤¹à¥ˆà¤‚...",
    
    // ============================================================
    // SECTION 12: EDIT REQUEST FORM
    // ============================================================
    edit_service_request: "à¤¸à¥‡à¤µà¤¾ à¤…à¤¨à¥à¤°à¥‹à¤§ à¤¸à¥à¤§à¤¾à¤°à¥‡à¤‚",
    current_location: "à¤µà¤°à¥à¤¤à¤®à¤¾à¤¨ à¤¸à¥à¤¥à¤¾à¤¨",
    cannot_edit_after_responses: "à¤ªà¥à¤°à¤¦à¤¾à¤¤à¤¾à¤“à¤‚ à¤•à¥‡ à¤œà¤µà¤¾à¤¬ à¤¦à¥‡à¤¨à¥‡ à¤•à¥‡ à¤¬à¤¾à¤¦ à¤…à¤¨à¥à¤°à¥‹à¤§ à¤•à¥‹ à¤¸à¥à¤§à¤¾à¤°à¤¾ à¤¨à¤¹à¥€à¤‚ à¤œà¤¾ à¤¸à¤•à¤¤à¤¾à¥¤ à¤•à¥ƒà¤ªà¤¯à¤¾ à¤°à¤¦à¥à¤¦ à¤•à¤°à¥‡à¤‚ à¤”à¤° à¤¨à¤¯à¤¾ à¤…à¤¨à¥à¤°à¥‹à¤§ à¤¬à¤¨à¤¾à¤à¤‚à¥¤",
    only_open_requests_editable: "à¤•à¥‡à¤µà¤² à¤¬à¤¿à¤¨à¤¾ à¤ªà¥à¤°à¤¤à¤¿à¤•à¥à¤°à¤¿à¤¯à¤¾ à¤•à¥‡ à¤…à¤¨à¥à¤°à¥‹à¤§à¥‹à¤‚ à¤•à¥‹ à¤¸à¥à¤§à¤¾à¤°à¤¾ à¤•à¤¿à¤¯à¤¾ à¤œà¤¾ à¤¸à¤•à¤¤à¤¾ à¤¹à¥ˆà¥¤",
    request_updated_success: "à¤…à¤¨à¥à¤°à¥‹à¤§ à¤¸à¤«à¤²à¤¤à¤¾à¤ªà¥‚à¤°à¥à¤µà¤• à¤¸à¥à¤§à¤¾à¤°à¤¾ à¤—à¤¯à¤¾!",
    
    // ============================================================
    // SECTION 13: PROFILE & SETTINGS
    // ============================================================
    edit_profile: "à¤œà¤¾à¤¨à¤•à¤¾à¤°à¥€ à¤®à¥‡à¤‚ à¤¬à¤¦à¤²à¤¾à¤µ à¤•à¤°à¥‡à¤‚",
    personal_information: "à¤†à¤ªà¤•à¥€ à¤œà¤¾à¤¨à¤•à¤¾à¤°à¥€",
    change_profile_photo: "à¤«à¥‹à¤Ÿà¥‹ à¤¬à¤¦à¤²à¥‡à¤‚",
    max_size_2mb: "2MB à¤¸à¥‡ à¤•à¤®à¥¤ à¤–à¤¾à¤²à¥€ à¤›à¥‹à¤¡à¤¼à¥‡à¤‚ à¤¤à¥‹ à¤ªà¥à¤°à¤¾à¤¨à¥€ à¤«à¥‹à¤Ÿà¥‹ à¤°à¤¹à¥‡à¤—à¥€",
    email_id: "Email ID",
    providing_services: "à¤¸à¥‡à¤µà¤¾ à¤¦à¥‡ à¤°à¤¹à¥‡ à¤¹à¥ˆà¤‚",
    not_providing: "à¤¸à¥‡à¤µà¤¾ à¤¨à¤¹à¥€à¤‚ à¤¦à¥‡ à¤°à¤¹à¥‡",
    click_to_stop: "à¤¬à¤‚à¤¦ à¤•à¤°à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤¦à¤¬à¤¾à¤à¤‚",
    click_to_start: "à¤¶à¥à¤°à¥‚ à¤•à¤°à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤¦à¤¬à¤¾à¤à¤‚",
    remove: "à¤¹à¤Ÿà¤¾à¤à¤‚",
    save_changes: "à¤¬à¤¦à¤²à¤¾à¤µ à¤•à¤°à¥‡à¤‚",
    rating: "à¤°à¥‡à¤Ÿà¤¿à¤‚à¤—",
    total_requests: "à¤•à¥à¤² à¤…à¤¨à¥à¤°à¥‹à¤§",
    completed_services: "à¤ªà¥‚à¤°à¥€ à¤•à¥€ à¤—à¤ˆ à¤¸à¥‡à¤µà¤¾à¤à¤‚",
    member_since: "à¤•à¤¬ à¤¸à¥‡ à¤œà¥à¤¡à¤¼à¥‡",
    error_loading_profile: "à¤œà¤¾à¤¨à¤•à¤¾à¤°à¥€ à¤²à¥‹à¤¡ à¤•à¤°à¤¨à¥‡ à¤®à¥‡à¤‚ à¤¸à¤®à¤¸à¥à¤¯à¤¾",
    profile_updated: "à¤œà¤¾à¤¨à¤•à¤¾à¤°à¥€ à¤¬à¤¦à¤² à¤—à¤ˆ!",
    service_added: "à¤¸à¥‡à¤µà¤¾ à¤œà¥à¤¡à¤¼ à¤—à¤ˆ!",
    service_removed: "à¤¸à¥‡à¤µà¤¾ à¤¹à¤Ÿà¤¾ à¤¦à¥€ à¤—à¤ˆ!",
    confirm_remove_service: "à¤‡à¤¸ à¤¸à¥‡à¤µà¤¾ à¤•à¥‹ à¤¹à¤Ÿà¤¾à¤¨à¤¾ à¤¹à¥ˆ? à¤¯à¤¹ à¤†à¤ªà¤•à¥€ à¤ªà¥à¤°à¥‹à¤«à¤¾à¤‡à¤² à¤¸à¥‡ à¤¸à¥à¤¥à¤¾à¤¯à¥€ à¤°à¥‚à¤ª à¤¸à¥‡ à¤¹à¤Ÿ à¤œà¤¾à¤à¤—à¥€à¥¤",
    saving: "à¤¸à¤¹à¥‡à¤œ à¤°à¤¹à¥‡ à¤¹à¥ˆà¤‚...",
    photo_size_error: "à¤ªà¥à¤°à¥‹à¤«à¤¾à¤‡à¤² à¤«à¥‹à¤Ÿà¥‹ à¤•à¤¾ à¤¸à¤¾à¤‡à¤œ 2MB à¤¸à¥‡ à¤•à¤® à¤¹à¥‹à¤¨à¤¾ à¤šà¤¾à¤¹à¤¿à¤",
    uploading_photo: "à¤¨à¤ˆ à¤ªà¥à¤°à¥‹à¤«à¤¾à¤‡à¤² à¤«à¥‹à¤Ÿà¥‹ à¤…à¤ªà¤²à¥‹à¤¡ à¤¹à¥‹ à¤°à¤¹à¥€ à¤¹à¥ˆ...",
    updating_location: "à¤¸à¥à¤¥à¤¾à¤¨ à¤…à¤ªà¤¡à¥‡à¤Ÿ à¤¹à¥‹ à¤°à¤¹à¤¾ à¤¹à¥ˆ...",
    saving_profile: "à¤ªà¥à¤°à¥‹à¤«à¤¾à¤‡à¤² à¤¸à¤¹à¥‡à¤œà¤¾ à¤œà¤¾ à¤°à¤¹à¤¾ à¤¹à¥ˆ...",
    no_services_added_update_profile: "à¤†à¤ªà¤¨à¥‡ à¤…à¤­à¥€ à¤¤à¤• à¤•à¥‹à¤ˆ à¤¸à¥‡à¤µà¤¾ à¤¨à¤¹à¥€à¤‚ à¤œà¥‹à¤¡à¤¼à¥€ à¤¹à¥ˆà¥¤ à¤•à¥ƒà¤ªà¤¯à¤¾ à¤…à¤ªà¤¨à¥€ à¤ªà¥à¤°à¥‹à¤«à¤¾à¤‡à¤² à¤…à¤ªà¤¡à¥‡à¤Ÿ à¤•à¤°à¥‡à¤‚à¥¤",
    your_services: "à¤†à¤ªà¤•à¥€ à¤¸à¥‡à¤µà¤¾à¤à¤‚",
    
    // ============================================================
    // SECTION 14: CHAT INTERFACE
    // ============================================================
    chat: "à¤¬à¤¾à¤¤à¤šà¥€à¤¤",
    view_chat: "à¤¬à¤¾à¤¤à¤šà¥€à¤¤ à¤¦à¥‡à¤–à¥‡à¤‚",
    type_your_message: "à¤¸à¤‚à¤¦à¥‡à¤¶ à¤²à¤¿à¤–à¥‡à¤‚...",
    send: "à¤­à¥‡à¤œà¥‡à¤‚",
    attach: "à¤«à¥‹à¤Ÿà¥‹ à¤œà¥‹à¤¡à¤¼à¥‡à¤‚",
    quick_templates: "à¤ªà¤¹à¤²à¥‡ à¤¸à¥‡ à¤¬à¤¨à¥‡ à¤¸à¤µà¤¾à¤² à¤œà¤µà¤¾à¤¬",
    shared_photo: "à¤«à¥‹à¤Ÿà¥‹ à¤­à¥‡à¤œà¥€",
    no_messages_yet: "à¤…à¤­à¥€ à¤•à¥‹à¤ˆ à¤¸à¤‚à¤¦à¥‡à¤¶ à¤¨à¤¹à¥€à¤‚ à¤¹à¥ˆà¥¤ à¤¬à¤¾à¤¤à¤šà¥€à¤¤ à¤¶à¥à¤°à¥‚ à¤•à¤°à¥‡à¤‚!",
    request_status: "à¤…à¤¨à¥à¤°à¥‹à¤§ à¤•à¥€ à¤¸à¥à¤¥à¤¿à¤¤à¤¿",
    
    // ============================================================
    // SECTION 15: CONTACT SHARING (Privacy & Permissions)
    // ============================================================
    request_contact_sharing: "à¤¸à¤‚à¤ªà¤°à¥à¤• à¤¸à¤¾à¤à¤¾ à¤•à¤°à¤¨à¥‡ à¤•à¤¾ à¤…à¤¨à¥à¤°à¥‹à¤§ à¤•à¤°à¥‡à¤‚",
    privacy_protected: "à¤œà¤¾à¤¨à¤•à¤¾à¤°à¥€ à¤¸à¥à¤°à¤•à¥à¤·à¤¿à¤¤ à¤¹à¥ˆ",
    privacy_notice_text: "à¤¦à¥‹à¤¨à¥‹à¤‚ à¤ªà¤•à¥à¤·à¥‹à¤‚ à¤•à¥€ à¤¸à¤¹à¤®à¤¤à¤¿ à¤•à¥‡ à¤¬à¤¾à¤¦ à¤¹à¥€ à¤«à¥‹à¤¨ à¤¨à¤‚à¤¬à¤° à¤”à¤° à¤ªà¤¤à¥‡ à¤¸à¤¾à¤à¤¾ à¤¹à¥‹à¤‚à¤—à¥‡à¥¤",
    contact_sharing_request: "à¤¨à¤‚à¤¬à¤° à¤¸à¤‚à¤à¤¾ à¤•à¤¾ à¤…à¤¨à¥à¤°à¥‹à¤§",
    approve: "à¤¹à¤¾à¤‚ à¤•à¤°à¥‡à¤‚",
    decline: "à¤¨à¤¾ à¤•à¤°à¥‡à¤‚",
    approved: "à¤®à¤‚à¤œà¥‚à¤°",
    declined: "à¤¨à¤¾à¤®à¤‚à¤œà¥‚à¤°",
    contact_visible: "à¤…à¤¬ à¤¨à¤‚à¤¬à¤° à¤”à¤° à¤ªà¤¤à¤¾ à¤¦à¥‡à¤– à¤¸à¤•à¤¤à¥‡ à¤¹à¥ˆà¤‚",
    phone: "à¤«à¥‹à¤¨",
    contact_info_visible_note: "à¤¯à¤¹ à¤œà¤¾à¤¨à¤•à¤¾à¤°à¥€ à¤¦à¤¿à¤–à¤¾à¤ˆ à¤¦à¥‡ à¤°à¤¹à¥€ à¤¹à¥ˆ à¤•à¥à¤¯à¥‹à¤‚à¤•à¤¿ à¤¦à¥‹à¤¨à¥‹à¤‚ à¤ªà¤•à¥à¤·à¥‹à¤‚ à¤¨à¥‡ à¤¸à¤‚à¤ªà¤°à¥à¤• à¤¸à¤¾à¤à¤¾ à¤•à¤°à¤¨à¥‡ à¤•à¥€ à¤®à¤‚à¤œà¥‚à¤°à¥€ à¤¦à¥€ à¤¹à¥ˆ",
    contact_shared_after_agreement: "à¤¦à¥‹à¤¨à¥‹à¤‚ à¤•à¥€ à¤¹à¤¾à¤‚ à¤•à¥‡ à¤¬à¤¾à¤¦ à¤¹à¥€ à¤¨à¤‚à¤¬à¤° à¤”à¤° à¤ªà¥‚à¤°à¤¾ à¤ªà¤¤à¤¾ à¤¦à¤¿à¤–à¥‡à¤—à¤¾à¥¤",
    
    // ============================================================
    // SECTION 16: WORK COMPLETION & WARRANTY
    // ============================================================
    mark_work_complete: "à¤•à¤¾à¤® à¤ªà¥‚à¤°à¥à¤£ à¤šà¤¿à¤¹à¥à¤¨à¤¿à¤¤ à¤•à¤°à¥‡à¤‚",
    mark_complete: "à¤•à¤¾à¤® à¤ªà¥‚à¤°à¥à¤£ à¤šà¤¿à¤¹à¥à¤¨à¤¿à¤¤ à¤•à¤°à¥‡à¤‚",
    select_warranty_period: "à¤µà¤¾à¤°à¤‚à¤Ÿà¥€ à¤…à¤µà¤§à¤¿ à¤šà¥à¤¨à¥‡à¤‚",
    select_warranty: "à¤µà¤¾à¤°à¤‚à¤Ÿà¥€ à¤šà¥à¤¨à¥‡à¤‚",
    no_warranty: "à¤•à¥‹à¤ˆ à¤µà¤¾à¤°à¤‚à¤Ÿà¥€ à¤¨à¤¹à¥€à¤‚",
    days_15: "15 à¤¦à¤¿à¤¨",
    month_1: "1 à¤®à¤¹à¥€à¤¨à¤¾",
    months_3: "3 à¤®à¤¹à¥€à¤¨à¥‡",
    months_6: "6 à¤®à¤¹à¥€à¤¨à¥‡",
    year_1: "1 à¤¸à¤¾à¤²",
    confirm_completion: "à¤ªà¥‚à¤°à¥à¤£ à¤¹à¥‹à¤¨à¥‡ à¤•à¥€ à¤ªà¥à¤·à¥à¤Ÿà¤¿ à¤•à¤°à¥‡à¤‚",
    accept_completion: "à¤¹à¤¾à¤‚, à¤ªà¥‚à¤°à¤¾ à¤¹à¥à¤†",
    reject_continue_work: "à¤¨à¤¹à¥€à¤‚, à¤œà¤¾à¤°à¥€ à¤°à¤–à¥‡à¤‚",
    reject_continue: "à¤¨à¤¹à¥€à¤‚, à¤œà¤¾à¤°à¥€ à¤°à¤–à¥‡à¤‚",
    completion_request: "à¤•à¤¾à¤® à¤ªà¥‚à¤°à¤¾ à¤¹à¥‹à¤¨à¥‡ à¤•à¤¾ à¤…à¤¨à¥à¤°à¥‹à¤§",
    warranty_offered: "à¤µà¤¾à¤°à¤‚à¤Ÿà¥€ à¤¦à¥€ à¤—à¤ˆ",
    warranty_left: "à¤¦à¤¿à¤¨ à¤µà¤¾à¤°à¤‚à¤Ÿà¥€ à¤¬à¤šà¥€",
    warranty_expires_today: "à¤µà¤¾à¤°à¤‚à¤Ÿà¥€ à¤†à¤œ à¤–à¤¤à¥à¤®",
    warranty_expired: "à¤µà¤¾à¤°à¤‚à¤Ÿà¥€ à¤–à¤¤à¥à¤®",
    no_warranty_offered: "à¤•à¥‹à¤ˆ à¤µà¤¾à¤°à¤‚à¤Ÿà¥€ à¤¨à¤¹à¥€à¤‚ à¤¦à¥€ à¤—à¤ˆ",
    days_warranty_offered: "à¤¦à¤¿à¤¨ à¤•à¥€ à¤µà¤¾à¤°à¤‚à¤Ÿà¥€ à¤¦à¥€ à¤—à¤ˆ",
    days_warranty: "à¤¦à¤¿à¤¨ à¤•à¥€ à¤µà¤¾à¤°à¤‚à¤Ÿà¥€",
    
    // ============================================================
    // SECTION 17: PROVIDER RESPONSES & SELECTION
    // ============================================================
    providers_who_responded: "à¤œà¤µà¤¾à¤¬ à¤¦à¥‡à¤¨à¥‡ à¤µà¤¾à¤²à¥‡ à¤ªà¥à¤°à¤¦à¤¾à¤¤à¤¾",
    providers_responded: "à¤œà¤µà¤¾à¤¬ à¤¦à¥‡à¤¨à¥‡ à¤µà¤¾à¤²à¥‡ à¤ªà¥à¤°à¤¦à¤¾à¤¤à¤¾",
    view_profile: "à¤œà¤¾à¤¨à¤•à¤¾à¤°à¥€ à¤¦à¥‡à¤–à¥‡à¤‚",
    select_provider: "à¤ªà¥à¤°à¤¦à¤¾à¤¤à¤¾ à¤šà¥à¤¨à¥‡à¤‚",
    respond: "à¤œà¤µà¤¾à¤¬ à¤­à¥‡à¤œà¥‡",
    responded: "à¤œà¤µà¤¾à¤¬ à¤­à¥‡à¤œà¥‡",
    no_ratings: "à¤…à¤­à¥€ à¤•à¥‹à¤ˆ à¤°à¥‡à¤Ÿà¤¿à¤‚à¤— à¤¨à¤¹à¥€à¤‚",
    km_away: "à¤•à¤¿à¤®à¥€ à¤¦à¥‚à¤°",
    away: "à¤¦à¥‚à¤°",
    response: "à¤œà¤µà¤¾à¤¬",
    responses: "à¤œà¤µà¤¾à¤¬",
    new_badge: "à¤¨à¤¯à¤¾",
    selected: "à¤šà¥à¤¨à¤¾ à¤—à¤¯à¤¾",
    pending: "à¤°à¥à¤•à¤¾ à¤¹à¥à¤†",
    pending_approval: "à¤œà¤µà¤¾à¤¬ à¤•à¤¾ à¤‡à¤‚à¤¤à¤œà¤¼à¤¾à¤°",
    checking: "à¤œà¤¾à¤‚à¤š à¤°à¤¹à¥‡ à¤¹à¥ˆà¤‚...",
    already_responded: "à¤†à¤ªà¤¨à¥‡ à¤ªà¤¹à¤²à¥‡ à¤¹à¥€ à¤‡à¤¸ à¤…à¤¨à¥à¤°à¥‹à¤§ à¤•à¤¾ à¤œà¤µà¤¾à¤¬ à¤¦à¥‡ à¤¦à¤¿à¤¯à¤¾ à¤¹à¥ˆ!",
    response_sent_success: "à¤œà¤µà¤¾à¤¬ à¤¸à¤«à¤²à¤¤à¤¾à¤ªà¥‚à¤°à¥à¤µà¤• à¤­à¥‡à¤œà¤¾ à¤—à¤¯à¤¾! à¤†à¤ª à¤…à¤¬ à¤šà¥ˆà¤Ÿ à¤•à¤° à¤¸à¤•à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤",
    
    // ============================================================
    // SECTION 18: REQUEST STATUS BADGES
    // ============================================================
    status_open: "à¤–à¥à¤²à¤¾ à¤¹à¥ˆ",
    status_in_progress: "à¤•à¤¾à¤® à¤šà¤² à¤°à¤¹à¤¾ à¤¹à¥ˆ",
    status_completed: "à¤ªà¥‚à¤°à¤¾ à¤¹à¥‹ à¤—à¤¯à¤¾",
    status_pending: "à¤²à¤‚à¤¬à¤¿à¤¤",
    status_pending_approval: "à¤®à¤‚à¤œà¥‚à¤°à¥€ à¤•à¤¾ à¤‡à¤‚à¤¤à¤œà¤¾à¤°",
    status_readonly: "à¤•à¥‡à¤µà¤² à¤¦à¥‡à¤–à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤",
    status_assigned_other: "à¤…à¤¨à¥à¤¯ à¤ªà¥à¤°à¤¦à¤¾à¤¤à¤¾ à¤•à¥‹ à¤šà¥à¤¨à¤¾ à¤—à¤¯à¤¾",
    status_warranty_expired: "à¤µà¤¾à¤°à¤‚à¤Ÿà¥€ à¤–à¤¤à¥à¤®",
    keep_existing_warranty: "à¤®à¥Œà¤œà¥‚à¤¦à¤¾ à¤µà¤¾à¤°à¤‚à¤Ÿà¥€ à¤°à¤–à¥‡à¤‚",
    days_remaining: "à¤¦à¤¿à¤¨ à¤¬à¤¾à¤•à¥€",
    or_provide_new_warranty: "à¤¯à¤¾ à¤¨à¤ˆ à¤µà¤¾à¤°à¤‚à¤Ÿà¥€ à¤¦à¥‡à¤‚",
    
    // ============================================================
    // SECTION 19: BUTTONS & ACTIONS
    // ============================================================
    btn_create_request: "à¤…à¤¨à¥à¤°à¥‹à¤§ à¤•à¤°à¥‡à¤‚",
    btn_edit_request: "à¤¸à¥à¤§à¤¾à¤°à¥‡à¤‚",
    btn_cancel_request: "à¤°à¤¦à¥à¤¦ à¤•à¤°à¥‡à¤‚",
    btn_view_responses: "à¤œà¤µà¤¾à¤¬ à¤¦à¥‡à¤–à¥‡à¤‚",
    btn_change_provider: "à¤¬à¤¦à¤²à¥‡à¤‚",
    btn_reactivate: "à¤«à¤¿à¤° à¤¸à¥‡ à¤–à¥‹à¤²à¥‡à¤‚",
    btn_back: "à¤µà¤¾à¤ªà¤¸",
    btn_close: "à¤¬à¤‚à¤¦ à¤•à¤°à¥‡à¤‚",
    btn_save: "à¤¸à¤¹à¥‡à¤œà¥‡à¤‚",
    btn_update: "à¤¬à¤¦à¤²à¥‡à¤‚",
    btn_submit: "à¤­à¥‡à¤œà¥‡à¤‚",
    btn_continue: "à¤†à¤—à¥‡ à¤¬à¤¢à¤¼à¥‡à¤‚",
    btn_skip: "à¤›à¥‹à¤¡à¤¼à¥‡à¤‚",
    // ADD THESE NEW KEYS:
    full_address: "à¤ªà¥‚à¤°à¤¾ à¤ªà¤¤à¤¾",
    service_label: "à¤¸à¥‡à¤µà¤¾",
    urgency_label: "à¤œà¤°à¥‚à¤°à¤¤",
    
    // ============================================================
    // SECTION 20: EMPTY STATES (When No Data Available)
    // ============================================================
    no_requests_yet: "à¤…à¤­à¥€ à¤•à¥‹à¤ˆ à¤®à¤¾à¤‚à¤— à¤¨à¤¹à¥€à¤‚ à¤¹à¥ˆ",
    no_responses_yet: "à¤…à¤­à¥€ à¤•à¥‹à¤ˆ à¤œà¤µà¤¾à¤¬ à¤¨à¤¹à¥€à¤‚",
    no_work_available: "à¤•à¥‹à¤ˆ à¤•à¤¾à¤® à¤¨à¤¹à¥€à¤‚ à¤®à¤¿à¤²à¤¾",
    no_open_requests: "à¤•à¥‹à¤ˆ à¤–à¥à¤²à¥€ à¤®à¤¾à¤‚à¤— à¤¨à¤¹à¥€à¤‚",
    no_open_requests_yet: "à¤…à¤­à¥€ à¤•à¥‹à¤ˆ à¤–à¥à¤²à¥€ à¤®à¤¾à¤‚à¤— à¤¨à¤¹à¥€à¤‚",
    no_completed_requests: "à¤•à¥‹à¤ˆ à¤ªà¥‚à¤°à¤¾ à¤•à¤¾à¤® à¤¨à¤¹à¥€à¤‚",
    no_in_progress_requests: "à¤•à¥‹à¤ˆ à¤šà¤² à¤°à¤¹à¤¾ à¤•à¤¾à¤® à¤¨à¤¹à¥€à¤‚",
    no_waiting_requests: "à¤•à¥‹à¤ˆ à¤¸à¤®à¥€à¤•à¥à¤·à¤¾ à¤®à¥‡à¤‚ à¤•à¤¾à¤® à¤¨à¤¹à¥€à¤‚",
    no_reactivated_requests: "à¤•à¥‹à¤ˆ à¤«à¤¿à¤° à¤¸à¥‡ à¤–à¥à¤²à¤¾ à¤•à¤¾à¤® à¤¨à¤¹à¥€à¤‚",
    no_urgency_requests: "à¤•à¥‹à¤ˆ {urgency} à¤®à¤¾à¤‚à¤—à¥‡à¤‚ à¤¨à¤¹à¥€à¤‚",
    create_first_request: "à¤ªà¤¹à¤²à¥€ à¤®à¤¾à¤‚à¤— à¤¬à¤¨à¤¾à¤à¤‚",
    respond_to_start: "à¤ªà¤¾à¤¸ à¤•à¥€ à¤®à¤¾à¤‚à¤—à¥‹à¤‚ à¤ªà¤° à¤œà¤µà¤¾à¤¬ à¤¦à¥‡à¤‚!",
    
    // ============================================================
    // SECTION 21: SYSTEM MESSAGES (Chat Notifications)
    // ============================================================
    sys_contact_approved: "à¤¨à¤‚à¤¬à¤° à¤¸à¤¾à¤à¤¾ à¤¹à¥‹ à¤—à¤¯à¤¾!",
    sys_contact_declined: "à¤¨à¤‚à¤¬à¤° à¤¦à¥‡à¤¨à¥‡ à¤¸à¥‡ à¤®à¤¨à¤¾ à¤•à¤¿à¤¯à¤¾",
    sys_work_accepted: "à¤•à¤¾à¤® à¤ªà¥‚à¤°à¤¾ à¤®à¤¾à¤¨à¤¾ à¤—à¤¯à¤¾",
    sys_work_rejected: "à¤•à¤¾à¤® à¤ªà¥‚à¤°à¤¾ à¤¨à¤¹à¥€à¤‚ à¤®à¤¾à¤¨à¤¾ à¤—à¤¯à¤¾",
    sys_request_completed: "à¤®à¤¾à¤‚à¤— à¤ªà¥‚à¤°à¥€ à¤¹à¥‹ à¤—à¤ˆ",
    sys_deselected: "à¤†à¤ªà¤•à¥‹ à¤‡à¤¸ à¤®à¤¾à¤‚à¤— à¤¸à¥‡ à¤¹à¤Ÿà¤¾ à¤¦à¤¿à¤¯à¤¾ à¤—à¤¯à¤¾",
    sys_request_open_again: "à¤®à¤¾à¤‚à¤— à¤«à¤¿à¤° à¤¸à¥‡ à¤–à¥à¤²à¥€ à¤¹à¥ˆ",
    sys_reactivated: "à¤®à¤¾à¤‚à¤— à¤«à¤¿à¤° à¤¸à¥‡ à¤–à¥‹à¤²à¥€ à¤—à¤ˆ à¤¹à¥ˆ",
    
    // ============================================================
    // SECTION 22: LOCATION & TIME
    // ============================================================
    location: "à¤œà¤—à¤¹",
    full_address: "à¤ªà¥‚à¤°à¤¾ à¤ªà¤¤à¤¾",
    distance: "à¤¦à¥‚à¤°à¥€",
    km: "à¤•à¤¿à¤®à¥€",
    just_now: "à¤…à¤­à¥€-à¤…à¤­à¥€",
    minutes_ago: "à¤®à¤¿à¤¨à¤Ÿ à¤ªà¤¹à¤²à¥‡",
    hours_ago: "à¤˜à¤‚à¤Ÿà¥‡ à¤ªà¤¹à¤²à¥‡",
    days_ago: "à¤¦à¤¿à¤¨ à¤ªà¤¹à¤²à¥‡",
    weeks_ago: "à¤¹à¤«à¥à¤¤à¥‡ à¤ªà¤¹à¤²à¥‡",
    locating_address: "à¤†à¤ªà¤•à¤¾ à¤ªà¤¤à¤¾ à¤–à¥‹à¤œà¤¾ à¤œà¤¾ à¤°à¤¹à¤¾ à¤¹à¥ˆ...",
    finding_location: "à¤œà¤—à¤¹ à¤–à¥‹à¤œ à¤°à¤¹à¥‡ à¤¹à¥ˆà¤‚...",
    
    // ============================================================
    // SECTION 23: RATING & REVIEW SYSTEM
    // ============================================================
    rate_provider: "à¤°à¥‡à¤Ÿà¤¿à¤‚à¤— à¤¦à¥‡à¤‚",
    how_was_experience: "à¤†à¤ªà¤•à¤¾ à¤…à¤¨à¥à¤­à¤µ à¤•à¥ˆà¤¸à¤¾ à¤°à¤¹à¤¾",
    experience_with: "à¤†à¤ªà¤•à¤¾ à¤…à¤¨à¥à¤­à¤µ à¤•à¥ˆà¤¸à¤¾ à¤°à¤¹à¤¾",
    rating_helps_others: "à¤†à¤ªà¤•à¥€ à¤°à¥‡à¤Ÿà¤¿à¤‚à¤— à¤¸à¥‡ à¤¦à¥‚à¤¸à¤°à¥‹à¤‚ à¤•à¥‹ à¤®à¤¦à¤¦ à¤®à¤¿à¤²à¥‡à¤—à¥€",
    rating_helps: "à¤†à¤ªà¤•à¥€ à¤°à¥‡à¤Ÿà¤¿à¤‚à¤— à¤¸à¥‡ à¤¦à¥‚à¤¸à¤°à¥‹à¤‚ à¤•à¥‹ à¤®à¤¦à¤¦ à¤®à¤¿à¤²à¥‡à¤—à¥€",
    select_rating: "à¤°à¥‡à¤Ÿà¤¿à¤‚à¤— à¤šà¥à¤¨à¥‡à¤‚",
    poor: "à¤¬à¤¹à¥à¤¤ à¤–à¤°à¤¾à¤¬",
    fair: "à¤ à¥€à¤•-à¤ à¤¾à¤•",
    good: "à¤…à¤šà¥à¤›à¤¾",
    very_good: "à¤¬à¤¹à¥à¤¤ à¤…à¤šà¥à¤›à¤¾",
    excellent: "à¤¬à¤¢à¤¼à¤¿à¤¯à¤¾",
    review_optional: "à¤°à¤¿à¤µà¥à¤¯à¥‚ (à¤šà¤¾à¤¹à¥‡à¤‚ à¤¤à¥‹)",
    share_your_experience: "à¤…à¤ªà¤¨à¤¾ à¤…à¤¨à¥à¤­à¤µ à¤¬à¤¤à¤¾à¤à¤‚",
    share_experience: "à¤…à¤ªà¤¨à¤¾ à¤…à¤¨à¥à¤­à¤µ à¤¬à¤¤à¤¾à¤à¤‚",
    submit_rating: "à¤°à¥‡à¤Ÿà¤¿à¤‚à¤— à¤­à¥‡à¤œà¥‡à¤‚",
    recent_reviews: "à¤¹à¤¾à¤² à¤•à¥€ à¤°à¥‡à¤Ÿà¤¿à¤‚à¤—",
    ratings: "à¤°à¥‡à¤Ÿà¤¿à¤‚à¤—",
    reviews: "à¤¸à¤®à¥€à¤•à¥à¤·à¤¾à¤à¤‚",
    please_select_rating: "à¤•à¥ƒà¤ªà¤¯à¤¾ à¤°à¥‡à¤Ÿà¤¿à¤‚à¤— à¤šà¥à¤¨à¥‡à¤‚",
    submitting: "à¤œà¤®à¤¾ à¤¹à¥‹ à¤°à¤¹à¤¾ à¤¹à¥ˆ...",
    rating_submitted: "à¤°à¥‡à¤Ÿà¤¿à¤‚à¤— à¤¸à¤«à¤²à¤¤à¤¾à¤ªà¥‚à¤°à¥à¤µà¤• à¤¦à¥€ à¤—à¤ˆ!",
    click_to_view_full_size: "à¤ªà¥‚à¤°à¥€ à¤«à¥‹à¤Ÿà¥‹ à¤¦à¥‡à¤–à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤•à¥à¤²à¤¿à¤• à¤•à¤°à¥‡à¤‚",
    click_photo_to_view: "à¤ªà¥‚à¤°à¥€ à¤«à¥‹à¤Ÿà¥‹ à¤¦à¥‡à¤–à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤•à¥à¤²à¤¿à¤• à¤•à¤°à¥‡à¤‚",
    
    // ============================================================
    // SECTION 24: NOTIFICATIONS - SUCCESS MESSAGES
    // ============================================================
    request_created: "à¤…à¤¨à¥à¤°à¥‹à¤§ à¤¬à¤¨ à¤—à¤¯à¤¾!",
    response_sent: "à¤œà¤µà¤¾à¤¬ à¤­à¥‡à¤œ à¤¦à¤¿à¤¯à¤¾!",
    provider_selected: "à¤šà¥à¤¨ à¤²à¤¿à¤¯à¤¾!",
    provider_selected_success: "à¤ªà¥à¤°à¤¦à¤¾à¤¤à¤¾ à¤šà¥à¤¨à¤¾ à¤—à¤¯à¤¾! à¤¬à¤¾à¤¤à¤šà¥€à¤¤ à¤–à¥‹à¤²à¥€ à¤œà¤¾ à¤°à¤¹à¥€ à¤¹à¥ˆ...",
    work_completed: "à¤•à¤¾à¤® à¤ªà¥‚à¤°à¤¾!",
    request_cancelled_success: "à¤…à¤¨à¥à¤°à¥‹à¤§ à¤¸à¤«à¤²à¤¤à¤¾à¤ªà¥‚à¤°à¥à¤µà¤• à¤°à¤¦à¥à¤¦ à¤•à¤° à¤¦à¤¿à¤¯à¤¾ à¤—à¤¯à¤¾",
    
    // ============================================================
    // SECTION 25: NOTIFICATIONS - ERROR MESSAGES
    // ============================================================
    error: "à¤¤à¥à¤°à¥à¤Ÿà¤¿",
    error_loading_responses: "à¤œà¤µà¤¾à¤¬ à¤²à¥‹à¤¡ à¤•à¤°à¤¨à¥‡ à¤®à¥‡à¤‚ à¤¸à¤®à¤¸à¥à¤¯à¤¾",
    error_loading_contact: "à¤¸à¤‚à¤ªà¤°à¥à¤• à¤µà¤¿à¤µà¤°à¤£ à¤²à¥‹à¤¡ à¤•à¤°à¤¨à¥‡ à¤®à¥‡à¤‚ à¤¤à¥à¤°à¥à¤Ÿà¤¿",
    error_submitting_feedback: "à¤°à¤¾à¤¯ à¤œà¤®à¤¾ à¤•à¤°à¤¨à¥‡ à¤®à¥‡à¤‚ à¤¤à¥à¤°à¥à¤Ÿà¤¿",
    error_submitting_request: "à¤…à¤¨à¥à¤°à¥‹à¤§ à¤œà¤®à¤¾ à¤•à¤°à¤¨à¥‡ à¤®à¥‡à¤‚ à¤¤à¥à¤°à¥à¤Ÿà¤¿",
    max_requests_error: "5 à¤¸à¥‡ à¤œà¥à¤¯à¤¾à¤¦à¤¾ à¤®à¤¾à¤‚à¤—à¥‡à¤‚ à¤¨à¤¹à¥€à¤‚ à¤¹à¥‹ à¤¸à¤•à¤¤à¥€",
    
    // ============================================================
    // SECTION 26: CONFIRMATION DIALOGS
    // ============================================================
    confirm_cancel_request: "à¤•à¥à¤¯à¤¾ à¤µà¤¾à¤•à¤ˆ à¤®à¤¾à¤‚à¤— à¤°à¤¦à¥à¤¦ à¤•à¤°à¤¨à¥€ à¤¹à¥ˆ?",
    confirm_logout: "à¤•à¥à¤¯à¤¾ à¤†à¤ª à¤µà¤¾à¤•à¤ˆ à¤¬à¤¾à¤¹à¤° à¤¨à¤¿à¤•à¤²à¤¨à¤¾ à¤šà¤¾à¤¹à¤¤à¥‡ à¤¹à¥ˆà¤‚?",
    permanent_delete: "à¤¯à¥‡ à¤®à¤¾à¤‚à¤— à¤¹à¤®à¥‡à¤¶à¤¾ à¤•à¥‡ à¤²à¤¿à¤ à¤¹à¤Ÿ à¤œà¤¾à¤à¤—à¥€",
    change_provider_confirm: "à¤¸à¥‡à¤µà¤¾ à¤¦à¥‡à¤¨à¥‡ à¤µà¤¾à¤²à¤¾ à¤¬à¤¦à¤²à¤¨à¤¾ à¤¹à¥ˆ?",
    change_provider_warning: "à¤¯à¤¹ à¤¹à¥‹à¤—à¤¾:\nâ€¢ à¤µà¤°à¥à¤¤à¤®à¤¾à¤¨ à¤ªà¥à¤°à¤¦à¤¾à¤¤à¤¾ à¤•à¥‹ à¤¹à¤Ÿà¤¾ à¤¦à¤¿à¤¯à¤¾ à¤œà¤¾à¤à¤—à¤¾\nâ€¢ à¤…à¤¨à¥à¤°à¥‹à¤§ 'à¤–à¥à¤²à¤¾' à¤¸à¥à¤¥à¤¿à¤¤à¤¿ à¤®à¥‡à¤‚ à¤µà¤¾à¤ªà¤¸ à¤œà¤¾à¤à¤—à¤¾\nâ€¢ à¤µà¤°à¥à¤¤à¤®à¤¾à¤¨ à¤ªà¥à¤°à¤¦à¤¾à¤¤à¤¾ à¤•à¥‹ à¤¸à¥‚à¤šà¤¿à¤¤ à¤•à¤¿à¤¯à¤¾ à¤œà¤¾à¤à¤—à¤¾\nâ€¢ à¤…à¤¨à¥à¤¯ à¤ªà¥à¤°à¤¦à¤¾à¤¤à¤¾à¤“à¤‚ à¤•à¥‡ à¤¸à¤¾à¤¥ à¤šà¥ˆà¤Ÿ à¤«à¤¿à¤° à¤¸à¥‡ à¤¸à¤•à¥à¤°à¤¿à¤¯ à¤¹à¥‹à¤—à¥€\n\nà¤•à¥à¤¯à¤¾ à¤†à¤ª à¤¬à¤¦à¤²à¤¨à¤¾ à¤šà¤¾à¤¹à¤¤à¥‡ à¤¹à¥ˆà¤‚?",
    provider_changed_success: "à¤ªà¥à¤°à¤¦à¤¾à¤¤à¤¾ à¤¸à¤«à¤²à¤¤à¤¾à¤ªà¥‚à¤°à¥à¤µà¤• à¤¬à¤¦à¤² à¤¦à¤¿à¤¯à¤¾ à¤—à¤¯à¤¾!\n\nà¤…à¤¨à¥à¤°à¥‹à¤§ à¤…à¤¬ à¤«à¤¿à¤° à¤¸à¥‡ à¤–à¥à¤²à¤¾ à¤¹à¥ˆà¥¤",
    reactivate_confirm: "à¤«à¤¿à¤° à¤¸à¥‡ à¤–à¥‹à¤²à¤¨à¤¾ à¤¹à¥ˆ?",
    reactivate_warning: "à¤ªà¥à¤°à¤¦à¤¾à¤¤à¤¾ à¤•à¥‹ à¤¸à¥‚à¤šà¤¿à¤¤ à¤•à¤¿à¤¯à¤¾ à¤œà¤¾à¤à¤—à¤¾ à¤•à¤¿ à¤†à¤ªà¤•à¥‹ à¤µà¤¾à¤°à¤‚à¤Ÿà¥€ à¤…à¤µà¤§à¤¿ à¤•à¥‡ à¤­à¥€à¤¤à¤° à¤«à¤¿à¤° à¤¸à¥‡ à¤¸à¥‡à¤µà¤¾ à¤•à¥€ à¤†à¤µà¤¶à¥à¤¯à¤•à¤¤à¤¾ à¤¹à¥ˆà¥¤",
    request_not_found: "à¤…à¤¨à¥à¤°à¥‹à¤§ à¤¨à¤¹à¥€à¤‚ à¤®à¤¿à¤²à¤¾",
    request_reactivated_success: "à¤…à¤¨à¥à¤°à¥‹à¤§ à¤«à¤¿à¤° à¤¸à¥‡ à¤¸à¤•à¥à¤°à¤¿à¤¯! à¤ªà¥à¤°à¤¦à¤¾à¤¤à¤¾ à¤•à¥‹ à¤¸à¥‚à¤šà¤¿à¤¤ à¤•à¤° à¤¦à¤¿à¤¯à¤¾ à¤—à¤¯à¤¾ à¤¹à¥ˆà¥¤",
    select_provider_confirm: "à¤‡à¤¸ à¤ªà¥à¤°à¤¦à¤¾à¤¤à¤¾ à¤•à¥‹ à¤šà¥à¤¨à¥‡à¤‚? à¤¯à¤¹ à¤…à¤¨à¥à¤°à¥‹à¤§ à¤•à¥€ à¤¸à¥à¤¥à¤¿à¤¤à¤¿ à¤•à¥‹ 'à¤ªà¥à¤°à¤—à¤¤à¤¿ à¤®à¥‡à¤‚' à¤®à¥‡à¤‚ à¤¬à¤¦à¤² à¤¦à¥‡à¤—à¤¾ à¤”à¤° à¤¬à¤¾à¤¤à¤šà¥€à¤¤ à¤–à¥‹à¤² à¤¦à¥‡à¤—à¤¾à¥¤",
    
    // ============================================================
    // SECTION 27: FEEDBACK FORM
    // ============================================================
    send_feedback_title: "à¤°à¤¾à¤¯ à¤¦à¥‡à¤‚",
    help_improve: "HelpBuddy à¤•à¥‹ à¤¬à¥‡à¤¹à¤¤à¤° à¤¬à¤¨à¤¾à¤¨à¥‡ à¤®à¥‡à¤‚ à¤®à¤¦à¤¦ à¤•à¤°à¥‡à¤‚!",
    feedback_type: "à¤°à¤¾à¤¯ à¤•à¤¾ à¤ªà¥à¤°à¤•à¤¾à¤°",
    bug_report: "à¤—à¤²à¤¤à¥€ à¤¬à¤¤à¤¾à¤à¤‚",
    feature_request: "à¤¨à¤ˆ à¤¸à¥à¤µà¤¿à¤§à¤¾ à¤šà¤¾à¤¹à¤¿à¤",
    improvement: "à¤¸à¥à¤§à¤¾à¤° à¤•à¤¾ à¤¸à¥à¤à¤¾à¤µ",
    complaint: "à¤¶à¤¿à¤•à¤¾à¤¯à¤¤",
    appreciation: "à¤¤à¤¾à¤°à¥€à¤«",
    other: "à¤…à¤¨à¥à¤¯",
    your_feedback: "à¤†à¤ªà¤•à¥€ à¤°à¤¾à¤¯",
    feedback_detail: "à¤…à¤ªà¤¨à¥€ à¤°à¤¾à¤¯ à¤µà¤¿à¤¸à¥à¤¤à¤¾à¤° à¤¸à¥‡ à¤¬à¤¤à¤¾à¤à¤‚",
    please_select_feedback_type: "à¤•à¥ƒà¤ªà¤¯à¤¾ à¤°à¤¾à¤¯ à¤•à¤¾ à¤ªà¥à¤°à¤•à¤¾à¤° à¤šà¥à¤¨à¥‡à¤‚",
    feedback_min_length: "à¤•à¥ƒà¤ªà¤¯à¤¾ à¤•à¤® à¤¸à¥‡ à¤•à¤® 10 à¤…à¤•à¥à¤·à¤°à¥‹à¤‚ à¤•à¥€ à¤°à¤¾à¤¯ à¤¦à¥‡à¤‚",
    sending: "à¤­à¥‡à¤œà¤¾ à¤œà¤¾ à¤°à¤¹à¤¾ à¤¹à¥ˆ...",
    feedback_success_message_part1: "à¤¹à¤® à¤†à¤ªà¤¸à¥‡ à¤¸à¤‚à¤ªà¤°à¥à¤• à¤•à¤°à¥‡à¤‚à¤—à¥‡",
    feedback_success_message_part2: "à¤œà¤²à¥à¤¦ à¤¹à¥€à¥¤",
    
    // ============================================================
    // SECTION 28: HELP & SUPPORT
    // ============================================================
    get_help_title: "à¤®à¤¦à¤¦ à¤šà¤¾à¤¹à¤¿à¤",
    find_answers: "à¤¸à¤¾à¤®à¤¾à¤¨à¥à¤¯ à¤¸à¤®à¤¸à¥à¤¯à¤¾à¤“à¤‚ à¤•à¥‡ à¤œà¤µà¤¾à¤¬",
    still_need_help: "à¤«à¤¿à¤° à¤­à¥€ à¤¸à¤¹à¤¾à¤¯à¤¤à¤¾ à¤šà¤¾à¤¹à¤¿à¤? à¤¸à¤‚à¤ªà¤°à¥à¤• à¤•à¤°à¥‡à¤‚",
    cant_login: "à¤²à¥‰à¤—à¤¿à¤¨ à¤¨à¤¹à¥€à¤‚ à¤¹à¥‹ à¤°à¤¹à¤¾",
    email_not_received: "Email à¤¨à¤¹à¥€à¤‚ à¤®à¤¿à¤²à¤¾",
    forgot_password_help: "Password à¤­à¥‚à¤² à¤—à¤",
    slow_loading: "à¤§à¥€à¤°à¥‡ à¤²à¥‹à¤¡ à¤¹à¥‹ à¤°à¤¹à¤¾ à¤¹à¥ˆ",
    account_issues: "à¤–à¤¾à¤¤à¥‡ à¤®à¥‡à¤‚ à¤¸à¤®à¤¸à¥à¤¯à¤¾",
    issue_type: "à¤¸à¤®à¤¸à¥à¤¯à¤¾ à¤•à¤¾ à¤ªà¥à¤°à¤•à¤¾à¤°",
    describe_problem: "à¤…à¤ªà¤¨à¥€ à¤¸à¤®à¤¸à¥à¤¯à¤¾ à¤¬à¤¤à¤¾à¤à¤‚",
    send_help_request: "à¤®à¤¦à¤¦ à¤®à¤¾à¤‚à¤—à¥‡à¤‚",
    cant_login_solution: "à¤¸à¥à¤¨à¤¿à¤¶à¥à¤šà¤¿à¤¤ à¤•à¤°à¥‡à¤‚ à¤•à¤¿ à¤†à¤ªà¤•à¤¾ Email à¤”à¤° Password à¤¸à¤¹à¥€ à¤¹à¥ˆà¤‚à¥¤ Password à¤•à¥‡à¤¸-à¤¸à¥‡à¤‚à¤¸à¤¿à¤Ÿà¤¿à¤µ à¤¹à¥ˆà¥¤ à¤¯à¤¦à¤¿ à¤†à¤ªà¤¨à¥‡ à¤¹à¤¾à¤² à¤¹à¥€ à¤®à¥‡à¤‚ à¤¸à¤¾à¤‡à¤¨ à¤…à¤ª à¤•à¤¿à¤¯à¤¾ à¤¹à¥ˆ, à¤¤à¥‹ à¤œà¤¾à¤‚à¤šà¥‡à¤‚ à¤•à¤¿ à¤•à¥à¤¯à¤¾ à¤†à¤ªà¤¨à¥‡ à¤…à¤ªà¤¨à¤¾ Email à¤¸à¤¤à¥à¤¯à¤¾à¤ªà¤¿à¤¤ à¤•à¤¿à¤¯à¤¾ à¤¹à¥ˆà¥¤",
    email_not_received_solution: "à¤…à¤ªà¤¨à¤¾ Spam/Junk à¤«à¤¼à¥‹à¤²à¥à¤¡à¤° à¤œà¤¾à¤‚à¤šà¥‡à¤‚à¥¤ à¤¸à¤¤à¥à¤¯à¤¾à¤ªà¤¨ Email HelpBuddy à¤¸à¥‡ à¤­à¥‡à¤œà¤¾ à¤œà¤¾à¤¤à¤¾ à¤¹à¥ˆà¥¤ à¤¯à¤¦à¤¿ à¤†à¤ªà¤•à¥‹ à¤…à¤­à¥€ à¤­à¥€ à¤¨à¤¹à¥€à¤‚ à¤¦à¤¿à¤–à¤¤à¤¾ à¤¹à¥ˆ, à¤¤à¥‹ à¤«à¤¿à¤° à¤¸à¥‡ à¤¸à¤¾à¤‡à¤¨ à¤…à¤ª à¤•à¤°à¤¨à¥‡ à¤•à¤¾ à¤ªà¥à¤°à¤¯à¤¾à¤¸ à¤•à¤°à¥‡à¤‚ à¤¯à¤¾ à¤¸à¤¹à¤¾à¤¯à¤¤à¤¾ à¤¸à¥‡ à¤¸à¤‚à¤ªà¤°à¥à¤• à¤•à¤°à¥‡à¤‚à¥¤",
    forgot_password_solution: "à¤²à¥‰à¤—à¤¿à¤¨ à¤ªà¥‡à¤œ à¤ªà¤° 'Password à¤­à¥‚à¤² à¤—à¤?' à¤²à¤¿à¤‚à¤• à¤ªà¤° à¤•à¥à¤²à¤¿à¤• à¤•à¤°à¥‡à¤‚à¥¤ Password à¤°à¥€à¤¸à¥‡à¤Ÿ à¤¨à¤¿à¤°à¥à¤¦à¥‡à¤¶ à¤ªà¥à¤°à¤¾à¤ªà¥à¤¤ à¤•à¤°à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤…à¤ªà¤¨à¤¾ à¤ªà¤‚à¤œà¥€à¤•à¥ƒà¤¤ Email à¤¦à¤°à¥à¤œ à¤•à¤°à¥‡à¤‚à¥¤",
    slow_loading_solution: "à¤ªà¥‡à¤œ à¤•à¥‹ à¤°à¤¿à¤«à¥à¤°à¥‡à¤¶ à¤•à¤°à¤¨à¥‡ à¤•à¤¾ à¤ªà¥à¤°à¤¯à¤¾à¤¸ à¤•à¤°à¥‡à¤‚ (Ctrl+R à¤¯à¤¾ Cmd+R)à¥¤ à¤…à¤ªà¤¨à¥‡ à¤¬à¥à¤°à¤¾à¤‰à¤œà¤¼à¤° à¤•à¥ˆà¤¶ à¤”à¤° à¤•à¥à¤•à¥€à¤œà¤¼ à¤¸à¤¾à¤«à¤¼ à¤•à¤°à¥‡à¤‚à¥¤ à¤…à¤ªà¤¨à¤¾ à¤‡à¤‚à¤Ÿà¤°à¤¨à¥‡à¤Ÿ à¤•à¤¨à¥‡à¤•à¥à¤¶à¤¨ à¤œà¤¾à¤‚à¤šà¥‡à¤‚à¥¤",
    account_issues_solution: "à¤¯à¤¦à¤¿ à¤†à¤ªà¤•à¤¾ à¤–à¤¾à¤¤à¤¾ à¤²à¥‰à¤• à¤¯à¤¾ à¤¨à¤¿à¤²à¤‚à¤¬à¤¿à¤¤ à¤¹à¥ˆ, à¤¤à¥‹ à¤…à¤ªà¤¨à¥‡ à¤ªà¤‚à¤œà¥€à¤•à¥ƒà¤¤ Email à¤•à¥‡ à¤¸à¤¾à¤¥ à¤¸à¤¹à¤¾à¤¯à¤¤à¤¾ à¤¸à¥‡ à¤¸à¤‚à¤ªà¤°à¥à¤• à¤•à¤°à¥‡à¤‚à¥¤ à¤ªà¥à¤°à¥‹à¤«à¤¼à¤¾à¤‡à¤² à¤…à¤ªà¤¡à¥‡à¤Ÿ à¤¸à¤®à¤¸à¥à¤¯à¤¾à¤“à¤‚ à¤•à¥‡ à¤²à¤¿à¤, à¤²à¥‰à¤— à¤†à¤‰à¤Ÿ à¤•à¤°à¤¨à¥‡ à¤”à¤° à¤µà¤¾à¤ªà¤¸ à¤²à¥‰à¤— à¤‡à¤¨ à¤•à¤°à¤¨à¥‡ à¤•à¤¾ à¤ªà¥à¤°à¤¯à¤¾à¤¸ à¤•à¤°à¥‡à¤‚à¥¤",
    email_already_registered_solution: "à¤¯à¤¹ Email à¤ªà¤¹à¤²à¥‡ à¤¸à¥‡ à¤‰à¤ªà¤¯à¥‹à¤— à¤®à¥‡à¤‚ à¤¹à¥ˆà¥¤ à¤‡à¤¸à¤•à¥‡ à¤¬à¤œà¤¾à¤¯ à¤²à¥‰à¤—à¤¿à¤¨ à¤•à¤°à¤¨à¥‡ à¤•à¤¾ à¤ªà¥à¤°à¤¯à¤¾à¤¸ à¤•à¤°à¥‡à¤‚à¥¤ à¤¯à¤¦à¤¿ à¤†à¤ª à¤…à¤ªà¤¨à¤¾ Password à¤­à¥‚à¤² à¤—à¤ à¤¹à¥ˆà¤‚, à¤¤à¥‹ 'Password à¤­à¥‚à¤² à¤—à¤?' à¤µà¤¿à¤•à¤²à¥à¤ª à¤•à¤¾ à¤‰à¤ªà¤¯à¥‹à¤— à¤•à¤°à¥‡à¤‚à¥¤",
    please_select_issue_type: "à¤•à¥ƒà¤ªà¤¯à¤¾ à¤¸à¤®à¤¸à¥à¤¯à¤¾ à¤•à¤¾ à¤ªà¥à¤°à¤•à¤¾à¤° à¤šà¥à¤¨à¥‡à¤‚",
    help_message_min_length: "à¤•à¥ƒà¤ªà¤¯à¤¾ à¤…à¤ªà¤¨à¥€ à¤¸à¤®à¤¸à¥à¤¯à¤¾ à¤•à¤¾ à¤µà¤°à¥à¤£à¤¨ à¤•à¤°à¥‡à¤‚ (à¤•à¤® à¤¸à¥‡ à¤•à¤® 10 à¤…à¤•à¥à¤·à¤°)",
    please_provide_email: "à¤•à¥ƒà¤ªà¤¯à¤¾ à¤…à¤ªà¤¨à¤¾ Email à¤ªà¤¤à¤¾ à¤ªà¥à¤°à¤¦à¤¾à¤¨ à¤•à¤°à¥‡à¤‚",
    help_request_success_part1: "à¤¹à¤® à¤†à¤ªà¤¸à¥‡ à¤¸à¤‚à¤ªà¤°à¥à¤• à¤•à¤°à¥‡à¤‚à¤—à¥‡",
    help_request_success_part2: "à¤œà¤²à¥à¤¦ à¤¹à¥€à¥¤",
    
    // ============================================================
    // SECTION 29: TERMS & CONDITIONS (Legal Headings)
    // ============================================================
    terms_last_updated: "à¤…à¤‚à¤¤à¤¿à¤® à¤…à¤ªà¤¡à¥‡à¤Ÿ",
    terms_introduction: "à¤ªà¤°à¤¿à¤šà¤¯",
    terms_definitions: "à¤ªà¤°à¤¿à¤­à¤¾à¤·à¤¾à¤à¤‚",
    terms_eligibility: "à¤ªà¤¾à¤¤à¥à¤°à¤¤à¤¾",
    terms_account: "à¤–à¤¾à¤¤à¤¾ à¤ªà¤‚à¤œà¥€à¤•à¤°à¤£",
    terms_platform_role: "à¤ªà¥à¤²à¥‡à¤Ÿà¤«à¥‰à¤°à¥à¤® à¤•à¥€ à¤­à¥‚à¤®à¤¿à¤•à¤¾",
    terms_user_responsibilities: "à¤‰à¤ªà¤¯à¥‹à¤—à¤•à¤°à¥à¤¤à¤¾ à¤œà¤¿à¤®à¥à¤®à¥‡à¤¦à¤¾à¤°à¤¿à¤¯à¤¾à¤‚",
    terms_content: "à¤‰à¤ªà¤¯à¥‹à¤—à¤•à¤°à¥à¤¤à¤¾ à¤¸à¤¾à¤®à¤—à¥à¤°à¥€",
    terms_prohibited: "à¤¨à¤¿à¤·à¤¿à¤¦à¥à¤§ à¤—à¤¤à¤¿à¤µà¤¿à¤§à¤¿à¤¯à¤¾à¤‚",
    terms_termination: "à¤¸à¤®à¤¾à¤ªà¥à¤¤à¤¿",
    terms_liability: "à¤¦à¥‡à¤¯à¤¤à¤¾ à¤¸à¥€à¤®à¤¾",
    terms_dispute: "à¤µà¤¿à¤µà¤¾à¤¦ à¤¸à¤®à¤¾à¤§à¤¾à¤¨",
    terms_governing_law: "à¤¶à¤¾à¤¸à¥€ à¤•à¤¾à¤¨à¥‚à¤¨",
    terms_changes: "à¤¶à¤°à¥à¤¤à¥‹à¤‚ à¤®à¥‡à¤‚ à¤¬à¤¦à¤²à¤¾à¤µ",
    terms_contact: "à¤¸à¤‚à¤ªà¤°à¥à¤• à¤œà¤¾à¤¨à¤•à¤¾à¤°à¥€",
    terms_severability: "à¤ªà¥ƒà¤¥à¤•à¥à¤•à¤°à¤£à¥€à¤¯à¤¤à¤¾",
    terms_acknowledgment: "à¤¸à¥à¤µà¥€à¤•à¥ƒà¤¤à¤¿",
    important: "à¤®à¤¹à¤¤à¥à¤µà¤ªà¥‚à¤°à¥à¤£",
    important_reminder: "à¤®à¤¹à¤¤à¥à¤µà¤ªà¥‚à¤°à¥à¤£ à¤…à¤¨à¥à¤¸à¥à¤®à¤¾à¤°à¤•",
    terms_reminder_text: "HelpBuddy à¤•à¥‡à¤µà¤² à¤à¤• à¤•à¤¨à¥‡à¤•à¥à¤¶à¤¨ à¤ªà¥à¤²à¥‡à¤Ÿà¤«à¥‰à¤°à¥à¤® à¤¹à¥ˆà¥¤ à¤¹à¤® à¤¸à¥‡à¤µà¤¾ à¤ªà¥à¤°à¤¦à¤¾à¤¤à¤¾à¤“à¤‚ à¤•à¥‹ à¤¨à¤¿à¤¯à¥à¤•à¥à¤¤ à¤¨à¤¹à¥€à¤‚ à¤•à¤°à¤¤à¥‡, à¤¸à¥‡à¤µà¤¾ à¤—à¥à¤£à¤µà¤¤à¥à¤¤à¤¾ à¤•à¥€ à¤—à¤¾à¤°à¤‚à¤Ÿà¥€ à¤¨à¤¹à¥€à¤‚ à¤¦à¥‡à¤¤à¥‡, à¤¯à¤¾ à¤­à¥à¤—à¤¤à¤¾à¤¨ à¤¨à¤¹à¥€à¤‚ à¤¸à¤‚à¤­à¤¾à¤²à¤¤à¥‡à¥¤ à¤†à¤ª à¤¸à¥€à¤§à¥‡ à¤…à¤¨à¥à¤¯ à¤‰à¤ªà¤¯à¥‹à¤—à¤•à¤°à¥à¤¤à¤¾à¤“à¤‚ à¤•à¥‡ à¤¸à¤¾à¤¥ à¤•à¥à¤°à¥‡à¤¡à¥‡à¤‚à¤¶à¤¿à¤¯à¤² à¤¸à¤¤à¥à¤¯à¤¾à¤ªà¤¿à¤¤ à¤•à¤°à¤¨à¥‡, à¤¶à¤°à¥à¤¤à¥‹à¤‚ à¤ªà¤° à¤¬à¤¾à¤¤à¤šà¥€à¤¤ à¤•à¤°à¤¨à¥‡ à¤”à¤° à¤µà¤¿à¤µà¤¾à¤¦à¥‹à¤‚ à¤•à¥‹ à¤¹à¤² à¤•à¤°à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤œà¤¿à¤®à¥à¤®à¥‡à¤¦à¤¾à¤° à¤¹à¥ˆà¤‚à¥¤",
    last_updated: "à¤…à¤‚à¤¤à¤¿à¤® à¤…à¤ªà¤¡à¥‡à¤Ÿ",
    
    // ============================================================
    // SECTION 30: PRIVACY POLICY (Legal Headings)
    // ============================================================
    privacy_introduction: "à¤ªà¤°à¤¿à¤šà¤¯",
    privacy_info_collect: "à¤¹à¤® à¤•à¥Œà¤¨ à¤¸à¥€ à¤œà¤¾à¤¨à¤•à¤¾à¤°à¥€ à¤à¤•à¤¤à¥à¤° à¤•à¤°à¤¤à¥‡ à¤¹à¥ˆà¤‚",
    privacy_how_use: "à¤¹à¤® à¤†à¤ªà¤•à¥€ à¤œà¤¾à¤¨à¤•à¤¾à¤°à¥€ à¤•à¤¾ à¤‰à¤ªà¤¯à¥‹à¤— à¤•à¥ˆà¤¸à¥‡ à¤•à¤°à¤¤à¥‡ à¤¹à¥ˆà¤‚",
    privacy_how_share: "à¤¹à¤® à¤†à¤ªà¤•à¥€ à¤œà¤¾à¤¨à¤•à¤¾à¤°à¥€ à¤•à¥ˆà¤¸à¥‡ à¤¸à¤¾à¤à¤¾ à¤•à¤°à¤¤à¥‡ à¤¹à¥ˆà¤‚",
    privacy_storage: "à¤¡à¥‡à¤Ÿà¤¾ à¤¸à¤‚à¤—à¥à¤°à¤¹à¤£ à¤”à¤° à¤¸à¥à¤°à¤•à¥à¤·à¤¾",
    privacy_retention: "à¤¡à¥‡à¤Ÿà¤¾ à¤ªà¥à¤°à¤¤à¤¿à¤§à¤¾à¤°à¤£",
    privacy_your_rights: "à¤†à¤ªà¤•à¥‡ à¤…à¤§à¤¿à¤•à¤¾à¤° à¤”à¤° à¤µà¤¿à¤•à¤²à¥à¤ª",
    privacy_cookies: "à¤•à¥à¤•à¥€à¤œà¤¼ à¤”à¤° à¤Ÿà¥à¤°à¥ˆà¤•à¤¿à¤‚à¤—",
    privacy_children: "à¤¬à¤šà¥à¤šà¥‹à¤‚ à¤•à¥€ à¤—à¥‹à¤ªà¤¨à¥€à¤¯à¤¤à¤¾",
    privacy_third_party: "à¤¤à¥ƒà¤¤à¥€à¤¯-à¤ªà¤•à¥à¤· à¤¸à¥‡à¤µà¤¾à¤à¤‚",
    privacy_changes: "à¤‡à¤¸ à¤—à¥‹à¤ªà¤¨à¥€à¤¯à¤¤à¤¾ à¤¨à¥€à¤¤à¤¿ à¤®à¥‡à¤‚ à¤¬à¤¦à¤²à¤¾à¤µ",
    privacy_legal: "à¤•à¤¾à¤¨à¥‚à¤¨à¥€ à¤…à¤¨à¥à¤ªà¤¾à¤²à¤¨",
    privacy_contact: "à¤¸à¤‚à¤ªà¤°à¥à¤• à¤•à¤°à¥‡à¤‚",
    privacy_grievance: "à¤¶à¤¿à¤•à¤¾à¤¯à¤¤ à¤…à¤§à¤¿à¤•à¤¾à¤°à¥€",
    your_privacy_matters: "à¤†à¤ªà¤•à¥€ à¤—à¥‹à¤ªà¤¨à¥€à¤¯à¤¤à¤¾ à¤®à¤¾à¤¯à¤¨à¥‡ à¤°à¤–à¤¤à¥€ à¤¹à¥ˆ",
    privacy_matters_text: "à¤¹à¤® à¤†à¤ªà¤•à¥€ à¤—à¥‹à¤ªà¤¨à¥€à¤¯à¤¤à¤¾ à¤•à¥€ à¤°à¤•à¥à¤·à¤¾ à¤•à¤°à¤¨à¥‡ à¤”à¤° à¤†à¤ªà¤•à¥‡ à¤¡à¥‡à¤Ÿà¤¾ à¤•à¥‡ à¤‰à¤ªà¤¯à¥‹à¤— à¤•à¥‡ à¤¬à¤¾à¤°à¥‡ à¤®à¥‡à¤‚ à¤ªà¤¾à¤°à¤¦à¤°à¥à¤¶à¥€ à¤°à¤¹à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤ªà¥à¤°à¤¤à¤¿à¤¬à¤¦à¥à¤§ à¤¹à¥ˆà¤‚à¥¤ à¤†à¤ªà¤•à¤¾ à¤µà¤¿à¤¶à¥à¤µà¤¾à¤¸ à¤¹à¤®à¤¾à¤°à¥‡ à¤²à¤¿à¤ à¤®à¤¹à¤¤à¥à¤µà¤ªà¥‚à¤°à¥à¤£ à¤¹à¥ˆà¥¤",
    data_controller: "à¤¡à¥‡à¤Ÿà¤¾ à¤¨à¤¿à¤¯à¤‚à¤¤à¥à¤°à¤•",
    response_time: "à¤ªà¥à¤°à¤¤à¤¿à¤•à¥à¤°à¤¿à¤¯à¤¾ à¤¸à¤®à¤¯",
    
    // ============================================================
    // SECTION 31: MISCELLANEOUS (Common UI Elements)
    // ============================================================
    required: "à¤œà¤°à¥‚à¤°à¥€",
    optional: "à¤à¤šà¥à¤›à¤¿à¤•",
    loading: "à¤²à¥‹à¤¡ à¤¹à¥‹ à¤°à¤¹à¤¾ à¤¹à¥ˆ...",
    please_wait: "à¤•à¥ƒà¤ªà¤¯à¤¾ à¤‡à¤‚à¤¤à¤œà¤¼à¤¾à¤° à¤•à¤°à¥‡à¤‚...",
    retry: "à¤«à¤¿à¤° à¤¸à¥‡ à¤•à¥‹à¤¶à¤¿à¤¶ à¤•à¤°à¥‡à¤‚",
    cancel: "à¤°à¤¦à¥à¤¦ à¤•à¤°à¥‡à¤‚",
    confirm: "à¤ªà¥à¤·à¥à¤Ÿà¤¿ à¤•à¤°à¥‡à¤‚",
    yes: "à¤¹à¤¾à¤‚",
    no: "à¤¨à¤¹à¥€à¤‚",
    ok: "à¤ à¥€à¤• à¤¹à¥ˆ",
    done: "à¤¹à¥‹ à¤—à¤¯à¤¾",
    next: "à¤…à¤—à¤²à¤¾",
    previous: "à¤ªà¤¿à¤›à¤²à¤¾",
    search: "à¤–à¥‹à¤œà¥‡à¤‚",
    filter: "à¤›à¤¾à¤‚à¤Ÿà¥‡à¤‚",
    sort: "à¤•à¥à¤°à¤® à¤²à¤—à¤¾à¤à¤‚",
    all: "à¤¸à¤­à¥€",
    none: "à¤•à¥‹à¤ˆ à¤¨à¤¹à¥€à¤‚",
    select: "à¤šà¥à¤¨à¥‡à¤‚",
    selected_count: "à¤šà¥à¤¨à¥‡ à¤—à¤",
    clear: "à¤¸à¤¾à¤« à¤•à¤°à¥‡à¤‚",
    reset: "à¤«à¤¿à¤° à¤¸à¥‡ à¤¶à¥à¤°à¥‚",
    apply: "à¤²à¤¾à¤—à¥‚ à¤•à¤°à¥‡à¤‚",
    more: "à¤”à¤°",
    less: "à¤•à¤®",
    show_all: "à¤¸à¤¬ à¤¦à¤¿à¤–à¤¾à¤à¤‚",
    hide: "à¤›à¥à¤ªà¤¾à¤à¤‚",
    expand: "à¤–à¥‹à¤²à¥‡à¤‚",
    collapse: "à¤¬à¤‚à¤¦ à¤•à¤°à¥‡à¤‚",
    
    // ============================================================
    // SECTION 32: PROVIDER PROFILE DISPLAY
    // ============================================================
    name: "à¤¨à¤¾à¤®",
    services: "à¤¸à¥‡à¤µà¤¾à¤à¤‚",
    services_provided: "à¤ªà¥à¤°à¤¦à¤¾à¤¨ à¤•à¥€ à¤—à¤ˆ à¤¸à¥‡à¤µà¤¾à¤à¤‚",
    address: "à¤ªà¤¤à¤¾",
    note: "à¤§à¥à¤¯à¤¾à¤¨ à¤¦à¥‡à¤‚",
    
    // ============================================================
    // SECTION 33: REQUEST & SERVICE COUNT (Pluralization)
    // ============================================================
    request: "à¤…à¤¨à¥à¤°à¥‹à¤§",
    requests: "à¤…à¤¨à¥à¤°à¥‹à¤§",
    service: "à¤¸à¥‡à¤µà¤¾",
    
    // ============================================================
    // SECTION 34: LOCATION & GPS
    // ============================================================
    gps_not_supported_message: "à¤†à¤ªà¤•à¤¾ à¤¬à¥à¤°à¤¾à¤‰à¤œà¤¼à¤° GPS à¤¸à¤ªà¥‹à¤°à¥à¤Ÿ à¤¨à¤¹à¥€à¤‚ à¤•à¤°à¤¤à¤¾",
    location_required_gps_alert: "à¤ªà¤¤à¤¾ à¤¸à¥à¤µà¤šà¤¾à¤²à¤¿à¤¤ à¤°à¥‚à¤ª à¤¸à¥‡ à¤¨à¤¹à¥€à¤‚ à¤®à¤¿à¤²à¤¾à¥¤ à¤¹à¤®à¥‡à¤‚ à¤†à¤ªà¤•à¥‡ GPS à¤¸à¥à¤¥à¤¾à¤¨ à¤•à¤¾ à¤‰à¤ªà¤¯à¥‹à¤— à¤•à¤°à¤¨à¤¾ à¤¹à¥‹à¤—à¤¾à¥¤ à¤•à¥ƒà¤ªà¤¯à¤¾ à¤¸à¤‚à¤•à¥‡à¤¤ à¤®à¤¿à¤²à¤¨à¥‡ à¤ªà¤° à¤¸à¥à¤¥à¤¾à¤¨ à¤ªà¤¹à¥à¤‚à¤š à¤•à¥€ à¤…à¤¨à¥à¤®à¤¤à¤¿ à¤¦à¥‡à¤‚à¥¤",
    location_access_denied_header: "à¤¸à¥à¤¥à¤¾à¤¨ à¤ªà¤¹à¥à¤‚à¤š à¤…à¤¸à¥à¤µà¥€à¤•à¥ƒà¤¤",
    gps_permission_denied_message: "\n\nâŒ à¤†à¤ªà¤¨à¥‡ à¤¸à¥à¤¥à¤¾à¤¨ à¤ªà¤¹à¥à¤‚à¤š à¤…à¤¸à¥à¤µà¥€à¤•à¤¾à¤° à¤•à¤° à¤¦à¥€à¥¤ à¤•à¥ƒà¤ªà¤¯à¤¾ à¤…à¤ªà¤¨à¥‡ à¤¬à¥à¤°à¤¾à¤‰à¤œà¤¼à¤° à¤¸à¥‡à¤Ÿà¤¿à¤‚à¤—à¥à¤¸ à¤®à¥‡à¤‚ à¤¸à¥à¤¥à¤¾à¤¨ à¤¸à¤•à¥à¤·à¤® à¤•à¤°à¥‡à¤‚:\n1. à¤à¤¡à¥à¤°à¥‡à¤¸ à¤¬à¤¾à¤° à¤®à¥‡à¤‚ à¤²à¥‰à¤• à¤†à¤‡à¤•à¤¨ à¤ªà¤° à¤•à¥à¤²à¤¿à¤• à¤•à¤°à¥‡à¤‚\n2. à¤¸à¥à¤¥à¤¾à¤¨ à¤ªà¤¹à¥à¤‚à¤š à¤•à¥€ à¤…à¤¨à¥à¤®à¤¤à¤¿ à¤¦à¥‡à¤‚\n3. à¤ªà¥‡à¤œ à¤°à¤¿à¤«à¥à¤°à¥‡à¤¶ à¤•à¤°à¥‡à¤‚ à¤”à¤° à¤«à¤¿à¤° à¤¸à¥‡ à¤ªà¥à¤°à¤¯à¤¾à¤¸ à¤•à¤°à¥‡à¤‚",
    gps_signal_unavailable: "\n\nâŒ GPS à¤¸à¤¿à¤—à¥à¤¨à¤² à¤‰à¤ªà¤²à¤¬à¥à¤§ à¤¨à¤¹à¥€à¤‚ à¤¹à¥ˆà¥¤ à¤•à¥ƒà¤ªà¤¯à¤¾:\n1. à¤¸à¥à¤¨à¤¿à¤¶à¥à¤šà¤¿à¤¤ à¤•à¤°à¥‡à¤‚ à¤•à¤¿ à¤†à¤ªà¤•à¥‡ à¤¡à¤¿à¤µà¤¾à¤‡à¤¸ à¤ªà¤° à¤¸à¥à¤¥à¤¾à¤¨ à¤¸à¥‡à¤µà¤¾à¤à¤‚ à¤¸à¤•à¥à¤·à¤® à¤¹à¥ˆà¤‚\n2. à¤¬à¥‡à¤¹à¤¤à¤° GPS à¤¸à¤¿à¤—à¥à¤¨à¤² à¤•à¥‡ à¤²à¤¿à¤ à¤–à¥à¤²à¥‡ à¤•à¥à¤·à¥‡à¤¤à¥à¤° à¤®à¥‡à¤‚ à¤œà¤¾à¤¨à¥‡ à¤•à¤¾ à¤ªà¥à¤°à¤¯à¤¾à¤¸ à¤•à¤°à¥‡à¤‚\n3. à¤°à¤¿à¤«à¥à¤°à¥‡à¤¶ à¤•à¤°à¥‡à¤‚ à¤”à¤° à¤«à¤¿à¤° à¤¸à¥‡ à¤ªà¥à¤°à¤¯à¤¾à¤¸ à¤•à¤°à¥‡à¤‚",
    gps_timeout_message: "\n\nâŒ GPS à¤¸à¥à¤¥à¤¾à¤¨ à¤®à¥‡à¤‚ à¤¬à¤¹à¥à¤¤ à¤¸à¤®à¤¯ à¤²à¤— à¤°à¤¹à¤¾ à¤¹à¥ˆà¥¤ à¤•à¥ƒà¤ªà¤¯à¤¾:\n1. à¤…à¤ªà¤¨à¤¾ à¤‡à¤‚à¤Ÿà¤°à¤¨à¥‡à¤Ÿ à¤•à¤¨à¥‡à¤•à¥à¤¶à¤¨ à¤œà¤¾à¤‚à¤šà¥‡à¤‚\n2. à¤¸à¥à¤¥à¤¾à¤¨ à¤¸à¥‡à¤µà¤¾à¤à¤‚ à¤¸à¤•à¥à¤·à¤® à¤•à¤°à¥‡à¤‚\n3. à¤«à¤¿à¤° à¤¸à¥‡ à¤ªà¥à¤°à¤¯à¤¾à¤¸ à¤•à¤°à¥‡à¤‚",

    select_service_type: "à¤¸à¥‡à¤µà¤¾ à¤•à¤¾ à¤ªà¥à¤°à¤•à¤¾à¤° à¤šà¥à¤¨à¥‡",
    please_select_service_type: "à¤•à¥ƒà¤ªà¤¾ à¤¸à¥‡à¤µà¤¾ à¤•à¤¾ à¤ªà¥à¤°à¤•à¤¾à¤° à¤šà¥à¤¨à¥‡",

   // ============================================================
// SECTION 16: SERVICE TYPE TRANSLATIONS
// ============================================================
// Electrician
electrician_installation: "à¤‡à¤²à¥‡à¤•à¥à¤Ÿà¥à¤°à¥€à¤¶à¤¿à¤¯à¤¨ - à¤‡à¤‚à¤¸à¥à¤Ÿà¥‰à¤²à¥‡à¤¶à¤¨ à¤¸à¥‡à¤µà¤¾à¤à¤‚",
electrician_repair: "à¤‡à¤²à¥‡à¤•à¥à¤Ÿà¥à¤°à¥€à¤¶à¤¿à¤¯à¤¨ - à¤®à¤°à¤®à¥à¤®à¤¤ à¤¸à¥‡à¤µà¤¾à¤à¤‚",
electrician_wiring: "à¤‡à¤²à¥‡à¤•à¥à¤Ÿà¥à¤°à¥€à¤¶à¤¿à¤¯à¤¨ - à¤¨à¤ à¤˜à¤° à¤•à¥€ à¤µà¤¾à¤¯à¤°à¤¿à¤‚à¤—/à¤°à¥€-à¤µà¤¾à¤¯à¤°à¤¿à¤‚à¤—",

// Plumber
plumber_installation: "à¤ªà¥à¤²à¤‚à¤¬à¤° - à¤‡à¤‚à¤¸à¥à¤Ÿà¥‰à¤²à¥‡à¤¶à¤¨ à¤¸à¥‡à¤µà¤¾à¤à¤‚",
plumber_repair: "à¤ªà¥à¤²à¤‚à¤¬à¤° - à¤®à¤°à¤®à¥à¤®à¤¤ à¤¸à¥‡à¤µà¤¾à¤à¤‚",
plumber_new_work: "à¤ªà¥à¤²à¤‚à¤¬à¤° - à¤¨à¤ à¤˜à¤° à¤•à¤¾ à¤ªà¥à¤²à¤‚à¤¬à¤¿à¤‚à¤— à¤•à¤¾à¤®",

// AC Services
ac_installation: "AC - à¤‡à¤‚à¤¸à¥à¤Ÿà¥‰à¤²à¥‡à¤¶à¤¨",
ac_repair_service: "AC - à¤®à¤°à¤®à¥à¤®à¤¤ à¤”à¤° à¤¸à¤°à¥à¤µà¤¿à¤¸à¤¿à¤‚à¤—",
ac_gas_filling: "AC - à¤—à¥ˆà¤¸ à¤«à¤¿à¤²à¤¿à¤‚à¤—",

// Carpenter
carpenter_repair: "à¤¬à¤¢à¤¼à¤ˆ - à¤«à¤°à¥à¤¨à¥€à¤šà¤° à¤•à¥€ à¤®à¤°à¤®à¥à¤®à¤¤",
carpenter_custom: "à¤¬à¤¢à¤¼à¤ˆ - à¤«à¤°à¥à¤¨à¥€à¤šà¤° à¤¬à¤¨à¤¾à¤¨à¤¾ (à¤•à¤¸à¥à¤Ÿà¤® à¤•à¤¾à¤®)",
carpenter_door_window: "à¤¬à¤¢à¤¼à¤ˆ - à¤¦à¤°à¤µà¤¾à¤œà¤¾ à¤”à¤° à¤–à¤¿à¤¡à¤¼à¤•à¥€ à¤•à¤¾ à¤•à¤¾à¤®",

// Painter
painter_house: "à¤ªà¥‡à¤‚à¤Ÿà¤° - à¤˜à¤°/à¤‡à¤®à¤¾à¤°à¤¤ à¤•à¥€ à¤ªà¥‡à¤‚à¤Ÿà¤¿à¤‚à¤—",
painter_furniture: "à¤ªà¥‡à¤‚à¤Ÿà¤° - à¤«à¤°à¥à¤¨à¥€à¤šà¤° à¤”à¤° à¤²à¤•à¤¡à¤¼à¥€ à¤•à¥€ à¤ªà¥‡à¤‚à¤Ÿà¤¿à¤‚à¤—",
painter_texture: "à¤ªà¥‡à¤‚à¤Ÿà¤° - à¤Ÿà¥‡à¤•à¥à¤¸à¤šà¤° à¤”à¤° à¤¡à¥‡à¤•à¥‹à¤°à¥‡à¤Ÿà¤¿à¤µ à¤ªà¥‡à¤‚à¤Ÿà¤¿à¤‚à¤—",

// Cleaner
cleaner_house: "à¤•à¥à¤²à¥€à¤¨à¤° - à¤˜à¤° à¤•à¥€ à¤¸à¤«à¤¾à¤ˆ",
cleaner_upholstery: "à¤•à¥à¤²à¥€à¤¨à¤° - à¤¸à¥‹à¤«à¤¾, à¤•à¤¾à¤°à¤ªà¥‡à¤Ÿ à¤”à¤° à¤…à¤ªà¤¹à¥‹à¤²à¥à¤¸à¥à¤Ÿà¥à¤°à¥€ à¤•à¥€ à¤¸à¤«à¤¾à¤ˆ",
cleaner_vehicle: "à¤•à¥à¤²à¥€à¤¨à¤° - à¤µà¤¾à¤¹à¤¨ à¤•à¥€ à¤¸à¤«à¤¾à¤ˆ",

// Appliance Repair
appliance_washing: "à¤‰à¤ªà¤•à¤°à¤£ à¤®à¤°à¤®à¥à¤®à¤¤ - à¤µà¥‰à¤¶à¤¿à¤‚à¤— à¤®à¤¶à¥€à¤¨",
appliance_refrigerator: "à¤‰à¤ªà¤•à¤°à¤£ à¤®à¤°à¤®à¥à¤®à¤¤ - à¤°à¥‡à¤«à¥à¤°à¤¿à¤œà¤°à¥‡à¤Ÿà¤°",
appliance_tv: "à¤‰à¤ªà¤•à¤°à¤£ à¤®à¤°à¤®à¥à¤®à¤¤ - TV/LED",
appliance_geyser: "à¤‰à¤ªà¤•à¤°à¤£ à¤®à¤°à¤®à¥à¤®à¤¤ - à¤—à¥€à¤œà¤°/à¤µà¥‰à¤Ÿà¤° à¤¹à¥€à¤Ÿà¤°",
appliance_ro: "à¤‰à¤ªà¤•à¤°à¤£ à¤®à¤°à¤®à¥à¤®à¤¤ - RO/à¤µà¥‰à¤Ÿà¤° à¤ªà¥à¤¯à¥‚à¤°à¥€à¤«à¤¾à¤¯à¤°",
appliance_microwave: "à¤‰à¤ªà¤•à¤°à¤£ à¤®à¤°à¤®à¥à¤®à¤¤ - à¤®à¤¾à¤‡à¤•à¥à¤°à¥‹à¤µà¥‡à¤µ/à¤“à¤µà¤¨",
appliance_other: "à¤‰à¤ªà¤•à¤°à¤£ à¤®à¤°à¤®à¥à¤®à¤¤ - à¤…à¤¨à¥à¤¯ à¤›à¥‹à¤Ÿà¥‡ à¤‰à¤ªà¤•à¤°à¤£",

// Short form service names (used in display)
elec_installation: "à¤²à¤—à¤¾à¤¨à¥‡ à¤•à¥€ à¤¸à¥‡à¤µà¤¾à¤à¤‚",
elec_repair: "à¤®à¤°à¤®à¥à¤®à¤¤ à¤¸à¥‡à¤µà¤¾à¤à¤‚",
elec_wiring: "à¤¨à¤ à¤˜à¤° à¤•à¥€ à¤µà¤¾à¤¯à¤°à¤¿à¤‚à¤—/à¤¦à¥à¤¬à¤¾à¤°à¤¾ -à¤µà¤¾à¤¯à¤°à¤¿à¤‚à¤—",

plumb_installation: "à¤²à¤—à¤¾à¤¨à¥‡ à¤•à¥€ à¤¸à¥‡à¤µà¤¾à¤à¤‚",
plumb_repair: "à¤®à¤°à¤®à¥à¤®à¤¤ à¤¸à¥‡à¤µà¤¾à¤à¤‚",
plumb_new_work: "à¤¨à¤ à¤˜à¤° à¤•à¤¾ à¤ªà¥à¤²à¤‚à¤¬à¤¿à¤‚à¤— à¤•à¤¾à¤®",

ac_installation: "AC à¤²à¤—à¤¾à¤¨à¤¾",
ac_repair_service: "AC à¤®à¤°à¤®à¥à¤®à¤¤ à¤”à¤° à¤¸à¤°à¥à¤µà¤¿à¤¸à¤¿à¤‚à¤—",
ac_gas_filling: "AC à¤—à¥ˆà¤¸ à¤«à¤¿à¤²à¤¿à¤‚à¤—",

carp_repair: "à¤«à¤°à¥à¤¨à¥€à¤šà¤° à¤•à¥€ à¤®à¤°à¤®à¥à¤®à¤¤",
carp_custom: "à¤«à¤°à¥à¤¨à¥€à¤šà¤° à¤¬à¤¨à¤¾à¤¨à¤¾ (Order à¤ªà¤°)",
carp_door_window: "à¤¦à¤°à¤µà¤¾à¤œà¤¾ à¤”à¤° à¤–à¤¿à¤¡à¤¼à¤•à¥€ à¤•à¤¾ à¤•à¤¾à¤®",

paint_house: "à¤˜à¤°/à¤‡à¤®à¤¾à¤°à¤¤ à¤•à¥€ à¤ªà¥‡à¤‚à¤Ÿà¤¿à¤‚à¤—",
paint_furniture: "à¤«à¤°à¥à¤¨à¥€à¤šà¤° à¤”à¤° à¤²à¤•à¤¡à¤¼à¥€ à¤•à¥€ à¤ªà¥‡à¤‚à¤Ÿà¤¿à¤‚à¤—",
paint_texture: "à¤Ÿà¥‡à¤•à¥à¤¸à¤šà¤° à¤”à¤° à¤¡à¥‡à¤•à¥‹à¤°à¥‡à¤Ÿà¤¿à¤µ à¤ªà¥‡à¤‚à¤Ÿà¤¿à¤‚à¤—",

clean_house: "à¤˜à¤° à¤•à¥€ à¤¸à¤«à¤¾à¤ˆ",
clean_upholstery: "à¤¸à¥‹à¤«à¤¾, à¤•à¤¾à¤°à¤ªà¥‡à¤Ÿ, à¤ªà¤°à¥à¤¦à¥‡ à¤”à¤° à¤…à¤ªà¤¹à¥‹à¤²à¥à¤¸à¥à¤Ÿà¥à¤°à¥€ à¤•à¥€ à¤¸à¤«à¤¾à¤ˆ",
clean_vehicle: "à¤µà¤¾à¤¹à¤¨ à¤•à¥€ à¤¸à¤«à¤¾à¤ˆ",

app_washing: "à¤µà¥‰à¤¶à¤¿à¤‚à¤— à¤®à¤¶à¥€à¤¨",
app_refrigerator: "à¤«à¥à¤°à¤¿à¤œ/ à¤°à¥‡à¤«à¥à¤°à¤¿à¤œà¤°à¥‡à¤Ÿà¤°",
app_tv: "TV/LED",
app_geyser: "à¤—à¥€à¤œà¤°/à¤µà¥‰à¤Ÿà¤° à¤¹à¥€à¤Ÿà¤°",
app_ro: "RO/à¤µà¥‰à¤Ÿà¤° à¤ªà¥à¤¯à¥‚à¤°à¥€à¤«à¤¾à¤¯à¤°",
app_microwave: "à¤®à¤¾à¤‡à¤•à¥à¤°à¥‹à¤µà¥‡à¤µ/à¤“à¤µà¤¨",
app_other: "à¤…à¤¨à¥à¤¯ à¤›à¥‹à¤Ÿà¥‡ à¤‰à¤ªà¤•à¤°à¤£",

// ============================================================
// SECTION 17: CONTACT SHARING CONFIRMATION MESSAGES
// ============================================================
confirm_request_contact_sharing: "à¤•à¥à¤¯à¤¾ à¤†à¤ª à¤¸à¤‚à¤ªà¤°à¥à¤• à¤œà¤¾à¤¨à¤•à¤¾à¤°à¥€ à¤¸à¤¾à¤à¤¾ à¤•à¤°à¤¨à¥‡ à¤•à¤¾ à¤…à¤¨à¥à¤°à¥‹à¤§ à¤•à¤°à¤¨à¤¾ à¤šà¤¾à¤¹à¤¤à¥‡ à¤¹à¥ˆà¤‚? à¤¦à¥‚à¤¸à¤°à¥‡ à¤ªà¤•à¥à¤· à¤•à¥‹ à¤µà¤¿à¤µà¤°à¤£ à¤¦à¤¿à¤–à¤¨à¥‡ à¤¸à¥‡ à¤ªà¤¹à¤²à¥‡ à¤®à¤‚à¤œà¥‚à¤°à¥€ à¤¦à¥‡à¤¨à¥€ à¤¹à¥‹à¤—à¥€à¥¤",
confirm_share_contact_info: "à¤•à¥à¤¯à¤¾ à¤†à¤ª à¤‡à¤¸ à¤µà¥à¤¯à¤•à¥à¤¤à¤¿ à¤•à¥‡ à¤¸à¤¾à¤¥ à¤…à¤ªà¤¨à¥€ à¤¸à¤‚à¤ªà¤°à¥à¤• à¤œà¤¾à¤¨à¤•à¤¾à¤°à¥€ à¤¸à¤¾à¤à¤¾ à¤•à¤°à¤¨à¤¾ à¤šà¤¾à¤¹à¤¤à¥‡ à¤¹à¥ˆà¤‚? à¤†à¤ªà¤•à¤¾ à¤«à¥‹à¤¨ à¤¨à¤‚à¤¬à¤° à¤”à¤° à¤ªà¤¤à¤¾ à¤‰à¤¨à¥à¤¹à¥‡à¤‚ à¤¦à¤¿à¤–à¤¾à¤ˆ à¤¦à¥‡à¤—à¤¾à¥¤",
contact_info_shared_success: "à¤¸à¤‚à¤ªà¤°à¥à¤• à¤œà¤¾à¤¨à¤•à¤¾à¤°à¥€ à¤¸à¤«à¤²à¤¤à¤¾à¤ªà¥‚à¤°à¥à¤µà¤• à¤¸à¤¾à¤à¤¾ à¤•à¥€ à¤—à¤ˆ! à¤µà¤¿à¤µà¤°à¤£ à¤…à¤¬ à¤¦à¥‹à¤¨à¥‹à¤‚ à¤ªà¤•à¥à¤·à¥‹à¤‚ à¤•à¥‹ à¤¦à¤¿à¤–à¤¾à¤ˆ à¤¦à¥‡ à¤°à¤¹à¥‡ à¤¹à¥ˆà¤‚à¥¤", 

// ============================================================
// SECTION 18: SERVICE EXAMPLES (Tooltips)
// ============================================================

// Electrician Examples
elec_installation_examples: "à¤ªà¤‚à¤–à¤¾ à¤²à¤—à¤¾à¤¨à¤¾, à¤²à¤¾à¤‡à¤Ÿ à¤«à¤¿à¤Ÿà¤¿à¤‚à¤—, à¤¸à¥à¤µà¤¿à¤š/à¤¸à¥‰à¤•à¥‡à¤Ÿ à¤²à¤—à¤¾à¤¨à¤¾, à¤—à¥€à¤œà¤° à¤•à¤¨à¥‡à¤•à¥à¤¶à¤¨, à¤¡à¥‹à¤°à¤¬à¥‡à¤² à¤²à¤—à¤¾à¤¨à¤¾, à¤‰à¤ªà¤•à¤°à¤£ à¤µà¤¾à¤¯à¤°à¤¿à¤‚à¤—",
elec_repair_examples: "à¤ªà¤‚à¤–à¤¾ à¤•à¤¾à¤® à¤¨à¤¹à¥€à¤‚ à¤•à¤° à¤°à¤¹à¤¾, à¤¸à¥à¤µà¤¿à¤šà¤¬à¥‹à¤°à¥à¤¡ à¤•à¥€ à¤¸à¤®à¤¸à¥à¤¯à¤¾, à¤²à¤¾à¤‡à¤Ÿ à¤Ÿà¤¿à¤®à¤Ÿà¤¿à¤®à¤¾à¤¨à¤¾, à¤¶à¥‰à¤°à¥à¤Ÿ à¤¸à¤°à¥à¤•à¤¿à¤Ÿ, MCB à¤Ÿà¥à¤°à¤¿à¤ª à¤¹à¥‹à¤¨à¤¾, à¤¬à¤¿à¤œà¤²à¥€ à¤¸à¥‰à¤•à¥‡à¤Ÿ à¤•à¥€ à¤¸à¤®à¤¸à¥à¤¯à¤¾",
elec_wiring_examples: "à¤ªà¥‚à¤°à¥‡ à¤˜à¤° à¤•à¥€ à¤µà¤¾à¤¯à¤°à¤¿à¤‚à¤—, à¤ªà¥à¤°à¤¾à¤¨à¥€ à¤µà¤¾à¤¯à¤°à¤¿à¤‚à¤— à¤¬à¤¦à¤²à¤¨à¤¾, à¤¡à¤¿à¤¸à¥à¤Ÿà¥à¤°à¥€à¤¬à¥à¤¯à¥‚à¤¶à¤¨ à¤¬à¥‹à¤°à¥à¤¡ à¤¸à¥‡à¤Ÿà¤…à¤ª, à¤¨à¤¿à¤°à¥à¤®à¤¾à¤£à¤¾à¤§à¥€à¤¨ à¤µà¤¿à¤¦à¥à¤¯à¥à¤¤ à¤•à¤¾à¤°à¥à¤¯, à¤¨à¤ à¤¸à¤°à¥à¤•à¤¿à¤Ÿ à¤œà¥‹à¤¡à¤¼à¤¨à¤¾",

// Plumber Examples
plumb_installation_examples: "à¤¨à¤² à¤²à¤—à¤¾à¤¨à¤¾, à¤¬à¤¾à¤¥à¤°à¥‚à¤® à¤«à¤¿à¤Ÿà¤¿à¤‚à¤—, à¤•à¤¿à¤šà¤¨ à¤¸à¤¿à¤‚à¤• à¤¸à¥‡à¤Ÿà¤…à¤ª, à¤ªà¤¾à¤¨à¥€ à¤•à¥€ à¤Ÿà¤‚à¤•à¥€ à¤²à¤—à¤¾à¤¨à¤¾, à¤®à¥‹à¤Ÿà¤°/à¤ªà¤‚à¤ª à¤²à¤—à¤¾à¤¨à¤¾, à¤ªà¤¾à¤‡à¤ªà¤²à¤¾à¤‡à¤¨ à¤¬à¤¿à¤›à¤¾à¤¨à¤¾",
plumb_repair_examples: "à¤¨à¤² à¤¸à¥‡ à¤ªà¤¾à¤¨à¥€ à¤°à¤¿à¤¸à¤¨à¤¾, à¤ªà¤¾à¤‡à¤ª à¤²à¥€à¤•, à¤Ÿà¥‰à¤¯à¤²à¥‡à¤Ÿ à¤«à¥à¤²à¤¶ à¤•à¥€ à¤¸à¤®à¤¸à¥à¤¯à¤¾, à¤¨à¤¾à¤²à¥€ à¤¬à¤‚à¤¦, à¤¬à¥‡à¤¸à¤¿à¤¨ à¤œà¤¾à¤®, à¤ªà¤¾à¤¨à¥€ à¤“à¤µà¤°à¤«à¥à¤²à¥‹",
plumb_new_work_examples: "à¤ªà¥‚à¤°à¤¾ à¤¬à¤¾à¤¥à¤°à¥‚à¤® à¤ªà¥à¤²à¤‚à¤¬à¤¿à¤‚à¤—, à¤•à¤¿à¤šà¤¨ à¤ªà¥à¤²à¤‚à¤¬à¤¿à¤‚à¤— à¤¸à¥‡à¤Ÿà¤…à¤ª, à¤¡à¥à¤°à¥‡à¤¨à¥‡à¤œ à¤¸à¤¿à¤¸à¥à¤Ÿà¤®, à¤ªà¤¾à¤¨à¥€ à¤•à¥€ à¤¸à¤ªà¥à¤²à¤¾à¤ˆ à¤²à¤¾à¤‡à¤¨, à¤¨à¤¿à¤°à¥à¤®à¤¾à¤£à¤¾à¤§à¥€à¤¨ à¤ªà¥à¤²à¤‚à¤¬à¤¿à¤‚à¤— à¤•à¤¾à¤°à¥à¤¯",

// AC Services Examples
ac_installation_examples: "à¤¨à¤¯à¤¾ AC à¤²à¤—à¤¾à¤¨à¤¾, AC à¤‰à¤¤à¤¾à¤°à¤¨à¤¾ à¤”à¤° à¤«à¤¿à¤° à¤²à¤—à¤¾à¤¨à¤¾, à¤‡à¤¨à¤¡à¥‹à¤°/à¤†à¤‰à¤Ÿà¤¡à¥‹à¤° à¤¯à¥‚à¤¨à¤¿à¤Ÿ à¤®à¤¾à¤‰à¤‚à¤Ÿà¤¿à¤‚à¤—, à¤ªà¤¾à¤‡à¤ªà¤¿à¤‚à¤— à¤”à¤° à¤¡à¥à¤°à¥‡à¤¨à¥‡à¤œ à¤¸à¥‡à¤Ÿà¤…à¤ª, AC à¤¶à¤¿à¤«à¥à¤Ÿà¤¿à¤‚à¤—",
ac_repair_examples: "AC à¤ à¤‚à¤¡à¤¾ à¤¨à¤¹à¥€à¤‚ à¤•à¤° à¤°à¤¹à¤¾, AC à¤•à¥€ à¤¸à¤«à¤¾à¤ˆ, à¤«à¤¿à¤²à¥à¤Ÿà¤° à¤¸à¤«à¤¾à¤ˆ, à¤…à¤œà¥€à¤¬ à¤†à¤µà¤¾à¤œ, à¤ªà¤¾à¤¨à¥€ à¤•à¤¾ à¤°à¤¿à¤¸à¤¾à¤µ, à¤•à¤‚à¤ªà¥à¤°à¥‡à¤¸à¤° à¤•à¥€ à¤¸à¤®à¤¸à¥à¤¯à¤¾",
ac_gas_examples: "à¤—à¥ˆà¤¸ à¤°à¤¿à¤«à¤¿à¤²à¤¿à¤‚à¤—, à¤—à¥ˆà¤¸ à¤•à¤® à¤¹à¥‹à¤¨à¥‡ à¤¸à¥‡ à¤ à¤‚à¤¡à¤• à¤¨à¤¹à¥€à¤‚, à¤—à¥ˆà¤¸ à¤²à¥€à¤• à¤•à¥€ à¤®à¤°à¤®à¥à¤®à¤¤, à¤ªà¥à¤°à¥‡à¤¶à¤° à¤šà¥‡à¤•, à¤•à¥‚à¤²à¤¿à¤‚à¤— à¤ªà¤°à¤«à¥‰à¤°à¥à¤®à¥‡à¤‚à¤¸ à¤•à¥€ à¤¸à¤®à¤¸à¥à¤¯à¤¾",

// Carpenter Examples
carp_repair_examples: "à¤¬à¤¿à¤¸à¥à¤¤à¤° à¤•à¥€ à¤®à¤°à¤®à¥à¤®à¤¤, à¤•à¥à¤°à¥à¤¸à¥€/à¤¸à¥‹à¤«à¤¾ à¤ à¥€à¤• à¤•à¤°à¤¨à¤¾, à¤Ÿà¥‡à¤¬à¤² à¤•à¥€ à¤®à¤°à¤®à¥à¤®à¤¤, à¤¦à¤°à¤¾à¤œ à¤•à¥€ à¤¸à¤®à¤¸à¥à¤¯à¤¾, à¤•à¤¬à¥à¤œà¥‡ à¤¬à¤¦à¤²à¤¨à¤¾, à¤«à¤°à¥à¤¨à¥€à¤šà¤° à¤ªà¥‰à¤²à¤¿à¤¶",
carp_custom_examples: "à¤•à¤¸à¥à¤Ÿà¤® à¤…à¤²à¤®à¤¾à¤°à¥€, à¤¸à¥à¤Ÿà¤¡à¥€ à¤Ÿà¥‡à¤¬à¤², TV à¤¯à¥‚à¤¨à¤¿à¤Ÿ, à¤œà¥‚à¤¤à¤¾ à¤°à¥ˆà¤•, à¤•à¤¿à¤šà¤¨ à¤•à¥ˆà¤¬à¤¿à¤¨à¥‡à¤Ÿ, à¤¬à¥à¤•à¤¶à¥‡à¤²à¥à¤«",
carp_door_examples: "à¤¦à¤°à¤µà¤¾à¤œà¤¾ à¤²à¤—à¤¾à¤¨à¤¾/à¤®à¤°à¤®à¥à¤®à¤¤, à¤–à¤¿à¤¡à¤¼à¤•à¥€ à¤•à¤¾ à¤«à¥à¤°à¥‡à¤®, à¤¦à¤°à¤µà¤¾à¤œà¥‡ à¤•à¤¾ à¤¤à¤¾à¤²à¤¾ à¤²à¤—à¤¾à¤¨à¤¾, à¤¹à¥ˆà¤‚à¤¡à¤² à¤”à¤° à¤•à¥à¤‚à¤¡à¥€, à¤¸à¥à¤²à¤¾à¤‡à¤¡à¤¿à¤‚à¤— à¤¦à¤°à¤µà¤¾à¤œà¥‡ à¤•à¥€ à¤ªà¤Ÿà¤°à¥€, à¤•à¤¿à¤šà¤¨ à¤•à¥ˆà¤¬à¤¿à¤¨à¥‡à¤Ÿ à¤•à¥‡ à¤¦à¤°à¤µà¤¾à¤œà¥‡",

// Painter Examples
paint_house_examples: "à¤•à¤®à¤°à¥‡ à¤•à¥€ à¤ªà¥‡à¤‚à¤Ÿà¤¿à¤‚à¤—, à¤ªà¥‚à¤°à¥‡ à¤˜à¤° à¤•à¥€ à¤ªà¥‡à¤‚à¤Ÿà¤¿à¤‚à¤—, à¤¬à¤¾à¤¹à¤°à¥€ à¤¦à¥€à¤µà¤¾à¤° à¤•à¥€ à¤ªà¥‡à¤‚à¤Ÿà¤¿à¤‚à¤—, à¤›à¤¤ à¤•à¥€ à¤ªà¥‡à¤‚à¤Ÿà¤¿à¤‚à¤—, à¤¬à¤¾à¤²à¤•à¤¨à¥€ à¤•à¥€ à¤ªà¥‡à¤‚à¤Ÿà¤¿à¤‚à¤—, à¤¬à¤¾à¤‰à¤‚à¤¡à¥à¤°à¥€ à¤µà¥‰à¤² à¤•à¥€ à¤ªà¥‡à¤‚à¤Ÿà¤¿à¤‚à¤—",
paint_furniture_examples: "à¤¦à¤°à¤µà¤¾à¤œà¥‡ à¤•à¥€ à¤ªà¥‡à¤‚à¤Ÿà¤¿à¤‚à¤—, à¤–à¤¿à¤¡à¤¼à¤•à¥€ à¤•à¥‡ à¤«à¥à¤°à¥‡à¤®, à¤²à¤•à¤¡à¤¼à¥€ à¤•à¤¾ à¤«à¤°à¥à¤¨à¥€à¤šà¤°, à¤…à¤²à¤®à¤¾à¤°à¥€ à¤•à¥€ à¤ªà¥‡à¤‚à¤Ÿà¤¿à¤‚à¤—, à¤°à¥‡à¤²à¤¿à¤‚à¤— à¤•à¥€ à¤ªà¥‡à¤‚à¤Ÿà¤¿à¤‚à¤—, à¤²à¤•à¤¡à¤¼à¥€ à¤ªà¤° à¤µà¤¾à¤°à¥à¤¨à¤¿à¤¶",
paint_texture_examples: "à¤Ÿà¥‡à¤•à¥à¤¸à¤šà¤° à¤µà¤¾à¤²à¥€ à¤¦à¥€à¤µà¤¾à¤°à¥‡à¤‚, à¤¡à¤¿à¤œà¤¾à¤‡à¤¨à¤° à¤«à¤¿à¤¨à¤¿à¤¶, à¤¬à¤šà¥à¤šà¥‹à¤‚ à¤•à¥‡ à¤•à¤®à¤°à¥‡ à¤•à¥€ à¤¡à¤¿à¤œà¤¾à¤‡à¤¨, à¤¸à¥à¤Ÿà¥‡à¤‚à¤¸à¤¿à¤² à¤†à¤°à¥à¤Ÿ, à¤à¤•à¥à¤¸à¥‡à¤‚à¤Ÿ à¤µà¥‰à¤², à¤µà¤¿à¤¶à¥‡à¤· à¤ªà¥à¤°à¤­à¤¾à¤µ",

// Cleaner Examples
clean_house_examples: "à¤•à¤®à¤°à¥‡ à¤•à¥€ à¤¸à¤«à¤¾à¤ˆ, à¤•à¤¿à¤šà¤¨ à¤•à¥€ à¤—à¤¹à¤°à¥€ à¤¸à¤«à¤¾à¤ˆ, à¤¬à¤¾à¤¥à¤°à¥‚à¤® à¤•à¥€ à¤¸à¤«à¤¾à¤ˆ, à¤«à¤°à¥à¤¶ à¤ªà¥‹à¤›à¤¨à¤¾, à¤¬à¤¾à¤²à¤•à¤¨à¥€ à¤•à¥€ à¤¸à¤«à¤¾à¤ˆ, à¤ªà¥‚à¤°à¥‡ à¤˜à¤° à¤•à¥€ à¤¸à¤«à¤¾à¤ˆ",
clean_upholstery_examples: "à¤¸à¥‹à¤«à¤¾ à¤•à¥€ à¤¸à¤«à¤¾à¤ˆ, à¤•à¤¾à¤°à¤ªà¥‡à¤Ÿ à¤¶à¥ˆà¤®à¥à¤ªà¥‚, à¤—à¤¦à¥à¤¦à¥‡ à¤•à¥€ à¤¸à¤«à¤¾à¤ˆ, à¤ªà¤°à¤¦à¥‹à¤‚ à¤•à¥€ à¤¸à¤«à¤¾à¤ˆ, à¤•à¥à¤°à¥à¤¸à¥€ à¤•à¤¾ à¤•à¤ªà¤¡à¤¼à¤¾, à¤•à¤ªà¤¡à¤¼à¥‡ à¤•à¥€ à¤—à¤¹à¤°à¥€ à¤¸à¤«à¤¾à¤ˆ",
clean_vehicle_examples: "à¤•à¤¾à¤° à¤§à¥‹à¤¨à¤¾, à¤¬à¤¾à¤‡à¤• à¤•à¥€ à¤¸à¤«à¤¾à¤ˆ, à¤•à¤¾à¤° à¤•à¥‡ à¤…à¤‚à¤¦à¤° à¤•à¥€ à¤¸à¤«à¤¾à¤ˆ, à¤µà¤¾à¤¹à¤¨ à¤¡à¤¿à¤Ÿà¥‡à¤²à¤¿à¤‚à¤—, à¤¡à¥ˆà¤¶à¤¬à¥‹à¤°à¥à¤¡ à¤•à¥€ à¤¸à¤«à¤¾à¤ˆ, à¤¸à¥€à¤Ÿ à¤¶à¥ˆà¤®à¥à¤ªà¥‚",

// Appliance Repair Examples
app_washing_examples: "à¤¸à¥à¤ªà¤¿à¤¨ à¤¨à¤¹à¥€à¤‚ à¤¹à¥‹ à¤°à¤¹à¤¾, à¤ªà¤¾à¤¨à¥€ à¤¨à¤¹à¥€à¤‚ à¤¨à¤¿à¤•à¤² à¤°à¤¹à¤¾, à¤šà¤¾à¤²à¥‚ à¤¨à¤¹à¥€à¤‚ à¤¹à¥‹ à¤°à¤¹à¤¾, à¤†à¤µà¤¾à¤œ à¤† à¤°à¤¹à¥€ à¤¹à¥ˆ, à¤¦à¤°à¤µà¤¾à¤œà¤¾ à¤¬à¤‚à¤¦ à¤¨à¤¹à¥€à¤‚ à¤¹à¥‹ à¤°à¤¹à¤¾, à¤¡à¥à¤°à¤® à¤•à¥€ à¤¸à¤®à¤¸à¥à¤¯à¤¾",
app_refrigerator_examples: "à¤ à¤‚à¤¡à¤¾ à¤¨à¤¹à¥€à¤‚ à¤¹à¥‹ à¤°à¤¹à¤¾, à¤«à¥à¤°à¥€à¤œà¤° à¤•à¥€ à¤¸à¤®à¤¸à¥à¤¯à¤¾, à¤…à¤œà¥€à¤¬ à¤†à¤µà¤¾à¤œ, à¤ªà¤¾à¤¨à¥€ à¤•à¤¾ à¤°à¤¿à¤¸à¤¾à¤µ, à¤¬à¤°à¥à¤« à¤œà¤®à¤¨à¤¾, à¤¦à¤°à¤µà¤¾à¤œà¥‡ à¤•à¥€ à¤¸à¥€à¤² à¤•à¥€ à¤¸à¤®à¤¸à¥à¤¯à¤¾",
app_tv_examples: "à¤¡à¤¿à¤¸à¥à¤ªà¥à¤²à¥‡ à¤¨à¤¹à¥€à¤‚ à¤† à¤°à¤¹à¤¾, à¤¸à¥à¤•à¥à¤°à¥€à¤¨ à¤Ÿà¤¿à¤®à¤Ÿà¤¿à¤®à¤¾à¤¨à¤¾, à¤†à¤µà¤¾à¤œ à¤¨à¤¹à¥€à¤‚ à¤† à¤°à¤¹à¥€, à¤¸à¥à¤•à¥à¤°à¥€à¤¨ à¤ªà¤° à¤²à¤¾à¤‡à¤¨à¥‡à¤‚, à¤°à¤¿à¤®à¥‹à¤Ÿ à¤•à¤¾à¤® à¤¨à¤¹à¥€à¤‚ à¤•à¤° à¤°à¤¹à¤¾, HDMI à¤ªà¥‹à¤°à¥à¤Ÿ à¤•à¥€ à¤¸à¤®à¤¸à¥à¤¯à¤¾",
app_geyser_examples: "à¤ªà¤¾à¤¨à¥€ à¤—à¤°à¥à¤® à¤¨à¤¹à¥€à¤‚ à¤¹à¥‹ à¤°à¤¹à¤¾, à¤¥à¤°à¥à¤®à¥‹à¤¸à¥à¤Ÿà¥‡à¤Ÿ à¤•à¥€ à¤¸à¤®à¤¸à¥à¤¯à¤¾, à¤ªà¤¾à¤¨à¥€ à¤•à¤¾ à¤°à¤¿à¤¸à¤¾à¤µ, à¤—à¥ˆà¤¸ à¤‡à¤—à¥à¤¨à¤¿à¤¶à¤¨ à¤•à¥€ à¤¸à¤®à¤¸à¥à¤¯à¤¾, à¤¹à¥€à¤Ÿà¤¿à¤‚à¤— à¤à¤²à¤¿à¤®à¥‡à¤‚à¤Ÿ à¤•à¥€ à¤–à¤°à¤¾à¤¬à¥€, à¤ªà¤¾à¤¯à¤²à¤Ÿ à¤²à¤¾à¤‡à¤Ÿ à¤•à¥€ à¤¸à¤®à¤¸à¥à¤¯à¤¾",
app_ro_examples: "à¤¶à¥à¤¦à¥à¤§ à¤¨à¤¹à¥€à¤‚ à¤•à¤° à¤°à¤¹à¤¾, à¤ªà¤¾à¤¨à¥€ à¤•à¤¾ à¤ªà¥à¤°à¤µà¤¾à¤¹ à¤•à¤®, à¤«à¤¿à¤²à¥à¤Ÿà¤° à¤¬à¤¦à¤²à¤¨à¤¾, TDS à¤•à¥€ à¤¸à¤®à¤¸à¥à¤¯à¤¾, à¤°à¤¿à¤¸à¤¾à¤µ, à¤®à¥‹à¤Ÿà¤° à¤•à¤¾à¤® à¤¨à¤¹à¥€à¤‚ à¤•à¤° à¤°à¤¹à¥€",
app_microwave_examples: "à¤—à¤°à¥à¤® à¤¨à¤¹à¥€à¤‚ à¤¹à¥‹ à¤°à¤¹à¤¾, à¤Ÿà¤°à¥à¤¨à¤Ÿà¥‡à¤¬à¤² à¤˜à¥‚à¤® à¤¨à¤¹à¥€à¤‚ à¤°à¤¹à¤¾, à¤¦à¤°à¤µà¤¾à¤œà¥‡ à¤•à¤¾ à¤²à¥ˆà¤š à¤Ÿà¥‚à¤Ÿà¤¾, à¤¡à¤¿à¤¸à¥à¤ªà¥à¤²à¥‡ à¤•à¥€ à¤¸à¤®à¤¸à¥à¤¯à¤¾, à¤…à¤œà¥€à¤¬ à¤†à¤µà¤¾à¤œà¥‡à¤‚, à¤…à¤‚à¤¦à¤° à¤šà¤¿à¤‚à¤—à¤¾à¤°à¥€",
app_other_examples: "à¤ªà¤‚à¤–à¥‡ à¤•à¥€ à¤®à¤°à¤®à¥à¤®à¤¤, à¤®à¤¿à¤•à¥à¤¸à¤° à¤•à¤¾à¤® à¤¨à¤¹à¥€à¤‚ à¤•à¤° à¤°à¤¹à¤¾, à¤—à¥à¤°à¤¾à¤‡à¤‚à¤¡à¤° à¤•à¥€ à¤¸à¤®à¤¸à¥à¤¯à¤¾, à¤ªà¥à¤°à¥‡à¤¸ à¤•à¥€ à¤¸à¤®à¤¸à¥à¤¯à¤¾, à¤•à¥‚à¤²à¤° à¤•à¤¾ à¤ªà¤‚à¤ª, à¤ªà¤¾à¤¨à¥€ à¤•à¤¾ à¤ªà¤‚à¤ª, à¤šà¤¿à¤®à¤¨à¥€ à¤•à¥€ à¤®à¤°à¤®à¥à¤®à¤¤",

// Seeker Templates
'templates.seeker.initial_contact.title': 'ðŸ’¬ à¤ªà¥à¤°à¤¾à¤°à¤‚à¤­à¤¿à¤• à¤¸à¤‚à¤ªà¤°à¥à¤•',
'templates.seeker.initial_contact.item1': 'à¤¨à¤®à¤¸à¥à¤¤à¥‡! à¤•à¥à¤¯à¤¾ à¤†à¤ª à¤¸à¥‡à¤µà¤¾ à¤•à¥‡ à¤¬à¤¾à¤°à¥‡ à¤®à¥‡à¤‚ à¤…à¤§à¤¿à¤• à¤œà¤¾à¤¨à¤•à¤¾à¤°à¥€ à¤¦à¥‡ à¤¸à¤•à¤¤à¥‡ à¤¹à¥ˆà¤‚?',
'templates.seeker.initial_contact.item2': 'à¤‡à¤¸ à¤•à¤¾à¤® à¤•à¥‡ à¤²à¤¿à¤ à¤†à¤ªà¤•à¥€ à¤‰à¤ªà¤²à¤¬à¥à¤§à¤¤à¤¾ à¤•à¥à¤¯à¤¾ à¤¹à¥ˆ?',
'templates.seeker.initial_contact.item3': 'à¤•à¥à¤¯à¤¾ à¤†à¤ª à¤‡à¤¸à¥€ à¤¤à¤°à¤¹ à¤•à¥‡ à¤•à¤¾à¤® à¤•à¤¾ à¤…à¤¨à¥à¤­à¤µ à¤¸à¤¾à¤à¤¾ à¤•à¤° à¤¸à¤•à¤¤à¥‡ à¤¹à¥ˆà¤‚?',

'templates.seeker.scheduling.title': 'ðŸ“… à¤¸à¤®à¤¯ à¤¨à¤¿à¤°à¥à¤§à¤¾à¤°à¤£',
'templates.seeker.scheduling.item1': 'à¤†à¤ª à¤•à¤¾à¤® à¤•à¤¬ à¤¶à¥à¤°à¥‚ à¤•à¤° à¤¸à¤•à¤¤à¥‡ à¤¹à¥ˆà¤‚?',
'templates.seeker.scheduling.item2': 'à¤‡à¤¸à¥‡ à¤ªà¥‚à¤°à¤¾ à¤¹à¥‹à¤¨à¥‡ à¤®à¥‡à¤‚ à¤•à¤¿à¤¤à¤¨à¤¾ à¤¸à¤®à¤¯ à¤²à¤—à¥‡à¤—à¤¾?',
'templates.seeker.scheduling.item3': 'à¤•à¥à¤¯à¤¾ à¤†à¤ª à¤†à¤œ à¤¯à¤¾ à¤•à¤² à¤† à¤¸à¤•à¤¤à¥‡ à¤¹à¥ˆà¤‚?',

'templates.seeker.pricing.title': 'ðŸ’° à¤®à¥‚à¤²à¥à¤¯ à¤¨à¤¿à¤°à¥à¤§à¤¾à¤°à¤£',
'templates.seeker.pricing.item1': 'à¤…à¤¨à¥à¤®à¤¾à¤¨à¤¿à¤¤ à¤²à¤¾à¤—à¤¤ à¤•à¥à¤¯à¤¾ à¤¹à¥‹à¤—à¥€?',
'templates.seeker.pricing.item2': 'à¤•à¥à¤¯à¤¾ à¤†à¤ª à¤¨à¤¿à¤°à¥€à¤•à¥à¤·à¤£/à¤µà¤¿à¤œà¤¿à¤Ÿ à¤•à¥‡ à¤²à¤¿à¤ à¤¶à¥à¤²à¥à¤• à¤²à¥‡à¤¤à¥‡ à¤¹à¥ˆà¤‚?',
'templates.seeker.pricing.item3': 'à¤•à¥à¤¯à¤¾ à¤¯à¤¹ à¤•à¥€à¤®à¤¤ à¤ªà¤° à¤¬à¤¾à¤¤à¤šà¥€à¤¤ à¤•à¥€ à¤œà¤¾ à¤¸à¤•à¤¤à¥€ à¤¹à¥ˆ?',

'templates.seeker.additional_info.title': 'â„¹ï¸ à¤…à¤¤à¤¿à¤°à¤¿à¤•à¥à¤¤ à¤œà¤¾à¤¨à¤•à¤¾à¤°à¥€',
'templates.seeker.additional_info.item1': 'à¤•à¥à¤¯à¤¾ à¤†à¤ªà¤•à¥‡ à¤ªà¤¾à¤¸ à¤†à¤µà¤¶à¥à¤¯à¤• à¤‰à¤ªà¤•à¤°à¤£ à¤”à¤° à¤”à¤œà¤¾à¤° à¤¹à¥ˆà¤‚?',
'templates.seeker.additional_info.item2': 'à¤•à¥à¤¯à¤¾ à¤†à¤ª à¤¸à¤¾à¤®à¤—à¥à¤°à¥€ à¤ªà¥à¤°à¤¦à¤¾à¤¨ à¤•à¤°à¥‡à¤‚à¤—à¥‡ à¤¯à¤¾ à¤®à¥à¤à¥‡ à¤µà¥à¤¯à¤µà¤¸à¥à¤¥à¤¾ à¤•à¤°à¤¨à¥€ à¤¹à¥‹à¤—à¥€?',
'templates.seeker.additional_info.item3': 'à¤•à¥à¤¯à¤¾ à¤†à¤ª à¤ªà¤¿à¤›à¤²à¥‡ à¤•à¤¾à¤® à¤•à¥€ à¤¤à¤¸à¥à¤µà¥€à¤°à¥‡à¤‚ à¤¸à¤¾à¤à¤¾ à¤•à¤° à¤¸à¤•à¤¤à¥‡ à¤¹à¥ˆà¤‚?',
'templates.seeker.additional_info.item4': 'à¤•à¥à¤¯à¤¾ à¤†à¤ª à¤…à¤ªà¤¨à¥‡ à¤•à¤¾à¤® à¤ªà¤° à¤µà¤¾à¤°à¤‚à¤Ÿà¥€ à¤¦à¥‡à¤¤à¥‡ à¤¹à¥ˆà¤‚?',

'templates.seeker.contact_finalization.title': 'ðŸ¤ à¤¸à¤‚à¤ªà¤°à¥à¤• à¤”à¤° à¤…à¤‚à¤¤à¤¿à¤® à¤°à¥‚à¤ª',
'templates.seeker.contact_finalization.item1': 'à¤šà¤²à¤¿à¤ à¤‡à¤¸ à¤¸à¥Œà¤¦à¥‡ à¤•à¥‹ à¤…à¤‚à¤¤à¤¿à¤® à¤°à¥‚à¤ª à¤¦à¥‡à¤‚à¥¤ à¤•à¥à¤¯à¤¾ à¤¹à¤® à¤¸à¤‚à¤ªà¤°à¥à¤• à¤µà¤¿à¤µà¤°à¤£ à¤¸à¤¾à¤à¤¾ à¤•à¤° à¤¸à¤•à¤¤à¥‡ à¤¹à¥ˆà¤‚?',
'templates.seeker.contact_finalization.item2': 'à¤®à¥ˆà¤‚ à¤†à¤ªà¤•à¥‡ à¤¸à¤¾à¤¥ à¤†à¤—à¥‡ à¤¬à¤¢à¤¼à¤¨à¤¾ à¤šà¤¾à¤¹à¥‚à¤‚à¤—à¤¾à¥¤ à¤¹à¤® à¤•à¤¬ à¤®à¤¿à¤² à¤¸à¤•à¤¤à¥‡ à¤¹à¥ˆà¤‚?',
'templates.seeker.contact_finalization.item3': 'à¤…à¤šà¥à¤›à¤¾ à¤²à¤—à¤¾! à¤•à¥ƒà¤ªà¤¯à¤¾ à¤…à¤ªà¤¨à¤¾ à¤¸à¤‚à¤ªà¤°à¥à¤• à¤¨à¤‚à¤¬à¤° à¤¸à¤¾à¤à¤¾ à¤•à¤°à¥‡à¤‚à¥¤',

// Provider Templates
'templates.provider.response.title': 'ðŸ‘‹ à¤ªà¥à¤°à¤¤à¤¿à¤•à¥à¤°à¤¿à¤¯à¤¾',
'templates.provider.response.item1': 'à¤¨à¤®à¤¸à¥à¤¤à¥‡! à¤®à¥ˆà¤‚ à¤‰à¤ªà¤²à¤¬à¥à¤§ à¤¹à¥‚à¤‚ à¤”à¤° à¤‡à¤¸ à¤•à¤¾à¤® à¤®à¥‡à¤‚ à¤°à¥à¤šà¤¿ à¤°à¤–à¤¤à¤¾ à¤¹à¥‚à¤‚à¥¤',
'templates.provider.response.item2': 'à¤®à¥à¤à¥‡ à¤‡à¤¸ à¤ªà¥à¤°à¤•à¤¾à¤° à¤•à¥‡ à¤•à¤¾à¤® à¤•à¤¾ à¤…à¤¨à¥à¤­à¤µ à¤¹à¥ˆà¥¤ à¤®à¤¦à¤¦ à¤•à¤°à¤¨à¥‡ à¤®à¥‡à¤‚ à¤–à¥à¤¶à¥€ à¤¹à¥‹à¤—à¥€!',
'templates.provider.response.item3': 'à¤®à¥ˆà¤‚ à¤¤à¥à¤°à¤‚à¤¤ à¤¶à¥à¤°à¥‚ à¤•à¤° à¤¸à¤•à¤¤à¤¾ à¤¹à¥‚à¤‚à¥¤ à¤¬à¤¤à¤¾à¤à¤‚ à¤…à¤—à¤° à¤†à¤—à¥‡ à¤¬à¤¢à¤¼à¤¨à¤¾ à¤šà¤¾à¤¹à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤',

'templates.provider.pricing.title': 'ðŸ’° à¤®à¥‚à¤²à¥à¤¯ à¤¨à¤¿à¤°à¥à¤§à¤¾à¤°à¤£',
'templates.provider.pricing.item1': 'à¤…à¤¨à¥à¤®à¤¾à¤¨à¤¿à¤¤ à¤²à¤¾à¤—à¤¤ à¤²à¤—à¤­à¤— â‚¹XXX à¤¹à¥‹à¤—à¥€à¥¤',
'templates.provider.pricing.item2': 'à¤®à¥ˆà¤‚ à¤¨à¤¿à¤°à¥€à¤•à¥à¤·à¤£ à¤•à¥‡ à¤¬à¤¾à¤¦ à¤µà¤¿à¤¸à¥à¤¤à¥ƒà¤¤ à¤•à¥‹à¤Ÿà¥‡à¤¶à¤¨ à¤¦à¥‡ à¤¸à¤•à¤¤à¤¾ à¤¹à¥‚à¤‚à¥¤',
'templates.provider.pricing.item3': 'à¤ªà¥à¤°à¤¾à¤°à¤‚à¤­à¤¿à¤• à¤µà¤¿à¤œà¤¿à¤Ÿ à¤”à¤° à¤¨à¤¿à¤°à¥€à¤•à¥à¤·à¤£ à¤•à¥‡ à¤²à¤¿à¤ à¤•à¥‹à¤ˆ à¤¶à¥à¤²à¥à¤• à¤¨à¤¹à¥€à¤‚à¥¤',

'templates.provider.information_requests.title': 'â„¹ï¸ à¤œà¤¾à¤¨à¤•à¤¾à¤°à¥€ à¤…à¤¨à¥à¤°à¥‹à¤§',
'templates.provider.information_requests.item1': 'à¤•à¥à¤¯à¤¾ à¤†à¤ª à¤¸à¤®à¤¸à¥à¤¯à¤¾ à¤•à¥‡ à¤¬à¤¾à¤°à¥‡ à¤®à¥‡à¤‚ à¤…à¤§à¤¿à¤• à¤µà¤¿à¤µà¤°à¤£ à¤¯à¤¾ à¤«à¥‹à¤Ÿà¥‹ à¤¸à¤¾à¤à¤¾ à¤•à¤° à¤¸à¤•à¤¤à¥‡ à¤¹à¥ˆà¤‚?',
'templates.provider.information_requests.item2': 'à¤µà¤¿à¤œà¤¿à¤Ÿ à¤•à¥‡ à¤²à¤¿à¤ à¤†à¤ªà¤•à¤¾ à¤ªà¤¸à¤‚à¤¦à¥€à¤¦à¤¾ à¤¸à¤®à¤¯ à¤•à¥à¤¯à¤¾ à¤¹à¥ˆ?',
'templates.provider.information_requests.item3': 'à¤•à¥à¤¯à¤¾ à¤•à¥‹à¤ˆ à¤µà¤¿à¤¶à¥‡à¤· à¤†à¤µà¤¶à¥à¤¯à¤•à¤¤à¤¾à¤à¤‚ à¤¹à¥ˆà¤‚ à¤œà¤¿à¤¨à¤•à¥‡ à¤¬à¤¾à¤°à¥‡ à¤®à¥‡à¤‚ à¤®à¥à¤à¥‡ à¤ªà¤¤à¤¾ à¤¹à¥‹à¤¨à¤¾ à¤šà¤¾à¤¹à¤¿à¤?',

'templates.provider.contact_finalization.title': 'ðŸ¤ à¤¸à¤‚à¤ªà¤°à¥à¤• à¤”à¤° à¤…à¤‚à¤¤à¤¿à¤® à¤°à¥‚à¤ª',
'templates.provider.contact_finalization.item1': 'à¤®à¥ˆà¤‚ à¤¶à¥à¤°à¥‚ à¤•à¤°à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤¤à¥ˆà¤¯à¤¾à¤° à¤¹à¥‚à¤‚à¥¤ à¤•à¥à¤¯à¤¾ à¤¹à¤® à¤¸à¤‚à¤ªà¤°à¥à¤• à¤µà¤¿à¤µà¤°à¤£ à¤¸à¤¾à¤à¤¾ à¤•à¤° à¤¸à¤•à¤¤à¥‡ à¤¹à¥ˆà¤‚?',
'templates.provider.contact_finalization.item2': 'à¤•à¥ƒà¤ªà¤¯à¤¾ à¤…à¤ªà¤¨à¤¾ à¤ªà¤¤à¤¾ à¤¸à¤¾à¤à¤¾ à¤•à¤°à¥‡à¤‚ à¤¤à¤¾à¤•à¤¿ à¤®à¥ˆà¤‚ à¤µà¤¿à¤œà¤¿à¤Ÿ à¤•à¤° à¤¸à¤•à¥‚à¤‚à¥¤',
'templates.provider.contact_finalization.item3': 'à¤šà¤²à¤¿à¤ à¤¶à¥‡à¤¡à¥à¤¯à¥‚à¤² à¤«à¤¾à¤‡à¤¨à¤² à¤•à¤°à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤ à¤¯à¤¹ à¤°à¤¹à¤¾ à¤®à¥‡à¤°à¤¾ à¤¸à¤‚à¤ªà¤°à¥à¤• à¤¨à¤‚à¤¬à¤°à¥¤',

'templates.provider.service_completion.title': 'âœ… à¤¸à¥‡à¤µà¤¾ à¤ªà¥‚à¤°à¥à¤£à¤¤à¤¾',
'templates.provider.service_completion.item1': 'à¤•à¤¾à¤® à¤¸à¤«à¤²à¤¤à¤¾à¤ªà¥‚à¤°à¥à¤µà¤• à¤ªà¥‚à¤°à¤¾ à¤¹à¥‹ à¤—à¤¯à¤¾à¥¤ à¤•à¥ƒà¤ªà¤¯à¤¾ à¤œà¤¾à¤‚à¤šà¥‡à¤‚ à¤”à¤° à¤ªà¥à¤·à¥à¤Ÿà¤¿ à¤•à¤°à¥‡à¤‚à¥¤',
'templates.provider.service_completion.item2': 'à¤¸à¤¬ à¤•à¥à¤› à¤¹à¥‹ à¤—à¤¯à¤¾à¥¤ à¤…à¤—à¤° à¤•à¥‹à¤ˆ à¤¬à¤¦à¤²à¤¾à¤µ à¤šà¤¾à¤¹à¤¿à¤ à¤¤à¥‹ à¤¬à¤¤à¤¾à¤à¤‚à¥¤',
'templates.provider.service_completion.item3': 'à¤¸à¥‡à¤µà¤¾ à¤ªà¥‚à¤°à¥à¤£ à¤¹à¥‹ à¤—à¤ˆ à¤¹à¥ˆà¥¤ à¤µà¤¾à¤°à¤‚à¤Ÿà¥€ à¤…à¤µà¤§à¤¿ à¤•à¥‡ à¤¦à¥Œà¤°à¤¾à¤¨ à¤®à¥à¤à¤¸à¥‡ à¤¸à¤‚à¤ªà¤°à¥à¤• à¤•à¤°à¥‡à¤‚à¥¤',

'sys_selected': 'ðŸŽ‰ à¤¬à¤§à¤¾à¤ˆ à¤¹à¥‹! à¤†à¤ªà¤•à¥‹ à¤‡à¤¸ à¤¸à¥‡à¤µà¤¾ à¤…à¤¨à¥à¤°à¥‹à¤§ à¤•à¥‡ à¤²à¤¿à¤ à¤šà¥à¤¨à¤¾ à¤—à¤¯à¤¾ à¤¹à¥ˆ',
'sys_selected_description': 'à¤—à¥à¤°à¤¾à¤¹à¤• à¤¨à¥‡ à¤†à¤ªà¤•à¥‹ à¤¯à¤¹ à¤•à¤¾à¤® à¤ªà¥‚à¤°à¤¾ à¤•à¤°à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤šà¥à¤¨à¤¾ à¤¹à¥ˆà¥¤ à¤•à¥ƒà¤ªà¤¯à¤¾ à¤¸à¥‡à¤µà¤¾ à¤•à¥‡ à¤¸à¤¾à¤¥ à¤†à¤—à¥‡ à¤¬à¤¢à¤¼à¥‡à¤‚ à¤”à¤° à¤—à¥à¤°à¤¾à¤¹à¤• à¤•à¥‹ à¤…à¤ªà¤¨à¥€ à¤ªà¥à¤°à¤—à¤¤à¤¿ à¤•à¥‡ à¤¬à¤¾à¤°à¥‡ à¤®à¥‡à¤‚ à¤…à¤ªà¤¡à¥‡à¤Ÿ à¤•à¤°à¤¤à¥‡ à¤°à¤¹à¥‡à¤‚à¥¤',

// Provider Stopped Service - Read-Only Chat
read_only_provider_stopped: "à¤ªà¥à¤°à¤¦à¤¾à¤¤à¤¾ à¤¨à¥‡ à¤¯à¤¹ à¤¸à¥‡à¤µà¤¾ à¤¦à¥‡à¤¨à¤¾ à¤¬à¤‚à¤¦ à¤•à¤° à¤¦à¤¿à¤¯à¤¾ à¤¹à¥ˆà¥¤ à¤•à¥ƒà¤ªà¤¯à¤¾ à¤¦à¥‚à¤¸à¤°à¤¾ à¤ªà¥à¤°à¤¦à¤¾à¤¤à¤¾ à¤šà¥à¤¨à¥‡à¤‚à¥¤",
status_readonly_provider_stopped: "à¤ªà¥à¤°à¤¦à¤¾à¤¤à¤¾ à¤¨à¥‡ à¤¸à¥‡à¤µà¤¾ à¤¬à¤‚à¤¦ à¤•à¤° à¤¦à¥€",
service_no_longer_available: "à¤¸à¥‡à¤µà¤¾ à¤…à¤¬ à¤‰à¤ªà¤²à¤¬à¥à¤§ à¤¨à¤¹à¥€à¤‚ à¤¹à¥ˆ",

// System notification messages (for chat)
provider_stopped_notification: "{providerName} à¤¨à¥‡ {serviceName} à¤¦à¥‡à¤¨à¤¾ à¤¬à¤‚à¤¦ à¤•à¤° à¤¦à¤¿à¤¯à¤¾ à¤¹à¥ˆ à¤”à¤° à¤†à¤ªà¤•à¤¾ à¤…à¤¨à¥à¤°à¥‹à¤§ à¤ªà¥‚à¤°à¤¾ à¤¨à¤¹à¥€à¤‚ à¤•à¤° à¤¸à¤•à¤¤à¥‡à¥¤ à¤•à¥ƒà¤ªà¤¯à¤¾ à¤¦à¥‚à¤¸à¤°à¤¾ à¤ªà¥à¤°à¤¦à¤¾à¤¤à¤¾ à¤šà¥à¤¨à¥‡à¤‚à¥¤",

  }
};

// ==================== END TRANSLATIONS ====================


// Language state
let currentLanguage = localStorage.getItem('language') || 'en';

// Translation helper function
function t(key) {
  return translations[currentLanguage]?.[key] || key;
}

// Language toggle function
function changeLanguage(lang) {
  currentLanguage = lang;
  localStorage.setItem('language', lang);
  location.reload(); // âœ… Reload page to apply language changes
}

function toggleLanguage() {
  const newLang = currentLanguage === 'en' ? 'hi' : 'en';
  changeLanguage(newLang);
}

// Initialize language toggle buttons on page load
function initLanguageToggles() {
    const isHindi = currentLanguage === 'hi';
    
    // Update login page toggle
    const loginToggle = document.getElementById('loginLangToggle');
    const loginLabel = document.getElementById('loginLangLabel');
    const loginThumb = document.getElementById('loginLangThumb');
    const loginAlt = document.getElementById('loginLangAlt');
    
    if (loginToggle) {
        if (isHindi) loginToggle.classList.add('hindi');
        else loginToggle.classList.remove('hindi');
    }
    if (loginLabel) loginLabel.textContent = isHindi ? 'à¤¹à¤¿' : 'EN';
    if (loginThumb) loginThumb.textContent = isHindi ? 'à¤¹à¤¿' : 'EN';
    if (loginAlt) loginAlt.textContent = isHindi ? 'English' : 'à¤¹à¤¿à¤‚à¤¦à¥€';
    
    // Update signup page toggle
    const signupToggle = document.getElementById('signupLangToggle');
    const signupLabel = document.getElementById('signupLangLabel');
    const signupThumb = document.getElementById('signupLangThumb');
    const signupAlt = document.getElementById('signupLangAlt');
    
    if (signupToggle) {
        if (isHindi) signupToggle.classList.add('hindi');
        else signupToggle.classList.remove('hindi');
    }
    if (signupLabel) signupLabel.textContent = isHindi ? 'à¤¹à¤¿' : 'EN';
    if (signupThumb) signupThumb.textContent = isHindi ? 'à¤¹à¤¿' : 'EN';
    if (signupAlt) signupAlt.textContent = isHindi ? 'English' : 'à¤¹à¤¿à¤‚à¤¦à¥€';
    
    // Update dropdown menu toggle (dashboard)
    const dropdownToggle = document.querySelector('.dropdown-item.language-toggle');
    const dropdownThumb = document.getElementById('dropdownLangThumb');
    
    if (dropdownToggle) {
        if (isHindi) dropdownToggle.classList.add('hindi');
        else dropdownToggle.classList.remove('hindi');
    }
    if (dropdownThumb) dropdownThumb.textContent = isHindi ? 'à¤¹à¤¿' : 'EN';
}

// Call init on DOMContentLoaded
document.addEventListener('DOMContentLoaded', initLanguageToggles);


// ==================== UPDATE UI LANGUAGE ====================
function updateLanguageUI() {
    // Update all elements with data-i18n attribute
    document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (translations[currentLanguage] && translations[currentLanguage][key]) {
            element.textContent = translations[currentLanguage][key];
        }
    });
    
    // Update placeholders
    document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
        const key = element.getAttribute('data-i18n-placeholder');
        if (translations[currentLanguage] && translations[currentLanguage][key]) {
            element.placeholder = translations[currentLanguage][key];
        }
    });
}

// Call on page load
document.addEventListener('DOMContentLoaded', updateLanguageUI);


// ==================== END TRANSLATION SYSTEM ====================
        const SUPABASE_URL = 'https://nzhivzzzcanniejzqvsc.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im56aGl2enp6Y2FubmllanpxdnNjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk2NTcxMDEsImV4cCI6MjA3NTIzMzEwMX0.ex0z4DZF38IKc57l6V3X-DofTi6ZZUfPVFrajo1cBRY';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        // ==================== FIREBASE INITIALIZATION ====================
    let messaging = null;
    let fcmToken = null;

    try {
        // Initialize Firebase
        firebase.initializeApp({
            apiKey: "AIzaSyA84umO1nKUfa-NmR40ifMlTP0ccx7SSp8",
            authDomain: "helpbuddy-app.firebaseapp.com",
            projectId: "helpbuddy-app",
            storageBucket: "helpbuddy-app.firebasestorage.app",
            messagingSenderId: "207546481980",
            appId: "1:207546481980:web:9cfa7d2cade0b263b93239"
        });

        // Initialize Firebase Messaging
        messaging = firebase.messaging();
        
        // ðŸ†• Initialize Firebase Auth (required for FCM)
        const auth = firebase.auth();
        
        console.log('âœ… Firebase Messaging and Auth initialized');
    } catch (error) {
        console.error('âŒ Firebase initialization error:', error);
    }

if ('serviceWorker' in navigator) {
    // Register main service worker for PWA
    navigator.serviceWorker.register('/service-worker.js')
        .then((registration) => {
            console.log('âœ… PWA Service Worker registered:', registration);
        })
        .catch((error) => {
            console.error('âŒ PWA Service Worker registration failed:', error);
        });
    
    // Register Firebase messaging service worker for push notifications
    navigator.serviceWorker.register('/firebase-messaging-sw.js')
        .then((registration) => {
            console.log('âœ… Firebase Service Worker registered:', registration);
        })
        .catch((error) => {
            console.error('âŒ Firebase Service Worker registration failed:', error);
        });
}

// ==================== REQUEST NOTIFICATION PERMISSION & GET FCM TOKEN ====================
async function requestNotificationPermission() {
    try {
        console.log('ðŸ”µ Requesting notification permission...');
        
        const permission = await Notification.requestPermission();
        
        if (permission === 'granted') {
            console.log('âœ… Notification permission granted');
            
            // ðŸ†• STEP 1: Sign in anonymously to Firebase (required for FCM)
            console.log('ðŸ”µ Authenticating with Firebase anonymously...');
            try {
                await firebase.auth().signInAnonymously();
                console.log('âœ… Firebase anonymous auth successful');
            } catch (authError) {
                console.error('âŒ Firebase auth failed:', authError);
                alert('Failed to authenticate for notifications. Please try again.');
                return;
            }
            
            // STEP 2: Wait for service worker to be ready
            console.log('ðŸ”µ Waiting for service worker to be ready...');
            const registration = await navigator.serviceWorker.ready;
            console.log('âœ… Service worker is ready:', registration.active?.scriptURL);
            
            // STEP 3: Get FCM token
            console.log('ðŸ”µ Getting FCM token...');
            const token = await messaging.getToken({
                vapidKey: 'BDwqy2g6dWGjmAg9wcnRClLhDhWXGBokX6R3Tn9lcxxllSeljQXVhuF26malwuaUsgItQUqWDjBtxmITG2LHgz0',
                serviceWorkerRegistration: registration
            });
            
            if (token) {
                console.log('âœ… FCM Token obtained:', token);
                fcmToken = token;
                await storeFCMToken(token);
            } else {
                console.error('âŒ No FCM token received');
            }
        } else if (permission === 'denied') {
            console.warn('âš ï¸ Notification permission denied by user');
            alert('âš ï¸ Notifications are blocked. Please enable them in your browser settings.');
        } else {
            console.warn('âš ï¸ Notification permission dismissed');
        }
    } catch (error) {
        console.error('âŒ Error requesting notification permission:', error);
    }
}

// ==================== STORE FCM TOKEN IN SUPABASE ====================
async function storeFCMToken(token) {
    try {
        if (!currentUser || !currentUser.id) {
            console.log('âš ï¸ No user logged in, skipping token storage');
            return;
        }
        
        console.log('ðŸ’¾ Storing FCM token in Supabase...');
        
        // Check if token already exists for this user
        const { data: existingTokens, error: checkError } = await supabase
            .from('fcm_tokens')
            .select('id')
            .eq('user_id', currentUser.id)
            .eq('fcm_token', token);
        
        if (checkError) {
            console.error('âŒ Error checking existing tokens:', checkError);
            return;
        }
        
        if (existingTokens && existingTokens.length > 0) {
            console.log('â„¹ï¸ FCM token already exists for this user');
            return;
        }
        
        // Insert new token
        const { error: insertError } = await supabase
            .from('fcm_tokens')
            .insert([{
                user_id: currentUser.id,
                fcm_token: token,
                created_at: new Date().toISOString(),
                updated_at: new Date().toISOString()
            }]);
        
        if (insertError) {
            console.error('âŒ Error storing FCM token:', insertError);
        } else {
            console.log('âœ… FCM token stored successfully');
        }
    } catch (error) {
        console.error('âŒ Error in storeFCMToken:', error);
    }
}

// ==================== HANDLE FOREGROUND MESSAGES ====================
if (messaging) {
    messaging.onMessage((payload) => {
        console.log('ðŸ”” Foreground message received:', payload);
        
        const notificationTitle = payload.notification?.title || 'HelpBuddy';
        const notificationOptions = {
    body: payload.notification?.body || 'You have a new update',
    icon: '/android-icon-192x192.png',     // âœ… FIXED
    badge: '/android-icon-144x144.png',    // âœ… FIXED
    tag: 'helpbuddy-notification',         // âœ… KEPT
    requireInteraction: true,              // âœ… KEPT
};
        
        // Show notification
        if (Notification.permission === 'granted') {
            new Notification(notificationTitle, notificationOptions);
        }
        
        // Play notification sound
        playNotificationSound('newRequestSound');
        
        // Refresh dashboard data
        if (currentDashboardMode === 'provider' && currentProfile && currentProfile.is_provider) {
            console.log('ðŸ”„ Refreshing dashboard data...');
            loadNearbyRequests();
            loadProviderResponses();
        }
    });
}
// Track services to be removed (deleted on Save Changes)
let servicesToRemove = [];
let currentUser = null;
let currentProfile = null;
let currentDashboardMode = null;
let previousMessages = []; // âœ… NEW: Track previous messages to detect new ones
	console.log('Step 1: JavaScript loaded');
        console.log('Step 2: Supabase client created');
        let selectedResponseRequest = null;
        let currentChatData = null;
        let chatRefreshInterval = null;
	let currentResponseFilter = 'active';
	window.currentWorkFilter = 'available'; // For Work Opportunities filtering
	let chatOpenedFrom = null; // Track where chat was opened from

	// ========== REALTIME SUBSCRIPTIONS ==========
let realtimeSubscriptions = {
    requests: null,
    responses: null,
    chats: null,
    profiles: null
};

        const SERVICE_ICONS = {
    // Electrician subcategories
    electrician_installation: 'ðŸ”Œ',
    electrician_repair: 'ðŸ”Œ',
    electrician_wiring: 'ðŸ”Œ',
    
    // Plumber subcategories
    plumber_installation: 'ðŸš°',
    plumber_repair: 'ðŸš°',
    plumber_new_work: 'ðŸš°',
    
    // AC subcategories
    ac_installation: 'â„ï¸',
    ac_repair_service: 'â„ï¸',
    ac_gas_filling: 'â„ï¸',
    
    // Carpenter subcategories
    carpenter_repair: 'ðŸ”¨',
    carpenter_custom: 'ðŸ”¨',
    carpenter_door_window: 'ðŸ”¨',
    
    // Painter subcategories
    painter_house: 'ðŸŽ¨',
    painter_furniture: 'ðŸŽ¨',
    painter_texture: 'ðŸŽ¨',
    
    // Cleaner subcategories
    cleaner_house: 'ðŸ§¹',
    cleaner_upholstery: 'ðŸ§¹',
    cleaner_vehicle: 'ðŸ§¹',
    
    // Appliance subcategories
    appliance_washing: 'ðŸ”§',
    appliance_refrigerator: 'ðŸ”§',
    appliance_tv: 'ðŸ”§',
    appliance_geyser: 'ðŸ”§',
    appliance_ro: 'ðŸ”§',
    appliance_microwave: 'ðŸ”§',
    appliance_other: 'ðŸ”§'
};

// Add this NEW function to handle subcategory icons
function getServiceIcon(serviceId) {
    // Try exact match first
    if (SERVICE_ICONS[serviceId]) {
        return SERVICE_ICONS[serviceId];
    }
    
    // Try parent category match (e.g., electrician_installation -> electrician)
    const parentCategory = serviceId.split('_')[0];
    if (SERVICE_ICONS[parentCategory]) {
        return SERVICE_ICONS[parentCategory];
    }
    
    // Default fallback
    return 'ðŸ”§';
}

        window.addEventListener('DOMContentLoaded', async () => {
    console.log('Step 3: DOMContentLoaded fired');
    
    // â­ STEP 1: Check URL parameters FIRST (highest priority)
    const params = new URLSearchParams(window.location.search);
    const view = params.get("mode");
    
    console.log("ðŸ” ROUTER CHECK:");
    console.log("Mode param:", view);
    
    // Setup form helpers (needed for signup/login)
    setupCharCounters();
    setupCityAutocomplete();
    
    // Handle explicit mode requests
    if (view === "signup") {
        console.log("â†’ SIGNUP requested");
        
        // Check if already logged in
        const { data: { user } } = await supabase.auth.getUser();
        if (user) {
            console.log("â†’ User already logged in, redirecting to dashboard");
            currentUser = user;
            await loadProfile();
        } else {
            console.log("â†’ Showing signup page");
            showSignup();
        }
        return; // â† Stop here
    }
    
    if (view === "login") {
        console.log("â†’ LOGIN requested");
        
        // Check if already logged in
        const { data: { user } } = await supabase.auth.getUser();
        if (user) {
            console.log("â†’ User already logged in, redirecting to dashboard");
            currentUser = user;
            await loadProfile();
        } else {
            console.log("â†’ Showing login page");
            showLogin();
        }
        return; // â† Stop here
    }
    
    if (view === "terms") {
        showTerms();
        return;
    }
    
    if (view === "privacy") {
        showPrivacy();
        return;
    }
    
    if (view === "help") {
        openGetHelpModal();
        return;
    }
    
    // â­ STEP 2: No explicit mode - continue with normal flow
    console.log("â†’ No mode parameter, continuing normal flow");
    
    // Check email verification
    const isVerifying = await handleEmailVerification();
    if (isVerifying) {
        console.log('âœ… Email verification handled');
        return;
    }
    
    // Check password reset
    const isResettingPassword = await handlePasswordReset();
    if (isResettingPassword) {
        console.log('âœ… Password reset handled');
        return;
    }
    
    // Check if user is already logged in
    const { data: { user } } = await supabase.auth.getUser();
    console.log('Step 4: Checked user:', user);
    
    if (user) { 
        currentUser = user; 
        await loadProfile(); 
    } else { 
        showLogin(); 
    }
});

        function hideAllViews() {
    const viewIds = [
        'loginView',
        'signupView', 
        'dashboardView',
        'editProfileView',
        'editRequestView',
        'chatView'
    ];
    
    viewIds.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
            element.classList.add('hidden');
            // âœ… DON'T set inline display:none - let CSS handle it
        }
    });
}

        function showLogin() { 
    console.log('ðŸ”µ Showing login page...');
    
    hideAllViews(); 
    
    // âœ… CRITICAL FIX: Explicitly hide signup view
    const signupView = document.getElementById('signupView');
    if (signupView) {
        signupView.classList.add('hidden');
        signupView.style.display = 'none';
    }
    
    // âœ… Hide loading view
    const loadingView = document.getElementById('loadingView');
    if (loadingView) {
        loadingView.classList.add('hidden');
        loadingView.style.display = 'none';
    }
    
    // âœ… Show login view
    const loginView = document.getElementById('loginView');
    if (loginView) {
        loginView.classList.remove('hidden');
        loginView.style.display = 'block';
        loginView.style.visibility = 'visible';
    }
    
    console.log('âœ… Login view now visible');
}
        function showSignup() {
    hideAllViews(); 
    
    // Explicitly hide login view
    const loginView = document.getElementById('loginView');
    if (loginView) {
        loginView.classList.add('hidden');
        loginView.style.display = 'none';
    }
    
    const signupView = document.getElementById('signupView');
    if (signupView) {
        signupView.classList.remove('hidden');
        signupView.style.display = 'block';
        signupView.style.visibility = 'visible';
        console.log('âœ… Signup view now visible');
    }
    
    // â­ NEW: Auto-fill referral code if present in URL
    autoFillReferralCode();
}

// â­ NEW: Auto-fill referral code from URL
function autoFillReferralCode() {
    // Check URL for referral parameter
    const params = new URLSearchParams(window.location.search);
    const referralCode = params.get('referral');
    
    if (referralCode) {
        console.log('ðŸŽ Referral code detected:', referralCode);
        
        // Find the referral code input field
        const referralInput = document.getElementById('signupReferralCode');
        
        if (referralInput) {
            // Auto-fill the code
            referralInput.value = referralCode.toUpperCase();
            
            // Make it look special (highlighted)
            referralInput.style.background = 'linear-gradient(135deg, #e8f5e9, #c8e6c9)';
            referralInput.style.border = '2px solid #4caf50';
            referralInput.style.fontWeight = '700';
            
            // Store in localStorage (so it persists if user refreshes)
            localStorage.setItem('pendingReferralCode', referralCode);
            
            // Show success message
            showReferralBanner(referralCode);
            
            console.log('âœ… Referral code auto-filled:', referralCode);
        }
    } else {
        // Check if we have a stored referral code
        const storedCode = localStorage.getItem('pendingReferralCode');
        if (storedCode) {
            const referralInput = document.getElementById('signupReferralCode');
            if (referralInput && !referralInput.value) {
                referralInput.value = storedCode.toUpperCase();
                referralInput.style.background = 'linear-gradient(135deg, #e8f5e9, #c8e6c9)';
                referralInput.style.border = '2px solid #4caf50';
                referralInput.style.fontWeight = '700';
                showReferralBanner(storedCode);
            }
        }
    }
}

// â­ NEW: Show "Referred by friend" banner
function showReferralBanner(code) {
    // Check if banner already exists
    if (document.getElementById('referralBanner')) return;
    
    // Create banner
    const banner = document.createElement('div');
    banner.id = 'referralBanner';
    banner.style.cssText = `
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: linear-gradient(135deg, #4caf50, #45a049);
        color: white;
        padding: 15px 30px;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(76, 175, 80, 0.4);
        z-index: 9999;
        font-weight: 600;
        text-align: center;
        animation: slideDown 0.5s ease;
    `;
    
    banner.innerHTML = `
        ðŸŽ You were referred by a friend!<br>
        <span style="font-size: 0.9em; opacity: 0.9;">Bonus credits will be applied after signup</span>
    `;
    
    document.body.appendChild(banner);
    
    // Add animation
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideDown {
            from { top: -100px; opacity: 0; }
            to { top: 20px; opacity: 1; }
        }
    `;
    document.head.appendChild(style);
    
    // Auto-remove after 5 seconds
    setTimeout(() => {
        banner.style.animation = 'slideDown 0.5s ease reverse';
        setTimeout(() => banner.remove(), 500);
    }, 5000);
}

// âœ… Function to resend verification email
async function resendVerificationEmail() {
    try {
        console.log('ðŸ“§ Resending verification email...');
        
        // Show loading state
        const resendBtn = event.target;
        const originalText = resendBtn.textContent;
        resendBtn.disabled = true;
        resendBtn.textContent = 'â³ Sending...';
        
        // Get current session
        const { data: { session } } = await supabase.auth.getSession();
        
        if (!session) {
            alert('âŒ Please login first');
            return;
        }
        
        // Use Supabase's built-in resend function
        const { error } = await supabase.auth.resend({
            type: 'signup',
            email: session.user.email,
            options: {
                emailRedirectTo: `${window.location.origin}/`
            }
        });
        
        if (error) {
            console.error('âŒ Error sending verification email:', error);
            alert('âŒ Failed to send verification email: ' + error.message);
            resendBtn.disabled = false;
            resendBtn.textContent = originalText;
            return;
        }
        
        console.log('âœ… Verification email sent successfully');
        alert('âœ… Verification email sent!\n\nPlease check your inbox and spam folder.');
        
        // Reset button
        resendBtn.disabled = false;
        resendBtn.textContent = originalText;
        
    } catch (error) {
        console.error('âŒ Error in resendVerificationEmail:', error);
        alert('âŒ Failed to send email: ' + error.message);
    }
}


        function showDashboard() { 
    console.log('Step 8: Calling showDashboard');
    
    hideAllViews(); 

// Initialize dashboard mode
    if (!currentDashboardMode) {
        currentDashboardMode = sessionStorage.getItem('dashboardMode');
        if (!currentDashboardMode) {
            currentDashboardMode = currentProfile.is_provider ? 'provider' : 'seeker';
            sessionStorage.setItem('dashboardMode', currentDashboardMode);
        }
    }
    
    // âœ… EXPLICITLY hide create request view
    const createRequestView = document.getElementById('createRequestView');
    if (createRequestView) {
        createRequestView.classList.add('hidden');
        createRequestView.style.display = 'none';
    }
    
    const dashboardView = document.getElementById('dashboardView');
    if (dashboardView) {
        dashboardView.classList.remove('hidden');
        dashboardView.style.display = 'block';
        dashboardView.style.visibility = 'visible';
    }
    
    // âœ… Hide loading view
    const loadingView = document.getElementById('loadingView');
    if (loadingView) {
        loadingView.classList.add('hidden');
        loadingView.style.display = 'none';
    }

// âœ… NEW: Check email verification status and show banner if needed
if (currentProfile && !currentProfile.email_verified) {
    // Create verification banner if it doesn't exist
    let verificationBanner = document.getElementById('verificationBanner');
    if (!verificationBanner) {
        verificationBanner = document.createElement('div');
        verificationBanner.id = 'verificationBanner';
        verificationBanner.style.cssText = 'background: #fff3cd; border: 2px solid #ffc107; border-radius: 10px; padding: 15px 20px; margin: 0 20px 20px 20px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;';
        verificationBanner.innerHTML = `
            <div style="display: flex; align-items: center; gap: 10px; flex: 1;">
                <span style="font-size: 24px;">âš ï¸</span>
                <div>
                    <div style="font-weight: 600; color: #856404; margin-bottom: 4px;">${t('email_verification_required')}</div>
                    <div style="font-size: 14px; color: #856404;">${t('verify_email_message')}</div>
                </div>
            </div>
            <button onclick="resendVerificationEmail()" style="background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-weight: 600; cursor: pointer; white-space: nowrap;">ðŸ“§ Resend Email</button>
        `;
        
        // Insert banner at the top of dashboard
        const dashboardView = document.getElementById('dashboardView');
        const dashboardHeader = document.getElementById('dashboardHeader');
        if (dashboardView && dashboardHeader) {
            dashboardView.insertBefore(verificationBanner, dashboardHeader);
        }
    } else {
        // Banner exists, make sure it's visible
        verificationBanner.style.display = 'flex';
    }
} else if (currentProfile && currentProfile.email_verified) {
    // User is verified - remove banner if it exists
    const verificationBanner = document.getElementById('verificationBanner');
    if (verificationBanner) {
        verificationBanner.style.display = 'none';
    }
}

    // âœ… Show dashboard elements
    const appLogo = document.getElementById('appLogo');
    const createRequestBtn = document.getElementById('createRequestBtn');
    const userMenu = document.querySelector('.user-menu');
    const dashboardHeader = document.getElementById('dashboardHeader');
    if (appLogo) appLogo.style.display = 'none';
    if (createRequestBtn) createRequestBtn.style.display = 'block';
    if (userMenu) userMenu.style.display = 'flex';
    if (dashboardHeader) dashboardHeader.style.display = 'block';
    // âœ… Step 3: Disable Create Request button if email not verified
    if (createRequestBtn && currentProfile && !currentProfile.email_verified) {
        // Disable button visually
        createRequestBtn.style.opacity = '0.5';
        createRequestBtn.style.cursor = 'not-allowed';
        createRequestBtn.style.pointerEvents = 'none';
        
        // Wrap in a container that will catch clicks
        const btnWrapper = document.createElement('div');
        btnWrapper.style.position = 'relative';
        btnWrapper.style.display = 'inline-block';
        
        createRequestBtn.parentNode.insertBefore(btnWrapper, createRequestBtn);
        btnWrapper.appendChild(createRequestBtn);
        
        // Add click interceptor on wrapper
        btnWrapper.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            alert('âš ï¸ Please verify your email address before creating service requests.\n\nCheck your inbox for the verification email.');
        });
    }
    
    // âœ… Show user profile photo and username
    const headerUserPhoto = document.getElementById('headerUserPhoto');
    const headerUserPhotoPlaceholder = document.getElementById('headerUserPhotoPlaceholder');
    const userButton = document.querySelector('.user-button');
    
    if (currentProfile?.profile_photo) {
        if (headerUserPhoto) {
            headerUserPhoto.src = currentProfile.profile_photo;
            headerUserPhoto.style.display = 'block';
        }
        if (headerUserPhotoPlaceholder) headerUserPhotoPlaceholder.style.display = 'none';
    } else {
        if (headerUserPhoto) headerUserPhoto.style.display = 'none';
        if (headerUserPhotoPlaceholder) headerUserPhotoPlaceholder.style.display = 'flex';
    }
    
    if (userButton) userButton.style.display = 'flex';
    
    // Show/hide sections based on mode
    const seekerSection = document.getElementById('seekerSection');
    const providerSection = document.getElementById('providerSection');
    const modeToggleBtn = document.getElementById('modeToggleBtn');
    
    if (currentDashboardMode === 'provider') {
        if (providerSection) providerSection.style.display = 'block';
        if (seekerSection) seekerSection.style.display = 'none';
        if (createRequestBtn) createRequestBtn.style.display = 'none';
 document.getElementById('modeToggleIcon').textContent = 'ðŸ”§';
        document.getElementById('modeToggleText').textContent = t('provider_mode');	
	modeToggleBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
	const userButton = document.querySelector('.user-button');
if (userButton) {
    userButton.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
}

document.querySelectorAll('button[onclick*="toggleSection(\'providerOpenRequests\')"]').forEach(btn => btn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)');
document.querySelectorAll('button[onclick*="toggleSection(\'myResponses\')"]').forEach(btn => btn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)');
document.querySelectorAll('button[onclick*="toggleSection(\'availableWork\')"]').forEach(btn => btn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)');

    } else {
        if (seekerSection) seekerSection.style.display = 'block';
        if (providerSection) providerSection.style.display = 'none';
        if (createRequestBtn) createRequestBtn.style.display = 'block';
        if (modeToggleBtn && currentProfile.is_provider) {
document.getElementById('modeToggleIcon').textContent = 'ðŸ™‹';
            document.getElementById('modeToggleText').textContent = t('seeker_mode');
	    modeToggleBtn.style.background = 'linear-gradient(135deg, #4285F4 0%, #34A853 100%)';
	    const userButton = document.querySelector('.user-button');
if (userButton) {
    userButton.style.background = 'linear-gradient(135deg, #4285F4 0%, #34A853 100%)';
}


        }
    }
    
    // Show/hide toggle button based on provider status
    if (modeToggleBtn) {
        modeToggleBtn.style.display = currentProfile.is_provider ? 'flex' : 'none';
    }
    
    // Clear chat refresh interval
    if (chatRefreshInterval) {
        clearInterval(chatRefreshInterval);
        chatRefreshInterval = null;
    }
    
    loadDashboardData(); 
    
    // âœ… NEW: Display credit balance in header
    displayCreditBalance();
    // âœ… NEW: Load referral data
    loadReferralData();
    console.log('âœ… Dashboard should now be visible');
}

function toggleDashboardMode() {
    currentDashboardMode = currentDashboardMode === 'provider' ? 'seeker' : 'provider';
    sessionStorage.setItem('dashboardMode', currentDashboardMode);
    showDashboard();
}
        function showLoading() { hideAllViews(); document.getElementById('loadingView').classList.remove('hidden'); }

async function showCreateRequestForm() { 
    hideAllViews(); 
    
    // Hide dashboard sections
    const seekerSection = document.getElementById('seekerSection');
    const providerSection = document.getElementById('providerSection');
    const createRequestBtn = document.getElementById('createRequestBtn');
    const userMenu = document.querySelector('.user-menu');
    
    if (seekerSection) seekerSection.style.display = 'none';
    if (providerSection) providerSection.style.display = 'none';
    if (createRequestBtn) createRequestBtn.style.display = 'none';
    if (userMenu) userMenu.style.display = 'none';

// Hide dashboard logo when Create Request form opens
const dashboardHeader = document.getElementById('dashboardHeader');
if (dashboardHeader) dashboardHeader.style.display = 'none';
    
    // Show create request form
    document.getElementById('createRequestView').classList.remove('hidden'); 
    document.getElementById('createRequestView').style.display = 'block';
    
    // âœ… Reset the form
    document.getElementById('createRequestForm').reset(); 
    document.getElementById('titleCounter').textContent = '0';
    document.getElementById('descCounter').textContent = '0';
    
    // âœ… CRITICAL FIX: Reset "Use different location" checkbox and hide custom fields
    const differentLocationCheckbox = document.getElementById('differentLocation');
    const customLocationFields = document.getElementById('customLocationFields');
    
    if (differentLocationCheckbox) {
        differentLocationCheckbox.checked = false; // Uncheck the checkbox
    }
    
    if (customLocationFields) {
        customLocationFields.classList.add('hidden'); // Hide the custom location fields
    }
    
    // Filter services based on provider's existing services
    await filterServiceDropdown();
}
        
        async function filterServiceDropdown() {
    // If user is not a provider, show all services
    if (!currentProfile.is_provider) {
        return;
    }
    
    try {
        // Get provider's services (subcategories they already provide)
        const { data: providerServices, error } = await supabase
            .from('provider_services')
            .select('service_id')
            .eq('provider_id', currentProfile.user_id);
        
        if (error) {
            console.error('Error fetching provider services:', error);
            return;
        }
        
        // Get list of subcategory services the provider already provides
        const providedServices = providerServices ? providerServices.map(s => s.service_id) : [];
        
        // Hide subcategory items that the provider already offers
        const accordion = document.getElementById('serviceAccordion');
        if (!accordion) return;
        
        const subcategoryItems = accordion.querySelectorAll('.subcategory-item');
        
        subcategoryItems.forEach(item => {
            const serviceValue = item.getAttribute('data-value');
            if (providedServices.includes(serviceValue)) {
                item.style.display = 'none';  // Hide this subcategory
            } else {
                item.style.display = '';  // Show this subcategory
            }
        });
        
        // Optional: Hide entire category if all its subcategories are hidden
        const categories = accordion.querySelectorAll('.service-category');
        categories.forEach(category => {
            const visibleSubcategories = category.querySelectorAll('.subcategory-item:not([style*="display: none"])');
            if (visibleSubcategories.length === 0) {
                category.style.display = 'none';  // Hide entire category
            } else {
                category.style.display = '';  // Show category
            }
        });
        
    } catch (error) {
        console.error('Error filtering services:', error);
    }
}
        function backToDashboard() { 
    // Clear chat refresh interval
    if (chatRefreshInterval) {
        clearInterval(chatRefreshInterval);
        chatRefreshInterval = null;
    }
    
    showDashboard(); 
}

// Smart back function - goes to previous page or dashboard
async function smartBack() {
    if (chatRefreshInterval) {
        clearInterval(chatRefreshInterval);
        chatRefreshInterval = null;
    }
    
    // âœ… NEW: Reload dashboard data to refresh unread counts
    console.log('ðŸ”„ Reloading dashboard data to update badges...');
    
    // âœ… Hide ALL possible views (including edit profile)
    const chatView = document.getElementById('chatView');
    const editProfileView = document.getElementById('editProfileView');
    const editRequestView = document.getElementById('editRequestView');
    const createRequestView = document.getElementById('createRequestView');
    
    if (chatView) {
        chatView.classList.add('hidden');
        chatView.style.display = 'none';
    }
    
    if (editProfileView) {
        editProfileView.classList.add('hidden');
        editProfileView.style.display = 'none';
    }
    
    if (editRequestView) {
        editRequestView.classList.add('hidden');
        editRequestView.style.display = 'none';
    }
    
    if (createRequestView) {
        createRequestView.classList.add('hidden');
        createRequestView.style.display = 'none';
    }
    
    // Restore header controls hidden by chat
    const userMenu = document.querySelector('.user-menu');
    const modeToggleBtn = document.getElementById('modeToggleBtn');
    const createRequestBtn = document.getElementById('createRequestBtn');
    if (userMenu) userMenu.style.display = 'flex';
    if (modeToggleBtn) modeToggleBtn.style.display = currentProfile.is_provider ? 'flex' : 'none';
    if (createRequestBtn && currentDashboardMode === 'seeker') createRequestBtn.style.display = 'block';
    
    // Navigate back based on origin
    console.log('ðŸ” DEBUG smartBack - chatOpenedFrom value:', chatOpenedFrom);
    console.log('ðŸ” DEBUG smartBack - checking if equals "responses-modal":', chatOpenedFrom === 'responses-modal');
    
    if (chatOpenedFrom === 'responses-modal') {
    console.log('âœ… Returning to responses modal');
    
    // Make sure dashboard is visible (modal needs it as background)
    const dashboardView = document.getElementById('dashboardView');
    if (dashboardView) {
        dashboardView.classList.remove('hidden');
        dashboardView.style.display = 'block';
    }
    
    // âœ… FIX: Reload responses to update unread counts
    if (selectedResponseRequest) {
        await viewResponses(selectedResponseRequest);
    }
    
    // Show responses modal (it's already shown by viewResponses, but ensure it's visible)
    const responsesModal = document.getElementById('responsesModal');
    if (responsesModal) {
        responsesModal.classList.add('active');
        responsesModal.style.display = 'flex';
        
        // Re-attach close button event
        setTimeout(() => {
            const closeBtn = responsesModal.querySelector('.close-btn');
            if (closeBtn) {
                closeBtn.onclick = closeResponsesModal;
                console.log('âœ… Close button event re-attached');
            }
        }, 100);
    }
    
    // Reload dashboard data in background (to refresh badges)
    loadDashboardData();
    
    chatOpenedFrom = null;
} else {
        console.log('âœ… Returning to dashboard');
        showDashboard();
        chatOpenedFrom = null;
    }
}

async function showEditProfile() {
    // Hide logo and dashboard elements when on profile page
    const appLogo = document.getElementById('appLogo');
    const dashboardLogo = document.getElementById('dashboardLogo');
    const createRequestBtn = document.getElementById('createRequestBtn');
    
    if (appLogo) appLogo.style.display = 'none';
    if (dashboardLogo) dashboardLogo.style.display = 'none';
    if (createRequestBtn) createRequestBtn.style.display = 'none';

    const modeToggleBtn = document.getElementById('modeToggleBtn');
if (modeToggleBtn) modeToggleBtn.style.display = 'none';

    
    // Hide small profile photo and username dropdown
    const headerUserPhoto = document.getElementById('headerUserPhoto');
    const headerUserPhotoPlaceholder = document.getElementById('headerUserPhotoPlaceholder');
    const userButton = document.querySelector('.user-button');
    const userMenu = document.querySelector('.user-menu');
    
if (headerUserPhoto) headerUserPhoto.style.display = 'none';
    if (headerUserPhotoPlaceholder) headerUserPhotoPlaceholder.style.display = 'none';
    if (userButton) userButton.style.display = 'none';
    if (userMenu) userMenu.style.display = 'none';
    
    // âœ… HIDE the old profile header section (we have new back button in form now)
    const profileHeaderSection = document.getElementById('profileHeaderSection');
    if (profileHeaderSection) profileHeaderSection.style.display = 'none';
    // Hide the profile photo in header (we'll keep the one in the form instead)
const headerProfilePhotoLarge = document.getElementById('headerProfilePhotoLarge');
const headerProfilePhotoLargePlaceholder = document.getElementById('headerProfilePhotoLargePlaceholder');

if (headerProfilePhotoLarge) headerProfilePhotoLarge.style.display = 'none';
if (headerProfilePhotoLargePlaceholder) headerProfilePhotoLargePlaceholder.style.display = 'none';
    
    // ... rest of your existing code continues below ...
    // DON'T hide all views - just hide the dashboard CONTENT sections
    const seekerSection = document.getElementById('seekerSection');
    const providerSection = document.getElementById('providerSection');
    if (seekerSection) seekerSection.style.display = 'none';
    if (providerSection) providerSection.style.display = 'none';
    if (createRequestBtn) createRequestBtn.style.display = 'none';
    
    // Show edit profile view
    document.getElementById('editEmail').value = currentUser.email || '';

    const editView = document.getElementById('editProfileView');
    if (editView) {
        editView.classList.remove('hidden');
        editView.style.display = 'block';
        editView.style.visibility = 'visible';
    }
    
    // Pre-fill form with current profile data
    document.getElementById('editName').value = currentProfile.name || '';
    document.getElementById('editPhone').value = currentProfile.phone || '';
    document.getElementById('editHouseNumber').value = currentProfile.house_number || '';
    document.getElementById('editAreaName').value = currentProfile.area_name || '';
    document.getElementById('editLandmark').value = currentProfile.landmark || '';
    document.getElementById('editCity').value = currentProfile.city || '';
    document.getElementById('editState').value = currentProfile.state || '';
    document.getElementById('editPinCode').value = currentProfile.pin_code || '';
    document.getElementById('editRadius').value = currentProfile.radius_km || 10;
    
    // Display current profile photo
    if (currentProfile.profile_photo) {
        document.getElementById('currentProfilePhoto').src = currentProfile.profile_photo;
        document.getElementById('currentProfilePhoto').style.display = 'block';
        document.getElementById('noProfilePhoto').style.display = 'none';
    } else {
        document.getElementById('currentProfilePhoto').style.display = 'none';
        document.getElementById('noProfilePhoto').style.display = 'flex';
    }
    // âœ… NEW: Display profile stats next to photo
await displayProfileStats();
    
    // Update provider button
    setTimeout(() => {
        updateProviderButton();
    }, 100);
    
    if (currentProfile.is_provider) {
        await loadCurrentServices();
    }
    // âœ… ADD THIS LINE
    initEditProfileServiceDropdown();
}

// Display Profile Stats (next to profile photo)
async function displayProfileStats() {
    try {
        let statsHTML = '';
    
    if (currentProfile.is_provider) {
    // ========== PROVIDER STATS ==========
    
    // 1. Average Rating
    let ratingText = t('no_ratings');
    if (currentProfile.average_rating && currentProfile.average_rating > 0 && currentProfile.total_ratings > 0) {
        const stars = 'â­'.repeat(Math.round(currentProfile.average_rating));
        const ratingWord = currentProfile.total_ratings === 1 ? t('rating') : t('ratings');
        ratingText = `${stars} ${currentProfile.average_rating}/5 (${currentProfile.total_ratings} ${ratingWord})`;
    }
    
    // 2. Active Since
    const activeSinceDate = new Date(currentProfile.created_at);
    const activeSinceText = activeSinceDate.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
    
    statsHTML = `
<div style="width: 100%; display: flex; flex-direction: column; gap: 8px;">
    <div style="background: #f0f4ff; padding: 8px 10px; border-radius: 8px; border-left: 4px solid #667eea;">
        <div style="font-size: 12px; color: #666; margin-bottom: 2px;">${t('rating')}</div>
        <div style="font-size: 14px; font-weight: 600; color: #333;">${ratingText}</div>
    </div>
    
    <div style="background: #f0f4ff; padding: 8px 10px; border-radius: 8px; border-left: 4px solid #17a2b8;">
        <div style="font-size: 12px; color: #666; margin-bottom: 2px;">${t('member_since')}</div>
        <div style="font-size: 14px; font-weight: 600; color: #333;">ðŸ“… ${activeSinceText}</div>
    </div>
</div>
`;
            
        } else {
            // ========== SEEKER STATS ==========
            
            // 1. Total Requests Created
            const { data: allRequests, error: allError } = await supabase
                .from('requests')
                .select('id')
                .eq('user_id', currentProfile.user_id);
            
            const totalRequests = allRequests ? allRequests.length : 0;
            
            // 2. Completed Services
            const { data: completedRequests, error: completedError } = await supabase
                .from('requests')
                .select('id')
                .eq('user_id', currentProfile.user_id)
                .eq('status', 'completed');
            
            const completedCount = completedRequests ? completedRequests.length : 0;
            
            const requestWord = totalRequests === 1 ? t('request') : t('requests');
            const serviceWord = completedCount === 1 ? t('service') : t('services');
            
statsHTML = `
    <div style="width: 100%; display: flex; flex-direction: column; gap: 8px;">
        <div style="background: #f0f4ff; padding: 8px 10px; border-radius: 8px; border-left: 4px solid #667eea;">
            <div style="font-size: 12px; color: #666; margin-bottom: 2px;">${t('total_requests')}</div>
            <div style="font-size: 14px; font-weight: 600; color: #333;">ðŸ“Š ${totalRequests} ${requestWord}</div>
        </div>
        
        <div style="background: #f0f4ff; padding: 10px 12px; border-radius: 8px; border-left: 4px solid #28a745;">
            <div style="font-size: 12px; color: #666; margin-bottom: 2px;">${t('completed_services')}</div>
            <div style="font-size: 14px; font-weight: 600; color: #333;">âœ… ${completedCount} ${serviceWord}</div>
        </div>
    </div>
`;
        }
        
        // Insert stats into the page
        const statsContainer = document.getElementById('profileStatsContainer');
        if (statsContainer) {
            statsContainer.innerHTML = statsHTML;
        }
        
    } catch (error) {
        console.error('Error displaying profile stats:', error);
    }
}

async function loadCurrentServices() {
    try {
        const { data: services, error } = await supabase
            .from('provider_services')
            .select('service_id, service_radius')
            .eq('provider_id', currentProfile.user_id);

        if (error) throw error;

        // Filter out services marked for removal
        let displayServices = services || [];
        if (servicesToRemove && servicesToRemove.length > 0) {
            displayServices = displayServices.filter(service => 
                !servicesToRemove.includes(service.service_id)
            );
            console.log('ðŸ” Filtered services:', displayServices.length);
        }

        const servicesList = document.getElementById('currentServicesList');
        
        if (!displayServices || displayServices.length === 0) {
            servicesList.innerHTML = '<p class="no-services-text">No services listed</p>';
            
            const toggleContainer = document.querySelector('.provider-toggle-container');
            if (toggleContainer) {
                toggleContainer.style.display = 'none';
            }
        } else {
            const toggleContainer = document.querySelector('.provider-toggle-container');
            if (toggleContainer) {
                toggleContainer.style.display = 'flex';
            }
            
            servicesList.innerHTML = displayServices.map(service => `
                <div class="service-item" style="
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 12px;
                    background: #f8f9fa;
                    border-radius: 8px;
                    margin-bottom: 10px;
                ">
                    <div class="service-info" style="flex: 1;">
    <div style="font-weight: 600; color: #fff; margin-bottom: 4px;">
        ${getServiceDisplayName(service.service_id)}
    </div>
</div>
                    <button type="button" onclick="removeService('${service.service_id}')" style="
                        background: #dc3545;
                        color: white;
                        border: none;
                        padding: 8px 16px;
                        border-radius: 6px;
                        cursor: pointer;
                        font-size: 13px;
                        font-weight: 600;
                        display: flex;
                        align-items: center;
                        gap: 6px;
                        transition: all 0.2s;
                        box-shadow: 0 2px 4px rgba(220,53,69,0.2);
                    " onmouseover="this.style.background='#c82333'; this.style.transform='scale(1.05)'" 
                       onmouseout="this.style.background='#dc3545'; this.style.transform='scale(1)'">
                        <span style="font-size: 16px; line-height: 1;">âœ–</span>
                        <span>${currentLanguage === 'hi' ? 'à¤¹à¤Ÿà¤¾à¤à¤‚' : 'Remove'}</span>
                    </button>
                </div>
            `).join('');
        }
        
    } catch (error) {
        console.error('Error loading services:', error);
    }
}

// =====================================================
// CREATE REQUEST - Service Dropdown Functionality
// =====================================================

// Initialize dropdown behavior when page loads
document.addEventListener('DOMContentLoaded', function() {
    initializeCreateRequestServiceDropdown();
});

function initializeCreateRequestServiceDropdown() {
    const trigger = document.getElementById('serviceDropdownTrigger');
    const accordion = document.getElementById('serviceAccordion');
    const serviceTypeInput = document.getElementById('serviceType');
    const serviceSubtypeInput = document.getElementById('serviceSubtype');
    
    if (!trigger || !accordion) return;
    
    // Click trigger to open/close dropdown
    trigger.addEventListener('click', function() {
        const isOpen = accordion.classList.contains('show');
        
        if (isOpen) {
            // Close dropdown
            accordion.classList.remove('show');
            trigger.classList.remove('active');
        } else {
            // Open dropdown
            accordion.classList.add('show');
            trigger.classList.add('active');
            
            // Reset all categories to show (in case some were hidden)
            document.querySelectorAll('#serviceAccordion .service-category').forEach(cat => {
                cat.classList.remove('hidden');
            });
        }
    });
    
    // Category header click - expand/collapse and hide others
    document.querySelectorAll('#serviceAccordion .service-category-header').forEach(header => {
        header.addEventListener('click', function(e) {
            e.stopPropagation();
            
            const category = this.closest('.service-category');
            const isExpanded = category.classList.contains('expanded');
            
            if (isExpanded) {
                // Collapse this category and show all categories again
                category.classList.remove('expanded');
                document.querySelectorAll('#serviceAccordion .service-category').forEach(cat => {
                    cat.classList.remove('hidden');
                });
            } else {
                // Expand this category and hide others
                document.querySelectorAll('#serviceAccordion .service-category').forEach(cat => {
                    if (cat !== category) {
                        cat.classList.add('hidden');
                        cat.classList.remove('expanded');
                    }
                });
                category.classList.add('expanded');
            }
        });
    });
    
    // Subcategory click - select service
    document.querySelectorAll('#serviceAccordion .subcategory-item').forEach(item => {
        item.addEventListener('click', function(e) {
            e.stopPropagation();
            
            const value = this.getAttribute('data-value');
            const category = this.closest('.service-category').getAttribute('data-category');
            
            // Remove previous selection
            document.querySelectorAll('#serviceAccordion .subcategory-item').forEach(i => {
                i.classList.remove('selected');
            });
            
            // Mark this as selected
            this.classList.add('selected');
            
            // Update hidden inputs
            serviceTypeInput.value = category;
            serviceSubtypeInput.value = value;
            
            // Get the service name for display
            const categoryIcon = this.closest('.service-category').querySelector('.category-icon').textContent;
            const categoryName = this.closest('.service-category').querySelector('.category-title').textContent;
            const subtypeName = this.querySelector('.subcategory-name').textContent;
            
            // Update trigger display
            trigger.innerHTML = `
                <span class="selected-service">${categoryIcon} ${categoryName} â†’ ${subtypeName}</span>
                <span class="dropdown-arrow">â–¼</span>
            `;
            
            // Close dropdown
            accordion.classList.remove('show');
            trigger.classList.remove('active');
            
            // Reset categories visibility
            document.querySelectorAll('#serviceAccordion .service-category').forEach(cat => {
                cat.classList.remove('hidden', 'expanded');
            });
        });
    });
    
    // Close dropdown when clicking outside
    document.addEventListener('click', function(e) {
        if (!trigger.contains(e.target) && !accordion.contains(e.target)) {
            accordion.classList.remove('show');
            trigger.classList.remove('active');
            
            // Reset categories visibility
            document.querySelectorAll('#serviceAccordion .service-category').forEach(cat => {
                cat.classList.remove('hidden', 'expanded');
            });
        }
    });
}

// =====================================================
// EDIT PROFILE - Provider Add Service Dropdown
// =====================================================

function initializeProviderServiceDropdown() {
    const trigger = document.getElementById('providerServiceDropdownTrigger');
    const accordion = document.getElementById('providerServiceAccordion');
    const addButton = document.getElementById('providerAddServiceBtn');
    const categoryInput = document.getElementById('newServiceSelect');
    const subtypeInput = document.getElementById('newServiceSubtype');
    
    if (!trigger || !accordion) return;
    if (addButton) addButton.disabled = true;
    // Click trigger to open/close dropdown
    trigger.addEventListener('click', function(e) {
        e.stopPropagation();
        const isOpen = accordion.classList.contains('show');
        
        if (isOpen) {
            // Close dropdown
            accordion.classList.remove('show');
            trigger.classList.remove('active');
        } else {
            // Open dropdown
            accordion.classList.add('show');
            trigger.classList.add('active');
            
            // Reset all categories to show
            document.querySelectorAll('#providerServiceAccordion .service-category').forEach(cat => {
                cat.classList.remove('hidden');
            });
        }
    });
    
    // Category header click - expand/collapse and hide others
    document.querySelectorAll('#providerServiceAccordion .service-category-header').forEach(header => {
        header.addEventListener('click', function(e) {
            e.stopPropagation();
            
            const category = this.closest('.service-category');
            const isExpanded = category.classList.contains('expanded');
            
            if (isExpanded) {
                // Collapse and show all categories
                category.classList.remove('expanded');
                document.querySelectorAll('#providerServiceAccordion .service-category').forEach(cat => {
                    cat.classList.remove('hidden');
                });
            } else {
                // Expand this and hide others
                document.querySelectorAll('#providerServiceAccordion .service-category').forEach(cat => {
                    if (cat !== category) {
                        cat.classList.add('hidden');
                        cat.classList.remove('expanded');
                    }
                });
                category.classList.add('expanded');
            }
        });
    });
    
    // Subcategory click - select service
    document.querySelectorAll('#providerServiceAccordion .subcategory-item').forEach(item => {
        item.addEventListener('click', function(e) {
            e.stopPropagation();
            
            const value = this.getAttribute('data-value');
            const category = this.closest('.service-category').getAttribute('data-category');
            
            // Remove previous selection
            document.querySelectorAll('#providerServiceAccordion .subcategory-item').forEach(i => {
                i.classList.remove('selected');
            });
            
            // Mark as selected
            this.classList.add('selected');
            
            // Update hidden inputs
            categoryInput.value = category;
            subtypeInput.value = value;
            
            // Get service name for display
            const categoryIcon = this.closest('.service-category').querySelector('.category-icon').textContent;
            const categoryName = this.closest('.service-category').querySelector('.category-title').textContent;
            const subtypeName = this.querySelector('.subcategory-name').textContent;
            
            // Update trigger display
            trigger.innerHTML = `
                <span class="selected-service">${categoryIcon} ${categoryName} â†’ ${subtypeName}</span>
                <span class="dropdown-arrow">â–¼</span>
            `;
            
            // Enable add button
            addButton.disabled = false;
            
            // Close dropdown
            accordion.classList.remove('show');
            trigger.classList.remove('active');
            
            // Reset categories
            document.querySelectorAll('#providerServiceAccordion .service-category').forEach(cat => {
                cat.classList.remove('hidden', 'expanded');
            });
        });
    });
    
    // Close dropdown when clicking outside
    document.addEventListener('click', function(e) {
        if (!trigger.contains(e.target) && !accordion.contains(e.target)) {
            accordion.classList.remove('show');
            trigger.classList.remove('active');
            
            // Reset categories
            document.querySelectorAll('#providerServiceAccordion .service-category').forEach(cat => {
                cat.classList.remove('hidden', 'expanded');
            });
        }
    });
}

// Initialize when editing profile
function initEditProfileServiceDropdown() {
    // Call this when edit profile view is shown
    setTimeout(() => {
        initializeProviderServiceDropdown();
    }, 100);
}

async function addProviderService() {
    const categoryInput = document.getElementById('newServiceSelect');
    const subtypeInput = document.getElementById('newServiceSubtype');
    const serviceId = subtypeInput.value;
    
    if (!serviceId) {
        alert('Please select a service to add');
        return;
    }
    
    try {
        const { error } = await supabase
            .from('provider_services')
            .insert([{
                provider_id: currentProfile.user_id,
                service_id: serviceId,
                service_radius: currentProfile.radius_km || 10
            }]);
        
        if (error) throw error;
        
        alert('âœ… Service added successfully!');
        
        // Clear selection
        categoryInput.value = '';
        subtypeInput.value = '';
        
        // Reset trigger display
        const trigger = document.getElementById('providerServiceDropdownTrigger');
        if (trigger) {
            trigger.innerHTML = `
                <span class="placeholder">Select Service to Add</span>
                <span class="dropdown-arrow">â–¼</span>
            `;
        }
        
        // Disable add button
        const addButton = document.getElementById('providerAddServiceBtn');
        if (addButton) addButton.disabled = true;
        
        // Reload services list
        await loadCurrentServices();
        
    } catch (error) {
        alert(`Error: ${error.message}`);
    }
}

// =====================================================
// INFO TOOLTIP POSITIONING FIX
// =====================================================

document.addEventListener('DOMContentLoaded', function() {
    const infoBubbles = document.querySelectorAll('.info-bubble');
    
    infoBubbles.forEach(bubble => {
        const tooltip = bubble.querySelector('.info-tooltip');
        if (!tooltip) return;
        
        bubble.addEventListener('mouseenter', function(e) {
            const bubbleRect = this.getBoundingClientRect();
            
            // Position tooltip to the left of the bubble
            tooltip.style.right = 'auto';
            tooltip.style.left = (bubbleRect.left - 240) + 'px';
            tooltip.style.top = (bubbleRect.top + bubbleRect.height / 2) + 'px';
            tooltip.style.transform = 'translateY(-50%)';
            
            tooltip.style.display = 'block';
        });
        
        bubble.addEventListener('mouseleave', function() {
            tooltip.style.display = 'none';
        });
    });
});

async function removeService(serviceId) {
    try {
        console.log('ðŸ—‘ï¸ Marking service for removal:', serviceId);
        
        // STEP 1: Check for existing requests FIRST
        const existingRequests = await checkExistingRequests(serviceId, currentProfile.user_id);
        
        console.log('ðŸ“Š Existing requests found:', existingRequests.length);
        
        // STEP 2A: No existing requests - Simple confirmation
        if (existingRequests.length === 0) {
            const simpleConfirm = confirm(
                currentLanguage === 'hi' 
                ? `âš ï¸ à¤‡à¤¸ à¤¸à¥‡à¤µà¤¾ à¤•à¥‹ à¤¹à¤Ÿà¤¾à¤à¤‚?\n\nà¤†à¤ª Seeker à¤®à¥‹à¤¡ à¤®à¥‡à¤‚ à¤¬à¤¦à¤² à¤œà¤¾à¤à¤‚à¤—à¥‡à¥¤\n\nà¤«à¤¿à¤° à¤¸à¥‡ à¤¸à¥‡à¤µà¤¾à¤à¤‚ à¤¦à¥‡à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤, Edit Profile à¤®à¥‡à¤‚ à¤œà¤¾à¤•à¤° à¤¸à¥‡à¤µà¤¾à¤à¤‚ à¤œà¥‹à¤¡à¤¼à¥‡à¤‚à¥¤`
                : `âš ï¸ Remove this service?\n\nYou will be converted to Seeker mode.\n\nTo provide services again, go to Edit Profile and add services.`
            );
            
            if (!simpleConfirm) {
                console.log('âŒ User cancelled removal (no existing requests)');
                return;
            }
            
            // âœ… NEW: Only mark for removal, don't delete from database yet
            if (!servicesToRemove.includes(serviceId)) {
                servicesToRemove.push(serviceId);
                console.log('âœ… Service marked for removal:', serviceId);
                console.log('ðŸ“‹ Services to remove on save:', servicesToRemove);
            }
            
            // Remove from UI list immediately
            await loadCurrentServices();
            
            return;
        }
        
        // STEP 2B: Has existing requests - Show choice dialog
        console.log('âš ï¸ Has existing requests - showing choice dialog');
        
        const providerChoice = await showProviderChoiceDialog(serviceId, existingRequests);
        
        console.log('ðŸ‘¤ Provider chose:', providerChoice);
        
        // User cancelled
        if (providerChoice === 'cancel') {
            console.log('âŒ User cancelled removal');
            return;
        }
        
        // âœ… NEW: Mark service for removal (will be deleted on Save Changes)
        if (!servicesToRemove.includes(serviceId)) {
            servicesToRemove.push(serviceId);
            console.log('âœ… Service marked for removal:', serviceId);
        }
        
        // âœ… NEW: Track the provider's choice for this service
        if (!window.serviceRemovalChoices) {
            window.serviceRemovalChoices = {};
        }
        window.serviceRemovalChoices[serviceId] = {
            choice: providerChoice,
            existingRequests: existingRequests
        };
        
        console.log('ðŸ“‹ Stored choice for service:', serviceId, 'â†’', providerChoice);
        
        // Remove from UI list immediately
        await loadCurrentServices();
        
        console.log('âœ… Service removal marked (will be saved on Save Changes)');
        
    } catch (error) {
        console.error('âŒ Error marking service for removal:', error);
        alert(
            currentLanguage === 'hi'
            ? `âŒ à¤¤à¥à¤°à¥à¤Ÿà¤¿: ${error.message}`
            : `âŒ Error: ${error.message}`
        );
    }
}

// âœ… NEW FUNCTION: Check if provider has existing requests for a service
async function checkExistingRequests(serviceId, providerId) {
    try {
        console.log('ðŸ” Checking existing requests for service:', serviceId);
        
        // Step 1: Get all requests where provider has responded
        const { data: providerResponses, error: responseError } = await supabase
            .from('request_responses')
            .select('request_id')
            .eq('provider_id', providerId);
        
        if (responseError) throw responseError;
        
        if (!providerResponses || providerResponses.length === 0) {
            console.log('âœ… No responses found - provider has no existing requests');
            return [];
        }
        
        const respondedRequestIds = providerResponses.map(r => r.request_id);
        console.log('ðŸ“‹ Provider has responded to', respondedRequestIds.length, 'requests');
        
        // Step 2: Get full request details for those responses
        const { data: requests, error: requestError } = await supabase
            .from('requests')
            .select('*')
            .in('id', respondedRequestIds)
            .eq('service_id', serviceId)
            .in('status', ['open', 'in_progress', 'pending_completion']); // Active statuses only
        
        if (requestError) throw requestError;
        
        console.log('âœ… Found', requests?.length || 0, 'existing requests for this service');
        
        return requests || [];
        
    } catch (error) {
        console.error('âŒ Error checking existing requests:', error);
        return [];
    }
}

// âœ… NEW FUNCTION: Show dialog for provider to choose action
async function showProviderChoiceDialog(serviceId, existingRequests) {
    return new Promise((resolve) => {
        
        // Get service name for display
        const serviceName = getServiceDisplayName(serviceId);
        
        // Build request list HTML
        let requestListHTML = '';
        existingRequests.forEach(req => {
            const statusText = req.status === 'open' ? t('status_pending') : 
                             req.status === 'in_progress' ? t('status_in_progress') :
                             req.status === 'pending_completion' ? t('status_pending_approval') : req.status;
            
            requestListHTML += `
                <div style="background: #f8f9fa; padding: 10px; border-radius: 6px; margin: 5px 0; display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-size: 13px;">${req.title}</span>
                    <span style="background: #007bff; color: white; padding: 3px 10px; border-radius: 12px; font-size: 11px;">${statusText}</span>
                </div>
            `;
        });
        
        // Create dialog HTML
        const dialogHTML = `
            <div id="providerChoiceDialog" style="
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.6);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                padding: 20px;
            ">
                <div style="
                    background: white;
                    border-radius: 12px;
                    max-width: 500px;
                    width: 100%;
                    max-height: 90vh;
                    overflow-y: auto;
                    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
                ">
                    <!-- Header -->
                    <div style="padding: 20px; border-bottom: 1px solid #e0e0e0;">
                        <h3 style="margin: 0; font-size: 18px; color: #333;">
                            âš ï¸ ${t('remove')} ${serviceName}?
                        </h3>
                    </div>
                    
                    <!-- Content -->
                    <div style="padding: 20px;">
                        <!-- Important Notice -->
                        <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 12px; margin-bottom: 15px; border-radius: 4px;">
                            <strong style="color: #856404;">âš ï¸ ${currentLanguage === 'hi' ? 'à¤®à¤¹à¤¤à¥à¤µà¤ªà¥‚à¤°à¥à¤£' : 'IMPORTANT'}:</strong>
                            <p style="margin: 5px 0 0 0; color: #856404; font-size: 13px;">
                                ${currentLanguage === 'hi' 
                                    ? 'à¤¯à¤¹ à¤¸à¥‡à¤µà¤¾ à¤†à¤ªà¤•à¥€ à¤ªà¥à¤°à¥‹à¤«à¤¼à¤¾à¤‡à¤² à¤¸à¥‡ à¤¤à¥à¤°à¤‚à¤¤ à¤¹à¤Ÿà¤¾ à¤¦à¥€ à¤œà¤¾à¤à¤—à¥€à¥¤ à¤†à¤ªà¤•à¥‹ à¤‡à¤¸ à¤¸à¥‡à¤µà¤¾ à¤•à¥‡ à¤²à¤¿à¤ à¤¨à¤ à¤…à¤¨à¥à¤°à¥‹à¤§ à¤¨à¤¹à¥€à¤‚ à¤®à¤¿à¤²à¥‡à¤‚à¤—à¥‡à¥¤'
                                    : 'This service will be removed from your profile immediately. You will NOT receive new requests for this service.'
                                }
                            </p>
                        </div>
                        
                        <!-- Existing Requests -->
                        <p style="margin: 10px 0; font-weight: 600; color: #333;">
                            ${currentLanguage === 'hi' 
                                ? `à¤†à¤ªà¤•à¥‡ à¤ªà¤¾à¤¸ à¤‡à¤¸ à¤¸à¥‡à¤µà¤¾ à¤•à¥‡ à¤²à¤¿à¤ ${existingRequests.length} à¤®à¥Œà¤œà¥‚à¤¦à¤¾ à¤…à¤¨à¥à¤°à¥‹à¤§ à¤¹à¥ˆà¤‚:`
                                : `You have ${existingRequests.length} existing request(s) for this service:`
                            }
                        </p>
                        
                        <div style="max-height: 150px; overflow-y: auto; margin-bottom: 15px;">
                            ${requestListHTML}
                        </div>
                        
                        <!-- Question -->
                        <p style="font-size: 15px; font-weight: 600; color: #333; margin: 15px 0 10px 0;">
                            ${currentLanguage === 'hi' 
                                ? 'â“ à¤•à¥à¤¯à¤¾ à¤†à¤ª à¤‡à¤¨ à¤®à¥Œà¤œà¥‚à¤¦à¤¾ à¤…à¤¨à¥à¤°à¥‹à¤§à¥‹à¤‚ à¤•à¥‹ à¤ªà¥‚à¤°à¤¾ à¤•à¤°à¤¨à¤¾ à¤šà¤¾à¤¹à¤¤à¥‡ à¤¹à¥ˆà¤‚?'
                                : 'â“ Do you want to complete these existing requests?'
                            }
                        </p>
                        
                        <!-- Choice 1: Complete Existing Work -->
                        <div style="border: 2px solid #28a745; border-radius: 8px; padding: 15px; margin-bottom: 12px; background: #f8fff9;">
                            <div style="display: flex; align-items: flex-start; margin-bottom: 8px;">
                                <span style="font-size: 24px; margin-right: 10px;">âœ…</span>
                                <strong style="font-size: 15px; color: #28a745;">
                                    ${currentLanguage === 'hi' ? 'à¤¹à¤¾à¤ - à¤®à¥Œà¤œà¥‚à¤¦à¤¾ à¤•à¤¾à¤® à¤ªà¥‚à¤°à¤¾ à¤•à¤°à¥‚à¤‚à¤—à¤¾' : 'YES - Complete Existing Work'}
                                </strong>
                            </div>
                            <ul style="margin: 5px 0 0 34px; padding: 0; font-size: 13px; color: #555; line-height: 1.6;">
                                <li>${currentLanguage === 'hi' ? 'à¤—à¥à¤°à¤¾à¤¹à¤•à¥‹à¤‚ à¤•à¥‹ à¤¸à¥‚à¤šà¤¨à¤¾ à¤¨à¤¹à¥€à¤‚ à¤­à¥‡à¤œà¥€ à¤œà¤¾à¤à¤—à¥€' : 'No customer notifications sent'}</li>
                                <li>${currentLanguage === 'hi' ? 'à¤†à¤ª à¤¯à¥‡ à¤…à¤¨à¥à¤°à¥‹à¤§ à¤ªà¥‚à¤°à¥‡ à¤•à¤° à¤¸à¤•à¤¤à¥‡ à¤¹à¥ˆà¤‚' : 'You can finish these requests'}</li>
                                <li>${currentLanguage === 'hi' ? 'à¤‡à¤¸ à¤¸à¥‡à¤µà¤¾ à¤•à¥‡ à¤¨à¤ à¤…à¤¨à¥à¤°à¥‹à¤§ à¤¨à¤¹à¥€à¤‚ à¤®à¤¿à¤²à¥‡à¤‚à¤—à¥‡' : 'No NEW requests for this service'}</li>
                            </ul>
                        </div>
                        
                        <!-- Choice 2: Stop Immediately -->
                        <div style="border: 2px solid #dc3545; border-radius: 8px; padding: 15px; background: #fff5f5;">
                            <div style="display: flex; align-items: flex-start; margin-bottom: 8px;">
                                <span style="font-size: 24px; margin-right: 10px;">âŒ</span>
                                <strong style="font-size: 15px; color: #dc3545;">
                                    ${currentLanguage === 'hi' ? 'à¤¨à¤¹à¥€à¤‚ - à¤¤à¥à¤°à¤‚à¤¤ à¤¬à¤‚à¤¦ à¤•à¤°à¥‡à¤‚' : 'NO - Stop Immediately'}
                                </strong>
                            </div>
                            <ul style="margin: 5px 0 0 34px; padding: 0; font-size: 13px; color: #555; line-height: 1.6;">
                                <li>${currentLanguage === 'hi' ? 'à¤—à¥à¤°à¤¾à¤¹à¤•à¥‹à¤‚ à¤•à¥‹ à¤¸à¥‚à¤šà¤¿à¤¤ à¤•à¤¿à¤¯à¤¾ à¤œà¤¾à¤à¤—à¤¾' : 'Customers will be notified'}</li>
                                <li>${currentLanguage === 'hi' ? 'à¤µà¥‡ à¤…à¤¨à¥à¤¯ à¤ªà¥à¤°à¤¦à¤¾à¤¤à¤¾ à¤šà¥à¤¨ à¤¸à¤•à¤¤à¥‡ à¤¹à¥ˆà¤‚' : 'They can select other providers'}</li>
                                <li>${currentLanguage === 'hi' ? 'à¤†à¤ª à¤¯à¥‡ à¤…à¤¨à¥à¤°à¥‹à¤§ à¤ªà¥‚à¤°à¥‡ à¤¨à¤¹à¥€à¤‚ à¤•à¤°à¥‡à¤‚à¤—à¥‡' : 'You won\'t complete these requests'}</li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- Buttons -->
                    <div style="padding: 15px 20px; background: #f8f9fa; border-top: 1px solid #e0e0e0; display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="handleProviderChoice('complete_existing')" style="
                            flex: 1;
                            min-width: 140px;
                            padding: 12px 20px;
                            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
                            color: white;
                            border: none;
                            border-radius: 8px;
                            font-size: 14px;
                            font-weight: 600;
                            cursor: pointer;
                            transition: transform 0.2s;
                        " onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                            ${currentLanguage === 'hi' ? 'âœ… à¤®à¥Œà¤œà¥‚à¤¦à¤¾ à¤•à¤¾à¤® à¤ªà¥‚à¤°à¤¾ à¤•à¤°à¥‚à¤‚à¤—à¤¾' : 'âœ… Complete Existing Work'}
                        </button>
                        
                        <button onclick="handleProviderChoice('stop_immediately')" style="
                            flex: 1;
                            min-width: 140px;
                            padding: 12px 20px;
                            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
                            color: white;
                            border: none;
                            border-radius: 8px;
                            font-size: 14px;
                            font-weight: 600;
                            cursor: pointer;
                            transition: transform 0.2s;
                        " onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                            ${currentLanguage === 'hi' ? 'âŒ à¤¤à¥à¤°à¤‚à¤¤ à¤¬à¤‚à¤¦ à¤•à¤°à¥‡à¤‚' : 'âŒ Stop Immediately'}
                        </button>
                        
                        <button onclick="handleProviderChoice('cancel')" style="
                            width: 100%;
                            padding: 10px 20px;
                            background: #6c757d;
                            color: white;
                            border: none;
                            border-radius: 8px;
                            font-size: 13px;
                            cursor: pointer;
                            transition: transform 0.2s;
                        " onmouseover="this.style.transform='scale(1.01)'" onmouseout="this.style.transform='scale(1)'">
                            ${t('cancel')}
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        // Add dialog to page
        document.body.insertAdjacentHTML('beforeend', dialogHTML);
        
        // Handle button clicks
        window.handleProviderChoice = (choice) => {
            document.getElementById('providerChoiceDialog').remove();
            delete window.handleProviderChoice;
            resolve(choice);
        };
    });
}

// âœ… NEW FUNCTION: Notify affected customers via chat
async function notifyAffectedCustomers(serviceId, providerId, existingRequests) {
    try {
        console.log('ðŸ“§ Starting customer notifications for service:', serviceId);
        console.log('ðŸ“‹ Affected requests:', existingRequests.length);
        
        if (!existingRequests || existingRequests.length === 0) {
            console.log('â„¹ï¸ No customers to notify');
            return;
        }
        
        // Get provider name for the message
        const { data: providerProfile, error: profileError } = await supabase
            .from('profiles')
            .select('name')
            .eq('user_id', providerId)
            .single();
        
        if (profileError) {
            console.error('Error fetching provider profile:', profileError);
            return;
        }
        
        const providerName = providerProfile.name;
        const serviceName = getServiceDisplayName(serviceId);
        
        console.log('ðŸ‘¤ Provider:', providerName);
        console.log('ðŸ”§ Service:', serviceName);
        
        // Notification messages (bilingual using translation keys)
     const message = `âš ï¸ ${t('provider_stopped_notification')
    .replace('{providerName}', providerName)
    .replace('{serviceName}', serviceName)}`;
        
        // Send notification to each affected customer
        let successCount = 0;
        let failCount = 0;
        
        for (const request of existingRequests) {
            try {
                console.log(`ðŸ“¨ Sending notification for request: ${request.id.substring(0, 8)}...`);
                
                // Get existing chat
                const { data: existingChat, error: fetchError } = await supabase
                    .from('chats')
                    .select('messages')
                    .eq('request_id', request.id)
                    .eq('provider_id', providerId)
                    .single();
                
                let messages = existingChat?.messages || [];
                
                // Add system message in user's language
messages.push({
    sender_id: 'system',
    sender_name: 'System',
    message: message,
    timestamp: new Date().toISOString(),
    is_system_message: true
});
                
                // Upsert chat with new messages AND mark as read-only
const { error: upsertError } = await supabase
    .from('chats')
    .upsert({
        request_id: request.id,
        provider_id: providerId,
        messages: messages,
        is_read_only: true,
        read_only_reason: 'provider_stopped_service'
    }, { onConflict: 'request_id,provider_id' });
                
                if (upsertError) {
                    console.error(`âŒ Failed to notify for request ${request.id}:`, upsertError);
                    failCount++;
                } else {
                    console.log(`âœ… Notification sent for request ${request.id.substring(0, 8)}...`);
                    successCount++;
                }
                
            } catch (requestError) {
                console.error(`âŒ Error processing request ${request.id}:`, requestError);
                failCount++;
            }
        }
        
        console.log(`âœ… Notification Summary: ${successCount} sent, ${failCount} failed`);
        
    } catch (error) {
        console.error('âŒ Error in notifyAffectedCustomers:', error);
    }
}

// âœ… HELPER FUNCTION: Get service display name
function getServiceDisplayName(serviceId) {
    const serviceNames = {
        electrician_installation: `${t('electrician')} - ${t('elec_installation')}`,
        electrician_repair: `${t('electrician')} - ${t('elec_repair')}`,
        electrician_wiring: `${t('electrician')} - ${t('elec_wiring')}`,
        plumber_installation: `${t('plumber')} - ${t('plumb_installation')}`,
        plumber_repair: `${t('plumber')} - ${t('plumb_repair')}`,
        plumber_new_work: `${t('plumber')} - ${t('plumb_new_work')}`,
        ac_installation: `${t('ac_services')} - ${t('ac_installation')}`,
        ac_repair_service: `${t('ac_services')} - ${t('ac_repair_service')}`,
        ac_gas_filling: `${t('ac_services')} - ${t('ac_gas_filling')}`,
        carpenter_repair: `${t('carpenter')} - ${t('carp_repair')}`,
        carpenter_custom: `${t('carpenter')} - ${t('carp_custom')}`,
        carpenter_door_window: `${t('carpenter')} - ${t('carp_door_window')}`,
        painter_house: `${t('painter')} - ${t('paint_house')}`,
        painter_furniture: `${t('painter')} - ${t('paint_furniture')}`,
        painter_texture: `${t('painter')} - ${t('paint_texture')}`,
        cleaner_house: `${t('cleaner')} - ${t('clean_house')}`,
        cleaner_upholstery: `${t('cleaner')} - ${t('clean_upholstery')}`,
        cleaner_vehicle: `${t('cleaner')} - ${t('clean_vehicle')}`,
        appliance_washing: `${t('appliance_repair')} - ${t('app_washing')}`,
        appliance_refrigerator: `${t('appliance_repair')} - ${t('app_refrigerator')}`,
        appliance_tv: `${t('appliance_repair')} - ${t('app_tv')}`,
        appliance_geyser: `${t('appliance_repair')} - ${t('app_geyser')}`,
        appliance_ro: `${t('appliance_repair')} - ${t('app_ro')}`,
        appliance_microwave: `${t('appliance_repair')} - ${t('app_microwave')}`,
        appliance_other: `${t('appliance_repair')} - ${t('app_other')}`
    };
    
    return serviceNames[serviceId] || serviceId;
}

// =====================================================
// SIGNUP - Service Accordion with Checkboxes
// =====================================================

function initializeSignupServiceAccordion() {
    const accordion = document.getElementById('signupServiceAccordion');
    
    if (!accordion) return;
    
    const categoryHeaders = accordion.querySelectorAll('.service-category-header');
    
    categoryHeaders.forEach(header => {
        header.addEventListener('click', function(e) {
            e.stopPropagation();
            
            const category = this.closest('.service-category');
            const content = category.querySelector('.service-category-content');
            const expandIcon = this.querySelector('.expand-icon');
            
            const isExpanded = category.classList.contains('expanded');
            
            if (isExpanded) {
                category.classList.remove('expanded');
                content.style.display = 'none';
                expandIcon.textContent = 'â–¼';
            } else {
                category.classList.add('expanded');
                content.style.display = 'block';
                expandIcon.textContent = 'â–²';
            }
        });
    });
    
    const checkboxes = accordion.querySelectorAll('.signup-service-checkbox');
    
    checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            updateSignupServicesSelected();
        });
    });
    
    updateSignupServicesSelected();
}

function updateSignupServicesSelected() {
    const checkboxes = document.querySelectorAll('.signup-service-checkbox:checked');
    const selectedValues = Array.from(checkboxes).map(cb => cb.value);
    
    const hiddenInput = document.getElementById('signupServicesSelected');
    if (hiddenInput) {
        hiddenInput.value = selectedValues.join(',');
    }
}

function backFromChat() {
    if (currentChatData && currentChatData.isPreSelection) {
        // If chatting before selection, go back to responses
        viewResponses(currentChatData.requestId);
    } else {
        // If chatting after selection, go to dashboard
        showDashboard();
    }
}

        function setupCharCounters() {
            const titleInput = document.getElementById('requestTitle');
            const descInput = document.getElementById('requestDescription');
            const editTitleInput = document.getElementById('editRequestTitle');
            const editDescInput = document.getElementById('editRequestDescription');
            
            if (titleInput) {
                titleInput.addEventListener('input', (e) => { 
                    document.getElementById('titleCounter').textContent = e.target.value.length; 
                });
            }
            
            if (descInput) {
                descInput.addEventListener('input', (e) => { 
                    document.getElementById('descCounter').textContent = e.target.value.length; 
                });
            }
            
            if (editTitleInput) {
                editTitleInput.addEventListener('input', (e) => { 
                    document.getElementById('editTitleCounter').textContent = e.target.value.length; 
                });
            }
            
            if (editDescInput) {
                editDescInput.addEventListener('input', (e) => { 
                    document.getElementById('editDescCounter').textContent = e.target.value.length; 
                });
            }
        }

        function toggleLocationFields() {
    const checked = document.getElementById('differentLocation').checked;
    document.getElementById('customLocationFields').classList.toggle('hidden', !checked);
}

        function validatePhoneInput(input) {
    const value = input.value;
    const errorId = input.id + 'Error';
    const errorDiv = document.getElementById(errorId);
    
    // Remove any non-digit characters
    input.value = value.replace(/[^0-9]/g, '');
    
    // Restrict to exactly 10 digits (prevent more than 10)
    if (input.value.length > 10) {
        input.value = input.value.substring(0, 10);
    }
    
    // If empty, hide error
    if (input.value.length === 0) {
        if (errorDiv) errorDiv.style.display = 'none';
        return false;
    }
    
    // Must be exactly 10 digits for validation
    if (input.value.length !== 10) {
        if (errorDiv) {
            errorDiv.textContent = 'Enter correct number';
            errorDiv.style.display = 'block';
        }
        return false;
    }
    
    const phone = input.value;
    
    // ===== VALIDATION RULES =====
    
    // Rule 1: Must start with 6, 7, 8, or 9
    const firstDigit = phone.charAt(0);
    if (!['6', '7', '8', '9'].includes(firstDigit)) {
        if (errorDiv) {
            errorDiv.textContent = 'Enter correct number';
            errorDiv.style.display = 'block';
        }
        return false;
    }
    
    // Rule 2: All same digits (6666666666)
    if (/^(\d)\1{9}$/.test(phone)) {
        if (errorDiv) {
            errorDiv.textContent = 'Enter correct number';
            errorDiv.style.display = 'block';
        }
        return false;
    }
    
    // Rule 3: Alternating pattern (9898989898, 6767676767)
    if (/^(\d)(\d)\1\2\1\2\1\2\1\2$/.test(phone)) {
        if (errorDiv) {
            errorDiv.textContent = 'Enter correct number';
            errorDiv.style.display = 'block';
        }
        return false;
    }
    
    // Rule 4: Three-digit alternating (989898989, 676767676)
    if (/^(\d)(\d)\1\2\1\2\1\2\1$/.test(phone)) {
        if (errorDiv) {
            errorDiv.textContent = 'Enter correct number';
            errorDiv.style.display = 'block';
        }
        return false;
    }
    
    // Rule 5: Sequential ascending (0123456789, 1234567890, etc.)
    const sequentialPatterns = [
        '0123456789', '1234567890', '2345678901', '3456789012',
        '4567890123', '5678901234', '6789012345', '7890123456',
        '8901234567', '9012345678'
    ];
    if (sequentialPatterns.includes(phone)) {
        if (errorDiv) {
            errorDiv.textContent = 'Enter correct number';
            errorDiv.style.display = 'block';
        }
        return false;
    }
    
    // Rule 6: Sequential descending (9876543210, 8765432109, etc.)
    const reverseSequentialPatterns = [
        '9876543210', '8765432109', '7654321098', '6543210987',
        '5432109876', '4321098765', '3210987654', '2109876543',
        '1098765432', '0987654321'
    ];
    if (reverseSequentialPatterns.includes(phone)) {
        if (errorDiv) {
            errorDiv.textContent = 'Enter correct number';
            errorDiv.style.display = 'block';
        }
        return false;
    }
    
    // Rule 7: Too many repeated digits (more than 5 same digits)
    const digitCounts = {};
    for (let digit of phone) {
        digitCounts[digit] = (digitCounts[digit] || 0) + 1;
        if (digitCounts[digit] > 5) {
            if (errorDiv) {
                errorDiv.textContent = 'Enter correct number';
                errorDiv.style.display = 'block';
            }
            return false;
        }
    }
    
    // Rule 8: Repeating pairs (9988776655, 6677889900)
    if (/^(\d)\1(\d)\2(\d)\3(\d)\4(\d)\5$/.test(phone)) {
        if (errorDiv) {
            errorDiv.textContent = 'Enter correct number';
            errorDiv.style.display = 'block';
        }
        return false;
    }
    
    // Rule 9: Common fake numbers (manually curated list)
    const commonFakeNumbers = [
        '9999999999', '8888888888', '7777777777', '6666666666',
        '1234567890', '0987654321', '9876543210',
        '1111111111', '2222222222', '3333333333', '4444444444', '5555555555',
        '9999900000', '8888800000', '7777700000',
        '0000000000', '1231231234', '9879879876'
    ];
    if (commonFakeNumbers.includes(phone)) {
        if (errorDiv) {
            errorDiv.textContent = 'Enter correct number';
            errorDiv.style.display = 'block';
        }
        return false;
    }
    
    // Rule 10: Lack of digit diversity (must have at least 4 unique digits)
    const uniqueDigits = new Set(phone.split('')).size;
    if (uniqueDigits < 4) {
        if (errorDiv) {
            errorDiv.textContent = 'Enter correct number';
            errorDiv.style.display = 'block';
        }
        return false;
    }
    
    // Rule 11: Check for repeating sequences of 3+ digits (888999888, 777666777)
    if (/(\d)\1{2,}/.test(phone)) {
        const matches = phone.match(/(\d)\1{2,}/g);
        if (matches && matches.length > 2) {
            if (errorDiv) {
                errorDiv.textContent = 'Enter correct number';
                errorDiv.style.display = 'block';
            }
            return false;
        }
    }
    
    // All validations passed
    if (errorDiv) errorDiv.style.display = 'none';
    return true;
}

        function toggleProviderFieldsSignup() {
    const checkbox = document.getElementById('isProvider');
    const providerFields = document.getElementById('signupProviderFields');
    
    if (checkbox.checked) {
        providerFields.classList.remove('hidden');
        
        // Initialize the accordion when provider fields are shown
        setTimeout(() => {
            initializeSignupServiceAccordion();
        }, 100);
    } else {
        providerFields.classList.add('hidden');
    }
}

function updateProviderButton() {
    const btn = document.getElementById('toggleProviderBtn');
    const text = document.getElementById('providerStatusText');
    const isProvider = currentProfile.is_provider;
    
    if (!btn || !text) return; // Safety check
    
    if (isProvider) {
        text.textContent = `âœ… ${t('providing_services')} (${t('click_to_stop')})`;
        btn.style.background = 'linear-gradient(135deg, #28a745 0%, #20c997 100%)';
    } else {
        text.textContent = `âŒ ${t('not_providing')} (${t('click_to_start')})`;
        btn.style.background = 'linear-gradient(135deg, #6c757d 0%, #5a6268 100%)';
    }
    
    document.getElementById('providerSettings').classList.toggle('hidden', !isProvider);
}

async function toggleProviderStatus() {
    const isCurrentlyProvider = currentProfile.is_provider;
    const btn = document.getElementById('toggleProviderBtn');
    const text = document.getElementById('providerStatusText');
    
    if (!isCurrentlyProvider) {
        // User wants to become a provider
        const confirmed = confirm('âš ï¸ Start providing services?\n\nYou will receive notifications for service requests in your selected area. You can add services and set your service radius.');
        
        if (confirmed) {
            currentProfile.is_provider = true;
            updateProviderButton();
        }
    } else {
        // User wants to stop being a provider
        const confirmed = confirm('âš ï¸ Stop providing services?\n\nYou will no longer receive notifications for service requests. All your services will be removed from your profile.');
        
        if (confirmed) {
            currentProfile.is_provider = false;
            updateProviderButton();
        }
    }
}

// Approve completion from chat message button
async function approveCompletionFromChat(messageIndex) {
    if (!confirm('âœ… Accept work completion?\n\nThis will mark the request as completed and you can rate the provider.')) return;
    
    try {
        // Get existing chat messages
        const { data: existingChat } = await supabase
            .from('chats')
            .select('messages')
            .eq('request_id', currentChatData.requestId)
            .eq('provider_id', currentChatData.providerId)
            .single();
        
        let messages = existingChat?.messages || [];
        
        // Update the completion request message status
        if (messages[messageIndex]) {
            messages[messageIndex].completion_request_status = 'approved';
        }
        
        // Update request status to completed
        const { error: updateError } = await supabase
            .from('requests')
            .update({ status: 'completed' })
            .eq('id', currentChatData.requestId);
        
        if (updateError) throw updateError;
        
        // Add system message
        messages.push({
            sender_id: currentUser.id,
            sender_name: currentProfile.name,
            message: 'âœ… Work completion accepted by customer. Request is now completed!',
            message_type: 'system',
            timestamp: new Date().toISOString()
        });
        
        // Update chat
        await supabase
            .from('chats')
            .update({ messages: messages })
            .eq('request_id', currentChatData.requestId)
            .eq('provider_id', currentChatData.providerId);
        
        // Update chat status display
        document.getElementById('chatRequestStatus').textContent = 'COMPLETED';
        currentChatData.requestStatus = 'completed';
        
        await loadChatMessages();
        
        // Open rating modal
        alert('âœ… Work completion accepted! Please rate the provider.');
        openRatingModal(currentChatData.requestId, currentChatData.providerId, currentChatData.partnerName);
        
    } catch (error) {
        alert('âŒ Error: ' + error.message);
    }
}

// Reject completion from chat message button
async function rejectCompletionFromChat(messageIndex) {
    const reason = prompt('âŒ Reject work completion?\n\nPlease provide a reason for rejection (the provider will see this):');
    
    if (!reason || reason.trim() === '') return;
    
    try {
        // Get existing chat messages
        const { data: existingChat } = await supabase
            .from('chats')
            .select('messages')
            .eq('request_id', currentChatData.requestId)
            .eq('provider_id', currentChatData.providerId)
            .single();
        
        let messages = existingChat?.messages || [];
        
        // Update the completion request message status
        if (messages[messageIndex]) {
            messages[messageIndex].completion_request_status = 'declined';
        }
        
        // Update request status back to in_progress
        const { error: updateError } = await supabase
            .from('requests')
            .update({ status: 'in_progress' })
            .eq('id', currentChatData.requestId);
        
        if (updateError) throw updateError;
        
        // Add system message with rejection reason
        messages.push({
            sender_id: currentUser.id,
            sender_name: currentProfile.name,
            message: `âŒ Work completion rejected by customer.\n\nReason: ${reason.trim()}\n\nPlease continue working to resolve the issues.`,
            message_type: 'system',
            timestamp: new Date().toISOString()
        });
        
        // Update chat
        await supabase
            .from('chats')
            .update({ messages: messages })
            .eq('request_id', currentChatData.requestId)
            .eq('provider_id', currentChatData.providerId);
        
        // Update chat status display
        document.getElementById('chatRequestStatus').textContent = 'IN PROGRESS';
        currentChatData.requestStatus = 'in_progress';
        
        await loadChatMessages();
        
        alert('âŒ Completion rejected. The provider can see your feedback and will continue working.');
        
    } catch (error) {
        alert('âŒ Error: ' + error.message);
    }
}

        // Login
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const errorDiv = document.getElementById('loginError');
            errorDiv.classList.add('hidden');
            
            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: document.getElementById('loginEmail').value.trim(),
                    password: document.getElementById('loginPassword').value
                });
                
                if (error) throw error;
                
                currentUser = data.user;
                
                // âœ… CRITICAL FIX: Explicitly hide login view BEFORE loading profile
                const loginView = document.getElementById('loginView');
                if (loginView) {
                    loginView.classList.add('hidden');
                    loginView.style.display = 'none';
                }
                
await loadProfile();

// âœ… DEBUG: Log all referral-related values
console.log('ðŸ” REFERRAL BONUS CHECK:', {
    hasCurrentUser: !!currentUser,
    hasCurrentProfile: !!currentProfile,
    email_verified: currentProfile?.email_verified,
    referral_bonus_awarded: currentProfile?.referral_bonus_awarded,
    referred_by: currentProfile?.referred_by,
    user_id: currentUser?.id
});

// Check and award referral bonus on first verified login
if (currentUser && currentProfile && currentProfile.email_verified && !currentProfile.referral_bonus_awarded && currentProfile.referred_by) {
    console.log('âœ… All conditions met! Awarding referral bonus...');
    await awardReferralBonus(currentUser.id);
} else {
    console.log('â­ï¸ Referral bonus conditions NOT met:', {
        reason: !currentProfile?.email_verified ? 'email not verified' :
                currentProfile?.referral_bonus_awarded ? 'bonus already awarded' :
                !currentProfile?.referred_by ? 'no referrer (referred_by is null)' : 'unknown'
    });
}
            } catch (error) {
                errorDiv.textContent = error.message;
                errorDiv.classList.remove('hidden');
            }
        });

        // Signup
document.getElementById('signupForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const errorDiv = document.getElementById('signupError');
    const infoDiv = document.getElementById('signupInfo');
    const submitBtn = document.querySelector('#signupForm button[type="submit"]');

    errorDiv.classList.add('hidden');
    infoDiv.classList.add('hidden');
    submitBtn.disabled = true;
    submitBtn.textContent = t('sign_up') + '...';

    try {
        console.log('ðŸ”µ STEP 0: Form submission started');
        
        // Validate phone number before proceeding
        const phoneInput = document.getElementById('signupPhone');
        if (!validatePhoneInput(phoneInput)) {
            errorDiv.textContent = t('invalid_phone');
            errorDiv.classList.remove('hidden');
            submitBtn.disabled = false;
            submitBtn.textContent = t('sign_up');
            return;
        }

        const formData = {
            email: document.getElementById('signupEmail').value.trim(),
            password: document.getElementById('signupPassword').value,
            name: document.getElementById('signupName').value.trim(),
            phone: document.getElementById('signupPhone').value.trim(),
            house_number: document.getElementById('houseNumber').value.trim() || null,
            area_name: document.getElementById('areaName').value.trim(),
            landmark: document.getElementById('landmark').value.trim() || null,
            city: document.getElementById('city').value,
            state: document.getElementById('state').value,
            pin_code: document.getElementById('pinCode').value.trim(),
            is_provider: document.getElementById('isProvider').checked
        };
        
        console.log('ðŸ”µ STEP 1: Form data collected:', formData);

        // âœ… STEP 1: Get coordinates (with retry on failure)
        showLoading();
        infoDiv.textContent = 'ðŸ“ Locating your address...';
        infoDiv.classList.remove('hidden');
        
        console.log('ðŸ”µ STEP 2: Starting geocoding...');
        
        let coords;
        try {
            coords = await getCoordinates(formData);
            console.log('âœ… STEP 2 COMPLETE: Coordinates obtained:', coords);
        } catch (error) {
            console.error('âŒ STEP 2 FAILED: Geocoding error:', error);
            // Geocoding failed - show clear error
            hideAllViews();
            document.getElementById('signupView').classList.remove('hidden');
            errorDiv.textContent = 'âŒ ' + error.message + '\n\nPlease retry signup with a valid address or allow GPS access.';
            errorDiv.classList.remove('hidden');
            submitBtn.disabled = false;
            submitBtn.textContent = t('sign_up');
            infoDiv.classList.add('hidden');
            return; // Stop signup
        }
        
        console.log('ðŸ”µ STEP 3: Calling Supabase signUp...');
        
        // âœ… STEP 2: Create auth user
        infoDiv.textContent = `ðŸ‘¤ ${t('creating_account')}`;        
        const { data: authData, error: authError } = await supabase.auth.signUp({
            email: formData.email,
            password: formData.password,
            options: {
                emailRedirectTo: `${window.location.origin}`
            }
        });
        
        console.log('âœ… STEP 3 COMPLETE: Supabase signUp response:', authData, authError);

if (authError) {
    console.error('âŒ STEP 3 FAILED: Auth error:', authError);
    throw authError;
}

// âœ… STEP 4: Use authData.user (no session needed during signup)
console.log('ðŸ”µ STEP 4: Using auth user from signup response...');

if (!authData || !authData.user || !authData.user.id) {
    console.error('âŒ STEP 4 FAILED: No user data in signup response');
    throw new Error('Signup failed. No user data returned.');
}

console.log('âœ… STEP 4 COMPLETE: Auth user ID obtained:', authData.user.id);

console.log('ðŸ”µ STEP 5: Creating profile (WHILE LOGGED IN)...');

// âœ… STEP 5: Create profile WHILE USER IS STILL LOGGED IN
infoDiv.textContent = `ðŸ’¾ ${t('saving_profile')}`;

// Calculate verification link expiry time (48 hours from now)
const expiryTime = new Date();
expiryTime.setHours(expiryTime.getHours() + 48);

// ===== ADD DEBUG LOGS HERE =====
// Get referral code if entered
const referralCodeInput = document.getElementById('signupReferralCode').value.trim().toUpperCase();
let referrerId = null;

console.log('ðŸ” DEBUG: Referral code input element exists?', document.getElementById('signupReferralCode'));
console.log('ðŸ” DEBUG: Referral code entered:', referralCodeInput);
console.log('ðŸ” DEBUG: Is referral code provided?', !!referralCodeInput);

// Validate referral code if provided
if (referralCodeInput) {
    console.log('ðŸ”µ Checking referral code:', referralCodeInput);
    const { data: referrerProfile, error: refError } = await supabase
        .rpc('validate_referral_code', { code: referralCodeInput });
    
    console.log('ðŸ” DEBUG: Referrer query result:', { referrerProfile, refError });
    
    if (referrerProfile && referrerProfile.length > 0) {
        referrerId = referrerProfile[0].user_id;
        console.log('âœ… Valid referral code from:', referrerProfile[0].name, 'ID:', referrerId);
    } else {
        console.log('âš ï¸ Invalid referral code - not found in database');
    }
}

// Generate referral code for new user
const generateReferralCode = () => {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    let code = 'REF-';
    for (let i = 0; i < 6; i++) {
        code += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return code;
};

const newUserReferralCode = generateReferralCode();

const { error: profileError } = await supabase.from('profiles').insert([{
    user_id: authData.user.id,
    name: formData.name,
    phone: formData.phone,
    house_number: formData.house_number,
    area_name: formData.area_name,
    landmark: formData.landmark,
    city: formData.city,
    state: formData.state,
    pin_code: formData.pin_code,
    latitude: coords.lat,
    longitude: coords.lng,
    is_provider: formData.is_provider,
    email_verified: false,
    verification_link_expires_at: expiryTime.toISOString(),
    last_verification_email_sent_at: new Date().toISOString(),
    referral_code: newUserReferralCode,  // â† NEW: Assign referral code
    referred_by: referrerId,  // â† ADD THIS (will be null if no referral code used)
    referral_bonus_awarded: false,  // â† ADD THIS
}]);

console.log('âœ… STEP 5 COMPLETE: Profile creation result:', profileError);

// âœ… DEBUG: Verify what was actually saved
if (!profileError) {
    console.log('ðŸ” DEBUG: Profile saved with referral data:', {
        user_id: authData.user.id,
        referred_by: referrerId,
        referral_bonus_awarded: false,
        referral_code: newUserReferralCode
    });
}

if (profileError) {
    console.error('âŒ STEP 5 FAILED: Profile error:', profileError);
    throw profileError;
}

// âœ… NEW: Add transaction entry for initial signup credits (200 credits from DB default)
console.log('ðŸ”µ Adding initial signup bonus transaction...');
await supabase.from('credit_transactions').insert([{
    user_id: authData.user.id,
    transaction_type: 'credit',
    amount: 200,
    description: 'Welcome bonus: Initial signup credits',
    status: 'completed',
    related_request_id: null
}]);
console.log('âœ… Initial signup transaction recorded');

console.log('âœ… Verification email sent automatically by Supabase');


        console.log('ðŸ”µ STEP 6: Adding provider services (if applicable)...');

        // âœ… STEP 6: If provider, create services (UPDATED FOR SUBCATEGORIES)
if (formData.is_provider) {
    const services = [];
    // Collect all checked subcategory services
    document.querySelectorAll('.signup-service-checkbox:checked').forEach(checkbox => {
        services.push(checkbox.value);
    });
    
    if (services.length === 0) {
        errorDiv.textContent = t('please_select_at_least_one_service');
        errorDiv.classList.remove('hidden');
        submitBtn.disabled = false;
        submitBtn.textContent = t('sign_up');
        return;
    }       
    if (services.length > 0) {
        const radius = parseInt(document.getElementById('signupRadius').value) || 10;
        
        const serviceData = services.map(serviceId => ({
            provider_id: authData.user.id,  // âœ… FIXED: Use authData instead of session
            service_id: serviceId,
            service_radius: radius
        }));
        
        const { error: serviceError } = await supabase.from('provider_services').insert(serviceData);
        console.log('âœ… STEP 6 COMPLETE: Provider services added:', serviceError);
        
        if (serviceError) {
            console.error('âŒ Error adding provider services:', serviceError);
            throw serviceError;
        }
        
        // Update profile with radius
        await supabase.from('profiles').update({ radius_km: radius }).eq('user_id', authData.user.id);  // âœ… FIXED
    }
} else {
    console.log('âœ… STEP 6 SKIPPED: Not a provider');
}

// âœ… NEW: Clear stored referral code after successful signup
console.log('ðŸ”µ Clearing stored referral code...');
localStorage.removeItem('pendingReferralCode');

// âœ… LOGOUT the user immediately after signup
console.log('ðŸ”µ Logging out user after signup...');
await supabase.auth.signOut();
currentUser = null;

// âœ… Clear form
document.getElementById('signupForm').reset();

// âœ… IMPROVED: Force redirect with explicit display management
const signupView = document.getElementById('signupView');
const loginView = document.getElementById('loginView');

// Hide signup view
if (signupView) {
    signupView.classList.add('hidden');
    signupView.style.display = 'none';
}

// Show login view
if (loginView) {
    loginView.classList.remove('hidden');
    loginView.style.display = 'block';
}

console.log('âœ… User logged out and redirected to login');

// âœ… Use setTimeout to ensure UI updates before alert
setTimeout(() => {
    alert('âœ… Account created successfully!\n\nðŸ“§ A verification email has been sent to ' + formData.email + '\n\nPlease check your inbox (and spam folder) and verify your email before logging in.');
}, 100);

// âœ… Show success message AFTER redirect (non-blocking alternative recommended)
alert('âœ… Account created successfully!\n\nðŸ“§ A verification email has been sent to ' + formData.email + '\n\nPlease check your inbox (and spam folder) and verify your email before logging in.');
        
    } catch (error) {
        console.error('âŒ âŒ âŒ SIGNUP FAILED:', error);
        hideAllViews();
        document.getElementById('signupView').classList.remove('hidden');
        errorDiv.textContent = error.message;
        errorDiv.classList.remove('hidden');
        submitBtn.disabled = false;
        submitBtn.textContent = t('sign_up');
        infoDiv.classList.add('hidden');
    }
});

// ==========================================
// STEP 1: FUZZY STRING MATCHING
// Add this at the TOP of your file
// ==========================================

/**
 * Calculate Levenshtein distance between two strings
 * Returns similarity percentage (0-100%)
 */
function calculateStringSimilarity(str1, str2) {
    // Normalize strings: lowercase, remove spaces, special chars
    const normalize = (s) => s.toLowerCase()
        .replace(/\s+/g, '')
        .replace(/[^\w\u0900-\u097F]/g, ''); // Keep alphanumeric + Hindi chars
    
    const s1 = normalize(str1);
    const s2 = normalize(str2);
    
    if (s1 === s2) return 100;
    if (s1.length === 0 || s2.length === 0) return 0;
    
    // Levenshtein distance algorithm
    const matrix = [];
    
    for (let i = 0; i <= s2.length; i++) {
        matrix[i] = [i];
    }
    
    for (let j = 0; j <= s1.length; j++) {
        matrix[0][j] = j;
    }
    
    for (let i = 1; i <= s2.length; i++) {
        for (let j = 1; j <= s1.length; j++) {
            if (s2.charAt(i - 1) === s1.charAt(j - 1)) {
                matrix[i][j] = matrix[i - 1][j - 1];
            } else {
                matrix[i][j] = Math.min(
                    matrix[i - 1][j - 1] + 1, // substitution
                    matrix[i][j - 1] + 1,     // insertion
                    matrix[i - 1][j] + 1      // deletion
                );
            }
        }
    }
    
    const distance = matrix[s2.length][s1.length];
    const maxLength = Math.max(s1.length, s2.length);
    const similarity = ((maxLength - distance) / maxLength) * 100;
    
    return Math.round(similarity);
}

/**
 * Test the function (you can remove this after testing)
 */
console.log('Testing String Similarity:');
console.log('Bhivani vs Bhiwani:', calculateStringSimilarity('Bhivani', 'Bhiwani') + '%'); // Should be ~85%
console.log('Sector 12 vs Sector 12A:', calculateStringSimilarity('Sector 12', 'Sector 12A') + '%'); // Should be ~90%
console.log('Model Town vs Model Town Extension:', calculateStringSimilarity('Model Town', 'Model Town Extension') + '%'); // Should be ~70%

// ==========================================
// STEP 2: STATE NORMALIZATION
// Add this AFTER the calculateStringSimilarity function
// ==========================================

/**
 * Normalize state names to handle all variations
 * Returns standardized state name
 */
function normalizeStateName(stateName) {
    if (!stateName) return '';
    
    const normalized = stateName.toLowerCase().trim();
    
    // State mapping with all variations
    const stateMap = {
        // Haryana
        'haryana': 'haryana',
        'hr': 'haryana',
        'hariyana': 'haryana',
        'à¤¹à¤°à¤¿à¤¯à¤¾à¤£à¤¾': 'haryana',
        
        // Punjab
        'punjab': 'punjab',
        'pb': 'punjab',
        'panjab': 'punjab',
        'à¤ªà¤‚à¤œà¤¾à¤¬': 'punjab',
        
        // Delhi
        'delhi': 'delhi',
        'dl': 'delhi',
        'à¤¦à¤¿à¤²à¥à¤²à¥€': 'delhi',
        'new delhi': 'delhi',
        
        // Uttar Pradesh
        'uttar pradesh': 'uttarpradesh',
        'up': 'uttarpradesh',
        'à¤‰à¤¤à¥à¤¤à¤° à¤ªà¥à¤°à¤¦à¥‡à¤¶': 'uttarpradesh',
        
        // Rajasthan
        'rajasthan': 'rajasthan',
        'rj': 'rajasthan',
        'à¤°à¤¾à¤œà¤¸à¥à¤¥à¤¾à¤¨': 'rajasthan',
        
        // Madhya Pradesh
        'madhya pradesh': 'madhyapradesh',
        'mp': 'madhyapradesh',
        'à¤®à¤§à¥à¤¯ à¤ªà¥à¤°à¤¦à¥‡à¤¶': 'madhyapradesh',
        
        // Gujarat
        'gujarat': 'gujarat',
        'gj': 'gujarat',
        'à¤—à¥à¤œà¤°à¤¾à¤¤': 'gujarat',
        
        // Maharashtra
        'maharashtra': 'maharashtra',
        'mh': 'maharashtra',
        'à¤®à¤¹à¤¾à¤°à¤¾à¤·à¥à¤Ÿà¥à¤°': 'maharashtra',
        
        // Karnataka
        'karnataka': 'karnataka',
        'ka': 'karnataka',
        'à¤•à¤°à¥à¤¨à¤¾à¤Ÿà¤•': 'karnataka',
        
        // Tamil Nadu
        'tamil nadu': 'tamilnadu',
        'tn': 'tamilnadu',
        'à¤¤à¤®à¤¿à¤² à¤¨à¤¾à¤¡à¥': 'tamilnadu',
        
        // Telangana
        'telangana': 'telangana',
        'ts': 'telangana',
        'tg': 'telangana',
        'à¤¤à¥‡à¤²à¤‚à¤—à¤¾à¤¨à¤¾': 'telangana',
        
        // Andhra Pradesh
        'andhra pradesh': 'andhrapradesh',
        'ap': 'andhrapradesh',
        'à¤†à¤‚à¤§à¥à¤° à¤ªà¥à¤°à¤¦à¥‡à¤¶': 'andhrapradesh',
        
        // West Bengal
        'west bengal': 'westbengal',
        'wb': 'westbengal',
        'à¤ªà¤¶à¥à¤šà¤¿à¤® à¤¬à¤‚à¤—à¤¾à¤²': 'westbengal',
        
        // Bihar
        'bihar': 'bihar',
        'br': 'bihar',
        'à¤¬à¤¿à¤¹à¤¾à¤°': 'bihar',
        
        // Odisha
        'odisha': 'odisha',
        'or': 'odisha',
        'orissa': 'odisha',
        'à¤“à¤¡à¤¿à¤¶à¤¾': 'odisha',
        
        // Jharkhand
        'jharkhand': 'jharkhand',
        'jh': 'jharkhand',
        'à¤à¤¾à¤°à¤–à¤‚à¤¡': 'jharkhand',
        
        // Chhattisgarh
        'chhattisgarh': 'chhattisgarh',
        'ct': 'chhattisgarh',
        'chattisgarh': 'chhattisgarh',
        'à¤›à¤¤à¥à¤¤à¥€à¤¸à¤—à¤¢à¤¼': 'chhattisgarh',
        
        // Assam
        'assam': 'assam',
        'as': 'assam',
        'à¤…à¤¸à¤®': 'assam',
        
        // Kerala
        'kerala': 'kerala',
        'kl': 'kerala',
        'à¤•à¥‡à¤°à¤²': 'kerala',
        
        // Goa
        'goa': 'goa',
        'ga': 'goa',
        'à¤—à¥‹à¤µà¤¾': 'goa',
        
        // Himachal Pradesh
        'himachal pradesh': 'himachalpradesh',
        'hp': 'himachalpradesh',
        'à¤¹à¤¿à¤®à¤¾à¤šà¤² à¤ªà¥à¤°à¤¦à¥‡à¤¶': 'himachalpradesh',
        
        // Uttarakhand
        'uttarakhand': 'uttarakhand',
        'uk': 'uttarakhand',
        'uttaranchal': 'uttarakhand',
        'à¤‰à¤¤à¥à¤¤à¤°à¤¾à¤–à¤‚à¤¡': 'uttarakhand',
        
        // Jammu and Kashmir
        'jammu and kashmir': 'jammuandkashmir',
        'jk': 'jammuandkashmir',
        'j&k': 'jammuandkashmir',
        'à¤œà¤®à¥à¤®à¥‚ à¤”à¤° à¤•à¤¶à¥à¤®à¥€à¤°': 'jammuandkashmir'
    };
    
    // Check if state exists in map
    if (stateMap[normalized]) {
        return stateMap[normalized];
    }
    
    // If not found, return normalized version (removes spaces)
    return normalized.replace(/\s+/g, '');
}

/**
 * Check if two state names match (handles all variations)
 */
function statesMatch(state1, state2) {
    const normalized1 = normalizeStateName(state1);
    const normalized2 = normalizeStateName(state2);
    
    return normalized1 === normalized2;
}

/**
 * Test the function (you can remove this after testing)
 */
console.log('Testing State Normalization:');
console.log('Haryana = HR:', statesMatch('Haryana', 'HR')); // Should be true
console.log('Haryana = à¤¹à¤°à¤¿à¤¯à¤¾à¤£à¤¾:', statesMatch('Haryana', 'à¤¹à¤°à¤¿à¤¯à¤¾à¤£à¤¾')); // Should be true
console.log('Haryana = HARYANA:', statesMatch('Haryana', 'HARYANA')); // Should be true
console.log('Haryana = Hariyana:', statesMatch('Haryana', 'Hariyana')); // Should be true
console.log('Haryana = Punjab:', statesMatch('Haryana', 'Punjab')); // Should be false
console.log('UP = Uttar Pradesh:', statesMatch('UP', 'Uttar Pradesh')); // Should be true
        // Geocoding
        // ==========================================
// STEP 5: UPDATED getCoordinates WITH CONFIRMATION POPUP
// REPLACE your existing getCoordinates function with this
// ==========================================

/**
 * Get coordinates with smart validation and user confirmation
 */
async function getCoordinates(formData) {
    const strategies = [
        formData.house_number 
            ? `${formData.house_number}, ${formData.area_name}, ${formData.landmark || ''}, ${formData.city}, ${formData.state}, ${formData.pin_code}, India`.replace(/,\s*,/g, ',')
            : null,
        formData.landmark
            ? `${formData.area_name}, ${formData.landmark}, ${formData.city}, ${formData.state}, ${formData.pin_code}, India`
            : null,
        `${formData.area_name}, ${formData.city}, ${formData.state}, ${formData.pin_code}, India`
    ];

    // Try all geocoding strategies with detailed logging
    for (let address of strategies.filter(Boolean)) {
        try {
            console.log('ðŸ” Trying to geocode:', address);
            const result = await geocodeAddress(address, formData);
            
            if (result) {
                console.log('âœ… Geocoding success:', result);
                
                // Check if user confirmation is needed
                if (result.needsConfirmation) {
                    console.log('âš ï¸ Confidence level requires user confirmation');
                    
                    const confirmed = await showConfirmationPopup(result.matchedAddress, formData);
                    
                    if (confirmed) {
                        console.log('âœ… User confirmed the address');
                        return { lat: result.lat, lng: result.lng };
                    } else {
                        console.log('âŒ User rejected the address, requesting GPS...');
                        break;
                    }
                } else {
                    console.log('âœ… High confidence, auto-accepting address');
                    return { lat: result.lat, lng: result.lng };
                }
            }
        } catch (error) {
            console.log('âŒ Geocoding failed for:', address, error);
        }
    }

    // Try PIN code-based fallback before GPS
    console.log('âš ï¸ Trying PIN code-based fallback...');
    try {
        const pinResult = await geocodeByPinCode(formData);
        if (pinResult) {
            console.log('âœ… PIN code fallback successful');
            
            if (pinResult.needsConfirmation) {
                const confirmed = await showConfirmationPopup(pinResult.matchedAddress, formData);
                
                if (confirmed) {
                    console.log('âœ… User confirmed PIN code location');
                    return { lat: pinResult.lat, lng: pinResult.lng };
                }
            } else {
                return { lat: pinResult.lat, lng: pinResult.lng };
            }
        }
    } catch (error) {
        console.log('âŒ PIN code fallback failed:', error);
    }

    // All strategies failed - request GPS
    console.log('âš ï¸ All geocoding strategies failed. Requesting GPS...');

    // Request GPS location as fallback
    return requestGPSLocation();
}

/**
 * Show bilingual confirmation popup (Hindi + English)
 * Returns: Promise<boolean> - true if user confirms, false if they choose GPS
 */
function showConfirmationPopup(matchedAddress, formData) {
    return new Promise((resolve) => {
        // Create overlay
        const overlay = document.createElement('div');
        overlay.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            font-family: Arial, sans-serif;
        `;

        // Create popup box
        const popup = document.createElement('div');
        popup.style.cssText = `
            background: white;
            border-radius: 12px;
            padding: 24px;
            max-width: 90%;
            width: 400px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            text-align: center;
        `;

        // Extract city, area from matched address for display
        const displayAddress = `${formData.area_name}, ${formData.city}\n${formData.state} - ${formData.pin_code}`;

        popup.innerHTML = `
            <div style="font-size: 48px; margin-bottom: 16px;">ðŸ“</div>
            
            <div style="font-size: 18px; font-weight: bold; color: #333; margin-bottom: 8px;">
                Is this your service area?
            </div>
            <div style="font-size: 16px; font-weight: bold; color: #666; margin-bottom: 20px;">
                à¤•à¥à¤¯à¤¾ à¤¯à¤¹ à¤†à¤ªà¤•à¤¾ à¤¸à¥‡à¤µà¤¾ à¤•à¥à¤·à¥‡à¤¤à¥à¤° à¤¹à¥ˆ?
            </div>
            
            <div style="background: #f5f5f5; padding: 16px; border-radius: 8px; margin-bottom: 24px;">
                <div style="font-size: 16px; color: #333; font-weight: 500; white-space: pre-line;">
                    ${displayAddress}
                </div>
            </div>
            
            <div style="display: flex; gap: 12px; flex-direction: column;">
                <button id="confirmYes" style="
                    background: #4CAF50;
                    color: white;
                    border: none;
                    padding: 14px 24px;
                    border-radius: 8px;
                    font-size: 16px;
                    font-weight: bold;
                    cursor: pointer;
                    box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
                ">
                    âœ“ Yes, This is Correct<br>
                    <span style="font-size: 14px; font-weight: normal;">à¤¹à¤¾à¤, à¤¯à¤¹ à¤¸à¤¹à¥€ à¤¹à¥ˆ</span>
                </button>
                
                <button id="confirmNo" style="
                    background: #f44336;
                    color: white;
                    border: none;
                    padding: 14px 24px;
                    border-radius: 8px;
                    font-size: 16px;
                    font-weight: bold;
                    cursor: pointer;
                    box-shadow: 0 2px 8px rgba(244, 67, 54, 0.3);
                ">
                    âœ— No, Use My Phone Location<br>
                    <span style="font-size: 14px; font-weight: normal;">à¤¨à¤¹à¥€à¤‚, à¤®à¥‡à¤°à¥€ à¤«à¤¼à¥‹à¤¨ à¤²à¥‹à¤•à¥‡à¤¶à¤¨ à¤‰à¤ªà¤¯à¥‹à¤— à¤•à¤°à¥‡à¤‚</span>
                </button>
            </div>
        `;

        overlay.appendChild(popup);
        document.body.appendChild(overlay);

        // Add hover effects
        const yesBtn = popup.querySelector('#confirmYes');
        const noBtn = popup.querySelector('#confirmNo');

        yesBtn.addEventListener('mouseenter', () => {
            yesBtn.style.background = '#45a049';
        });
        yesBtn.addEventListener('mouseleave', () => {
            yesBtn.style.background = '#4CAF50';
        });

        noBtn.addEventListener('mouseenter', () => {
            noBtn.style.background = '#da190b';
        });
        noBtn.addEventListener('mouseleave', () => {
            noBtn.style.background = '#f44336';
        });

        // Handle button clicks
        yesBtn.addEventListener('click', () => {
            document.body.removeChild(overlay);
            resolve(true);
        });

        noBtn.addEventListener('click', () => {
            document.body.removeChild(overlay);
            resolve(false);
        });
    });
}

/**
 * Request GPS location from user's phone
 */
function requestGPSLocation() {
    return new Promise((resolve, reject) => {
        if (!navigator.geolocation) {
            reject(new Error('GPS not supported on this device\nà¤‡à¤¸ à¤¡à¤¿à¤µà¤¾à¤‡à¤¸ à¤ªà¤° GPS à¤‰à¤ªà¤²à¤¬à¥à¤§ à¤¨à¤¹à¥€à¤‚ à¤¹à¥ˆ'));
            return;
        }
        
        // Show alert before requesting GPS
        alert('We need your phone location to find your exact service area.\n\nà¤¹à¤®à¥‡à¤‚ à¤†à¤ªà¤•à¤¾ à¤¸à¤Ÿà¥€à¤• à¤¸à¥‡à¤µà¤¾ à¤•à¥à¤·à¥‡à¤¤à¥à¤° à¤–à¥‹à¤œà¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤†à¤ªà¤•à¥‡ à¤«à¤¼à¥‹à¤¨ à¤•à¥€ à¤²à¥‹à¤•à¥‡à¤¶à¤¨ à¤šà¤¾à¤¹à¤¿à¤à¥¤');
        
        // Request GPS location
        navigator.geolocation.getCurrentPosition(
            (position) => {
                console.log('âœ… GPS location obtained:', position.coords);
                resolve({ 
                    lat: position.coords.latitude, 
                    lng: position.coords.longitude 
                });
            },
            (error) => {
                console.error('âŒ GPS error:', error);
                
                let errorMessage = 'Unable to get your location.\nà¤†à¤ªà¤•à¥€ à¤²à¥‹à¤•à¥‡à¤¶à¤¨ à¤ªà¥à¤°à¤¾à¤ªà¥à¤¤ à¤¨à¤¹à¥€à¤‚ à¤¹à¥‹ à¤¸à¤•à¥€à¥¤\n\n';
                
                if (error.code === 1) {
                    errorMessage += 'Please allow location access in your browser settings.\nà¤•à¥ƒà¤ªà¤¯à¤¾ à¤…à¤ªà¤¨à¥‡ à¤¬à¥à¤°à¤¾à¤‰à¤œà¤¼à¤° à¤¸à¥‡à¤Ÿà¤¿à¤‚à¤—à¥à¤¸ à¤®à¥‡à¤‚ à¤²à¥‹à¤•à¥‡à¤¶à¤¨ à¤à¤•à¥à¤¸à¥‡à¤¸ à¤•à¥€ à¤…à¤¨à¥à¤®à¤¤à¤¿ à¤¦à¥‡à¤‚à¥¤';
                } else if (error.code === 2) {
                    errorMessage += 'Location signal not available.\nà¤²à¥‹à¤•à¥‡à¤¶à¤¨ à¤¸à¤¿à¤—à¥à¤¨à¤² à¤‰à¤ªà¤²à¤¬à¥à¤§ à¤¨à¤¹à¥€à¤‚ à¤¹à¥ˆà¥¤';
                } else if (error.code === 3) {
                    errorMessage += 'Location request timed out.\nà¤²à¥‹à¤•à¥‡à¤¶à¤¨ à¤°à¤¿à¤•à¥à¤µà¥‡à¤¸à¥à¤Ÿ à¤¸à¤®à¤¯ à¤¸à¤®à¤¾à¤ªà¥à¤¤ à¤¹à¥‹ à¤—à¤ˆà¥¤';
                }
                
                reject(new Error(errorMessage));
            },
            {
                enableHighAccuracy: true,
                timeout: 15000,
                maximumAge: 0
            }
        );
    });
}

console.log('âœ… Step 5: Updated getCoordinates with confirmation popup loaded');

        // Geocode using OpenStreetMap (Nominatim)
async function geocodeWithOpenStreetMap(address) {
    try {
        console.log('ðŸ”µ Trying OpenStreetMap:', address);
        const url = `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(address)}&format=json&limit=1&countrycodes=in`;
        const response = await fetch(url, { headers: { 'User-Agent': 'HelpBuddy/1.0' } });
        const data = await response.json();
        
        if (data && data.length > 0) {
    console.log('âœ… OpenStreetMap returned result:', data[0]);
    
    // Create result object with formatted address
    const result = {
        lat: parseFloat(data[0].lat),
        lng: parseFloat(data[0].lon),
        formatted: data[0].display_name || ''
    };
    
    return result;
}
        console.log('âš ï¸ OpenStreetMap: No results found');
        return null;
    } catch (error) {
        console.error('âŒ OpenStreetMap error:', error);
        return null;
    }
}

// Geocode using OpenCage API
async function geocodeWithOpenCage(address) {
    try {
        console.log('ðŸ”µ Trying OpenCage:', address);
        // You'll need to get a FREE API key from https://opencagedata.com/api
        const apiKey = 'c227c2331da94f6b862df0a4f4149920'; // â† Replace with your key
        
        const url = `https://api.opencagedata.com/geocode/v1/json?q=${encodeURIComponent(address)}&key=${apiKey}&countrycode=in&limit=1&language=en`;
        const response = await fetch(url);
        const data = await response.json();
        
        if (data.results && data.results.length > 0) {
    console.log('âœ… OpenCage returned result:', data.results[0]);
    
    return { 
        lat: data.results[0].geometry.lat, 
        lng: data.results[0].geometry.lng,
        formatted: data.results[0].formatted || ''
    };
}
        console.log('âš ï¸ OpenCage: No results found');
        return null;
    } catch (error) {
        console.error('âŒ OpenCage error:', error);
        return null;
    }
}

// ==========================================
// STEP 4: UPDATED GEOCODE ADDRESS FUNCTION
// REPLACE your existing geocodeAddress function with this
// ==========================================

/**
 * Master geocoding function with smart validation
 * Returns: { lat, lng, confidence, needsConfirmation, matchedAddress } or null
 */
async function geocodeAddress(address, formData) {
    console.log('ðŸ”µ Trying to geocode:', address);
    
    // Try OpenStreetMap first (free, no limit)
    let result = await geocodeWithOpenStreetMap(address);
    if (result) {
        const validation = validateGeocodingResult(result, formData);
        
        if (validation.valid) {
            console.log('âœ… OpenStreetMap: Valid result found');
            console.log('ðŸ“Š Confidence:', validation.confidence + '%');
            console.log('â“ Needs confirmation:', validation.needsConfirmation);
            
            return { 
                lat: result.lat, 
                lng: result.lng,
                confidence: validation.confidence,
                needsConfirmation: validation.needsConfirmation,
                matchedAddress: validation.matchedAddress
            };
        } else {
            console.log('âš ï¸ OpenStreetMap: Result found but validation failed');
        }
    }
    
    // Try OpenCage if OpenStreetMap fails (free 2,500/day)
    result = await geocodeWithOpenCage(address);
    if (result) {
        const validation = validateGeocodingResult(result, formData);
        
        if (validation.valid) {
            console.log('âœ… OpenCage: Valid result found');
            console.log('ðŸ“Š Confidence:', validation.confidence + '%');
            console.log('â“ Needs confirmation:', validation.needsConfirmation);
            
            return { 
                lat: result.lat, 
                lng: result.lng,
                confidence: validation.confidence,
                needsConfirmation: validation.needsConfirmation,
                matchedAddress: validation.matchedAddress
            };
        } else {
            console.log('âš ï¸ OpenCage: Result found but validation failed');
        }
    }
    
    // Both failed validation
    console.log('âŒ All geocoding attempts failed validation');
    return null;
}

console.log('âœ… Step 4: Updated geocodeAddress function loaded');

// ==========================================
// STEP 3: SMART VALIDATION WITH CONFIDENCE SCORING
// REPLACE your existing validateGeocodingResult function with this
// ==========================================

/**
 * Validate geocoding result with smart fuzzy matching
 * Returns: { valid: boolean, confidence: number, needsConfirmation: boolean, matchedAddress: string }
 */
function validateGeocodingResult(result, formData) {
    const formatted = result.formatted || '';
    
    console.log('ðŸ” Validating geocoding result...');
    console.log('ðŸ“ Formatted address from API:', formatted);
    console.log('ðŸ“ User input:', {
        area: formData.area_name,
        city: formData.city,
        state: formData.state,
        pin: formData.pin_code
    });
    
    // Extract user input
    const userArea = (formData.area_name || '').trim();
    const userCity = (formData.city || '').trim();
    const userState = (formData.state || '').trim();
    const userPin = (formData.pin_code || '').trim();
    
    // Check if mandatory fields are present
    if (!userArea || !userCity || !userState) {
        console.log('âŒ VALIDATION FAILED: Missing mandatory fields');
        return { valid: false, confidence: 0, needsConfirmation: false };
    }
    
    // === STEP 1: STATE VALIDATION (MANDATORY) ===
    const formattedLower = formatted.toLowerCase();
    const normalizedUserState = normalizeStateName(userState);
    
    // Check if state exists in formatted address
    let stateFound = false;
    
    // Try to find state in various forms
    const stateVariations = [
        userState.toLowerCase(),
        normalizedUserState,
        // Get all possible variations from our state map
        userState.toLowerCase().substring(0, 2) // Abbreviation
    ];
    
    for (let stateVar of stateVariations) {
        if (formattedLower.includes(stateVar)) {
            stateFound = true;
            break;
        }
    }
    
    if (!stateFound) {
        console.log('âŒ VALIDATION FAILED: State not found in result');
        console.log('   Expected state:', userState);
        console.log('   Normalized:', normalizedUserState);
        return { valid: false, confidence: 0, needsConfirmation: false };
    }
    
    console.log('âœ… State matched:', userState);
    
    // === STEP 2: CITY VALIDATION (MANDATORY with 85%+ similarity) ===
    let cityMatch = 0;
    let bestCityMatch = 0;
    
    // Split formatted address into words to find city
    const words = formatted.toLowerCase().split(/[,\s]+/);
    
    for (let word of words) {
        const similarity = calculateStringSimilarity(word, userCity);
        if (similarity > bestCityMatch) {
            bestCityMatch = similarity;
        }
    }
    
    cityMatch = bestCityMatch;
    
    // City must match at least 85% (allows minor typos like Bhivani/Bhiwani)
    if (cityMatch < 85) {
        console.log('âŒ VALIDATION FAILED: City match too low');
        console.log('   Expected city:', userCity);
        console.log('   Best match found:', bestCityMatch + '%');
        return { valid: false, confidence: 0, needsConfirmation: false };
    }
    
    console.log('âœ… City matched:', userCity, '(' + cityMatch + '%)');
    
    // === STEP 3: AREA VALIDATION (MANDATORY with 60%+ similarity) ===
    let areaMatch = 0;
    let bestAreaMatch = 0;
    
    // Check area name in formatted address
    for (let word of words) {
        const similarity = calculateStringSimilarity(word, userArea);
        if (similarity > bestAreaMatch) {
            bestAreaMatch = similarity;
        }
    }
    
    // Also check multi-word area names
    const userAreaWords = userArea.toLowerCase().split(/\s+/);
    if (userAreaWords.length > 1) {
        // Check if all words of area name exist
        let allWordsFound = true;
        for (let areaWord of userAreaWords) {
            if (areaWord.length < 3) continue; // Skip small words like "New", "Old"
            
            let wordFound = false;
            for (let word of words) {
                if (calculateStringSimilarity(word, areaWord) >= 80) {
                    wordFound = true;
                    break;
                }
            }
            if (!wordFound) {
                allWordsFound = false;
                break;
            }
        }
        
        if (allWordsFound) {
            bestAreaMatch = Math.max(bestAreaMatch, 85); // Boost if all words found
        }
    }
    
    areaMatch = bestAreaMatch;
    
    // Area must match at least 60%
    if (areaMatch < 60) {
        console.log('âŒ VALIDATION FAILED: Area match too low');
        console.log('   Expected area:', userArea);
        console.log('   Best match found:', bestAreaMatch + '%');
        return { valid: false, confidence: 0, needsConfirmation: false };
    }
    
    console.log('âœ… Area matched:', userArea, '(' + areaMatch + '%)');
    
    // === STEP 4: PIN CODE (OPTIONAL - adds confidence) ===
    const pinMatch = formattedLower.includes(userPin.toLowerCase());
    if (pinMatch) {
        console.log('âœ… PIN code matched:', userPin);
    } else {
        console.log('âš ï¸ PIN code not found (optional)');
    }
    
    // === STEP 5: CALCULATE OVERALL CONFIDENCE ===
    // Area match is most important for 100m accuracy
    let confidence = areaMatch;
    
    // Boost confidence if PIN matches
    if (pinMatch) {
        confidence = Math.min(100, confidence + 10);
    }
    
    // === STEP 6: DETERMINE ACTION ===
    let needsConfirmation = false;
    
    if (confidence >= 80) {
        console.log('âœ… HIGH CONFIDENCE (' + confidence + '%) - Auto-accept');
        needsConfirmation = false;
    } else if (confidence >= 60) {
        console.log('âš ï¸ MEDIUM CONFIDENCE (' + confidence + '%) - Needs user confirmation');
        needsConfirmation = true;
    } else {
        console.log('âŒ LOW CONFIDENCE (' + confidence + '%) - Reject');
        return { valid: false, confidence: confidence, needsConfirmation: false };
    }
    
    return {
        valid: true,
        confidence: confidence,
        needsConfirmation: needsConfirmation,
        matchedAddress: formatted
    };
}

console.log('âœ… Step 3: Smart validation function loaded');

 // ==========================================
// PIN CODE FALLBACK STRATEGY
// Add this AFTER geocodeAddress function
// ==========================================

/**
 * Try geocoding using PIN code + City (more reliable for Indian addresses)
 */
async function geocodeByPinCode(formData) {
    console.log('ðŸ”µ Trying PIN code-based geocoding...');
    
    // Strategy 1: PIN code + City + State
    const address1 = `${formData.pin_code}, ${formData.city}, ${formData.state}, India`;
    let result = await geocodeWithOpenStreetMap(address1);
    
    if (result) {
        console.log('âœ… PIN code geocoding returned result:', result);
        // For PIN code-based results, we relax validation (only check state and city)
        return {
            lat: result.lat,
            lng: result.lng,
            confidence: 65, // Medium confidence (will trigger confirmation)
            needsConfirmation: true,
            matchedAddress: `${formData.area_name}, ${formData.city}, ${formData.state} - ${formData.pin_code}`
        };
    }
    
    console.log('âŒ PIN code geocoding failed');
    return null;
}       

        // Convert Image to Base64
        function convertImageToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = (error) => reject(error);
                reader.readAsDataURL(file);
            });
        }

// ==================== CREDIT SYSTEM HELPER FUNCTIONS ====================

// Deduct credits from user
async function deductCredits(userId, amount, description, relatedRequestId = null, status = 'completed', warrantyExpiresAt = null) {
    try {
        console.log(`ðŸ’³ Deducting ${amount} credits from user ${userId}`);
        
        // If status is 'completed', deduct credits immediately
        if (status === 'completed') {
            // Use RPC to bypass RLS (negative amount = deduction)
            const { error: rpcError } = await supabase.rpc('add_credits_bypass_rls', {
                target_user_id: userId,
                credit_amount: -amount  // Negative to deduct
            });
            
            if (rpcError) throw rpcError;
        }
        
        // Log transaction
        const { error: logError } = await supabase
            .from('credit_transactions')
            .insert([{
                user_id: userId,
                transaction_type: 'debit',
                amount: amount,
                description: description,
                status: status,
                related_request_id: relatedRequestId,
                warranty_expires_at: warrantyExpiresAt
            }]);
        
        if (logError) throw logError;
        
        console.log(`âœ… Successfully deducted ${amount} credits`);
        return true;
        
    } catch (error) {
        console.error('âŒ Error deducting credits:', error);
        throw error;
    }
}

// Add credits to user (with pending support)
async function addCredits(userId, amount, description, relatedRequestId = null, status = 'completed', warrantyExpiresAt = null) {
    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
    console.log('ðŸ”µ START addCredits()');
    console.log('   userId:', userId);
    console.log('   amount:', amount);
    console.log('   description:', description);
    console.log('   status:', status);
    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
    
    try {
        // If status is 'completed', add credits immediately
        if (status === 'completed') {
            console.log('âœ… Status is completed, proceeding to update profile...');
            
            // Use RPC function to bypass RLS
            console.log('ðŸ’¾ Calling add_credits_bypass_rls RPC...');
            const { data: rpcData, error: rpcError } = await supabase.rpc('add_credits_bypass_rls', {
                target_user_id: userId,
                credit_amount: amount
            });
            
            console.log('ðŸ’¾ RPC result:');
            console.log('   - rpcData:', rpcData);
            console.log('   - rpcError:', rpcError);
            
            if (rpcError) {
                console.error('âŒ RPC CALL FAILED!');
                console.error('   Error details:', JSON.stringify(rpcError, null, 2));
                throw rpcError;
            }
            
            console.log('âœ… Profile credits updated successfully via RPC!');
            
            // âœ… If the updated user is the currently logged-in user, refresh their UI
            if (currentUser && currentUser.id === userId) {
                console.log('ðŸ”„ Refreshing current user profile...');
                await loadProfile(currentUser.id);
                displayCreditBalance();
                
                // Also reload referral data if it exists
                if (typeof loadReferralData === 'function') {
                    await loadReferralData();
                }
            }
            
            // Verify the update
            console.log('ðŸ” Verifying credit update...');
            const { data: verifyProfile, error: verifyError } = await supabase
                .from('profiles')
                .select('credits, name')
                .eq('user_id', userId)
                .single();
            
            if (verifyError) {
                console.error('âš ï¸ Could not verify update:', verifyError);
            } else {
                console.log('âœ… Verification result:');
                console.log('   Name:', verifyProfile.name);
                console.log('   Credits:', verifyProfile.credits);
            }
        } else {
            console.log('â¸ï¸ Status is pending, skipping profile update');
        }
        
        // Log transaction
        console.log('ðŸ“ Logging transaction...');
        const transactionData = {
            user_id: userId,
            transaction_type: 'credit',
            amount: amount,
            description: description,
            status: status,
            related_request_id: relatedRequestId,
            warranty_expires_at: warrantyExpiresAt
        };
        
        console.log('   Transaction data:', transactionData);
        
        const { data: logData, error: logError } = await supabase
            .from('credit_transactions')
            .insert([transactionData])
            .select();
        
        console.log('ðŸ“ Transaction log result:');
        console.log('   - logData:', logData);
        console.log('   - logError:', logError);
        
        if (logError) {
            console.error('âŒ TRANSACTION LOG FAILED!');
            console.error('   Error details:', JSON.stringify(logError, null, 2));
            throw logError;
        }
        
        console.log('âœ… Transaction logged successfully');
        console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
        console.log('ðŸŽ‰ addCredits() COMPLETED SUCCESSFULLY');
        console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
        return true;
        
    } catch (error) {
        console.error('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
        console.error('ðŸ’¥ FATAL ERROR in addCredits()');
        console.error('   Error message:', error.message);
        console.error('   Error details:', JSON.stringify(error, null, 2));
        console.error('   Stack trace:', error.stack);
        console.error('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
        throw error;
    }

// âœ… If the updated user is the currently logged-in user, refresh their UI
if (currentUser && currentUser.id === userId) {
    console.log('ðŸ”„ Refreshing current user profile...');
    await loadProfile(currentUser.id);
    displayCreditBalance();
    
    // âœ… Also reload referral data
    if (typeof loadReferralData === 'function') {
        await loadReferralData();
    }
}

}

// Award referral bonus to both users
async function awardReferralBonus(userId) {
    try {
        console.log('ðŸŽ Checking for pending referral bonus for user:', userId);
        
        // Get user's profile to check for pending referral
        const { data: profile, error: profileError } = await supabase
            .from('profiles')
            .select('referred_by, referral_bonus_awarded, name, credits')
            .eq('user_id', userId)
            .single();
        
        // âœ… DEBUG: Log what was fetched
        console.log('ðŸ” DEBUG awardReferralBonus - Profile fetched:', {
            profile: profile,
            error: profileError
        });
        
        if (profileError) {
            console.error('âŒ Error fetching profile:', profileError);
            return;
        }
        
        // Check if bonus already awarded or no referrer
        if (!profile.referred_by) {
            console.log('â„¹ï¸ No referrer found for this user');
            return;
        }
        
        if (profile.referral_bonus_awarded) {
            console.log('â„¹ï¸ Referral bonus already awarded');
            return;
        }
        
        console.log('ðŸŽ Awarding referral bonuses...');
        
        // Step 1: Create referral record
const { error: referralError } = await supabase.from('referrals').insert([{
    referrer_id: profile.referred_by,
    referred_id: userId,
    status: 'completed',
    credits_awarded_first_request: false  // âœ… ADD THIS!
}]);
        
        if (referralError) {
            console.error('âŒ Error creating referral record:', referralError);
            // Continue anyway - bonus is more important
        } else {
            console.log('âœ… Referral record created');
        }
        
        // Step 2: Award bonus to NEW USER (+20 credits)
        await addCredits(
            userId, 
            20, 
            'Signup bonus: You signed up using a referral code', 
            null, 
            'completed', 
            null
        );
        console.log('âœ… +20 credits awarded to new user');
        
        // Step 3: Award bonus to REFERRER (+50 credits)
console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
console.log('ðŸŽ AWARDING REFERRER BONUS');
console.log('   Referrer ID:', profile.referred_by);
console.log('   New user name:', profile.name);
console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

try {
    const newUserName = profile.name || 'A new user';
    
    await addCredits(
        profile.referred_by, 
        50, 
        `Referral bonus: ${newUserName} signed up using your referral code`, 
        null, 
        'completed', 
        null
    );
    
    console.log('âœ… Referrer bonus awarded successfully');
    
} catch (referrerBonusError) {
    console.error('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
    console.error('ðŸ’¥ FAILED TO AWARD REFERRER BONUS!');
    console.error('   Error:', referrerBonusError);
    console.error('   This is a CRITICAL issue - referrer did not receive credits!');
    console.error('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
    // Don't throw - let the process continue for the new user
}

// Verify provider credits were updated
console.log('ðŸ” Verifying referrer credits...');
const { data: verifyProvider, error: verifyError } = await supabase
    .from('profiles')
    .select('credits, name')
    .eq('user_id', profile.referred_by)
    .single();

if (verifyError) {
    console.error('âŒ Error verifying provider credits:', verifyError);
} else {
    console.log('âœ… Referrer verification result:');
    console.log('   Name:', verifyProvider.name);
    console.log('   Credits:', verifyProvider.credits);
}
        
        // Step 4: Mark bonus as awarded
        const { error: updateError } = await supabase
            .from('profiles')
            .update({ referral_bonus_awarded: true })
            .eq('user_id', userId);
        
        if (updateError) {
            console.error('âŒ Error updating referral_bonus_awarded flag:', updateError);
        } else {
            console.log('âœ… Referral bonus marked as awarded');
	    // After referral bonus awarded successfully, reload the profile to update UI
            await loadProfile(currentUser.id);
            displayCreditBalance(); // Call your function that updates the credit display
        }
        
        console.log('ðŸŽ‰ Referral bonus process completed successfully!');
        
    } catch (error) {
        console.error('âŒ Error in awardReferralBonus:', error);
    }

// Step 4: Mark bonus as awarded
const { error: updateError } = await supabase
    .from('profiles')
    .update({ referral_bonus_awarded: true })
    .eq('user_id', userId);

if (updateError) {
    console.error('âŒ Error updating referral_bonus_awarded flag:', updateError);
} else {
    console.log('âœ… Referral bonus marked as awarded');
    await loadProfile(currentUser.id);
    displayCreditBalance();
    
    // âœ… ALSO reload referral data
    await loadReferralData();
}

}

// ========== REFERRAL CREDIT AWARDS ==========

// Award referrer when referred user completes first request (+25 credits)
async function awardReferralFirstRequestBonus(userId) {
    console.log('ðŸ”µ Checking referral first request bonus for:', userId);
    
    try {
        // Step 1: Get the referral record
        const { data: referral, error: refError } = await supabase
            .from('referrals')
            .select('*')
            .eq('referred_id', userId)
            .maybeSingle();
        
        if (refError) {
            console.error('âŒ Error fetching referral:', refError);
            return;
        }
        
        if (!referral) {
            console.log('â­ï¸ User was not referred by anyone');
            return;
        }
        
        console.log('ðŸ“Š Referral found:', referral);
        console.log('ðŸ“Š Flag status:', referral.credits_awarded_first_request);
        
        // Step 2: CHECK THE FLAG FIRST AND FOREMOST
        if (referral.credits_awarded_first_request === true) {
            console.log('â­ï¸ STOP: First request bonus already awarded (flag is true)');
            return;
        }
        
        // Step 3: Try to update the flag atomically (THIS IS THE KEY!)
        // Use UPDATE with WHERE condition to ensure only ONE request succeeds
        const { data: updateResult, error: updateError } = await supabase
            .from('referrals')
            .update({ 
                credits_awarded_first_request: true,
                status: 'first_request_completed'
            })
            .eq('id', referral.id)
            .eq('credits_awarded_first_request', false) // â­ CRITICAL: Only update if still false
            .select(); // Return the updated row
        
        if (updateError) {
            console.error('âŒ Error updating referral flag:', updateError);
            return;
        }
        
        // Step 4: Check if the update actually happened
        if (!updateResult || updateResult.length === 0) {
            console.log('â­ï¸ STOP: Flag was already updated by another request (race condition prevented)');
            return;
        }
        
        console.log('âœ… Flag updated successfully - proceeding to award credits');
        
        // Step 5: Get user name for description
        const { data: userProfile } = await supabase
            .from('profiles')
            .select('name')
            .eq('user_id', userId)
            .single();
        
        const userName = userProfile?.name || 'A user';
        
        // Step 6: NOW award credits (flag is already set, so this can only happen once)
        await addCredits(
            referral.referrer_id, 
            25, 
            `Referral bonus: ${userName} (${userId}) created their first request`,
            null, 
            'completed', 
            null
        );
        
        console.log('âœ… Referral first request bonus awarded successfully');
        
    } catch (error) {
        console.error('âŒ Referral first request bonus failed:', error);
    }
}

// ========== REFERRAL UI FUNCTIONS ==========

// Load and display referral data
async function loadReferralData() {
    console.log('ðŸ” loadReferralData called');
    console.log('   currentProfile:', currentProfile);
    console.log('   currentProfile.user_id:', currentProfile?.user_id);
    
    if (!currentProfile) {
        console.log('âŒ No currentProfile - returning early');
        return;
    }
    
    try {
        // Display user's referral code
        const codeEl = document.getElementById('myReferralCode');
        if (codeEl && currentProfile.referral_code) {
            codeEl.textContent = currentProfile.referral_code;
        }
        
        // Fetch referral stats
        const { data: referrals, error } = await supabase
            .from('referrals')
            .select('*')
            .eq('referrer_id', currentProfile.user_id);
        
if (error) {
    console.error('âŒ Referral query error:', error);
    throw error;
}

console.log('ðŸ“Š Referral query results:', referrals);
console.log('   Total found:', referrals?.length);

const totalReferrals = referrals?.length || 0;
        const completedReferrals = referrals?.filter(r => r.status === 'completed' || r.status === 'first_request_completed').length || 0;        
        // Calculate credits earned from referrals
        let creditsEarned = 0;
        referrals?.forEach(r => {
            if (r.status === 'completed') creditsEarned += 50;  // Signup bonus
            if (r.credits_awarded_first_request) creditsEarned += 25;  // First request bonus
        });
        
        // Update UI with null checks
        const totalEl = document.getElementById('totalReferrals');
        if (totalEl) totalEl.textContent = totalReferrals;
        
        const verifiedEl = document.getElementById('verifiedReferrals');
        if (verifiedEl) verifiedEl.textContent = completedReferrals;
        
        const creditsEl = document.getElementById('referralCreditsEarned');
        if (creditsEl) creditsEl.textContent = creditsEarned;
        // âœ… Also update MODAL elements directly
        const modalTotalEl = document.getElementById('modalTotalReferrals');
        if (modalTotalEl) modalTotalEl.textContent = totalReferrals;
        
        const modalVerifiedEl = document.getElementById('modalVerifiedReferrals');
        if (modalVerifiedEl) modalVerifiedEl.textContent = completedReferrals;
        
        const modalCreditsEl = document.getElementById('modalReferralCredits');
        if (modalCreditsEl) modalCreditsEl.textContent = creditsEarned;        
    } catch (error) {
        console.error('Error loading referral data:', error);
    }
}

// Copy referral code to clipboard
function copyReferralCode() {
    const code = currentProfile?.referral_code;
    if (!code) {
        alert('No referral code available');
        return;
    }
    
    navigator.clipboard.writeText(code).then(() => {
        alert('âœ… Referral code copied!\n\n' + code);
    }).catch(() => {
        // Fallback for older browsers
        const textArea = document.createElement('textarea');
        textArea.value = code;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        alert('âœ… Referral code copied!\n\n' + code);
    });
}

function shareReferralCode() {
    const code = currentProfile?.referral_code;
    if (!code) {
        alert('No referral code available');
        return;
    }
    
    // â­ NEW: Create referral URL with code in it
    const referralUrl = `${window.location.origin}/app.html?mode=signup&referral=${code}`;
    
    const message = `ðŸŽ Join HelpBuddy and get â‚¹200 bonus credits!\n\nðŸ‘‰ Sign up using my link:\n${referralUrl}\n\nâœ… Your referral bonus will be automatically applied!`;
    
    // Try native share first (mobile)
    if (navigator.share) {
        navigator.share({
            title: 'Join HelpBuddy - Get â‚¹200 Free!',
            text: message,
           // url: referralUrl
        }).catch(err => console.log('Share cancelled'));
    } else {
        // Fallback to WhatsApp
        const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
        window.open(whatsappUrl, '_blank');
    }
}

// Theme Toggle Function
function toggleTheme() {
    const body = document.body;
    const isChecked = document.getElementById('themeToggle').checked;
    
    if (isChecked) {
        body.classList.add('dark-theme');
        localStorage.setItem('theme', 'dark');
    } else {
        body.classList.remove('dark-theme');
        localStorage.setItem('theme', 'light');
    }
}

// Load saved theme on page load
document.addEventListener('DOMContentLoaded', function() {
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'dark') {
        document.body.classList.add('dark-theme');
        const toggle = document.getElementById('themeToggle');
        if (toggle) toggle.checked = true;
    }
});

// Referral Modal Functions
function openReferralModal() {
    // âœ… Load fresh referral data
    loadReferralData();
    
    // Sync data from existing elements
    const code = currentProfile?.referral_code || '---';
    document.getElementById('modalReferralCode').textContent = code;
    
    const totalRef = document.getElementById('totalReferrals');
    const verifiedRef = document.getElementById('verifiedReferrals');
    const creditsRef = document.getElementById('referralCreditsEarned');
    
    if (totalRef) document.getElementById('modalTotalReferrals').textContent = totalRef.textContent;
    if (verifiedRef) document.getElementById('modalVerifiedReferrals').textContent = verifiedRef.textContent;
    if (creditsRef) document.getElementById('modalReferralCredits').textContent = creditsRef.textContent;
    
        document.getElementById('referralModal').style.display = 'flex';
    // Close profile dropdown if it exists
    const profileDropdown = document.getElementById('profileDropdown');
    if (profileDropdown) profileDropdown.style.display = 'none';
}

function closeReferralModal() {
    document.getElementById('referralModal').style.display = 'none';
}

// Close modal when clicking outside
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('referralModal')?.addEventListener('click', function(e) {
        if (e.target === this) closeReferralModal();
    });
});

// Display credit balance in dashboard header
function displayCreditBalance() {
    if (!currentProfile) return;
    
    // Find the user button in header
    const userButton = document.querySelector('.user-button');
    if (!userButton) return;
    
    // Check if credit display already exists
    let creditDisplay = document.getElementById('creditBalanceDisplay');
    
    if (!creditDisplay) {
        // Create credit display element
        creditDisplay = document.createElement('div');
        creditDisplay.id = 'creditBalanceDisplay';
        creditDisplay.style.cssText = 'background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); color: #333; padding: 8px 16px; border-radius: 20px; font-weight: 700; font-size: 15px; margin-right: 12px; box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3); display: flex; align-items: center; gap: 6px;';
        
                // Insert before profile photo (left side)
        const headerUserPhoto = document.getElementById('headerUserPhoto');
        const headerUserPhotoPlaceholder = document.getElementById('headerUserPhotoPlaceholder');
        const profilePhotoElement = headerUserPhoto && headerUserPhoto.style.display !== 'none' 
            ? headerUserPhoto 
            : headerUserPhotoPlaceholder;
        
        if (profilePhotoElement && profilePhotoElement.parentNode) {
            profilePhotoElement.parentNode.insertBefore(creditDisplay, profilePhotoElement);
        } else {
            // Fallback: insert before user button
            userButton.parentNode.insertBefore(creditDisplay, userButton);
        }
    }

    
    // Update credit display
    const credits = currentProfile.credits || 0;
    creditDisplay.innerHTML = `ðŸ’° ${credits}`;
    
    // Add warning color if low on credits
    if (credits < 25) {
        creditDisplay.style.background = 'linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%)';
        creditDisplay.style.color = 'white';
    } else if (credits < 50) {
        creditDisplay.style.background = 'linear-gradient(135deg, #ffd93d 0%, #fcbf49 100%)';
        creditDisplay.style.color = '#333';
    } else {
        creditDisplay.style.background = 'linear-gradient(135deg, #FFD700 0%, #FFA500 100%)';
        creditDisplay.style.color = '#333';
    }
}

// Check and award expired warranties
async function checkAndAwardExpiredWarranties() {
    if (!currentProfile) return;
    
    try {
        console.log('ðŸ” Checking for expired warranties...');
        
        const today = new Date().toISOString().split('T')[0];
        const lastChecked = currentProfile.last_warranty_check_date;
        
        // Only check once per day
        if (lastChecked === today) {
            console.log('âœ… Already checked warranties today');
            return;
        }
        
        // Find all pending transactions with expired warranties
        const { data: expiredTransactions, error } = await supabase
            .from('credit_transactions')
            .select('*')
            .eq('user_id', currentProfile.user_id)
            .eq('status', 'pending')
            .not('warranty_expires_at', 'is', null)
            .lt('warranty_expires_at', new Date().toISOString());
        
        if (error) throw error;
        
        if (!expiredTransactions || expiredTransactions.length === 0) {
            console.log('âœ… No expired warranties found');
            
            // Update last check date
            await supabase
                .from('profiles')
                .update({ last_warranty_check_date: today })
                .eq('user_id', currentProfile.user_id);
            
            return;
        }
        
        console.log(`ðŸŽ Found ${expiredTransactions.length} expired warranties to award`);
        
        let totalAwarded = 0;
        
        for (let transaction of expiredTransactions) {
            // Award the credits
            const { data: profile } = await supabase
                .from('profiles')
                .select('credits')
                .eq('user_id', currentProfile.user_id)
                .single();
            
            await supabase
                .from('profiles')
                .update({ credits: profile.credits + transaction.amount })
                .eq('user_id', currentProfile.user_id);
            
            // Update transaction status
            await supabase
                .from('credit_transactions')
                .update({ status: 'completed' })
                .eq('id', transaction.id);
            
            totalAwarded += transaction.amount;
        }
        
        // Update last check date
        await supabase
            .from('profiles')
            .update({ last_warranty_check_date: today })
            .eq('user_id', currentProfile.user_id);
        
        // Update local profile
        currentProfile.credits += totalAwarded;
        currentProfile.last_warranty_check_date = today;
        
        // Show alert
        alert(`ðŸŽ‰ ${totalAwarded} credits awarded!\n\n${expiredTransactions.length} warranty period(s) have expired and your pending credits have been added to your account.`);
        
        // Refresh credit display
        displayCreditBalance();
        
    } catch (error) {
        console.error('âŒ Error checking warranties:', error);
    }
}

// Check and award weekly bonus
async function checkWeeklyBonus() {
    if (!currentProfile) return;
    
    try {
        const credits = currentProfile.credits || 0;
        const isProvider = currentProfile.is_provider;
        const threshold = isProvider ? 50 : 25;
        
        // Check if eligible for bonus
        if (credits >= threshold) {
            console.log('âœ… Not eligible for weekly bonus (sufficient credits)');
            return;
        }
        
        const lastBonus = currentProfile.last_weekly_bonus_date;
        const now = new Date();
        
        // Check if 7 days have passed
        if (lastBonus) {
            const lastBonusDate = new Date(lastBonus);
            const daysSince = Math.floor((now - lastBonusDate) / (1000 * 60 * 60 * 24));
            
            if (daysSince < 7) {
                console.log(`âœ… Weekly bonus not yet available (${7 - daysSince} days remaining)`);
                return;
            }
        }
        
        // Award bonus
        await addCredits(
            currentProfile.user_id,
            10,
            'Weekly bonus (low credits)',
            null,
            'completed'
        );
        
        // Update last bonus date
        await supabase
            .from('profiles')
            .update({ last_weekly_bonus_date: now.toISOString() })
            .eq('user_id', currentProfile.user_id);
        
        // Update local profile
        currentProfile.credits += 10;
        currentProfile.last_weekly_bonus_date = now.toISOString();
        
        alert('ðŸŽ Weekly Bonus!\n\n+10 credits added to help you get started.');
        
        // Refresh credit display
        displayCreditBalance();
        
    } catch (error) {
        console.error('âŒ Error checking weekly bonus:', error);
    }
}

// ========== TRANSACTIONS MODAL FUNCTIONS ==========

// Show Transactions Modal
async function showTransactionsModal() {
    const modal = document.getElementById('transactionsModal');
    modal.classList.remove('hidden');
    modal.style.display = 'flex';
    
    await loadTransactions();
}

// Close Transactions Modal
function closeTransactionsModal() {
    const modal = document.getElementById('transactionsModal');
    modal.classList.add('hidden');
    modal.style.display = 'none';
}

// Load and Display Transactions
async function loadTransactions() {
    const listContainer = document.getElementById('transactionsList');
    const totalCreditsEl = document.getElementById('totalCredits');
    const pendingCreditsEl = document.getElementById('pendingCredits');
    
    try {
        // Fetch all transactions for current user
        const { data: transactions, error } = await supabase
            .from('credit_transactions')
            .select('*')
            .eq('user_id', currentProfile.user_id)
            .order('created_at', { ascending: false });
        
        if (error) throw error;
        
        // Calculate pending credits
        let pendingTotal = 0;
        if (transactions) {
            transactions.forEach(t => {
                if (t.status === 'pending' && t.transaction_type === 'credit') {
                    pendingTotal += t.amount;
                }
            });
        }
        
        // Update summary
        totalCreditsEl.textContent = currentProfile.credits || 0;
        pendingCreditsEl.textContent = pendingTotal;
        
        // Display transactions
        if (!transactions || transactions.length === 0) {
            listContainer.innerHTML = `
                <div style="text-align: center; color: #999; padding: 40px;">
                    <div style="font-size: 48px; margin-bottom: 15px;">ðŸ“­</div>
                    <div>No transactions yet</div>
                </div>
            `;
            return;
        }
        
        // Group transactions by date
        const groupedByDate = {};
        transactions.forEach(t => {
            const date = new Date(t.created_at).toLocaleDateString('en-IN', {
                day: 'numeric',
                month: 'short',
                year: 'numeric'
            });
            if (!groupedByDate[date]) groupedByDate[date] = [];
            groupedByDate[date].push(t);
        });
        
        // Build HTML
        let html = '';
        for (const [date, items] of Object.entries(groupedByDate)) {
            html += `<div style="margin-bottom: 20px;">`;
            html += `<div style="font-size: 13px; font-weight: 600; color: #667eea; margin-bottom: 10px; padding-bottom: 5px; border-bottom: 1px solid #e0e0e0;">ðŸ“… ${date}</div>`;
            
            items.forEach(t => {
                const isCredit = t.transaction_type === 'credit';
                const isPending = t.status === 'pending';
                const amountColor = isCredit ? '#28a745' : '#dc3545';
                const amountPrefix = isCredit ? '+' : '-';
                const statusBadge = isPending 
                    ? `<span style="background: #fff3cd; color: #856404; padding: 2px 8px; border-radius: 10px; font-size: 11px; margin-left: 8px;">â³ Pending</span>` 
                    : '';
                
                // Format warranty info for pending
                let warrantyInfo = '';
                if (isPending && t.warranty_expires_at) {
                    const expiryDate = new Date(t.warranty_expires_at).toLocaleDateString('en-IN', {
                        day: 'numeric',
                        month: 'short'
                    });
                    warrantyInfo = `<div style="font-size: 11px; color: #856404; margin-top: 4px;">Available after: ${expiryDate}</div>`;
                }
                
                html += `
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; padding: 12px; background: #f8f9fa; border-radius: 10px; margin-bottom: 8px;">
                        <div style="flex: 1;">
                            <div style="font-size: 14px; color: #333; font-weight: 500;">
                                ${t.description || 'Transaction'}${statusBadge}
                            </div>
                            ${warrantyInfo}
                        </div>
                        <div style="font-size: 16px; font-weight: 700; color: ${amountColor}; white-space: nowrap; margin-left: 10px;">
                            ${amountPrefix}${t.amount}
                        </div>
                    </div>
                `;
            });
            
            html += `</div>`;
        }
        
        listContainer.innerHTML = html;
        
    } catch (error) {
        console.error('Error loading transactions:', error);
        listContainer.innerHTML = `
            <div style="text-align: center; color: #dc3545; padding: 40px;">
                <div style="font-size: 48px; margin-bottom: 15px;">âŒ</div>
                <div>Error loading transactions</div>
            </div>
        `;
    }
}


        // Load Profile
        async function loadProfile() {
    // Prevent infinite loop
    if (window.isLoadingProfile) {
        console.log('âš ï¸ Already loading profile, skipping...');
        return;
    }
    window.isLoadingProfile = true;
    
    console.log('Step 5: loadProfile started');
    showLoading();
    try {
        console.log('Step 6: Fetching profile for user:', currentUser.id);
        const { data, error } = await supabase.from('profiles').select('*').eq('user_id', currentUser.id).single();
        if (error) throw error;
        
        currentProfile = data;
        console.log('Step 7: Profile loaded:', currentProfile);
        displayProfile(data);
console.log('Step 8: Calling showDashboard');
showDashboard();

// âœ… NEW: Start realtime subscriptions after login
await setupRealtimeSubscriptions();
       // âœ… NEW: Request notification permission after login (if provider)
if (currentProfile.is_provider && messaging) {
    setTimeout(() => {
        requestNotificationPermission();
    }, 2000); // Wait 2 seconds after login to request permission
} 
        window.isLoadingProfile = false;  // Reset flag
    } catch (error) {
        window.isLoadingProfile = false;  // Reset flag on error too
        alert('Error loading profile: ' + error.message);
        showLogin();
    }
}

// ========== SETUP REALTIME SUBSCRIPTIONS ==========
async function setupRealtimeSubscriptions() {
    console.log('ðŸ”µ Setting up Realtime subscriptions...');
    
    // Cleanup old subscriptions first
    cleanupRealtimeSubscriptions();
    
    // 1ï¸âƒ£ SUBSCRIBE TO REQUESTS TABLE (New requests, status changes)
    realtimeSubscriptions.requests = supabase
        .channel('requests_channel')
        .on(
            'postgres_changes',
            { 
                event: '*', 
                schema: 'public', 
                table: 'requests'
            },
            (payload) => {
                console.log('ðŸ”” Requests table changed:', payload);
                handleRequestChange(payload);
            }
        )
        .subscribe();
    
    // 2ï¸âƒ£ SUBSCRIBE TO REQUEST_RESPONSES TABLE (New responses from providers)
    realtimeSubscriptions.responses = supabase
        .channel('responses_channel')
        .on(
            'postgres_changes',
            { 
                event: '*', 
                schema: 'public', 
                table: 'request_responses'
            },
            (payload) => {
                console.log('ðŸ”” Responses table changed:', payload);
                handleResponseChange(payload);
            }
        )
        .subscribe();
    
    // 3ï¸âƒ£ SUBSCRIBE TO CHATS TABLE (New messages, contact approvals)
realtimeSubscriptions.chats = supabase
    .channel('chats_channel')
    .on(
        'postgres_changes',
        { 
            event: 'UPDATE',  // â† CHANGED from '*' to 'UPDATE'
            schema: 'public', 
            table: 'chats'
            // Note: We removed the filter because it doesn't work as expected
        },
            (payload) => {
                console.log('ðŸ”” Chats table changed:', payload);
                handleChatChange(payload);
            }
        )
        .subscribe();
    
    // 4ï¸âƒ£ SUBSCRIBE TO PROFILES TABLE (Email verification, profile updates)
    realtimeSubscriptions.profiles = supabase
        .channel('profiles_channel')
        .on(
            'postgres_changes',
            { 
                event: 'UPDATE', 
                schema: 'public', 
                table: 'profiles',
                filter: `user_id=eq.${currentProfile.user_id}`
            },
            (payload) => {
                console.log('ðŸ”” Your profile changed:', payload);
                handleProfileChange(payload);
            }
        )
        .subscribe();
    
    console.log('âœ… Realtime subscriptions active!');
}

// ========== CLEANUP REALTIME SUBSCRIPTIONS ==========
function cleanupRealtimeSubscriptions() {
    console.log('ðŸ§¹ Cleaning up old subscriptions...');
    
    Object.keys(realtimeSubscriptions).forEach(key => {
        if (realtimeSubscriptions[key]) {
            supabase.removeChannel(realtimeSubscriptions[key]);
            realtimeSubscriptions[key] = null;
        }
    });
}

// ========== SOUND NOTIFICATION SYSTEM ==========

// Play notification sound (with browser permission handling)
function playNotificationSound(soundId) {
    try {
        const sound = document.getElementById(soundId);
        if (!sound) {
            console.log('âš ï¸ Sound element not found:', soundId);
            return;
        }
        
        // Reset sound to beginning
        sound.currentTime = 0;
        
        // Try to play
        const playPromise = sound.play();
        
        if (playPromise !== undefined) {
            playPromise
                .then(() => {
                    console.log('ðŸ”Š Sound played:', soundId);
                })
                .catch(error => {
                    console.log('âš ï¸ Sound blocked by browser (user needs to interact first):', error.message);
                });
        }
    } catch (error) {
        console.log('âš ï¸ Sound error:', error.message);
    }
}

// ========== SMART NOTIFICATION - CONTEXT-AWARE SOUND ==========
function playSmartNotification(data) {
    console.log('ðŸ”” playSmartNotification called with:', data);
    
    try {
        // Check if user is currently in THIS specific chat
        const chatView = document.getElementById('chatView');
        const isInThisChat = (
            chatView && 
            !chatView.classList.contains('hidden') &&
            currentChatData &&
            currentChatData.requestId === data.requestId &&
            currentChatData.providerId === data.providerId
        );
        
        if (isInThisChat) {
            // User is IN this chat - play SOFT sound
            console.log('ðŸ”Š Playing SOFT sound (user is in this chat)');
            const inChatSound = document.getElementById('inChatSound');
            if (inChatSound) {
                inChatSound.volume = 0.3; // Soft volume
                inChatSound.currentTime = 0;
                inChatSound.play()
                    .then(() => console.log('âœ… Soft in-chat sound played'))
                    .catch(e => console.log('âš ï¸ Sound blocked:', e.message));
            } else {
                console.log('âš ï¸ inChatSound element not found');
            }
        } else {
            // User is NOT in this chat - play LOUD sound
            console.log('ðŸ”Š Playing LOUD sound (user is elsewhere)');
            const newChatSound = document.getElementById('newChatSound');
            if (newChatSound) {
                newChatSound.volume = 0.7; // Loud volume
                newChatSound.currentTime = 0;
                newChatSound.play()
                    .then(() => console.log('âœ… Loud notification sound played'))
                    .catch(e => console.log('âš ï¸ Sound blocked:', e.message));
            } else {
                console.log('âš ï¸ newChatSound element not found');
            }
        }
        
        // Optional: Show browser notification if supported
        if (Notification.permission === 'granted' && !isInThisChat) {
            new Notification('New Message from ' + data.senderName, {
                body: data.message.substring(0, 100),
                icon: '/android-icon-192x192.png',
                tag: 'helpbuddy-message'
            });
        }
        
    } catch (error) {
        console.error('âŒ Error in playSmartNotification:', error);
    }
}

// Enable sound after first user interaction
let soundEnabled = false;

function enableSoundOnFirstClick() {
    if (!soundEnabled) {
        soundEnabled = true;
        console.log('âœ… Sound notifications enabled after user interaction');
    }
}

// Add listener for first click anywhere (silent activation)
document.addEventListener('click', enableSoundOnFirstClick, { once: true });

// ========== HANDLE REALTIME CHANGES ==========

// Handle changes to REQUESTS table
async function handleRequestChange(payload) {
    const { eventType, new: newRecord, old: oldRecord } = payload;
    
    // If in seeker mode, refresh user requests
    if (currentDashboardMode === 'seeker') {
        console.log('â™»ï¸ Refreshing seeker requests...');
        await loadUserRequests();
    }
    
    // If in provider mode, refresh nearby requests
    if (currentDashboardMode === 'provider' && currentProfile.is_provider) {
        console.log('â™»ï¸ Refreshing provider requests...');
        
        // ðŸ”Š NEW: Play sound if new request appears
        if (eventType === 'INSERT' && newRecord.status === 'open') {
            playNotificationSound('newRequestSound');
        }
        
        await loadNearbyRequests();
        await loadProviderResponses();
        await loadProviderOpenRequests();
    }
}

// Handle changes to REQUEST_RESPONSES table
async function handleResponseChange(payload) {
    const { eventType, new: newRecord, old: oldRecord } = payload;
    
    // If I'm the seeker, refresh my requests (new responses badge)
    if (currentDashboardMode === 'seeker') {
        console.log('â™»ï¸ New response received, refreshing...');
        
        // ðŸ”Š NEW: Play sound if new response received
        if (eventType === 'INSERT') {
            playNotificationSound('newResponseSound');
        }
        
        await loadUserRequests();
    }
    
    // If I'm a provider, refresh my responses
    if (currentDashboardMode === 'provider' && currentProfile.is_provider) {
        console.log('â™»ï¸ Refreshing provider responses...');
        await loadProviderResponses();
        await loadProviderOpenRequests();
    }
}

// Handle changes to CHATS table
async function handleChatChange(payload) {
    const { eventType, new: newRecord, old: oldRecord } = payload;
    
    console.log('ðŸ”” Chats table changed:', eventType);
    
    // âœ… Safety check
    if (!newRecord || !oldRecord) {
        console.log('âŒ Missing record data, exiting');
        return;
    }
    
    // âœ… Check if this chat involves current user
    const isMyChat = (
        newRecord.request_id && 
        newRecord.provider_id &&
        currentUser && 
        currentProfile
    );
    
    if (!isMyChat) {
        console.log('â­ï¸ Skipping - not my chat');
        return;
    }
    
    // âœ… CRITICAL FIX: Check if currently in THIS specific chat
    const chatView = document.getElementById('chatView');
    const isInThisChat = (
        chatView && 
        !chatView.classList.contains('hidden') &&
        currentChatData &&
        currentChatData.requestId === newRecord.request_id &&
        currentChatData.providerId === newRecord.provider_id
    );
    
    // âœ… NUCLEAR FIX: Compare message arrays using JSON.stringify
    const oldMessages = oldRecord?.messages || [];
    const newMessages = newRecord.messages || [];
    
    const oldMessagesHash = JSON.stringify(oldMessages);
    const newMessagesHash = JSON.stringify(newMessages);
    
    console.log('ðŸ“Š Message comparison:', {
        oldCount: oldMessages.length,
        newCount: newMessages.length,
        arraysEqual: oldMessagesHash === newMessagesHash
    });
    
    // If message arrays are EXACTLY the same, it's just a timestamp update - IGNORE IT
    if (oldMessagesHash === newMessagesHash) {
        console.log('â­ï¸ No actual message changes (just timestamp update), skipping');
        
        // Still update badges though (in case unread count changed due to viewing)
        if (currentDashboardMode === 'seeker') {
            await loadUserRequests();
        } else if (currentDashboardMode === 'provider') {
            await loadProviderResponses();
            await loadProviderOpenRequests();
        }
        return;
    }
    
    console.log('âœ… REAL MESSAGE CHANGE DETECTED!');
    
    // If in this chat, refresh messages
    if (isInThisChat) {
        console.log('â™»ï¸ In this chat, refreshing...');
        await loadChatMessages('realtime_refresh');
        return;
    }
    
    // Check if the last message is recent and from someone else
    if (newMessages.length > 0) {
        const lastMessage = newMessages[newMessages.length - 1];
        const lastMessageTime = new Date(lastMessage.timestamp).getTime();
        const now = Date.now();
        
        const isRecentMessage = (now - lastMessageTime) < 10000;
        
        console.log('ðŸ“Š Last message check:', {
            time: new Date(lastMessage.timestamp).toLocaleTimeString(),
            ageSeconds: Math.round((now - lastMessageTime) / 1000),
            isRecent: isRecentMessage,
            fromMe: lastMessage.sender_id === currentUser.id
        });
        
        // Play sound only for recent messages from others
        if (isRecentMessage && lastMessage.sender_id !== currentUser.id) {
            console.log('ðŸ”Š NEW MESSAGE! Playing notification...');
            
            playSmartNotification({
                requestId: newRecord.request_id,
                providerId: newRecord.provider_id,
                senderName: lastMessage.sender_name,
                message: lastMessage.message
            });
            
            // Refresh dashboard
            console.log('â™»ï¸ Updating badges...');
            if (currentDashboardMode === 'seeker') {
                await loadUserRequests();
            } else if (currentDashboardMode === 'provider') {
                await loadProviderResponses();
                await loadProviderOpenRequests();
            }
        }
    }
}

// Handle changes to PROFILES table (your own profile)
async function handleProfileChange(payload) {
    const { eventType, new: newRecord, old: oldRecord } = payload;
    
    console.log('â™»ï¸ Your profile updated, reloading...', payload);
    
    // âœ… Safety check: Make sure we have both old and new records
    if (!oldRecord || !newRecord) {
        console.log('âš ï¸ Incomplete profile data, skipping alert');
        currentProfile = newRecord || currentProfile;
        return;
    }
    
    // Update local profile
    currentProfile = newRecord;
    
    // âœ… ONLY show alert if email_verified actually changed from false to true
    if (
    oldRecord.email_verified === false && 
    newRecord.email_verified === true
) {
    alert('âœ… Email verified successfully! You can now create requests and respond to work.');
        
        // Remove verification banner if exists
        const banner = document.getElementById('verificationBanner');
        if (banner) banner.remove();
    }
    
    // âœ… Silently update display (no alert for other profile changes)
    displayProfile(newRecord);
}

// Handle Password Reset
async function handlePasswordReset() {
    console.log('ðŸ”µ Checking for password reset token...');
    
    const urlParams = new URLSearchParams(window.location.search);
    const hashParams = new URLSearchParams(window.location.hash.substring(1));
    
    const token = urlParams.get('token') || hashParams.get('access_token');
    const type = urlParams.get('type') || hashParams.get('type');
    
    // Check if this is a password reset callback
    if (!token || type !== 'recovery') {
        return false;
    }
    
    console.log('âœ… Password reset token found, showing reset form...');
    
    // Hide all views
    hideAllViews();
    
    // Show password reset view
    const resetView = document.getElementById('passwordResetView');
    if (resetView) {
        resetView.classList.remove('hidden');
        resetView.style.display = 'block';
        resetView.style.visibility = 'visible';
    }
    
    // Clean URL
    window.history.replaceState({}, document.title, '/');
    
    return true;
}

// Password Reset Form Submission
document.addEventListener('DOMContentLoaded', () => {
    const passwordResetForm = document.getElementById('passwordResetForm');
    if (passwordResetForm) {
        passwordResetForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const errorDiv = document.getElementById('passwordResetError');
            const infoDiv = document.getElementById('passwordResetInfo');
            const submitBtn = document.getElementById('resetPasswordBtn');
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmNewPassword').value;
            
            // Hide previous messages
            errorDiv.classList.add('hidden');
            infoDiv.classList.add('hidden');
            
            // Validation
            if (newPassword.length < 6) {
                errorDiv.textContent = 'âŒ Password must be at least 6 characters';
                errorDiv.classList.remove('hidden');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                errorDiv.textContent = 'âŒ Passwords do not match';
                errorDiv.classList.remove('hidden');
                return;
            }
            
            // Disable button
            submitBtn.disabled = true;
            submitBtn.textContent = 'Resetting...';
            
            try {
                const { error } = await supabase.auth.updateUser({
                    password: newPassword
                });
                
                if (error) throw error;
                
                alert('âœ… Password reset successful! Please login with your new password.');
                
                // âœ… CRITICAL FIX: Hide password reset view explicitly
                const passwordResetView = document.getElementById('passwordResetView');
                if (passwordResetView) {
                    passwordResetView.classList.add('hidden');
                    passwordResetView.style.display = 'none';
                }
                
                // Logout and redirect to login
                await supabase.auth.signOut();
                showLogin();
                
            } catch (error) {
                errorDiv.textContent = 'âŒ Error: ' + error.message;
                errorDiv.classList.remove('hidden');
                submitBtn.disabled = false;
                submitBtn.textContent = 'ðŸ”’ Reset Password';
            }
        });
    }
});

let isVerificationInProgress = false;  // NEW

// =====================================================
// REFERRAL BONUS - Award credits when referred user verifies email
// =====================================================

async function awardReferralVerificationBonus(newUserId) {
    try {
        console.log('ðŸŽ Checking for referral bonus...');
        
        // Check if this user was referred by someone
        const { data: referralData, error: referralError } = await supabase
            .from('referrals')
            .select('referrer_id, bonus_awarded')
            .eq('referred_user_id', newUserId)
            .maybeSingle();
        
        if (referralError) {
            console.error('âŒ Error checking referral:', referralError);
            return;
        }
        
        // If no referral exists, or bonus already awarded, skip
        if (!referralData) {
            console.log('â„¹ï¸ No referral found for this user');
            return;
        }
        
        if (referralData.bonus_awarded) {
            console.log('â„¹ï¸ Referral bonus already awarded');
            return;
        }
        
        console.log('âœ… Referral found! Referrer:', referralData.referrer_id);
        
        // Award bonus credits to the referrer
        const REFERRAL_BONUS = 50; // 50 credits bonus
        
        // Get referrer's current credits
        const { data: referrerProfile, error: profileError } = await supabase
            .from('profiles')
            .select('credits')
            .eq('user_id', referralData.referrer_id)
            .single();
        
        if (profileError) {
            console.error('âŒ Error fetching referrer profile:', profileError);
            return;
        }
        
        // Update referrer's credits
        const newCredits = (referrerProfile.credits || 0) + REFERRAL_BONUS;
        
        const { error: updateError } = await supabase
            .from('profiles')
            .update({ credits: newCredits })
            .eq('user_id', referralData.referrer_id);
        
        if (updateError) {
            console.error('âŒ Error updating referrer credits:', updateError);
            return;
        }
        
        // Mark bonus as awarded
        const { error: markError } = await supabase
            .from('referrals')
            .update({ bonus_awarded: true })
            .eq('referred_user_id', newUserId);
        
        if (markError) {
            console.error('âŒ Error marking bonus as awarded:', markError);
            return;
        }
        
        // Log the transaction
        const { error: txError } = await supabase
            .from('credit_transactions')
            .insert({
                user_id: referralData.referrer_id,
                amount: REFERRAL_BONUS,
                transaction_type: 'referral_bonus',
                description: `Referral bonus - User verified email`,
                balance_after: newCredits
            });
        
        if (txError) {
            console.error('âŒ Error logging transaction:', txError);
        }
        
        console.log(`âœ… Awarded ${REFERRAL_BONUS} credits to referrer!`);
        
    } catch (error) {
        console.error('âŒ Error in awardReferralVerificationBonus:', error);
        // Don't throw - we don't want to break email verification if bonus fails
    }
}

// Handle email verification callback
async function handleEmailVerification() {
    console.log('ðŸ”µ Checking for email verification...');
    
    // Check URL for verification tokens
    const urlParams = new URLSearchParams(window.location.search);
    const hashParams = new URLSearchParams(window.location.hash.substring(1));
    
    // Get token from either query params or hash
    const token = urlParams.get('token') || hashParams.get('access_token');
    const type = urlParams.get('type') || hashParams.get('type');
    
    // If no token, not a verification callback
    if (!token || type !== 'signup') {
        return false;
    }

// âœ… NEW: Set flag to prevent race condition
    isVerificationInProgress = true;
    
    console.log('âœ… Verification token found, processing...');
    showLoading();
    
    try {
        // Get the current session (Supabase auto-logs in verified users)
        const { data: { session }, error: sessionError } = await supabase.auth.getSession();
        
        if (sessionError) throw sessionError;
        
        if (!session) {
            throw new Error('No session found after verification');
        }
        
        console.log('âœ… Session found:', session.user.id);
        
        // âœ… NEW: Check if profile exists (it should, because we created it during signup)
        const { data: existingProfile, error: profileError } = await supabase
            .from('profiles')
            .select('email_verified')
            .eq('user_id', session.user.id)
            .maybeSingle();
        
        if (profileError) {
            console.error('âŒ Profile fetch error:', profileError);
            throw new Error('Error loading profile: ' + profileError.message);
        }
        
        if (!existingProfile) {
            // Profile doesn't exist - something went wrong during signup
            throw new Error('Profile not found. Please contact support or try signing up again.');
        }
        
// âœ… Profile exists - just update email_verified flag
console.log('ðŸ“ Updating email_verified flag...');

// Update the email_verified flag in profiles table
const { error: updateError } = await supabase
    .from('profiles')
    .update({ email_verified: true })
    .eq('user_id', session.user.id);

if (updateError) {
    console.error('âŒ Error updating email_verified:', updateError);
    throw new Error('Failed to update verification status: ' + updateError.message);
}

console.log('âœ… Email verified successfully!');

// Award referral bonus to the referrer (if applicable)
await awardReferralVerificationBonus(session.user.id);
        
        // Logout the user (they should login manually after verification)
        await supabase.auth.signOut();
        
        // Clean URL
        window.history.replaceState({}, document.title, '/');
        
        // Show success message
        alert('âœ… Email verified successfully!\n\nðŸŽ‰ Your account is now active.\n\nðŸ‘‰ Please login to access HelpBuddy.');
        
        // Redirect to login page
        showLogin();

 // âœ… NEW: Reset flag after small delay
    setTimeout(() => {
        isVerificationInProgress = false;
    }, 1000);
        
        return true;
        
    } catch (error) {
        console.error('âŒ Verification error:', error);
        
        // Clean URL
        window.history.replaceState({}, document.title, '/');
        
        // Show error and redirect to login
        alert('âŒ Error verifying email: ' + error.message + '\n\nPlease try logging in. If the problem persists, contact support.');
        
        showLogin();
        
        return false;
    }
}

        function displayProfile(profile) {
    // Update header username and photo
    const headerUsername = document.getElementById('headerUsername');
    const headerPhoto = document.getElementById('headerUserPhoto');
    const headerPhotoPlaceholder = document.getElementById('headerUserPhotoPlaceholder');
    
    if (headerUsername) {
        headerUsername.textContent = profile.name;
    }
    
    // Display profile photo in header
    if (profile.profile_photo) {
        headerPhoto.src = profile.profile_photo;
        headerPhoto.style.display = 'block';
        headerPhotoPlaceholder.style.display = 'none';
    } else {
        headerPhoto.style.display = 'none';
        headerPhotoPlaceholder.style.display = 'flex';
    }
}

        // Load Dashboard Data
        async function loadDashboardData() {
    if (currentProfile.is_provider) {
        document.getElementById('providerSection').classList.remove('hidden');
        loadProviderResponses();
	loadProviderOpenRequests();
        loadNearbyRequests();
    }
    
    document.getElementById('seekerSection').classList.remove('hidden');
    loadUserRequests();
}

        // Load User Requests (Seeker View)
        async function loadUserRequests() {
    try {
        const { data, error } = await supabase
            .from('requests')
            .select('*')
            .eq('user_id', currentUser.id)
            .order('created_at', { ascending: false });

        if (error) throw error;

        // Ensure filter is set to 'no_response' on initial load
if (!currentRequestFilter || currentRequestFilter === '') {
    currentRequestFilter = 'no_response';
}

                // Cache the data for fast tab switching
        window.cachedUserRequests = data || [];
        
        await displayUserRequests(window.cachedUserRequests);
                
                const openRequests = (window.cachedUserRequests).filter(r => r.status === 'open');
                document.getElementById('createRequestBtn').disabled = openRequests.length >= 5;
                document.getElementById('requestLimitWarning').classList.toggle('hidden', openRequests.length < 5);
            } catch (error) {
                console.error('Error loading requests:', error);
            }
        }

async function displayUserRequests(requests) {
    // Determine which container to use based on current filter
let container;
if (currentRequestFilter === 'open' || currentRequestFilter === 'no_response' || currentRequestFilter === 'negotiating') {
    container = document.getElementById('openRequestsList');
} else {
    container = document.getElementById('activeRequestsList');
}

    if (!container) {
        console.error('Container not found for filter:', currentRequestFilter);
        return;
    }

    if (requests.length === 0) {
        // Update ALL badge counts first
        const openRequestsTotalEl = document.getElementById('openRequestsTotal');
        const activeRequestsTotalEl = document.getElementById('activeRequestsTotal');
        const respondedCountEl = document.getElementById('respondedCount');
        const inProgressCountEl = document.getElementById('inProgressCount');
        const completedCountEl = document.getElementById('completedCount');

        if (openRequestsTotalEl) openRequestsTotalEl.textContent = '0';
        if (activeRequestsTotalEl) activeRequestsTotalEl.textContent = '0';
        if (respondedCountEl) respondedCountEl.textContent = '0';
        if (inProgressCountEl) inProgressCountEl.textContent = '0';
        if (completedCountEl) completedCountEl.textContent = '0';

        container.innerHTML = `
            <div class="empty-state">
                <div class="empty-state-icon">ðŸ“‹</div>
                <div class="empty-state-text">${t('no_requests_yet')}</div>
                <button class="btn" onclick="showCreateRequestForm()">${t('create_first_request')}</button>
            </div>
        `;
        return;
    }

    // Count statistics

const respondedRequests = [];
const pendingRequests = [];
const responseCountMap = {};
let newMessagesTotal = 0;
let respondedUnreadCount = 0;
let inProgressUnreadCount = 0;  // âœ… NEW: Track in_progress specifically
let pendingUnreadCount = 0;
let completedUnreadCount = 0;
// NEW: Track negotiating-specific counts
let negotiatingNewResponsesTotal = 0;
let negotiatingUnreadMessagesTotal = 0;

// ========== PARALLEL BADGE COUNTING ==========
// Pre-fetch ALL responses and chats in bulk (2 queries instead of N*M)

const openRequestIds = requests.filter(r => r.status === 'open').map(r => r.id);
const activeRequestIds = requests.filter(r => 
    (r.status === 'in_progress' || r.status === 'pending_completion' || r.status === 'completed') && 
    r.selected_provider_id
).map(r => r.id);

// Bulk fetch all responses for open requests
const { data: allResponsesData } = await supabase
    .from('request_responses')
    .select('id, request_id, provider_id, created_at')
    .in('request_id', openRequestIds.length > 0 ? openRequestIds : ['none']);

// Bulk fetch all chats
const allRequestIds = requests.map(r => r.id);
const { data: allChatsData } = await supabase
    .from('chats')
    .select('request_id, provider_id, messages, seeker_last_viewed_at')
    .in('request_id', allRequestIds.length > 0 ? allRequestIds : ['none']);

// Build lookup maps for O(1) access
const responsesByRequest = {};
const chatsByRequestProvider = {};

(allResponsesData || []).forEach(resp => {
    if (!responsesByRequest[resp.request_id]) {
        responsesByRequest[resp.request_id] = [];
    }
    responsesByRequest[resp.request_id].push(resp);
});

(allChatsData || []).forEach(chat => {
    const key = `${chat.request_id}_${chat.provider_id}`;
    chatsByRequestProvider[key] = chat;
});

// Helper function for timestamp normalization
const normalizeToUTC = (timestamp) => {
    if (!timestamp) return null;
    let normalized = timestamp;
    if (typeof timestamp === 'string' && !timestamp.endsWith('Z') && !timestamp.includes('+')) {
        normalized = timestamp + 'Z';
    }
    return new Date(normalized).getTime();
};

// Now process requests using cached data (NO MORE QUERIES IN LOOP!)
for (let req of requests) {
    if (req.status === 'open') {
        const responses = responsesByRequest[req.id] || [];
        const responseCount = responses.length;
        responseCountMap[req.id] = responseCount;
        
        if (responseCount > 0) {
            respondedRequests.push(req.id);
            
            // Calculate new responses count
            if (req.seeker_last_viewed_responses_at) {
                const viewedTime = normalizeToUTC(req.seeker_last_viewed_responses_at);
                const newResponsesCount = responses.filter(r => 
                    normalizeToUTC(r.created_at) > viewedTime
                ).length;
                negotiatingNewResponsesTotal += newResponsesCount;
            } else {
                negotiatingNewResponsesTotal += responseCount;
            }
            
            // Calculate unread messages from all providers
            for (let response of responses) {
                const chatKey = `${req.id}_${response.provider_id}`;
                const chat = chatsByRequestProvider[chatKey];
                
                if (chat && chat.messages) {
                    const lastViewedAt = chat.seeker_last_viewed_at;
                    const unreadFromThisProvider = chat.messages.filter(m => {
                        if (m.sender_id === currentUser.id) return false;
                        if (!lastViewedAt) return true;
                        const messageTime = normalizeToUTC(m.timestamp);
                        const viewedTime = normalizeToUTC(lastViewedAt);
                        return messageTime > viewedTime;
                    }).length;
                    negotiatingUnreadMessagesTotal += unreadFromThisProvider;
                }
            }
        }
    } else if (req.status === 'pending_completion') {
        pendingRequests.push(req.id);
    } else if (req.status === 'completed') {
        respondedRequests.push(req.id);
    }
    
    // Count unread for in_progress, pending_completion, completed
    if ((req.status === 'in_progress' || req.status === 'pending_completion' || req.status === 'completed') && req.selected_provider_id) {
        const chatKey = `${req.id}_${req.selected_provider_id}`;
        const chat = chatsByRequestProvider[chatKey];
        
        if (chat && chat.messages) {
            const lastViewedAt = chat.seeker_last_viewed_at;
            const unread = chat.messages.filter(m => {
                if (m.sender_id === currentUser.id) return false;
                if (!lastViewedAt) return true;
                const messageTime = normalizeToUTC(m.timestamp);
                const viewedTime = normalizeToUTC(lastViewedAt);
                return messageTime > viewedTime;
            }).length;
            
            newMessagesTotal += unread;
            
            if (req.status === 'in_progress') {
                inProgressUnreadCount += unread;
            } else if (req.status === 'pending_completion') {
                pendingUnreadCount += unread;
            } else if (req.status === 'completed') {
                completedUnreadCount += unread;
            }
        }
    }
}

// Store cached data for card rendering
window.cachedResponsesByRequest = responsesByRequest;
window.cachedChatsByRequestProvider = chatsByRequestProvider;
window.cachedNormalizeToUTC = normalizeToUTC;

            // Update section badges
            const completedRequests = requests.filter(r => r.status === 'completed');
const pendingCompletionRequests = requests.filter(r => r.status === 'pending_completion');  // âœ… NEW LINE
const negotiatingRequests = requests.filter(r => 
    respondedRequests.includes(r.id) && 
    r.status === 'open'
);
const openWithoutResponse = requests.filter(r => !respondedRequests.includes(r.id) && !pendingRequests.includes(r.id) && r.status === 'open');
            
            // Update section badges with null checks
const openRequestsTotalEl = document.getElementById('openRequestsTotal');
const activeRequestsTotalEl = document.getElementById('activeRequestsTotal');
const respondedCountEl = document.getElementById('respondedCount');
const inProgressCountEl = document.getElementById('inProgressCount');
const completedCountEl = document.getElementById('completedCount');

// Calculate counts for each category
const openCount = openWithoutResponse.length;
const negotiatingCount = negotiatingRequests.length;
const inProgressCount = requests.filter(r => r.status === 'in_progress').length;
const completedCount = completedRequests.length;

// Update No Response and Negotiating counts
const noResponseCountEl = document.getElementById('noResponseCount');
const negotiatingCountEl = document.getElementById('negotiatingCount');
if (noResponseCountEl) noResponseCountEl.textContent = openCount;
if (negotiatingCountEl) negotiatingCountEl.textContent = negotiatingCount;

// âœ… NEW: Update Negotiating tab badges (new responses + unread messages)
const negotiatingNewResponsesEl = document.getElementById('negotiatingNewResponses');
const negotiatingUnreadEl = document.getElementById('negotiatingUnread');

if (negotiatingNewResponsesEl) {
    if (negotiatingNewResponsesTotal > 0) {
        negotiatingNewResponsesEl.textContent = `ðŸ†• ${negotiatingNewResponsesTotal}`;
        negotiatingNewResponsesEl.classList.remove('hidden');
        negotiatingNewResponsesEl.style.display = 'inline-flex';
    } else {
        negotiatingNewResponsesEl.classList.add('hidden');
        negotiatingNewResponsesEl.style.display = 'none';
    }
}

if (negotiatingUnreadEl) {
    if (negotiatingUnreadMessagesTotal > 0) {
        const unreadBadge = negotiatingUnreadEl.querySelector('.unread-badge');
        if (unreadBadge) unreadBadge.textContent = negotiatingUnreadMessagesTotal;
        negotiatingUnreadEl.classList.remove('hidden');
        negotiatingUnreadEl.style.display = 'inline-flex';
    } else {
        negotiatingUnreadEl.classList.add('hidden');
        negotiatingUnreadEl.style.display = 'none';
    }
}

// âœ… NEW: Update OPEN REQUESTS main heading badges (same counts as Negotiating)
const openRequestsNewResponsesEl = document.getElementById('openRequestsNewResponses');
const openRequestsUnreadEl = document.getElementById('openRequestsUnread');

if (openRequestsNewResponsesEl) {
    if (negotiatingNewResponsesTotal > 0) {
        openRequestsNewResponsesEl.textContent = `ðŸ†• ${negotiatingNewResponsesTotal}`;
        openRequestsNewResponsesEl.classList.remove('hidden');
        openRequestsNewResponsesEl.style.display = 'inline-block';
    } else {
        openRequestsNewResponsesEl.classList.add('hidden');
        openRequestsNewResponsesEl.style.display = 'none';
    }
}

if (openRequestsUnreadEl) {
    if (negotiatingUnreadMessagesTotal > 0) {
        const unreadBadge = openRequestsUnreadEl.querySelector('.unread-badge');
        if (unreadBadge) unreadBadge.textContent = negotiatingUnreadMessagesTotal;
        openRequestsUnreadEl.classList.remove('hidden');
        openRequestsUnreadEl.style.display = 'inline-flex';
    } else {
        openRequestsUnreadEl.classList.add('hidden');
        openRequestsUnreadEl.style.display = 'none';
    }
}

// Update Open Requests heading (no response + negotiating)
const openTotal = openCount + negotiatingCount;
if (openRequestsTotalEl) openRequestsTotalEl.textContent = openTotal;

// Update Active Requests heading (in progress + pending completion + completed)
const activeTotal = inProgressCount + pendingCompletionRequests.length + completedCount;
if (activeRequestsTotalEl) activeRequestsTotalEl.textContent = activeTotal;

// Update individual tab counts (NO MORE respondedCountEl)
if (inProgressCountEl) inProgressCountEl.textContent = inProgressCount;

// Add pending completion count
const pendingCompletionCountEl = document.getElementById('pendingCompletionCount');
if (pendingCompletionCountEl) pendingCompletionCountEl.textContent = pendingCompletionRequests.length;  // âœ… FIXED

if (completedCountEl) completedCountEl.textContent = completedCount;

// Update Active Requests heading unread badge - ONLY show if there are unread messages
const activeRequestsUnreadBadge = document.getElementById('activeRequestsUnreadBadge');
if (activeRequestsUnreadBadge) {
    if (newMessagesTotal > 0) {
        const unreadBadgeSpan = activeRequestsUnreadBadge.querySelector('.unread-badge');
        if (unreadBadgeSpan) unreadBadgeSpan.textContent = newMessagesTotal;
        activeRequestsUnreadBadge.style.display = 'inline-flex';
        activeRequestsUnreadBadge.classList.remove('hidden');
    } else {
        activeRequestsUnreadBadge.style.display = 'none';
        activeRequestsUnreadBadge.classList.add('hidden');
    }
}    
            
            
            // Update main header badge (MY REQUESTS)
try {
    const mainHeaderBadge = document.getElementById('myRequestsUnreadBadge');
    if (mainHeaderBadge) {
        const unreadBadge = mainHeaderBadge.querySelector('.unread-badge');
        if (newMessagesTotal > 0) {
            if (unreadBadge) unreadBadge.textContent = newMessagesTotal;
            mainHeaderBadge.classList.remove('hidden');
            mainHeaderBadge.style.display = 'inline-flex';
        } else {
            mainHeaderBadge.classList.add('hidden');
            mainHeaderBadge.style.display = 'none';
        }
    }
} catch (error) {
    console.log('Badge update error (main):', error);
}

try {
    const inProgressUnreadBadge = document.getElementById('inProgressUnread');
    if (inProgressUnreadBadge) {
        const badge = inProgressUnreadBadge.querySelector('.unread-badge');
        if (inProgressUnreadCount > 0) {  // âœ… FIXED: Use inProgressUnreadCount
            if (badge) badge.textContent = inProgressUnreadCount;
            inProgressUnreadBadge.classList.remove('hidden');
            inProgressUnreadBadge.style.display = 'inline-flex';
        } else {
            inProgressUnreadBadge.classList.add('hidden');
            inProgressUnreadBadge.style.display = 'none';
        }
    }
} catch (error) {
    console.log('Badge update error (in progress):', error);
}

// âœ… NEW: Update Review/Pending Completion tab badge
try {
    const pendingCompletionUnreadBadge = document.getElementById('pendingCompletionUnread');
    if (pendingCompletionUnreadBadge) {
        const badge = pendingCompletionUnreadBadge.querySelector('.unread-badge');
        if (pendingUnreadCount > 0) {
            if (badge) badge.textContent = pendingUnreadCount;
            pendingCompletionUnreadBadge.classList.remove('hidden');
            pendingCompletionUnreadBadge.style.display = 'inline-flex';
        } else {
            pendingCompletionUnreadBadge.classList.add('hidden');
            pendingCompletionUnreadBadge.style.display = 'none';
        }
    }
} catch (error) {
    console.log('Badge update error (pending completion):', error);
}

try {
    const completedUnreadBadge = document.getElementById('completedUnread');
    if (completedUnreadBadge) {
        const badge = completedUnreadBadge.querySelector('.unread-badge');
        if (completedUnreadCount > 0) {
            if (badge) badge.textContent = completedUnreadCount;
            completedUnreadBadge.classList.remove('hidden');
            completedUnreadBadge.style.display = 'inline-flex';
        } else {
            completedUnreadBadge.classList.add('hidden');
            completedUnreadBadge.style.display = 'none';
        }
    }
} catch (error) {
    console.log('Badge update error (completed):', error);
}

            // Filter requests based on current filter
let filteredRequests = requests;
if (currentRequestFilter === 'open' || currentRequestFilter === 'no_response') {
    filteredRequests = openWithoutResponse;
} else if (currentRequestFilter === 'negotiating') {
    filteredRequests = negotiatingRequests;
} else if (currentRequestFilter === 'in_progress') {
    filteredRequests = requests.filter(r => r.status === 'in_progress');
} else if (currentRequestFilter === 'pending_completion') {
    filteredRequests = pendingCompletionRequests;  // âœ… FIXED - use the correct array
    filteredRequests = requests.filter(r => pendingRequests.includes(r.id));
} else if (currentRequestFilter === 'completed') {
    filteredRequests = completedRequests;
}

            if (filteredRequests.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ðŸ“‹</div>
                        <div class="empty-state-text">No ${currentRequestFilter} requests</div>
                    </div>
                `;
                return;
            }

            let html = '';            

            for (let req of filteredRequests) {
                const serviceIcon = SERVICE_ICONS[req.service_id] || 'ðŸ”§';
                const isReactivated = req.status === 'in_progress' && req.warranty_end_date;
                
		const reactivatedBadge = isReactivated ? '<span style="color: #dc3545; font-weight: 700; font-size: 11px; margin-left: 6px; background: #fee; padding: 2px 8px; border-radius: 4px;">' + t('reactivated') + '</span>' : '';
		const statusClass = `status-${req.status.replace('_', '-')}`;
                let statusText = t('status_' + req.status);
                const timeAgo = getTimeAgo(new Date(req.created_at));

                let warrantyBadge = '';
                if (req.status === 'completed' && req.warranty_end_date) {
                    const isSeeker = req.user_id === currentUser.id;
                    const isSelectedProvider = req.selected_provider_id === currentProfile.user_id;
                    
                    if (isSeeker || isSelectedProvider) {
                        const warrantyEndDate = new Date(req.warranty_end_date);
                        const today = new Date();
                        const remainingDays = Math.ceil((warrantyEndDate - today) / (1000 * 60 * 60 * 24));
                        
                        if (remainingDays > 0) {
                            warrantyBadge = `<span class="info-badge" style="background: #28a745;">ðŸ›¡ï¸ ${remainingDays} ${t('days_warranty')}</span>`;
                        } else if (remainingDays === 0) {
                            warrantyBadge = `<span class="info-badge" style="background: #ffc107; color: #333;">ðŸ›¡ï¸ ${t('warranty_expires_today')}</span>`;
                        } else {
                            warrantyBadge = `<span class="info-badge" style="background: #dc3545;">ðŸ›¡ï¸ ${t('warranty_expired')}</span>`;
                        }
                    }
                }

let showChat = false;
let newMessagesCount = 0;
let responseCount = 0;
let showResponses = false;
let isReadOnlyChat = false;
let newResponsesCount = 0;
let totalUnreadFromProviders = 0;

if (req.status === 'open') {
    // ðŸ†• STEP 1: Get deselected providers for this request
    const { data: deselectedProviders } = await supabase
        .from('request_rejected_providers')
        .select('provider_id')
        .eq('request_id', req.id)
        .eq('rejection_reason', 'deselected');
    
    const deselectedSet = new Set((deselectedProviders || []).map(d => d.provider_id));
    
    // ðŸ†• STEP 2: Filter responses to exclude deselected providers
    const allResponses = window.cachedResponsesByRequest[req.id] || [];
    const responses = allResponses.filter(r => !deselectedSet.has(r.provider_id));
    
    // ðŸ†• STEP 3: Use filtered count
    responseCount = responses.length; // âœ… NOW EXCLUDES DESELECTED
    showResponses = responseCount > 0;
    
    const normalizeToUTC = window.cachedNormalizeToUTC;
    
    // Calculate NEW responses count (Badge 1) - FROM FILTERED RESPONSES
    if (responseCount > 0 && req.seeker_last_viewed_responses_at) {
        const viewedTime = normalizeToUTC(req.seeker_last_viewed_responses_at);
        newResponsesCount = responses.filter(r => 
            normalizeToUTC(r.created_at) > viewedTime
        ).length;
    } else if (responseCount > 0 && !req.seeker_last_viewed_responses_at) {
        newResponsesCount = responseCount;
    }
    
    // Calculate total unread messages from ACTIVE providers only (Badge 2)
    if (responseCount > 0) {
        for (let response of responses) {
            const chatKey = `${req.id}_${response.provider_id}`;
            const chat = window.cachedChatsByRequestProvider[chatKey];
            
            if (chat && chat.messages) {
                const lastViewedAt = chat.seeker_last_viewed_at;
                const unreadFromThisProvider = chat.messages.filter(m => {
                    if (m.sender_id === currentUser.id) return false;
                    if (!lastViewedAt) return true;
                    const messageTime = normalizeToUTC(m.timestamp);
                    const viewedTime = normalizeToUTC(lastViewedAt);
                    return messageTime > viewedTime;
                }).length;
                totalUnreadFromProviders += unreadFromThisProvider;
            }
        }
    }
} else if ((req.status === 'in_progress' || req.status === 'pending_completion' || req.status === 'completed') && req.selected_provider_id) {
    showChat = true;
    
    // Use cached chat data instead of query!
    const chatKey = `${req.id}_${req.selected_provider_id}`;
    const chat = window.cachedChatsByRequestProvider[chatKey];
    const normalizeToUTC = window.cachedNormalizeToUTC;
    
    if (chat && chat.messages) {
        const lastViewedAt = chat.seeker_last_viewed_at;
        newMessagesCount = chat.messages.filter(m => {
            if (m.sender_id === currentUser.id) return false;
            if (!lastViewedAt) return true;
            const messageTime = normalizeToUTC(m.timestamp);
            const viewedTime = normalizeToUTC(lastViewedAt);
            return messageTime > viewedTime;
        }).length;
    }
    
    // Check if completed request warranty/grace period expired
    if (req.status === 'completed') {
        if (req.warranty_period === 0 || req.warranty_period === null) {
            const completionDate = new Date(req.warranty_end_date);
            const gracePeriodEndDate = new Date(completionDate);
            gracePeriodEndDate.setDate(gracePeriodEndDate.getDate() + 7);
            const currentDate = new Date();
            if (currentDate > gracePeriodEndDate) {
                isReadOnlyChat = true;
            }
        } else if (req.warranty_period > 0) {
            const warrantyEndDate = new Date(req.warranty_end_date);
            const currentDate = new Date();
            if (currentDate > warrantyEndDate) {
                isReadOnlyChat = true;
            }
        }
    }
}

                let reactivateButton = '';
                if (req.status === 'completed' && req.warranty_end_date) {
                    const warrantyEndDate = new Date(req.warranty_end_date);
                    const today = new Date();
                    if (warrantyEndDate > today) {
                        reactivateButton = `<button class="btn btn-select action-btn-compact" onclick="reactivateRequest('${req.id}')" style="background: #dc3545 !important;">ðŸ”„ ${t('btn_reactivate')}</button>`;
                    }
                }
                                
                // Build responses badge with NEW count and UNREAD count
let responsesBadge = '';
if (showResponses) {
    const newBadge = newResponsesCount > 0 ? `<span class="info-badge" style="background: #dc3545; color: white;">ðŸ†• ${newResponsesCount}</span>` : '';
    const unreadBadge = totalUnreadFromProviders > 0 ? `
        <span class="badge-container" style="display: inline-flex; position: relative; margin-left: 8px;">
            <span class="chat-bubble-icon"></span>
            <span class="unread-badge">${totalUnreadFromProviders}</span>
        </span>
    ` : '';
responsesBadge = `<span class="info-badge">ðŸ‘¥ ${responseCount} ${t('response')}${responseCount > 1 ? '' : ''}</span>${newBadge}${unreadBadge}`;
}

html += `
    <div class="request-card compact">
        <div class="request-card-main">
            <div class="request-card-left">
                <div class="request-title-compact" onclick="toggleRequestDetails(event, '${req.id}')">
                    <span class="urgency-bubble ${req.urgency}"></span>
                    <span class="request-title-text">${serviceIcon} ${req.title}${reactivatedBadge}</span>
                    <span class="request-chevron" id="chevron-${req.id}">â–¼</span>
                </div>
                <div class="request-summary" style="display: flex !important; justify-content: space-between !important; width: 100% !important; align-items: center !important;">
    <span class="status-badge ${statusClass}">${statusText}</span>
    ${showResponses ? `
        <button class="btn btn-select btn-select-mobile" onclick="viewResponses('${req.id}')" style="margin-left: auto !important; flex-shrink: 0 !important;">
            ðŸ‘ï¸ ${t('btn_view_responses')}
        </button>
    ` : ''}
${showChat ? `
    <div class="chat-btn-wrapper" style="margin-left: auto !important;">
        <button class="btn ${isReadOnlyChat ? 'btn-view-profile' : 'btn-chat'}" onclick="openChat('${req.id}', '${req.selected_provider_id}', ${isReadOnlyChat})">${isReadOnlyChat ? 'ðŸ‘ï¸ ' + t('view_chat') : 'ðŸ’¬ ' + t('chat')}</button>
        ${newMessagesCount > 0 && !isReadOnlyChat ? `<span class="chat-unread-badge">${newMessagesCount}</span>` : ''}
    </div>
` : ''}
</div>
${responsesBadge ? `<div class="request-summary">${responsesBadge}</div>` : ''}
${warrantyBadge || reactivateButton ? `
<div class="request-summary" style="display: flex !important; justify-content: space-between !important; align-items: center !important; width: 100% !important; margin-top: 8px !important;">
    ${warrantyBadge ? `<span>${warrantyBadge}</span>` : '<span></span>'}
    ${reactivateButton ? `<span style="margin-left: auto !important;">${reactivateButton}</span>` : ''}
</div>
` : ''}
<div class="request-summary" style="margin-top: 6px; color: #999;">
    ðŸ“ ${req.request_location_address.split(',').slice(0, 2).join(',')} â€¢ ðŸ•’ ${timeAgo}
</div>
                            </div>
                            <div class="request-card-right">
    ${showChat ? `
    <div class="chat-btn-wrapper">
        <button class="btn btn-chat action-btn-compact" onclick="chatOpenedFrom='responses-modal'; closeResponsesModal(); openChat('${req.id}', '${req.selected_provider_id}')">${'ðŸ’¬ ' + t('chat')}</button>
        ${newMessagesCount > 0 ? `<span class="chat-unread-badge">${newMessagesCount}</span>` : ''}
    </div>
` : ''}
    ${reactivateButton}
</div>

</div>
    <div class="request-details" id="details-${req.id}">
        <div class="request-description"><strong>${t('description')}:</strong> ${req.description}</div>
        <div class="request-location" style="margin-top: 8px;"><strong>${t('full_address')}:</strong> ${req.request_location_address}</div>
        <div class="request-meta" style="margin-top: 8px;">
            <span class="meta-item">ðŸ”§ ${t('service_label')}: ${req.service_id}</span>
            <span class="meta-item">âš¡ ${t('urgency_label')}: ${t(req.urgency)}</span>
        </div>
        
        ${req.status === 'open' ? `
            <div style="display: flex; gap: 10px; margin-top: 16px; padding-top: 16px; border-top: 1px solid #f0f0f0;">
                ${responseCount === 0 ? `
                    <button class="btn" style="flex: 1; background: #128C7E; color: white;" onclick="editRequest('${req.id}')">âœï¸ ${t('btn_edit_request')}</button>
                ` : ''}
                <button class="btn btn-cancel" style="flex: 1;" onclick="cancelRequest('${req.id}')">âŒ ${t('btn_cancel_request')}</button>
            </div>
        ` : ''}
        
        ${(req.status === 'in_progress' || req.status === 'pending_completion') && req.selected_provider_id ? `
            <div style="display: flex; gap: 10px; margin-top: 16px; padding-top: 16px; border-top: 1px solid #f0f0f0;">
                <button class="btn" style="flex: 1; background: #ff9800; color: white;" onclick="changeProvider('${req.id}', '${req.selected_provider_id}')">ðŸ”„ ${t('btn_change_provider')}</button>
            </div>
        ` : ''}
    </div>
</div>
`;
            }
            
            if (container) {
                container.innerHTML = html;
            } else {
                console.error('Container still null after rendering. Filter:', currentRequestFilter);
            }
        }
            

        // Helper function for time ago
        function getTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            if (seconds < 60) return 'Just now';
            const minutes = Math.floor(seconds / 60);
            if (minutes < 60) return `${minutes}m ago`;
            const hours = Math.floor(minutes / 60);
            if (hours < 24) return `${hours}h ago`;
            const days = Math.floor(hours / 24);
            if (days < 7) return `${days}d ago`;
            return date.toLocaleDateString();
        }

        // Toggle request details
function toggleRequestDetails(event, requestId) {
    event.stopPropagation();
    const details = document.getElementById('details-' + requestId);
    const chevron = document.getElementById('chevron-' + requestId);
    
    if (!details || !chevron) return; // Safety check
    
    if (details.classList.contains('expanded')) {
        details.classList.remove('expanded');
        chevron.classList.remove('expanded');
    } else {
        details.classList.add('expanded');
        chevron.classList.add('expanded');
    }
}

// Open Chat
async function openChat(requestId, providerId, isReadOnly = false) {
    try {
        if (!currentUser || !currentProfile) {
            alert(t('session_expired_login_again'));
            showLogin();
            return;
        }
        
        showLoading();
        
        // Load request details
        const { data: request, error: reqError } = await supabase
            .from('requests')
            .select('*')
            .eq('id', requestId)
            .single();
        
        if (reqError) {
            console.error('âŒ Request fetch error:', reqError);
            throw reqError;
        }
        
        // CHECK IF CHAT EXISTS - if not, create it

        const { data: existingChat, error: chatCheckError } = await supabase
            .from('chats')
            .select('id')
            .eq('request_id', requestId)
            .eq('provider_id', providerId)
            .maybeSingle();

        // If no chat exists, create one
        if (!existingChat) {
            const { error: createError } = await supabase
                .from('chats')
                .insert([{
                    request_id: requestId,
                    provider_id: providerId,
                    messages: []
                }]);
            
            if (createError) {
                console.error('âŒ Error creating chat:', createError);
            } else {
            }
        } else {
        }
        
        // CRITICAL FIX: Determine partner ID based on who is viewing
        let partnerId;
        let partnerProfile;
        
        // If current user is the SEEKER (request owner)
        if (currentProfile.user_id === request.user_id) {
            
            // Partner is the PROVIDER
            partnerId = providerId;
            
            const { data: providerData, error: providerError } = await supabase
                .from('profiles')
                .select('*')
                .eq('user_id', providerId)
                .maybeSingle();
            
            if (providerError) {
                console.error('âŒ Provider fetch error:', providerError);
                alert(`âŒ ${t('error_loading_provider_profile')}: ${providerError.message}`);
                showDashboard();
                return;
            }
            
            if (!providerData) {
                console.error('âŒ Provider profile not found');
                alert(`âŒ ${t('provider_profile_not_found')}`);
                showDashboard();
                return;
            }
            
            partnerProfile = providerData;
        } 
        // If current user is the PROVIDER
        else {
            
            // Partner is the SEEKER (request owner)
            partnerId = request.user_id;
            
            const { data: seekerData, error: seekerError } = await supabase
                .from('profiles')
                .select('*')
                .eq('user_id', request.user_id)
                .maybeSingle();
            
            if (seekerError) {
                console.error('âŒ Seeker fetch error:', seekerError);
                alert(`âŒ ${t('error_loading_seeker_profile')}: ${seekerError.message}`);
                showDashboard();
                return;
            }
            
            if (!seekerData) {
                console.error('âŒ Seeker profile not found');
                alert(`âŒ ${t('seeker_profile_not_found')}`);
                showDashboard();
                return;
            }
            
            partnerProfile = seekerData;
        }
        
        // Determine chat source
        const chatSource = (currentProfile.user_id === providerId) ? 'myResponses' : 'myRequests';
        // Check if we're opening chat from responses modal
	const responsesModalOpen = document.getElementById('responsesModal').classList.contains('active');
console.log('ðŸ”µ openChat - responsesModal is active?', responsesModalOpen);
if (responsesModalOpen) {
    chatOpenedFrom = 'responses-modal';  // âœ… Set ONLY when coming from modal
    console.log('ðŸ”µ openChat - SET chatOpenedFrom to:', chatOpenedFrom);
} else {
    chatOpenedFrom = null;  // âœ… Clear otherwise
    console.log('ðŸ”µ openChat - CLEARED chatOpenedFrom (set to null)');
}
console.log('ðŸ”µ openChat - FINAL chatOpenedFrom value:', chatOpenedFrom);
        // âœ… CRITICAL FIX: Determine if current user is provider or seeker
const isCurrentUserTheSeeker = currentProfile.user_id === request.user_id;
const isCurrentUserTheProvider = currentProfile.user_id === providerId;

console.log('ðŸ”µ Chat role check:', {
    currentUserId: currentProfile.user_id,
    requestOwnerId: request.user_id,
    providerId: providerId,
    isSeeker: isCurrentUserTheSeeker,
    isProvider: isCurrentUserTheProvider
});

currentChatData = {
    requestId: requestId,
    providerId: providerId,
    partnerName: partnerProfile.name,
    partnerId: partnerId,
    isProvider: isCurrentUserTheProvider && !isCurrentUserTheSeeker,
    requestStatus: request.status,
    chatSource: chatSource
};
        
        // Update chat header (while still showing loading)
        document.getElementById('chatPartnerName').textContent = partnerProfile.name;
        document.getElementById('chatRequestStatus').textContent = request.status.replace('_', ' ').toUpperCase();

        // Update profile photo
        if (partnerProfile.profile_photo) {
            document.getElementById('chatPartnerPhoto').src = partnerProfile.profile_photo;
            document.getElementById('chatPartnerPhoto').style.display = 'block';
            document.getElementById('chatPartnerPhotoPlaceholder').style.display = 'none';
        } else {
            document.getElementById('chatPartnerPhoto').style.display = 'none';
            document.getElementById('chatPartnerPhotoPlaceholder').style.display = 'flex';
        }
        
// Load messages BEFORE showing chat view
// await loadChatMessages(); // âŒ COMMENTED OUT - moved to after read-only state is set
        // Mark chat as viewed
        try {
            const viewedField = currentChatData.isProvider ? 'provider_last_viewed_at' : 'seeker_last_viewed_at';
            
            const { error: viewError } = await supabase
                .from('chats')
                .update({ [viewedField]: new Date().toISOString() })
                .eq('request_id', currentChatData.requestId)
                .eq('provider_id', currentChatData.providerId);
            
            if (viewError) {
                console.error('âš ï¸ Error marking chat as viewed:', viewError);
            } else {
            }
        } catch (error) {
            console.error('âš ï¸ Error updating last viewed timestamp:', error);
        }

        // Check contact sharing status and button visibility
        const { data: chatData } = await supabase
            .from('chats')
            .select('messages')
            .eq('request_id', currentChatData.requestId)
            .eq('provider_id', currentChatData.providerId)
            .maybeSingle();

        const contactAlreadyApproved = chatData?.messages?.some(m => 
            m.message_type === 'contact_request' && 
            m.contact_request_status === 'approved'
        );
        const { data: latestRequest } = await supabase
            .from('requests')
            .select('status, selected_provider_id')
            .eq('id', currentChatData.requestId)
            .single();

        const acceptBtn = document.getElementById('acceptCompletionBtn');
        const rejectBtn = document.getElementById('rejectCompletionBtn');
        const markCompleteBtn = document.getElementById('markCompleteBtn');

        if (markCompleteBtn) markCompleteBtn.style.display = 'none';
        if (acceptBtn) acceptBtn.style.display = 'none';
        if (rejectBtn) rejectBtn.style.display = 'none';

        if (latestRequest) {
            if (currentChatData.isProvider && 
    (latestRequest.status === 'in_progress' || latestRequest.status === 'pending_completion') &&  // âœ… ALSO CHECK pending_completion
    latestRequest.selected_provider_id === currentProfile.user_id) {
    // âœ… Only show button if status is EXACTLY 'in_progress' (not pending)
    if (latestRequest.status === 'in_progress' && markCompleteBtn) {
        markCompleteBtn.style.display = 'inline-block';
    }
  }
}

        // Handle read-only mode for non-selected providers OR missed opportunities OR deselected providers
const isNonSelectedProvider = currentChatData.isProvider && 
                              latestRequest && 
                              (latestRequest.status === 'in_progress' || 
                               latestRequest.status === 'completed' || 
                               latestRequest.status === 'pending_completion') && 
                              latestRequest.selected_provider_id !== currentProfile.user_id;

// âœ… NEW: Check if provider is DESELECTED (in rejected table)
let isDeselectedProvider = false;
if (currentChatData.isProvider) {
    const { data: rejectionCheck } = await supabase
        .from('request_rejected_providers')
        .select('id')
        .eq('request_id', currentChatData.requestId)
        .eq('provider_id', currentProfile.user_id)
        .maybeSingle();
    
    isDeselectedProvider = !!rejectionCheck;
    
    if (isDeselectedProvider) {
        console.log('âš ï¸ Provider is DESELECTED (in rejection table)');
    }
}

// âœ… NEW: Check if chat is marked as read-only (provider stopped service)
const { data: chatReadOnlyCheck } = await supabase
    .from('chats')
    .select('is_read_only, read_only_reason')
    .eq('request_id', requestId)
    .eq('provider_id', providerId)
    .maybeSingle();

const isProviderStoppedService = chatReadOnlyCheck?.is_read_only && 
                                  chatReadOnlyCheck?.read_only_reason === 'provider_stopped_service';

console.log('ðŸ” Read-only check:', {
    isReadOnly,
    isNonSelectedProvider,
    isDeselectedProvider,
    isProviderStoppedService,
    reason: chatReadOnlyCheck?.read_only_reason
});

// âœ… Store read-only state in currentChatData
currentChatData.isReadOnly = isReadOnly || isProviderStoppedService || false;
currentChatData.isNonSelectedProvider = isNonSelectedProvider || false;
currentChatData.isDeselectedProvider = isDeselectedProvider || false;
currentChatData.isProviderStoppedService = isProviderStoppedService || false;

// âœ… FIX: Reload chat messages NOW that read-only state is set
await loadChatMessages();

if (isNonSelectedProvider || isReadOnly || isDeselectedProvider || isProviderStoppedService) {
    // âœ… DETERMINE THE REASON FOR READ-ONLY MODE
    let readOnlyReason = '';
    let statusText = '';
    
    if (isDeselectedProvider) {
        // This provider was DESELECTED by the seeker
        readOnlyReason = t('read_only_deselected');
        statusText = t('status_readonly_deselected');
        console.log('âš ï¸ Read-only mode enabled (deselected provider)');
    } else if (isProviderStoppedService) {
        // Provider stopped providing this service
        readOnlyReason = t('read_only_provider_stopped');
        statusText = t('status_readonly_provider_stopped');
        console.log('âš ï¸ Read-only mode enabled (provider stopped service)');
    } else if (isNonSelectedProvider) {
        // This is a missed opportunity (another provider was selected)
        readOnlyReason = t('read_only_assigned_other');
        statusText = t('status_readonly_assigned_other');
        console.log('âš ï¸ Read-only mode enabled (non-selected provider)');
    } else if (isReadOnly) {
        // This is a completed request with expired warranty
        readOnlyReason = t('read_only_warranty_expired');
        statusText = t('status_readonly_warranty_expired');
        console.log('âš ï¸ Read-only mode enabled (warranty expired)');
    }
    
    // Apply read-only mode
    const messageInput = document.getElementById('chatMessageInput');
    const sendBtn = document.querySelector('.chat-input-wrapper .btn-send');
    const templateBtn = document.querySelector('.template-button');
    const plusBtn = document.querySelector('.plus-button');
    const actionButtons = document.querySelector('.chat-action-buttons');
    
    if (messageInput) {
        messageInput.disabled = true;
        messageInput.placeholder = readOnlyReason; // âœ… Context-aware message
        messageInput.style.background = '#f0f0f0';
        messageInput.style.cursor = 'not-allowed';
    }
    
    if (sendBtn) sendBtn.style.display = 'none';
    if (templateBtn) templateBtn.style.display = 'none';
    if (plusBtn) plusBtn.style.display = 'none';
    if (actionButtons) actionButtons.style.display = 'none';
    
    const chatStatus = document.getElementById('chatRequestStatus');
    if (chatStatus) {
        chatStatus.textContent = statusText; // âœ… Context-aware status
        chatStatus.style.color = '#dc3545';
    }
} else {
    // âœ… NON-READ-ONLY MODE: Restore all chat functionality
    const messageInput = document.getElementById('chatMessageInput');
    const sendBtn = document.querySelector('.chat-input-wrapper .btn-send');
    const templateBtn = document.querySelector('.template-button');
    const plusBtn = document.querySelector('.plus-button');
    const actionButtons = document.querySelector('.chat-action-buttons');
    
    // Re-enable input box
    if (messageInput) {
        messageInput.disabled = false;
        messageInput.placeholder = t('type_your_message');
        messageInput.style.background = 'white';
        messageInput.style.cursor = 'text';
    } else {
    // âœ… NON-READ-ONLY MODE: Restore all chat functionality
    const messageInput = document.getElementById('chatMessageInput');
    const sendBtn = document.querySelector('.chat-input-wrapper .btn-send');
    const templateBtn = document.querySelector('.template-button');
    const plusBtn = document.querySelector('.plus-button');
    const actionButtons = document.querySelector('.chat-action-buttons');
    
    // Re-enable input box
    if (messageInput) {
        messageInput.disabled = false;
        messageInput.placeholder = 'Type your message...';
        messageInput.style.background = 'white';
        messageInput.style.cursor = 'text';
    }
    
    // âœ… RESTORE BUTTONS: Remove inline display styles (let CSS and toggle function handle it)
    if (plusBtn) plusBtn.style.display = ''; // Remove inline style
    
    // âœ… RESTORE TEMPLATE BUTTON: Remove inline style and hide class
    if (templateBtn) {
        templateBtn.style.display = ''; // Remove inline style
        templateBtn.classList.remove('hide'); // Ensure hide class is removed
    }
    
    // âœ… RESTORE SEND BUTTON: Remove inline style and show class
    if (sendBtn) {
        sendBtn.style.display = ''; // Remove inline style
        sendBtn.classList.remove('show'); // Ensure show class is removed
    }
    
    // âœ… RESTORE ACTION BUTTONS
    if (actionButtons) actionButtons.style.display = '';
    
    // âœ… TRIGGER TOGGLE TO SET CORRECT INITIAL STATE
    toggleSendButton();
}

// âœ…âœ…âœ… NEW CODE BLOCK - ADD AFTER THE ENTIRE if/else BLOCK:
// Handle contact button visibility based on read-only state
const contactDetailsHeaderBtn = document.getElementById('contactDetailsHeaderBtn');
const requestContactBtn = document.querySelector('.btn-contact');

if (contactDetailsHeaderBtn || requestContactBtn) {
    // Check if contact was approved in chat history
    const contactApproved = chatData?.messages?.some(m => 
        m.message_type === 'contact_request' && 
        m.contact_request_status === 'approved'
    );
    
    // Determine if chat is read-only
    const isChatReadOnly = isReadOnly || isNonSelectedProvider;
    
    // Set button visibility
    if (contactApproved && !isChatReadOnly) {
        // Show contact button only if approved AND not read-only
        if (contactDetailsHeaderBtn) contactDetailsHeaderBtn.style.display = 'inline-block';
        if (requestContactBtn) requestContactBtn.style.display = 'none';
    } else {
        // Hide contact button
        if (contactDetailsHeaderBtn) contactDetailsHeaderBtn.style.display = 'none';
        // Show request button only if not read-only
        if (requestContactBtn) {
            requestContactBtn.style.display = isChatReadOnly ? 'none' : 'inline-block';
        }
    }
}
    
    // âœ… RESTORE BUTTONS: Remove inline display styles (let CSS and toggle function handle it)
    if (plusBtn) plusBtn.style.display = ''; // Remove inline style
    
    // âœ… RESTORE TEMPLATE BUTTON: Remove inline style and hide class
    if (templateBtn) {
        templateBtn.style.display = ''; // Remove inline style
        templateBtn.classList.remove('hide'); // Ensure hide class is removed
    }
    
    // âœ… RESTORE SEND BUTTON: Remove inline style and show class
    if (sendBtn) {
        sendBtn.style.display = ''; // Remove inline style
        sendBtn.classList.remove('show'); // Ensure show class is removed
    }
    
    // âœ… RESTORE ACTION BUTTONS
    if (actionButtons) actionButtons.style.display = '';
    
    // âœ… TRIGGER TOGGLE TO SET CORRECT INITIAL STATE
    toggleSendButton();
}
        
        // â­ CRITICAL FIX: Show chat view ONLY AFTER everything is loaded

// Hide all main views EXCEPT dashboardView (because chatView is inside it)
const viewsToHide = ['loginView', 'signupView', 'createRequestView', 
                     'editRequestView', 'editProfileView', 'loadingView'];
viewsToHide.forEach(viewId => {
    const view = document.getElementById(viewId);
    if (view) {
        view.classList.add('hidden');
        view.style.display = 'none';
    }
});

// Hide only header controls (keep dashboard sections visible in background)
const createRequestBtn = document.getElementById('createRequestBtn');
const userMenu = document.querySelector('.user-menu');
const modeToggleBtn = document.getElementById('modeToggleBtn');

if (createRequestBtn) createRequestBtn.style.display = 'none';
if (userMenu) userMenu.style.display = 'none';
if (modeToggleBtn) modeToggleBtn.style.display = 'none';
if (modeToggleBtn) modeToggleBtn.style.display = 'none'; // Hide toggle button when chat is open



// Keep dashboardView visible (parent container)
const dashboardView = document.getElementById('dashboardView');
if (dashboardView) {
    dashboardView.classList.remove('hidden');
    dashboardView.style.display = 'block';
}

// Show chatView
const chatView = document.getElementById('chatView');
if (chatView) {
    chatView.classList.remove('hidden');
    chatView.style.display = 'block';
    chatView.style.visibility = 'visible';
}
        
        // Start auto-refresh
        if (chatRefreshInterval) clearInterval(chatRefreshInterval);
        chatRefreshInterval = setInterval(() => loadChatMessages('realtime_refresh'), 5000);
        
    } catch (error) {
        console.error('âŒ âŒ âŒ ERROR OPENING CHAT:', error);
        alert('Error opening chat: ' + error.message);
        showDashboard();
    }
}

// âœ… NEW: Helper function to detect new messages
function getNewMessages(oldMessages, newMessages) {
    if (!oldMessages || oldMessages.length === 0) {
        return []; // First load, no "new" messages yet
    }
    
    // Find messages in newMessages that are NOT in oldMessages
    const newOnes = newMessages.filter(newMsg => {
        const exists = oldMessages.some(oldMsg => 
            oldMsg.timestamp === newMsg.timestamp && 
            oldMsg.sender_id === newMsg.sender_id &&
            oldMsg.message === newMsg.message
        );
        return !exists;
    });
    
    return newOnes;
}

// Load Chat Messages
async function loadChatMessages() {
    // âœ… CRITICAL FIX: Only update timestamp if we're VIEWING the chat (not just refreshing)
    const chatView = document.getElementById('chatView');
    const isChatVisible = chatView && !chatView.classList.contains('hidden');
    
    // ðŸ†• NEW: Add flag to prevent timestamp update during Realtime refresh
    const isRealtimeRefresh = arguments[0] === 'realtime_refresh';
    
    if (currentChatData && currentProfile && isChatVisible && !isRealtimeRefresh) {
        const now = new Date().toISOString();
        
        console.log('ðŸ”µ Updating timestamp (User actively viewing chat)');
        
        try {
            if (currentChatData.isProvider) {
                // PROVIDER viewing: Update provider_last_viewed_at for THIS provider only
                const { data: result, error } = await supabase
                    .from('chats')
                    .update({ provider_last_viewed_at: now })
                    .eq('request_id', currentChatData.requestId)
                    .eq('provider_id', currentProfile.user_id)
                    .select();
                
                if (error) {
                    console.error('âŒ Provider timestamp update FAILED:', error);
                } else if (!result || result.length === 0) {
                    console.error('âŒ Provider timestamp matched ZERO rows');
                } else {
                    console.log('âœ… Provider timestamp updated:', result[0].provider_last_viewed_at);
                }
            } else {
                // SEEKER viewing: Update seeker_last_viewed_at ONLY for the current provider
                const { data: result, error } = await supabase
                    .from('chats')
                    .update({ seeker_last_viewed_at: now })
                    .eq('request_id', currentChatData.requestId)
                    .eq('provider_id', currentChatData.providerId)
                    .select();
                
                if (error) {
                    console.error('âŒ Seeker timestamp update FAILED:', error);
                } else if (!result || result.length === 0) {
                    console.error('âŒ Seeker timestamp matched ZERO rows');
                } else {
                    console.log('âœ… Seeker timestamp updated:', result[0].seeker_last_viewed_at);
                }
            }
        } catch (err) {
            console.error('âš ï¸ Timestamp update error:', err);
        }
    } else if (isRealtimeRefresh) {
        console.log('â­ï¸ Skipping timestamp update (Realtime refresh)');
    }
    
    try {
        const { data: chats, error } = await supabase

            .from('chats')
            .select('messages')
            .eq('request_id', currentChatData.requestId)
            .eq('provider_id', currentChatData.providerId)
            .maybeSingle();
        
        const chat = chats;
        
        if (error) {
            console.error('Error fetching chat:', error);
            return;
        }
        
        const messages = chat?.messages || [];
        
        // âœ… CHECK FIRST LOAD BEFORE STORING (important!)
        const isFirstLoad = previousMessages.length === 0 || window.lastLoadedChatId !== currentChatData.requestId;
        
        // âœ… NEW: Detect new messages
        const newMessages = getNewMessages(previousMessages, messages);
        console.log('ðŸ”” New messages detected:', newMessages.length, newMessages); // â­ TEMPORARY TEST LINE
        
        // âœ… NEW: Check if this is a different chat than last time
        const isDifferentChat = previousMessages.length > 0 && 
                               currentChatData.requestId !== window.lastLoadedChatId;
        
        // âœ… FIX FLICKERING: If no new messages and not a different chat, skip DOM update
        // BUT allow first load
        if (newMessages.length === 0 && !isDifferentChat && !isFirstLoad) {
            console.log('âœ… No new messages, skipping DOM update (no flicker)');
            return; // Exit early - don't touch DOM
        }
        
        if (isFirstLoad) {
            console.log('ðŸ†• First load - displaying all messages');
        }
        
        // âœ… NEW: Store current messages for next comparison (AFTER the check)
        previousMessages = [...messages];
        window.lastLoadedChatId = currentChatData.requestId;
        
        if (newMessages.length === 0 && !isDifferentChat && !isFirstLoad) {
            console.log('âœ… No new messages, skipping DOM update (no flicker)');
            return; // Exit early - don't touch DOM
        }
        
        if (isFirstLoad) {
            console.log('ðŸ†• First load - displaying all messages');
        }
        const container = document.getElementById('chatMessages'); // âœ… MOVED UP - DEFINED BEFORE USE
        
        // If no chat exists and user is non-selected provider, show empty state
        if (!chat && currentChatData.isProvider && currentChatData.requestStatus === 'in_progress') {
            container.innerHTML = '<div class="empty-chat-state"><div class="empty-chat-state-text">No chat history available.</div></div>';
            return;
        }
        
        if (messages.length === 0) {
            container.innerHTML = '<div class="empty-chat-state"><div class="empty-chat-state-text">No messages yet. Start the conversation!</div></div>';
            return;
        }
        
        let html = '';
        messages.forEach((msg, index) => {
            const isSent = msg.sender_id === currentUser.id;
            const messageClass = isSent ? 'sent' : 'received';
            const time = new Date(msg.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            // Handle contact request messages
            if (msg.message_type === 'contact_request') {
                const status = msg.contact_request_status || 'pending';
                let cardClass = 'contact-request-card';
                let statusHTML = '';
                
                if (status === 'approved') {
                    cardClass += ' contact-status-approved';
                    statusHTML = '<p style="margin-top: 10px; font-weight: 600;">âœ… Approved - Contact details visible below</p>';
                } else if (status === 'declined') {
                    cardClass += ' contact-status-declined';
                    statusHTML = '<p style="margin-top: 10px; font-weight: 600;">âŒ Declined</p>';
                } else if (!isSent && status === 'pending') {
                    statusHTML = `
                        <div class="contact-approval-buttons">
                            <button class="btn-approve" onclick="approveContactSharing(${index})">âœ… Approve</button>
                            <button class="btn-decline" onclick="declineContactSharing(${index})">âŒ Decline</button>
                        </div>
                    `;
                } else if (isSent && status === 'pending') {
                    statusHTML = '<p style="margin-top: 10px; color: #856404; font-size: 12px;">â³ Waiting for approval...</p>';
                }
                
                html += `
                    <div class="${cardClass}" style="margin: 15px 0;">
                        <div class="contact-request-title">ðŸ“ž Contact Sharing Request</div>
                        <p style="font-size: 13px; color: #555;">From: ${msg.sender_name}</p>
                        ${statusHTML}
                    </div>
                `;
            } 

	// Handle completion request messages
else if (msg.message_type === 'completion_request') {
    const status = msg.completion_request_status || 'pending';
    const isSent = msg.sender_id === currentUser.id;
    let cardClass = 'contact-request-card';
    let statusHTML = '';
    
    if (status === 'approved') {
        cardClass += ' contact-status-approved';
        statusHTML = '<p style="margin-top: 10px; font-weight: 600;">âœ… Work completion accepted by customer</p>';
    } else if (status === 'declined') {
        cardClass += ' contact-status-declined';
        statusHTML = '<p style="margin-top: 10px; font-weight: 600;">âŒ Completion rejected - work continues</p>';
    } else if (!isSent && status === 'pending') {
        // SEEKER viewing - show Accept/Reject buttons
        statusHTML = `
            <div class="contact-approval-buttons">
                <button class="btn-approve" onclick="approveCompletionFromChat(${index})">âœ… Accept Completion</button>
                <button class="btn-decline" onclick="rejectCompletionFromChat(${index})">âŒ Reject & Continue Work</button>
            </div>
        `;
    } else if (isSent && status === 'pending') {
        // PROVIDER viewing - show waiting message
        statusHTML = '<p style="margin-top: 10px; color: #856404; font-size: 12px;">â³ Waiting for customer approval...</p>';
    }
    
    html += `
        <div class="${cardClass}" style="margin: 15px 0;">
            <div class="contact-request-title">âœ… Work Completion Request</div>
            <p style="font-size: 13px; color: #555;">From: ${msg.sender_name}</p>
            <p style="font-size: 13px; color: #555; margin-top: 5px;">${msg.message}</p>
            ${statusHTML}
        </div>
    `;
}
            // Handle system messages
            else if (msg.message_type === 'system') {
                html += `
                    <div style="text-align: center; margin: 15px 0; padding: 10px; background: #f0f0f0; border-radius: 8px; font-size: 13px; color: #555;">
                        ${msg.message}
                    </div>
                `;
            }
            // Handle regular messages
            else {
                html += `
                    <div class="message ${messageClass}">
                        <div class="message-bubble">
                            ${msg.message}
                            ${msg.image ? `<img src="${msg.image}" class="message-image" alt="Shared image" onclick="openImagePreview('${msg.image}')">` : ''}
                        </div>
                        <div class="message-time">${time}</div>
                    </div>
                `;
            }
        });
        
        // Check if contact sharing was approved
const contactApproved = messages.some(m => 
    m.message_type === 'contact_request' && 
    m.contact_request_status === 'approved'
);

// Show/hide contact details button in header
const contactDetailsHeaderBtn = document.getElementById('contactDetailsHeaderBtn');
const requestContactBtn = document.querySelector('.btn-contact');

// âœ… NEW: Check if chat is read-only
const isChatReadOnly = currentChatData && (currentChatData.isReadOnly || currentChatData.isNonSelectedProvider);

if (contactApproved && !isChatReadOnly) {
    // Show contact details button ONLY if approved AND not read-only
    if (contactDetailsHeaderBtn) contactDetailsHeaderBtn.style.display = 'inline-block';
    if (requestContactBtn) requestContactBtn.style.display = 'none';
} else {
    // Hide contact details button
    if (contactDetailsHeaderBtn) contactDetailsHeaderBtn.style.display = 'none';
    // Show request button only if not read-only
    if (requestContactBtn) {
        requestContactBtn.style.display = isChatReadOnly ? 'none' : 'inline-block';
    }
}
        
container.innerHTML = html;
        
        // âœ… FIXED: Smart scroll logic - scroll AFTER DOM update
        setTimeout(() => {
            // Always scroll if: first load, I sent message, or I was at bottom
            if (isFirstLoad || hasMyNewMessage || wasAtBottom) {
                container.scrollTop = container.scrollHeight;
                console.log('ðŸ“œ Auto-scrolled to bottom (reason: first=' + isFirstLoad + ', myMsg=' + hasMyNewMessage + ', wasBottom=' + wasAtBottom + ')');
            } else {
                console.log('ðŸ“œ User reading above, not scrolling');
            }
        }, 100);
        
        // âœ… NEW: Play sound for new messages (but NOT on first load)
        if (newMessages.length > 0 && !isDifferentChat) {
            // Check if any new message is from OTHER person (not me)
            const hasNewFromOther = newMessages.some(msg => msg.sender_id !== currentUser.id);
            
            if (hasNewFromOther) {
                // Check if I'm currently in THIS specific chat
                const chatView = document.getElementById('chatView');
                const isInThisChat = chatView && !chatView.classList.contains('hidden') && 
                                    currentChatData.requestId === window.lastLoadedChatId;
                
                if (isInThisChat) {
                    // Soft sound - I'm in this chat
                    console.log('ðŸ”” Playing SOFT sound (in-chat)');
                    const inChatSound = document.getElementById('inChatSound');
                    if (inChatSound) {
                        inChatSound.volume = 0.3;
                        inChatSound.play()
                            .then(() => console.log('âœ… Soft sound played'))
                            .catch(e => console.log('âŒ Sound blocked by browser:', e));
                    }
                } else {
                    // Loud sound - message from different chat
                    console.log('ðŸ”” Playing LOUD sound (different chat)');
                    const newChatSound = document.getElementById('newChatSound');
                    if (newChatSound) {
                        newChatSound.volume = 0.7;
                        newChatSound.play()
                            .then(() => console.log('âœ… Loud sound played'))
                            .catch(e => console.log('âŒ Sound blocked by browser:', e));
                    }
                }
            }
        }
        
        // âœ… CHECK if user is at bottom BEFORE updating DOM
        const wasAtBottom = container.scrollHeight - container.scrollTop <= container.clientHeight + 100;
        console.log('ðŸ“ User position before update - at bottom:', wasAtBottom);
        
        // Check if any new message is from ME (current user)
        const hasMyNewMessage = newMessages.some(msg => msg.sender_id === currentUser.id);
        
    // âœ… NUCLEAR FIX: Update timestamp - handles seeker and provider separately
        try {
            const chatView = document.getElementById('chatView');
            const isChatVisible = chatView && !chatView.classList.contains('hidden');
            
            if (isChatVisible && currentChatData) {
                const now = new Date().toISOString();
                
                console.log('ðŸ”µ Updating timestamp:', {
                    isProvider: currentChatData.isProvider,
                    requestId: currentChatData.requestId,
                    currentUserId: currentProfile.user_id,
                    timestamp: now
                });
                
                if (currentChatData.isProvider) {
                    // PROVIDER viewing: Update provider_last_viewed_at for THIS provider only
                    const { data: result, error } = await supabase
                        .from('chats')
                        .update({ provider_last_viewed_at: now })
                        .eq('request_id', currentChatData.requestId)
                        .eq('provider_id', currentProfile.user_id)
                        .select();
                    
                    if (error) {
                        console.error('âŒ Provider timestamp update FAILED:', error);
                    } else if (!result || result.length === 0) {
                        console.error('âŒ Provider timestamp update matched ZERO rows');
                    } else {
                        console.log('âœ… Provider timestamp updated successfully:', result);
                    }
                    
                } else {
    // SEEKER viewing: Update seeker_last_viewed_at ONLY for the current provider
    const { data: result, error } = await supabase
        .from('chats')
        .update({ seeker_last_viewed_at: now })
        .eq('request_id', currentChatData.requestId)
        .eq('provider_id', currentChatData.providerId);  // âœ… ADD THIS LINE
                    
                    if (error) {
                        console.error('âŒ Seeker timestamp update FAILED:', error);
                    } else if (!result || result.length === 0) {
                        console.error('âŒ Seeker timestamp update matched ZERO rows');
                    } else {
                        console.log('âœ… Seeker timestamp updated successfully for', result.length, 'chat(s):', result);
                    }
                }
            }
        } catch (error) {
            console.error('âš ï¸ Error updating last viewed timestamp:', error);
        }
        
    } catch (error) {
        console.error('Error loading messages:', error);

        const container = document.getElementById('chatMessages');
        if (container) {
            container.innerHTML = '<div class="empty-chat-state"><div class="empty-chat-state-text">Error loading messages. Please refresh.</div></div>';
        }
    }
}

// Open Image Preview (Full Screen)
function openImagePreview(imageUrl) {
    const modal = document.createElement('div');
    modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 999999; display: flex; align-items: center; justify-content: center; cursor: pointer;';
    
    modal.innerHTML = `
        <img src="${imageUrl}" style="max-width: 90%; max-height: 90%; border-radius: 8px; box-shadow: 0 8px 32px rgba(0,0,0,0.5);">
        <button style="position: absolute; top: 20px; right: 20px; background: white; border: none; border-radius: 50%; width: 40px; height: 40px; font-size: 24px; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.3);">Ã—</button>
    `;
    
    modal.onclick = () => document.body.removeChild(modal);
    document.body.appendChild(modal);
}
        // Send Message
        async function sendMessage() {
    const input = document.getElementById('chatMessageInput');
    const message = input.value.trim();
    
    if (!message) return;
    
    // Disable button during send to prevent double-clicks
    const sendBtn = document.getElementById('sendBtn');
    sendBtn.disabled = true;
    
    try {
        // Get existing chat
        const { data: existingChat, error: fetchError } = await supabase
            .from('chats')
            .select('messages')
            .eq('request_id', currentChatData.requestId)
            .eq('provider_id', currentChatData.providerId)
            .single();
        
        let messages = existingChat?.messages || [];
        
        // Add new message
        messages.push({
            sender_id: currentUser.id,
            sender_name: currentProfile.name,
            message: message,
            timestamp: new Date().toISOString()
        });
        
        // Upsert chat
        const { error: upsertError } = await supabase
            .from('chats')
            .upsert({
                request_id: currentChatData.requestId,
                provider_id: currentChatData.providerId,
                messages: messages
            }, { onConflict: 'request_id,provider_id' });
        
        if (upsertError) throw upsertError;
        
        // Clear input AFTER successful send
        input.value = '';
        
        // Manually toggle buttons after clearing
        sendBtn.classList.remove('show');
        document.getElementById('templateBtn').classList.remove('hide');
        
        // Re-enable button
        sendBtn.disabled = false;
        
        // Reload messages
        await loadChatMessages();
        
    } catch (error) {
        alert('Error sending message: ' + error.message);
        sendBtn.disabled = false;
    }
}

        // Handle Photo Upload
        async function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (file.size > 5 * 1024 * 1024) {
                alert('Image size should be less than 5MB');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = async (e) => {
                try {
                    const { data: existingChat } = await supabase
                        .from('chats')
                        .select('messages')
                        .eq('request_id', currentChatData.requestId)
                        .eq('provider_id', currentChatData.providerId)
                        .single();
                    
                    let messages = existingChat?.messages || [];
                    
                    messages.push({
                        sender_id: currentUser.id,
                        sender_name: currentProfile.name,
                        message: 'ðŸ“· Shared a photo',
                        image: e.target.result,
                        timestamp: new Date().toISOString()
                    });
                    
                    await supabase
                        .from('chats')
                        .upsert({
                            request_id: currentChatData.requestId,
                            provider_id: currentChatData.providerId,
                            messages: messages
                        }, { onConflict: 'request_id,provider_id' });
                    
                    event.target.value = '';
                    await loadChatMessages();
                    
                } catch (error) {
                    alert('Error uploading photo: ' + error.message);
                }
            };
            reader.readAsDataURL(file);
        }

        // Toggle Template Category
        function toggleTemplateCategory(element) {
            const items = element.nextElementSibling;
            const isCurrentlyOpen = items.classList.contains('open');
            
            // Close all other open categories first (accordion behavior)
            document.querySelectorAll('.template-category-items.open').forEach(openItem => {
                if (openItem !== items) {
                    openItem.classList.remove('open');
                    // Update the arrow icon for closed categories
                    const header = openItem.previousElementSibling;
                    if (header && header.textContent.includes('â–¶')) {
                        header.innerHTML = header.innerHTML.replace('â–¶', 'â–¼');
                    }
                }
            });
            
            // Toggle the clicked category
            items.classList.toggle('open');
            element.textContent = element.textContent.includes('â–¼') 
                ? element.textContent.replace('â–¼', 'â–¶')
                : element.textContent.replace('â–¶', 'â–¼');
        }

        // Insert Template
        function insertTemplate(element) {
            document.getElementById('chatMessageInput').value = element.textContent;
            document.getElementById('chatMessageInput').focus();
            closeTemplateModal();
        }

        // Open Template Modal
        function openTemplateModal() {
            const modal = document.getElementById('templateModal');
            const container = document.getElementById('templateCategoriesContainer');
            
            // Determine templates based on chat source (which section the chat came from)
            const templates = (currentChatData.chatSource === 'myRequests') ? seekerTemplatesData : providerTemplatesData;
            
            // Build HTML for modal
            let html = '';
            templates.forEach(category => {
                html += `
                    <div class="template-category-block">
                        <div class="template-category-header" onclick="toggleTemplateCategory(this)">
                            <span>${category.title}</span>
                            <span>â–¼</span>
                        </div>
                        <div class="template-category-items">
                            ${category.items.map(item => `
                                <div class="template-option" onclick="selectTemplateOption(this)">
                                    ${item}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            modal.classList.add('active');
        }

        // Close Template Modal
        function closeTemplateModal() {
    const modal = document.getElementById('templateModal');
    if (modal) {
        modal.classList.remove('active');
        // Reset all category items to closed state
        document.querySelectorAll('.template-category-items').forEach(item => {
            item.classList.remove('open');
        });
        // Reset all arrows to down position
        document.querySelectorAll('.template-category-header span:last-child').forEach(arrow => {
            arrow.textContent = 'â–¼';
        });
    }
}

// Close template modal when clicking outside
document.addEventListener('click', function(event) {
    const modal = document.getElementById('templateModal');
    const templateBtn = document.getElementById('templateBtn');
    const modalContent = document.querySelector('.template-modal-content');
    
    if (modal && modal.classList.contains('active')) {
        if (!modalContent.contains(event.target) && event.target !== templateBtn) {
            closeTemplateModal();
        }
    }
});

// Close contact details modal when clicking outside
document.addEventListener('click', function(event) {
    const modal = document.getElementById('contactDetailsModal');
    const modalContent = modal?.querySelector('.modal-content');
    const headerBtn = document.getElementById('contactDetailsHeaderBtn');
    
    if (modal && modal.classList.contains('active')) {
        if (!modalContent.contains(event.target) && event.target !== headerBtn) {
            closeContactDetailsModal();
        }
    }
});

// Close contact details modal on ESC key
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modal = document.getElementById('contactDetailsModal');
        if (modal && modal.classList.contains('active')) {
            closeContactDetailsModal();
        }
    }
});
        // Select Template Option
        // Select Template Option
        function selectTemplateOption(element) {
            const input = document.getElementById('chatMessageInput');
            const sendBtn = document.getElementById('sendBtn');
            const templateBtn = document.getElementById('templateBtn');
            
            // Set the message
            input.value = element.textContent.trim();
            
            // Show send button, hide template button
            if (input.value.trim().length > 0) {
                sendBtn.classList.add('show');
                templateBtn.classList.add('hide');
            }
            
            // Focus input
            input.focus();
            
            // IMPORTANT: Close modal immediately
            closeTemplateModal();
        }

        // Template Data
const seekerTemplatesData = [
    {
        title: t('templates.seeker.initial_contact.title'),
        items: [
            t('templates.seeker.initial_contact.item1'),
            t('templates.seeker.initial_contact.item2'),
            t('templates.seeker.initial_contact.item3')
        ]
    },
    {
        title: t('templates.seeker.scheduling.title'),
        items: [
            t('templates.seeker.scheduling.item1'),
            t('templates.seeker.scheduling.item2'),
            t('templates.seeker.scheduling.item3')
        ]
    },
    {
        title: t('templates.seeker.pricing.title'),
        items: [
            t('templates.seeker.pricing.item1'),
            t('templates.seeker.pricing.item2'),
            t('templates.seeker.pricing.item3')
        ]
    },
    {
        title: t('templates.seeker.additional_info.title'),
        items: [
            t('templates.seeker.additional_info.item1'),
            t('templates.seeker.additional_info.item2'),
            t('templates.seeker.additional_info.item3'),
            t('templates.seeker.additional_info.item4')
        ]
    },
    {
        title: t('templates.seeker.contact_finalization.title'),
        items: [
            t('templates.seeker.contact_finalization.item1'),
            t('templates.seeker.contact_finalization.item2'),
            t('templates.seeker.contact_finalization.item3')
        ]
    }
];

const providerTemplatesData = [
    {
        title: t('templates.provider.response.title'),
        items: [
            t('templates.provider.response.item1'),
            t('templates.provider.response.item2'),
            t('templates.provider.response.item3')
        ]
    },
    {
        title: t('templates.provider.pricing.title'),
        items: [
            t('templates.provider.pricing.item1'),
            t('templates.provider.pricing.item2'),
            t('templates.provider.pricing.item3')
        ]
    },
    {
        title: t('templates.provider.information_requests.title'),
        items: [
            t('templates.provider.information_requests.item1'),
            t('templates.provider.information_requests.item2'),
            t('templates.provider.information_requests.item3')
        ]
    },
    {
        title: t('templates.provider.contact_finalization.title'),
        items: [
            t('templates.provider.contact_finalization.item1'),
            t('templates.provider.contact_finalization.item2'),
            t('templates.provider.contact_finalization.item3')
        ]
    },
    {
        title: t('templates.provider.service_completion.title'),
        items: [
            t('templates.provider.service_completion.item1'),
            t('templates.provider.service_completion.item2'),
            t('templates.provider.service_completion.item3')
        ]
    }
];

        // Request Contact Sharing
       async function requestContactSharing() {
    if (!confirm(t('confirm_request_contact_sharing'))) return;
    try {
        const { data: existingChat } = await supabase
            .from('chats')
            .select('messages')
            .eq('request_id', currentChatData.requestId)
            .eq('provider_id', currentChatData.providerId)
            .maybeSingle();
        
        let messages = existingChat?.messages || [];
        
        // Check if contact request already exists
        const existingRequest = messages.find(m => 
            m.message_type === 'contact_request' && 
            m.contact_request_status === 'pending'
        );
        
        if (existingRequest) {
            alert('âš ï¸ Contact sharing request already sent! Waiting for response.');
            return;
        }
        
        // Add contact request message with special type
        const contactRequestMessage = {
            sender_id: currentUser.id,
            sender_name: currentProfile.name,
            message: 'ðŸ“ž Requesting to share contact information for finalizing the deal.',
            message_type: 'contact_request',
            contact_request_status: 'pending',
            timestamp: new Date().toISOString()
        };
        
        messages.push(contactRequestMessage);
        
        const { error: upsertError } = await supabase
            .from('chats')
            .upsert({
                request_id: currentChatData.requestId,
                provider_id: currentChatData.providerId,
                messages: messages
            }, { onConflict: 'request_id,provider_id' });
        
        if (upsertError) throw upsertError;
        
        await loadChatMessages();
        alert('âœ… Contact sharing request sent! The other person will see it in the chat.');
        
    } catch (error) {
        alert('âŒ Error sending contact request: ' + error.message);
        console.error('Contact sharing error:', error);
    }
}

	// Approve Contact Sharing
async function approveContactSharing(messageIndex) {
    // Add confirmation dialog
    if (!confirm(t('confirm_share_contact_info'))) {
        return;
    }
    
    try {
        const { data: existingChat, error: fetchError } = await supabase
            .from('chats')
            .select('messages')
            .eq('request_id', currentChatData.requestId)
            .eq('provider_id', currentChatData.providerId)
            .single();
        
        if (fetchError) throw fetchError;
        
        let messages = existingChat?.messages || [];
        
        // Update the request message status
        if (messages[messageIndex]) {
            messages[messageIndex].contact_request_status = 'approved';
        } else {
            throw new Error('Contact request message not found');
        }
        
        // Add approval notification message
        messages.push({
            sender_id: currentUser.id,
            sender_name: currentProfile.name,
            message: 'âœ… Contact sharing approved! Contact details are now visible to both parties.',
            message_type: 'system',
            timestamp: new Date().toISOString()
        });
        
        const { error: updateError } = await supabase
            .from('chats')
            .update({
                messages: messages
            })
            .eq('request_id', currentChatData.requestId)
            .eq('provider_id', currentChatData.providerId);
        
        if (updateError) throw updateError;
        
        // Verify the update was successful
        const { data: verifyChat, error: verifyError } = await supabase
            .from('chats')
            .select('messages')
            .eq('request_id', currentChatData.requestId)
            .eq('provider_id', currentChatData.providerId)
            .single();
        
        if (verifyError) throw new Error('Failed to verify approval was saved');
        
        // Check if the approval was saved
        const approvalSaved = verifyChat?.messages?.some(m => 
            m.message_type === 'system' && 
            m.message.includes('Contact sharing approved')
        );
        
        if (!approvalSaved) throw new Error('Approval not saved properly');
        
        await loadChatMessages();
        alert(`âœ… ${t('contact_info_shared_success')}`);
        
    } catch (error) {
        alert('âŒ Error approving contact sharing: ' + error.message);
        console.error('Approval error:', error);
    }
}

// Decline Contact Sharing
async function declineContactSharing(messageIndex) {
    if (!confirm(t('confirm_decline_contact'))) return;
    
    try {
        const { data: existingChat } = await supabase
            .from('chats')
            .select('messages')
            .eq('request_id', currentChatData.requestId)
            .eq('provider_id', currentChatData.providerId)
            .single();
        
        let messages = existingChat?.messages || [];
        
        // Update the request message status
        if (messages[messageIndex]) {
            messages[messageIndex].contact_request_status = 'declined';
        }
        
        // Add decline notification message
        messages.push({
            sender_id: currentUser.id,
            sender_name: currentProfile.name,
            message: 'âŒ Contact sharing request declined.',
            message_type: 'system',
            timestamp: new Date().toISOString()
        });
        
        await supabase
            .from('chats')
            .update({
                messages: messages
            })
            .eq('request_id', currentChatData.requestId)
            .eq('provider_id', currentChatData.providerId);
        
        await loadChatMessages();
        
    } catch (error) {
        alert('Error: ' + error.message);
    }
}
        // Show Warranty Form
async function showWarrantyForm() {
    // Security check: Only selected provider can show warranty form
    if (!currentChatData.isProvider) {
        alert(`âŒ ${t('only_provider_can_complete')}`);
        return;
    }
    
    // Verify this provider is the selected one
    const { data: request } = await supabase
        .from('requests')
        .select('selected_provider_id, status, warranty_period, warranty_end_date')
        .eq('id', currentChatData.requestId)
        .single();
    
    if (!request) {
        alert(`âŒ ${t('request_not_found')}`);
        return;
    }
    
    if (request.selected_provider_id !== currentProfile.user_id) {
        alert(`âŒ ${t('not_selected_provider')}`);
        return;
    }
    
    if (request.status !== 'in_progress') {
        alert(`âŒ ${t('request_not_in_progress')}`);
        return;
    }
    
    // Reset all radio buttons
    document.querySelectorAll('input[name="warranty"]').forEach(radio => {
        radio.checked = false;
    });
    
    // Check if this is a REACTIVATED request (has existing warranty)
    const keepExistingOption = document.getElementById('keepExistingWarrantyOption');
    const newWarrantyDivider = document.getElementById('newWarrantyDivider');
    const keepExistingText = document.getElementById('keepExistingWarrantyText');
    
    if (request.warranty_end_date) {
        // This is a reactivated request - calculate remaining warranty
        const warrantyEndDate = new Date(request.warranty_end_date);
        const today = new Date();
        const remainingDays = Math.ceil((warrantyEndDate - today) / (1000 * 60 * 60 * 24));
        
        if (remainingDays > 0) {
            // Show the "Keep Existing Warranty" option
            keepExistingOption.style.display = 'block';
            newWarrantyDivider.style.display = 'block';
            keepExistingText.textContent = `ðŸ”„ Keep Existing Warranty (${remainingDays} days left)`;
            
            // Pre-select the existing warranty option
            document.getElementById('warrantyExisting').checked = true;
            
            console.log(`ðŸ“‹ Reactivated request detected. Remaining warranty: ${remainingDays} days`);
        } else {
            // Warranty expired - hide the option
            keepExistingOption.style.display = 'none';
            newWarrantyDivider.style.display = 'none';
        }
    } else {
        // First-time completion - hide the keep existing option
        keepExistingOption.style.display = 'none';
        newWarrantyDivider.style.display = 'none';
    }
    
    // All checks passed - show the form
    document.getElementById('warrantyForm').classList.remove('hidden');
}

// Complete Work
async function completeWork() {
    const selectedWarranty = document.querySelector('input[name="warranty"]:checked');
    
    if (!selectedWarranty) {
        alert(t('please_select_warranty'));
        return;
    }
    
    if (!confirm(t('confirm_send_completion_request'))) return;
    
    try {
        console.log('ðŸ”µ STEP 3D: Starting work completion with pending bonus...');
        
        let warrantyDays;
        let warrantyEndDate;
        let isKeepingExistingWarranty = false;
        
        // Check if "Keep Existing Warranty" was selected
        if (selectedWarranty.value === 'existing') {
            // Fetch existing warranty info from the request
            const { data: existingRequest } = await supabase
                .from('requests')
                .select('warranty_period, warranty_end_date')
                .eq('id', currentChatData.requestId)
                .single();
            
            if (!existingRequest || !existingRequest.warranty_end_date) {
                alert('âŒ Error: Could not find existing warranty information.');
                return;
            }
            
            // Keep the existing warranty end date
            warrantyEndDate = new Date(existingRequest.warranty_end_date);
            const today = new Date();
            warrantyDays = Math.ceil((warrantyEndDate - today) / (1000 * 60 * 60 * 24));
            isKeepingExistingWarranty = true;
            
            console.log('ðŸ“Š Keeping existing warranty:', warrantyDays, 'days remaining');
            console.log('ðŸ“… Existing warranty expires:', warrantyEndDate.toISOString());
        } else {
            // New warranty selected
            warrantyDays = parseInt(selectedWarranty.value);
            warrantyEndDate = new Date();
            warrantyEndDate.setDate(warrantyEndDate.getDate() + warrantyDays);
            
            console.log('ðŸ“Š New warranty period:', warrantyDays, 'days');
            console.log('ðŸ“… Warranty expires:', warrantyEndDate.toISOString());
        }
        
        // STEP 1: Update request status to pending_completion
        const updateData = {
            status: 'pending_completion'
        };
        
        // Only update warranty fields if providing NEW warranty
        if (!isKeepingExistingWarranty) {
            updateData.warranty_period = warrantyDays;
            updateData.warranty_end_date = warrantyEndDate.toISOString();
        }
        
        const { error: updateError } = await supabase
            .from('requests')
            .update(updateData)
            .eq('id', currentChatData.requestId);
        
        if (updateError) throw updateError;
        
        console.log('âœ… Request status updated to pending_completion');
console.log(`âœ… Request status updated, waiting for seeker approval`);
        
        // STEP 3: Send completion message with warranty info
        const { data: existingChat } = await supabase
            .from('chats')
            .select('messages')
            .eq('request_id', currentChatData.requestId)
            .eq('provider_id', currentChatData.providerId)
            .single();
        
        let messages = existingChat?.messages || [];
        
        // Build warranty text based on selection
        let warrantyText;
        if (isKeepingExistingWarranty) {
            warrantyText = `existing warranty (${warrantyDays} days remaining)`;
        } else if (warrantyDays === 0) {
            warrantyText = 'no warranty';
        } else {
            warrantyText = `${warrantyDays} days warranty`;
        }
        
        messages.push({
            sender_id: currentUser.id,
            sender_name: currentProfile.name,
            message: `âœ… Provider has completed the work and is offering ${warrantyText}.\n\nâ³ Waiting for customer approval...`,
            message_type: 'completion_request',
            timestamp: new Date().toISOString()
        });
        
        await supabase
            .from('chats')
            .upsert({
                request_id: currentChatData.requestId,
                provider_id: currentChatData.providerId,
                messages: messages
            }, { onConflict: 'request_id,provider_id' });
        
        console.log('âœ… Completion message sent with pending bonus info');
        
console.log('âœ… STEP 3D COMPLETE: Completion request sent to seeker');
        
alert(`âœ… ${t('completion_request_sent')}\n\nâ³ Waiting for customer approval...`);        
        // Hide warranty form and mark complete button
        document.getElementById('warrantyForm').classList.add('hidden');
        document.getElementById('markCompleteBtn').style.display = 'none';
        document.getElementById('chatRequestStatus').textContent = 'PENDING APPROVAL';
        currentChatData.requestStatus = 'pending_completion';
        
        await loadChatMessages();
        
    } catch (error) {
        console.error('âŒ STEP 3D ERROR:', error);
        alert('Error: ' + error.message);
    }
}

// Accept Completion (Seeker)
async function acceptCompletion() {
    try {
        console.log('ðŸ”µ STEP 3E: Starting seeker acceptance with pending bonus...');
        
        // STEP 1: Get warranty info from request
        const { data: requestData, error: fetchError } = await supabase
            .from('requests')
            .select('warranty_period, warranty_end_date')
            .eq('id', currentChatData.requestId)
            .single();
        
        if (fetchError) throw fetchError;
        
        const warrantyDays = requestData.warranty_period || 0;
        const warrantyEndDate = requestData.warranty_end_date;
        const seekerBonus = 5;
        
        console.log('ðŸ“Š Warranty period:', warrantyDays, 'days');
        console.log('ðŸ“… Warranty expires:', warrantyEndDate);
        
        // STEP 2: Show confirmation with seeker's credit bonus (PRIVACY PROTECTED)
const confirmMessage = warrantyDays > 0
    ? `âœ… Accept work completion?\n\nðŸ’³ You'll receive +${seekerBonus} credits after ${warrantyDays} days warranty expires (first acceptance only).\n\nâ­ Rate the provider to earn +10 bonus credits (first rating only)!`
    : `âœ… Accept work completion?\n\nðŸ’³ You'll receive +${seekerBonus} credits immediately (first acceptance only).\n\nâ­ Rate the provider to earn +10 bonus credits (first rating only)!`;
        
        if (!confirm(confirmMessage)) return;
        
        console.log('âœ… Seeker confirmed acceptance');
        
        // STEP 3: Update request status to completed
        const { error: updateError } = await supabase
            .from('requests')
            .update({ status: 'completed' })
            .eq('id', currentChatData.requestId);
        
        if (updateError) throw updateError;
        
        console.log('âœ… Request status updated to completed');

console.log('ðŸ”´ DEBUG: About to execute STEP 4 - Seeker bonus');  // ADD THIS

// STEP 4: Add pending +5 credit bonus for seeker (awarded after warranty)
// Award completion bonus to seeker (pending warranty)
const seekerCompletionBonus = 5;
try {
    console.log('ðŸ’³ Attempting to award seeker completion bonus...');
    
    // âœ… FIX: Get seeker ID from currentChatData (the person viewing the chat who is accepting)
    const seekerId = currentUser.id;  // The seeker is the one accepting completion
    const requestId = currentChatData.requestId;
    
        console.log('ðŸ’³ Attempting to award seeker completion bonus...');
    console.log('   Seeker ID:', currentUser.id);
    console.log('   Request ID:', currentChatData.requestId);
    
    // Check if seeker already received completion bonus for THIS request
    const { data: existingSeekerBonus, error: checkError } = await supabase
        .from('credit_transactions')
        .select('id')
        .eq('user_id', currentUser.id)
        .eq('related_request_id', currentChatData.requestId)
        .like('description', '%completion bonus%')
        .maybeSingle();
    
    if (checkError) {
        console.error('âŒ Error checking existing seeker bonus:', checkError);
    }
    
    console.log('   Existing bonus check result:', existingSeekerBonus);
    
    if (!existingSeekerBonus) {
        await addCredits(
            currentUser.id,
            seekerCompletionBonus,
            'Request completion bonus (pending warranty)',
            currentChatData.requestId,
            'pending',
            warrantyEndDate
        );
        console.log('âœ… Seeker completion bonus awarded:', seekerCompletionBonus);
    } else {
        console.log('â­ï¸ Seeker already received completion bonus for this request');
    }
} catch (bonusError) {
    console.error('âŒ Error awarding seeker completion bonus:', bonusError);
}
        console.log(`âœ… Seeker pending bonus: +${seekerBonus} credits (awarded after warranty)`);
        
        // STEP 5: Add system message (NO credit amounts - privacy protected)
        const { data: existingChat } = await supabase
            .from('chats')
            .select('messages')
            .eq('request_id', currentChatData.requestId)
            .eq('provider_id', currentChatData.providerId)
            .single();
        
        let messages = existingChat?.messages || [];
        
        messages.push({
            sender_id: currentUser.id,
            sender_name: currentProfile.name,
            message: 'âœ… Work completion accepted by customer. Request is now completed!',
            message_type: 'system',
            timestamp: new Date().toISOString()
        });
        
        await supabase
            .from('chats')
            .upsert({
                request_id: currentChatData.requestId,
                provider_id: currentChatData.providerId,
                messages: messages
            }, { onConflict: 'request_id,provider_id' });
        
        console.log('âœ… System message sent (no credit info - privacy protected)');
        
        // STEP 6: Hide accept/reject buttons
        document.getElementById('acceptCompletionBtn').style.display = 'none';
        document.getElementById('rejectCompletionBtn').style.display = 'none';
        
        // STEP 7: Update chat status display
        document.getElementById('chatRequestStatus').textContent = 'COMPLETED';
        currentChatData.requestStatus = 'completed';
        
        await loadChatMessages();
        
        console.log('âœ… STEP 3E COMPLETE: Seeker gets +5 credits (pending after warranty)');
        // âœ… Check if this is seeker's first completed request (referral bonus)
const { count: completedCount } = await supabase
    .from('requests')
    .select('*', { count: 'exact', head: true })
    .eq('user_id', currentUser.id)
    .eq('status', 'completed');

if (completedCount === 1) {
    await awardReferralFirstRequestBonus(currentUser.id);
}
        // STEP 8: Open rating modal
        alert(`âœ… Work completion accepted!\n\nðŸ’³ +${seekerBonus} credits will be credited after warranty period.\n\nPlease rate the provider now.`);
        openRatingModal(currentChatData.requestId, currentChatData.providerId, currentChatData.partnerName);
        
    } catch (error) {
        console.error('âŒ STEP 3E ERROR:', error);
        alert('âŒ Error: ' + error.message);
    }
}

// Reject Completion (Seeker)
async function rejectCompletion() {
    const reason = prompt('âŒ Reject work completion?\n\nPlease provide a reason for rejection (the provider will see this):');
    
    if (!reason || reason.trim() === '') return;
    
    try {
        // Update request status back to in_progress
        const { error: updateError } = await supabase
            .from('requests')
            .update({ status: 'in_progress' })
            .eq('id', currentChatData.requestId);
        
        if (updateError) throw updateError;
        
        // Add system message with rejection reason
        const { data: existingChat } = await supabase
            .from('chats')
            .select('messages')
            .eq('request_id', currentChatData.requestId)
            .eq('provider_id', currentChatData.providerId)
            .single();
        
        let messages = existingChat?.messages || [];
        
        messages.push({
            sender_id: currentUser.id,
            sender_name: currentProfile.name,
            message: `âŒ Work completion rejected by customer.\n\nReason: ${reason.trim()}\n\nPlease continue working to resolve the issues.`,
            message_type: 'system',
            timestamp: new Date().toISOString()
        });
        
        await supabase
            .from('chats')
            .upsert({
                request_id: currentChatData.requestId,
                provider_id: currentChatData.providerId,
                messages: messages
            }, { onConflict: 'request_id,provider_id' });
        
        // Hide accept/reject buttons
        document.getElementById('acceptCompletionBtn').style.display = 'none';
        document.getElementById('rejectCompletionBtn').style.display = 'none';
        
        // Update chat status display
        document.getElementById('chatRequestStatus').textContent = 'IN PROGRESS';
        currentChatData.requestStatus = 'in_progress';
        
        await loadChatMessages();
        
        alert('âŒ Completion rejected. The provider can see your feedback and will continue working.');
        
    } catch (error) {
        alert('âŒ Error: ' + error.message);
    }
}  
         
// ========== COMPLETION FROM CHAT MESSAGE CARD ==========

// Approve Completion from Chat Message Card
async function approveCompletionFromChat(messageIndex) {
    try {
        console.log('ðŸ”µ approveCompletionFromChat called with index:', messageIndex);
        
        // Get existing chat to update message status
        const { data: existingChat, error: fetchError } = await supabase
            .from('chats')
            .select('messages')
            .eq('request_id', currentChatData.requestId)
            .eq('provider_id', currentChatData.providerId)
            .single();
        
        if (fetchError) throw fetchError;
        
        let messages = existingChat?.messages || [];
        
        // Update the completion request message status
        if (messages[messageIndex]) {
            messages[messageIndex].completion_request_status = 'approved';
        }
        
        // Save updated messages
        const { error: updateError } = await supabase
            .from('chats')
            .update({ messages: messages })
            .eq('request_id', currentChatData.requestId)
            .eq('provider_id', currentChatData.providerId);
        
        if (updateError) throw updateError;
        
        console.log('âœ… Message status updated to approved');
        
        // Now call the main acceptCompletion function
        await acceptCompletion();
        
    } catch (error) {
        console.error('âŒ Error in approveCompletionFromChat:', error);
        alert('âŒ Error: ' + error.message);
    }
}

// Reject Completion from Chat Message Card
async function rejectCompletionFromChat(messageIndex) {
    try {
        console.log('ðŸ”µ rejectCompletionFromChat called with index:', messageIndex);
        
        // Get existing chat to update message status
        const { data: existingChat, error: fetchError } = await supabase
            .from('chats')
            .select('messages')
            .eq('request_id', currentChatData.requestId)
            .eq('provider_id', currentChatData.providerId)
            .single();
        
        if (fetchError) throw fetchError;
        
        let messages = existingChat?.messages || [];
        
        // Update the completion request message status
        if (messages[messageIndex]) {
            messages[messageIndex].completion_request_status = 'declined';
        }
        
        // Save updated messages
        const { error: updateError } = await supabase
            .from('chats')
            .update({ messages: messages })
            .eq('request_id', currentChatData.requestId)
            .eq('provider_id', currentChatData.providerId);
        
        if (updateError) throw updateError;
        
        console.log('âœ… Message status updated to declined');
        
        // Now call the main rejectCompletion function
        await rejectCompletion();
        
    } catch (error) {
        console.error('âŒ Error in rejectCompletionFromChat:', error);
        alert('âŒ Error: ' + error.message);
    }
}

        // View Responses
async function viewResponses(requestId) {
    selectedResponseRequest = requestId;
    
    try {
        // Update timestamp when seeker views responses
        await supabase
            .from('requests')
            .update({ seeker_last_viewed_responses_at: new Date().toISOString() })
            .eq('id', requestId)
            .eq('user_id', currentUser.id);
        
        const { data: responses, error } = await supabase
            .from('request_responses')
            .select('*, provider_id')
            .eq('request_id', requestId);
        
        if (error) throw error;
        
        // ðŸ†• FILTER OUT DESELECTED PROVIDERS
        // Fetch list of rejected/deselected providers for this request
        const { data: rejectedProviders, error: rejError } = await supabase
            .from('request_rejected_providers')
            .select('provider_id')
            .eq('request_id', requestId)
            .eq('rejection_reason', 'deselected');
        
        if (rejError) throw rejError;
        
        // Create a Set of rejected provider IDs for fast lookup
        const rejectedProviderIds = new Set(
            (rejectedProviders || []).map(r => r.provider_id)
        );
        
        // Filter out deselected providers from responses
        const activeResponses = responses.filter(
            response => !rejectedProviderIds.has(response.provider_id)
        );
        
        if (!activeResponses || activeResponses.length === 0) {
            document.getElementById('responsesList').innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-text">${t('no_responses_yet')}</div>
                </div>
            `;
            document.getElementById('responsesModal').classList.add('active');
            return;
        }

        // âœ… SORT PROVIDERS BY RATING (HIGHEST FIRST)
        // First, fetch provider profiles with ratings for all responses
        const providerIds = activeResponses.map(r => r.provider_id);
        const { data: providersData, error: provError } = await supabase
            .from('profiles')
            .select('user_id, average_rating, total_ratings')
            .in('user_id', providerIds);
        
        if (provError) throw provError;
        
        // Create a map of provider ratings
        const ratingMap = {};
        (providersData || []).forEach(p => {
            ratingMap[p.user_id] = p.average_rating || 0;
        });
        
        // Sort responses by provider rating (highest first)
        activeResponses.sort((a, b) => {
            const ratingA = ratingMap[a.provider_id] || 0;
            const ratingB = ratingMap[b.provider_id] || 0;
            return ratingB - ratingA; // Descending order
        });
        
        let html = '';
        
        for (let response of activeResponses) {
            const { data: provider } = await supabase
                .from('profiles')
                .select('*')
                .eq('user_id', response.provider_id)
                .single();
            
            let ratingDisplay = t('no_ratings');
            if (provider.average_rating && provider.average_rating > 0 && provider.total_ratings > 0) {
                const stars = 'â­'.repeat(Math.round(provider.average_rating));
                const ratingWord = provider.total_ratings === 1 ? t('rating') : t('ratings');
                ratingDisplay = `${stars} ${provider.average_rating}/5 (${provider.total_ratings} ${ratingWord})`;
            }
    
            // âœ… NEW: Calculate unread messages from THIS specific provider
            let providerUnreadCount = 0;
            const { data: providerChat } = await supabase
                .from('chats')
                .select('messages, seeker_last_viewed_at')
                .eq('request_id', requestId)
                .eq('provider_id', response.provider_id)
                .maybeSingle();

            if (providerChat && providerChat.messages) {
                const lastViewedAt = providerChat.seeker_last_viewed_at;
                
                const normalizeToUTC = (timestamp) => {
                    if (!timestamp) return null;
                    let normalized = timestamp;
                    if (typeof timestamp === 'string' && !timestamp.endsWith('Z') && !timestamp.includes('+')) {
                        normalized = timestamp + 'Z';
                    }
                    return new Date(normalized).getTime();
                };
                
                providerUnreadCount = providerChat.messages.filter(m => {
                    if (m.sender_id === currentUser.id) return false;
                    if (!lastViewedAt) return true;
                    
                    const messageTime = normalizeToUTC(m.timestamp);
                    const viewedTime = normalizeToUTC(lastViewedAt);
                    
                    return messageTime > viewedTime;
                }).length;
            }            
            
            const { data: request } = await supabase
                .from('requests')
                .select('request_latitude, request_longitude')
                .eq('id', requestId)
                .single();
            
            const distance = calculateDistance(
                provider.latitude,          // â† Provider first
                provider.longitude,
                request.request_latitude,   // â† Request second
                request.request_longitude
            );
            
            // âœ… NEW: Calculate "Member since" date from provider's account creation
            const memberSinceDate = new Date(provider.created_at);
            const memberSinceText = memberSinceDate.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
            
            const photoHTML = provider.profile_photo 
                ? `<img src="${provider.profile_photo}" style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover; border: 3px solid #667eea; margin-bottom: 12px; cursor: pointer; transition: transform 0.2s;" onclick="openImagePreview('${provider.profile_photo}')" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'" title="${t('click_to_view_full_size')}">`
                : `<div style="width: 60px; height: 60px; border-radius: 50%; background: #e0e0e0; display: flex; align-items: center; justify-content: center; font-size: 32px; margin-bottom: 12px;">ðŸ‘¤</div>`;

            // Check if this provider is selected
            const { data: requestDetails } = await supabase
                .from('requests')
                .select('selected_provider_id, status')
                .eq('id', requestId)
                .single();
            
            const isSelected = requestDetails?.selected_provider_id === response.provider_id;
            const requestStatus = requestDetails?.status;
            
            // Show different buttons based on selection status
            let actionButtons = '';

            // âœ… NEW: Build chat button with unread badge
            const chatButtonHTML = providerUnreadCount > 0 
                ? `<div class="chat-btn-wrapper" style="display: inline-block; position: relative;">
                        <button class="btn btn-chat" onclick="chatOpenedFrom='responses-modal'; openChat('${requestId}', '${response.provider_id}')">${t('chat')}</button>
                        <span class="chat-unread-badge">${providerUnreadCount}</span>
                   </div>`
                : `<button class="btn btn-chat" onclick="chatOpenedFrom='responses-modal'; openChat('${requestId}', '${response.provider_id}')">${t('chat')}</button>`;

            if (isSelected) {
                // Selected provider - always show chat button
                actionButtons = `
                    <button class="btn btn-view-profile" onclick="viewProviderProfile('${response.provider_id}')">${t('view_profile')}</button>
                    ${chatButtonHTML}
                `;
            } else {
                // Not selected - show view profile and select button
                actionButtons = `
                    <button class="btn btn-view-profile" onclick="viewProviderProfile('${response.provider_id}')">${t('view_profile')}</button>
                    ${chatButtonHTML}
                    <button class="btn btn-select" onclick="selectProvider('${requestId}', '${response.provider_id}')">${t('select_provider')}</button>
                `;
            }
            
            html += `
                <div class="provider-card">
                    <div style="display: flex; align-items: flex-start; gap: 15px;">
                        <div style="flex-shrink: 0;">${photoHTML}</div>
                        <div style="flex: 1; min-width: 0;">
                            <div class="provider-name" style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                <span>${provider.name}</span>
                                <span class="rating-display" style="margin: 0; font-size: 13px;">${ratingDisplay}</span>
                                ${isSelected ? `<span style="color: #667eea; font-weight: bold; font-size: 12px;">âœ“ ${t('selected')}</span>` : ''}
                            </div>
                            <div class="provider-info">ðŸ“ ${distance} km ${t('away')}</div>
                            <div class="provider-info">ðŸ“… ${t('member_since')} ${memberSinceText}</div>
                        </div>
                    </div>
                    <div class="provider-actions" style="margin-top: 12px;">
                        ${actionButtons}
                    </div>
                </div>
            `;
        }
        
        document.getElementById('responsesList').innerHTML = html;

        // Mark that we're in responses modal
        document.getElementById('responsesModal').classList.add('active');
    } catch (error) {
        alert(`${t('error_loading_responses')}: ${error.message}`);
    }
}

        // Calculate Distance
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return parseFloat((R * c).toFixed(2));
        }

        // View Provider Profile
async function viewProviderProfile(providerId) {
    try {
        const { data: provider } = await supabase
            .from('profiles')
            .select('*')
            .eq('user_id', providerId)
            .single();
        
        const { data: services } = await supabase
            .from('provider_services')
            .select('service_id')
            .eq('provider_id', providerId);
        
        const serviceList = services && services.length > 0 
            ? services.map(s => s.service_id).join(', ')
            : t('no_services_listed');
        
        const addr = [provider.house_number, provider.area_name, provider.landmark, provider.city, provider.state, provider.pin_code].filter(Boolean).join(', ');
        
        let ratingDisplay = t('no_ratings');
        let ratingDetailsHTML = '';

        if (provider.average_rating && provider.average_rating > 0 && provider.total_ratings > 0) {
            const stars = 'â­'.repeat(Math.round(provider.average_rating));
            const ratingWord = provider.total_ratings === 1 ? t('rating') : t('ratings');
            ratingDisplay = `${stars} ${provider.average_rating}/5 (${provider.total_ratings} ${ratingWord})`;
            
            // âœ… UPDATED: Fetch review details WITH service_type
            const { data: ratings } = await supabase
                .from('ratings')
                .select('rating, review, created_at, service_type')  // â† ADDED service_type
                .eq('provider_id', providerId)
                .order('created_at', { ascending: false });
            
            if (ratings && ratings.length > 0) {
    // Service type icons and names mapping - UPDATED TO SUBCATEGORIES
    const serviceIcons = {
        // Electrician subcategories
        electrician_installation: `ðŸ”Œ ${t('electrician')} â†’ ${t('elec_installation')}`,
        electrician_repair: `ðŸ”Œ ${t('electrician')} â†’ ${t('elec_repair')}`,
        electrician_wiring: `ðŸ”Œ ${t('electrician')} â†’ ${t('elec_wiring')}`,
        
        // Plumber subcategories
        plumber_installation: `ðŸš° ${t('plumber')} â†’ ${t('plumb_installation')}`,
        plumber_repair: `ðŸš° ${t('plumber')} â†’ ${t('plumb_repair')}`,
        plumber_new_work: `ðŸš° ${t('plumber')} â†’ ${t('plumb_new_work')}`,
        
        // AC subcategories
        ac_installation: `â„ï¸ ${t('ac_services')} â†’ ${t('ac_installation')}`,
        ac_repair_service: `â„ï¸ ${t('ac_services')} â†’ ${t('ac_repair_service')}`,
        ac_gas_filling: `â„ï¸ ${t('ac_services')} â†’ ${t('ac_gas_filling')}`,
        
        // Carpenter subcategories
        carpenter_repair: `ðŸ”¨ ${t('carpenter')} â†’ ${t('carp_repair')}`,
        carpenter_custom: `ðŸ”¨ ${t('carpenter')} â†’ ${t('carp_custom')}`,
        carpenter_door_window: `ðŸ”¨ ${t('carpenter')} â†’ ${t('carp_door_window')}`,
        
        // Painter subcategories
        painter_house: `ðŸŽ¨ ${t('painter')} â†’ ${t('paint_house')}`,
        painter_furniture: `ðŸŽ¨ ${t('painter')} â†’ ${t('paint_furniture')}`,
        painter_texture: `ðŸŽ¨ ${t('painter')} â†’ ${t('paint_texture')}`,
        
        // Cleaner subcategories
        cleaner_house: `ðŸ§¹ ${t('cleaner')} â†’ ${t('clean_house')}`,
        cleaner_upholstery: `ðŸ§¹ ${t('cleaner')} â†’ ${t('clean_upholstery')}`,
        cleaner_vehicle: `ðŸ§¹ ${t('cleaner')} â†’ ${t('clean_vehicle')}`,
        
        // Appliance subcategories
        appliance_washing: `ðŸ”§ ${t('appliance_repair')} â†’ ${t('app_washing')}`,
        appliance_refrigerator: `ðŸ”§ ${t('appliance_repair')} â†’ ${t('app_refrigerator')}`,
        appliance_tv: `ðŸ”§ ${t('appliance_repair')} â†’ ${t('app_tv')}`,
        appliance_geyser: `ðŸ”§ ${t('appliance_repair')} â†’ ${t('app_geyser')}`,
        appliance_ro: `ðŸ”§ ${t('appliance_repair')} â†’ ${t('app_ro')}`,
        appliance_microwave: `ðŸ”§ ${t('appliance_repair')} â†’ ${t('app_microwave')}`,
        appliance_other: `ðŸ”§ ${t('appliance_repair')} â†’ ${t('app_other')}`
    };
    
    ratingDetailsHTML = `<hr style="margin: 20px 0;"><h3 style="margin-bottom: 15px;">${t('recent_reviews')}:</h3>`;
    ratings.slice(0, 5).forEach(r => {  // Show last 5 ratings
        const reviewStars = 'â­'.repeat(r.rating);
        const reviewDate = new Date(r.created_at).toLocaleDateString();
        
        // Get service name with icon - now with subcategory support
        const serviceName = r.service_type && serviceIcons[r.service_type] 
            ? serviceIcons[r.service_type] 
            : 'ðŸ”§ Service';  // Fallback if service_type is missing
                    
                    ratingDetailsHTML += `
                        <div style="background: #f5f5f5; padding: 12px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #667eea;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <div style="font-weight: 600; color: #667eea;">${reviewStars} ${r.rating}/5</div>
                                <span style="background: #667eea; color: white; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600;">${serviceName}</span>
                            </div>
                            ${r.review ? `<p style="color: #555; margin-bottom: 5px; font-size: 14px; line-height: 1.5;">"${r.review}"</p>` : ''}
                            <p style="font-size: 12px; color: #999; margin-top: 8px;">ðŸ“… ${reviewDate}</p>
                        </div>
                    `;
                });
            }
        }
        
        // âœ… NEW: Calculate "Active Since" date
        const activeSinceDate = new Date(provider.created_at);
        const activeSinceText = activeSinceDate.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
        
        const photoHTML = provider.profile_photo 
            ? `<div style="text-align: center; margin-bottom: 20px;">
                <img src="${provider.profile_photo}" 
                     onclick="openImagePreview('${provider.profile_photo}')" 
                     style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 4px solid #667eea; cursor: pointer; transition: transform 0.2s;" 
                     onmouseover="this.style.transform='scale(1.05)'" 
                     onmouseout="this.style.transform='scale(1)'">
                <p style="font-size: 12px; color: #999; margin-top: 8px;">${t('click_photo_to_view')}</p>
               </div>`
            : `<div style="text-align: center; margin-bottom: 20px;">
                <div style="width: 150px; height: 150px; border-radius: 50%; background: #e0e0e0; display: inline-flex; align-items: center; justify-content: center; font-size: 64px; border: 4px solid #667eea;">ðŸ‘¤</div>
               </div>`;
        
        document.getElementById('profileContent').innerHTML = `
            ${photoHTML}
            <div class="profile-details">
                <p><strong>ðŸ‘¤ ${t('name')}:</strong> ${provider.name}</p>
                <p><strong>â­ ${t('rating')}:</strong> ${ratingDisplay}</p>
                <p style="background: #f0f4ff; padding: 10px; border-radius: 8px; border-left: 4px solid #667eea;"><strong>ðŸ“… ${t('member_since')}:</strong> ${activeSinceText}</p>
                <p><strong>ðŸ”§ ${t('services')}:</strong> ${serviceList}</p>
                <p><strong>ðŸ“ ${t('address')}:</strong> ${addr}</p>
                <p><strong>ðŸ“Œ ${t('note')}:</strong> ${t('contact_shared_after_agreement')}</p>
                ${ratingDetailsHTML}
            </div>
        `;
        
        document.getElementById('profileModal').classList.add('active');
    } catch (error) {
        alert(`${t('error_loading_profile')}: ${error.message}`);
    }
}

// Select Provider
async function selectProvider(requestId, providerId) {
    if (!confirm(t('select_provider_confirm'))) return;
    
    try {
        console.log('ðŸ”µ STEP 3B: Starting provider selection with rejection refunds...');
        
        // STEP 1: Get all responses for this request
        const { data: allResponses, error: responsesError } = await supabase
            .from('request_responses')
            .select('provider_id')
            .eq('request_id', requestId);
        
        if (responsesError) throw responsesError;
        
        console.log('ðŸ“Š Total providers who responded:', allResponses?.length || 0);
        
        // STEP 2: Update request with selected provider
        const { error: updateError } = await supabase
            .from('requests')
            .update({ 
                selected_provider_id: providerId, 
                status: 'in_progress' 
            })
            .eq('id', requestId);
        
        if (updateError) throw updateError;
        
        console.log('âœ… Request status updated to in_progress');
        
        // ðŸ†• STEP 2.5: Send system message to SELECTED provider
        try {
            const { data: selectedChat } = await supabase
                .from('chats')
                .select('messages')
                .eq('request_id', requestId)
                .eq('provider_id', providerId)
                .maybeSingle();
            
            if (selectedChat) {
                let messages = selectedChat.messages || [];
                messages.push({
                    sender_id: currentUser.id,
                    sender_name: currentProfile.name,
                    message: `ðŸŽ‰ ${t('sys_selected')}\n\n${t('sys_selected_description')}`,
                    message_type: 'system',
                    timestamp: new Date().toISOString()
                });
                
                await supabase
                    .from('chats')
                    .update({ messages: messages })
                    .eq('request_id', requestId)
                    .eq('provider_id', providerId);
                
                console.log(`âœ… Selection notification sent to provider ${providerId}`);
            }
        } catch (error) {
            console.error(`âŒ Error sending selection notification:`, error);
            // Continue even if notification fails
        }
        
        // STEP 3: Process rejection refunds for non-selected providers
        if (allResponses && allResponses.length > 0) {
            const rejectedProviders = allResponses.filter(r => r.provider_id !== providerId);
            
            console.log('ðŸ”„ Processing refunds for', rejectedProviders.length, 'rejected providers...');
            
            for (let response of rejectedProviders) {
                try {
                    // STEP 3A: Check if this is their first response (to determine original cost)
                    const { data: providerResponseCount, error: countError } = await supabase
                        .from('request_responses')
                        .select('id', { count: 'exact', head: true })
                        .eq('provider_id', response.provider_id);
                    
                    if (countError) {
                        console.error('âŒ Error checking response count:', countError);
                        continue;
                    }
                    
                    // If they have only 1 response (this one), it was their first (50 credits)
                    // Otherwise it was additional (40 credits)
                    const wasFirstResponse = providerResponseCount && providerResponseCount.count === 1;
                    const refundAmount = 40; // Fixed refund amount regardless of original cost
                    
                    console.log(`ðŸ’° Refunding ${refundAmount} credits to provider ${response.provider_id} (was ${wasFirstResponse ? 'first' : 'additional'} response)`);
                    
                    // STEP 3B: Add refund credits
                    await addCredits(
                        response.provider_id,
                        refundAmount,
                        `Refund: Not selected for service request`,
                        requestId,
                        'completed',
                        null
                    );
                    
                    console.log(`âœ… Refunded ${refundAmount} credits to provider ${response.provider_id}`);
                    
                    // STEP 3C: Send system message to rejected provider
                    const { data: rejectedChat } = await supabase
                        .from('chats')
                        .select('messages')
                        .eq('request_id', requestId)
                        .eq('provider_id', response.provider_id)
                        .maybeSingle();
                    
                    if (rejectedChat) {
                        let messages = rejectedChat.messages || [];
                        messages.push({
                            sender_id: currentUser.id,
                            sender_name: currentProfile.name,
                            message: `âŒ ${t('sys_deselected')}\n\nðŸ’³ +${refundAmount} credits refunded`,
                            message_type: 'system',
                            timestamp: new Date().toISOString()
                        });
                        
                        await supabase
                            .from('chats')
                            .update({ messages: messages })
                            .eq('request_id', requestId)
                            .eq('provider_id', response.provider_id);
                        
                        console.log(`âœ… System message sent to rejected provider ${response.provider_id}`);
                    }
                    
                } catch (error) {
                    console.error(`âŒ Error processing refund for provider ${response.provider_id}:`, error);
                    // Continue processing other providers even if one fails
                }
            }
        }
        
        console.log('âœ… STEP 3B COMPLETE: All rejection refunds processed');
        
        // Close modals
        closeResponsesModal();
        closeProfileModal();
        
        // Show success message
        alert(`âœ… ${t('provider_selected_success')}`);
        
        // Open chat with selected provider
        await openChat(requestId, providerId);
        
    } catch (error) {
        console.error('âŒ STEP 3B ERROR:', error);
        alert(`âŒ ${t('error')}: ${error.message}`);
    }
}

        // Close Modals
function closeResponsesModal() {
    const modal = document.getElementById('responsesModal');
    modal.classList.remove('active');
    modal.style.display = 'none';  // âœ… ADD THIS LINE
    chatOpenedFrom = null;  // âœ… Clear the state
    selectedResponseRequest = null;  // âœ… Clear selected request
}

function closeResponsesModalAndGoBack() {
    document.getElementById('responsesModal').classList.remove('active');
    showDashboard();
}

function closeProfileModal() {
    document.getElementById('profileModal').classList.remove('active');
}

async function displayProviderOpenRequests(data) {
    const container = document.getElementById('providerOpenRequestsList');
    
    if (!data || data.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <div class="empty-state-icon">ðŸ“‹</div>
                <div class="empty-state-text">${t('no_open_requests_yet')}</div>
            </div>
        `;
        return;
    }
    
    let html = '';
    
    for (let item of data) {
        const req = item.request;
        if (!req) continue;
        
        const icon = getServiceIcon(req.service_id);
        const timeAgo = getTimeAgo(new Date(item.created_at));
        const distance = calculateDistance(
            currentProfile.latitude,
            currentProfile.longitude,
            req.request_latitude,
            req.request_longitude
        );
        
        const unreadBadgeHTML = item.unreadCount > 0 ? `<span class="chat-unread-badge">${item.unreadCount}</span>` : '';
const chatButton = `<div class="chat-btn-wrapper"><button class="btn btn-chat action-btn-compact" onclick="openChat('${req.id}', '${currentProfile.user_id}')">${t('chat')}</button>${unreadBadgeHTML}</div>`;
        
        html += `
            <div class="request-card compact">
                <div class="request-card-main">
                    <div class="request-card-left">
                        <div class="request-title-compact" onclick="toggleRequestDetails(event, 'open-${req.id}')">
                            <span class="urgency-bubble ${req.urgency}"></span>
                            <span class="request-title-text">${icon} ${req.title}</span>
                            <span class="request-chevron" id="chevron-open-${req.id}">â–¼</span>
                        </div>
                        <div class="request-summary" style="display: flex !important; justify-content: space-between !important; width: 100% !important; align-items: center !important;">
                            <span class="status-badge status-open">â³ ${t('status_pending')}</span>
                            ${chatButton}
                        </div>
                        <div class="request-summary" style="margin-top: 6px; color: #999;">
                            ðŸ‘¤ ${item.seekerName} â€¢ ðŸ“ ${distance} km â€¢ ðŸ•’ ${timeAgo}
                        </div>
                    </div>
                </div>
                <div class="request-details" id="details-open-${req.id}">
                    <div class="request-description"><strong>${t('description')}:</strong> ${req.description}</div>
                    <div class="request-location" style="margin-top: 8px;"><strong>${t('location')}:</strong> ${req.request_location_address}</div>
                </div>
            </div>
        `;
    }
    
    container.innerHTML = html;
}

// Load Provider Responses
        async function loadProviderResponses() {
    try {
        // Get all responses by this provider
        const { data: responses, error: respError } = await supabase
            .from('request_responses')
            .select('*')
            .eq('provider_id', currentProfile.user_id)
            .order('created_at', { ascending: false });
        
        if (respError) throw respError;
        
        if (!responses || responses.length === 0) {
            document.getElementById('myResponsesList').innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">ðŸ’¬</div>
                    <div class="empty-state-text">${t('no_responses_yet')}. ${t('respond_to_start')}</div>
                </div>
            `;
        document.getElementById('myResponsesTotal').textContent = '0';
            document.getElementById('myResponsesNew').classList.add('hidden');
            return;
        }
        
        // Get full request details for each response
        const requestIds = responses.map(r => r.request_id);
        const { data: requests, error: reqError } = await supabase
            .from('requests')
            .select('*')
            .in('id', requestIds);
        
        if (reqError) throw reqError;
        
        // Get seeker profiles
        const userIds = requests.map(r => r.user_id);
        const { data: seekers, error: seekerError } = await supabase
            .from('profiles')
            .select('user_id, name')
            .in('user_id', userIds);
        
        if (seekerError) throw seekerError;
        
        // Check for unread messages in each chat (excluding open status requests)
        const chatChecks = await Promise.all(responses.map(async (response) => {
            // Get request details to check status
            const request = requests.find(r => r.id === response.request_id);
            
            // Skip open requests (they belong to Open Requests section)
            if (request && request.status === 'open') {
                return { requestId: response.request_id, hasMessages: false, unreadCount: 0 };
            }
            const { data: chat } = await supabase
                .from('chats')
                .select('messages, seeker_last_viewed_at, provider_last_viewed_at')
                .eq('request_id', response.request_id)
                .eq('provider_id', currentProfile.user_id)
.single();

if (!chat || !chat.messages) return { requestId: response.request_id, hasMessages: false, unreadCount: 0 };

// Get last viewed time for provider
const lastViewedAt = chat.provider_last_viewed_at;

// âœ… FIX: Normalize timestamps before comparison
const normalizeToUTC = (timestamp) => {
    if (!timestamp) return null;
    let normalized = timestamp;
    if (typeof timestamp === 'string' && !timestamp.endsWith('Z') && !timestamp.includes('+')) {
        normalized = timestamp + 'Z';
    }
    return new Date(normalized).getTime();
};

// Count only messages AFTER last viewed time
const unreadCount = chat.messages.filter(m => {
    if (m.sender_id === currentUser.id) return false;
    if (!lastViewedAt) return true;
    
    const messageTime = normalizeToUTC(m.timestamp);
    const viewedTime = normalizeToUTC(lastViewedAt);
    
    return messageTime > viewedTime;
}).length;
            
            return { 
                requestId: response.request_id, 
                hasMessages: chat.messages.length > 0,
                unreadCount: unreadCount
            };
        }));
        
        // âœ… NEW: Check for deselected providers FIRST (before any filtering)
const deselectedChecks = await Promise.all(responses.map(async (response) => {
    const { data: rejectionCheck } = await supabase
        .from('request_rejected_providers')
        .select('id')
        .eq('request_id', response.request_id)
        .eq('provider_id', currentProfile.user_id)
        .maybeSingle();
    
    return {
        requestId: response.request_id,
        isDeselected: !!rejectionCheck
    };
}));

// Filter out open requests AND deselected requests from active responses
const activeResponses = responses.filter(response => {
    const request = requests.find(r => r.id === response.request_id);
    
    // âœ… NEW: Skip deselected requests
    const deselectedInfo = deselectedChecks.find(d => d.requestId === response.request_id);
    if (deselectedInfo && deselectedInfo.isDeselected) {
        console.log('â­ï¸ Filtering out deselected request from responses:', response.request_id);
        return false;
    }
    
    return request && request.status !== 'open';
});

// Combine all data - EXCLUDE open requests AND missed opportunities
const combinedData = activeResponses.map(response => {
    const request = requests.find(r => r.id === response.request_id);
    
    // Skip if request was deleted or invalid
    if (!request || !request.request_latitude || !request.request_longitude) {
        return null;
    }
    
    // âœ… NEW: Check if this provider is DESELECTED
    const deselectedInfo = deselectedChecks.find(d => d.requestId === response.request_id);
    if (deselectedInfo && deselectedInfo.isDeselected) {
        console.log('â­ï¸ Skipping deselected request:', request.id);
        return null; // Skip deselected requests - they go to Missed Opportunities
    }
    
    // Check if this is a "missed opportunity"
    const isMissedOpportunity = (request.status === 'in_progress' || request.status === 'completed' || request.status === 'pending_completion') && 
                               request.selected_provider_id !== currentProfile.user_id;
    
    // CRITICAL: Skip missed opportunities - they belong in Work Opportunities section now
    if (isMissedOpportunity) {
        return null;
    }
    
    const seeker = seekers.find(s => s.user_id === request.user_id);
    const chatInfo = chatChecks.find(c => c.requestId === response.request_id);
    
    return {
        ...response,
        request: request,
        seekerName: seeker?.name || 'Unknown',
        hasMessages: chatInfo?.hasMessages || false,
        unreadCount: chatInfo?.unreadCount || 0
    };
}).filter(data => data !== null);

// Pass only active responses to display function (no missed opportunities)
await displayProviderResponses(combinedData);

// Update total badge (only active responses, excluding missed)
//document.getElementById('myResponsesTotal').textContent = combinedData.length;
        
    } catch (error) {
        console.error('Error loading provider responses:', error);
    } 
}

async function displayProviderResponses(activeResponses) {
    const container = document.getElementById('myResponsesList');
    
    // Check if no active responses
    if (!activeResponses || activeResponses.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <div class="empty-state-icon">ðŸ’¬</div>
                <div class="empty-state-text">${t('no_responses_yet')}. ${t('respond_to_start')}</div>
            </div>
        `;
        document.getElementById('myResponsesTotal').textContent = '0';
        const myResponsesNewEl = document.getElementById('myResponsesNew');
        if (myResponsesNewEl) {
            myResponsesNewEl.classList.add('hidden');
            myResponsesNewEl.style.display = 'none';
        }
        return;
    }
    
    // NEW LOGIC: Separate into 4 categories (MERGED REACTIVATED INTO IN PROGRESS)
const activeNegotiating = activeResponses.filter(r => 
    r.request.status === 'open' // Still negotiating, not selected yet
);

// âœ… MERGED: In Progress now includes BOTH normal + reactivated
const inProgress = activeResponses.filter(r => 
    r.request.status === 'in_progress' // ALL in_progress (both normal + reactivated)
);

const pendingCompletion = activeResponses.filter(r => 
    r.request.status === 'pending_completion' && 
    r.request.selected_provider_id === currentProfile.user_id
);

const completedResponses = activeResponses.filter(r => 
    r.request.status === 'completed'
);
    
    // Calculate unread counts for each category
const activeUnread = activeNegotiating.reduce((sum, r) => sum + (r.unreadCount || 0), 0);
const inProgressUnread = inProgress.reduce((sum, r) => sum + (r.unreadCount || 0), 0);
const pendingCompletionUnread = pendingCompletion.reduce((sum, r) => sum + (r.unreadCount || 0), 0);
const completedUnread = completedResponses.reduce((sum, r) => sum + (r.unreadCount || 0), 0);

document.getElementById('myResponsesTotal').textContent = inProgress.length + pendingCompletion.length + completedResponses.length;

// NEW: Add sub-tabs for Active, In Progress, Pending Completion, Reactivated, Completed
let tabsHTML = '<div class="sub-tabs" style="margin-bottom: 20px;">';

// Tab 2: In Progress
if (true || inProgress.length > 0) {  // Always show
    const unreadBadge = inProgressUnread > 0 ? `
        <div class="badge-container">
            <div class="chat-bubble-icon"></div>
            <span class="unread-badge">${inProgressUnread}</span>
        </div>
    ` : '';
    
    tabsHTML += `
        <button class="sub-tab ${currentResponseFilter === 'in_progress' ? 'active' : ''}" onclick="filterResponses('in_progress')">
            <span>${t('in_progress')}</span>
            <div class="sub-tab-badges">
                <span class="count-badge">${inProgress.length}</span>
                ${unreadBadge}
            </div>
        </button>
    `;
}

// Tab 3: Waiting (renamed from Pending Completion)
if (true || pendingCompletion.length > 0) {
    const unreadBadge = pendingCompletionUnread > 0 ? `
        <div class="badge-container">
            <div class="chat-bubble-icon"></div>
            <span class="unread-badge">${pendingCompletionUnread}</span>
        </div>
    ` : '';
    
    tabsHTML += `
        <button class="sub-tab ${currentResponseFilter === 'pending_completion' ? 'active' : ''}" onclick="filterResponses('pending_completion')">
            <span>${t('waiting')}</span>
            <div class="sub-tab-badges">
                <span class="count-badge">${pendingCompletion.length}</span>
                ${unreadBadge}
            </div>
        </button>
    `;
}


// Tab 5: Completed
if (true || completedResponses.length > 0) {
    const unreadBadge = completedUnread > 0 ? `
        <div class="badge-container">
            <div class="chat-bubble-icon"></div>
            <span class="unread-badge">${completedUnread}</span>
        </div>
    ` : '';
    
    tabsHTML += `
        <button class="sub-tab ${currentResponseFilter === 'completed' ? 'active' : ''}" onclick="filterResponses('completed')">
            <span>${t('completed')}</span>
            <div class="sub-tab-badges">
                <span class="count-badge">${completedResponses.length}</span>
                ${unreadBadge}
            </div>
        </button>
    `;
}

tabsHTML += '</div>';
    
    // NEW: Determine which data to show based on filter
let responsesData = inProgress; // Default to In Progress (no more Active tab)

if (currentResponseFilter === 'in_progress') {
    responsesData = inProgress;
    } else if (currentResponseFilter === 'pending_completion') {  // â† ðŸ†• NEW FILTER
        responsesData = pendingCompletion;
    } else if (currentResponseFilter === 'reactivated') {
        responsesData = reactivated;
    } else if (currentResponseFilter === 'completed') {
        responsesData = completedResponses;
    }
    
    // NEW: If filtered data is empty, show empty state
if (!responsesData || responsesData.length === 0) {
    let emptyIcon = 'ðŸ“‹';
    let emptyText = t('no_in_progress_requests');
    
    if (currentResponseFilter === 'in_progress') {
        emptyIcon = 'ðŸ“‹';
        emptyText = t('no_in_progress_requests');
    } else if (currentResponseFilter === 'pending_completion') {
        emptyIcon = 'â³';
        emptyText = t('no_waiting_requests');
    } else if (currentResponseFilter === 'reactivated') {
        emptyIcon = 'ðŸ”';
        emptyText = t('no_reactivated_requests');
    } else if (currentResponseFilter === 'completed') {
        emptyIcon = 'âœ…';
        emptyText = t('no_completed_requests');
    }
        
        container.innerHTML = tabsHTML + `
            <div class="empty-state">
                <div class="empty-state-icon">${emptyIcon}</div>
                <div class="empty-state-text">${emptyText}</div>
            </div>
        `;
        return;
    }
    
    // Count unread messages from ALL active responses (not just in progress)
    const totalUnread = activeResponses.reduce((sum, d) => sum + (d.unreadCount || 0), 0);
    
    // Update section badges - show total unread count with chat bubble icon
    const myResponsesNewEl = document.getElementById('myResponsesNew');
    if (myResponsesNewEl) {
        if (totalUnread > 0) {
            const unreadBadge = myResponsesNewEl.querySelector('.unread-badge');
            if (unreadBadge) {
                unreadBadge.textContent = totalUnread;
            }
            myResponsesNewEl.classList.remove('hidden');
            myResponsesNewEl.style.display = 'inline-flex';
        } else {
            myResponsesNewEl.classList.add('hidden');
            myResponsesNewEl.style.display = 'none';
        }
    }
    
    let html = tabsHTML; // Start with tabs
    
for (let data of responsesData) {
    const req = data.request;
    if (!req) continue;
    
    const icon = getServiceIcon(req.service_id);
    const timeAgo = getTimeAgo(new Date(data.created_at));
    
    // âœ… Line 1: Reactivated check
    const isReactivated = req.status === 'in_progress' && req.warranty_end_date;
    const reactivatedBadge = isReactivated ? `<span style="color: #dc3545; font-weight: 700; font-size: 11px; margin-left: 6px; background: #fee; padding: 2px 8px; border-radius: 4px;">${t('reactivated')}</span>` : '';

    // âœ… Line 2: Declare isReadOnlyChat FIRST
    let isReadOnlyChat = false;

    // âœ… Line 3: Check if provider stopped service (uses isReadOnlyChat)
    //let hasStoppedService = false;
    let serviceStoppedBadge = '';
    
    // Only check if this is the current provider's response
    if (currentProfile.user_id === data.provider_id) {
        const { data: chatCheck } = await supabase
            .from('chats')
            .select('is_read_only, read_only_reason')
            .eq('request_id', req.id)
            .eq('provider_id', currentProfile.user_id)
            .maybeSingle();
        
        hasStoppedService = chatCheck?.is_read_only && 
                           chatCheck?.read_only_reason === 'provider_stopped_service';
        
        if (hasStoppedService) {
            serviceStoppedBadge = `<span style="color: #856404; font-weight: 700; font-size: 11px; margin-left: 6px; background: #fff3cd; padding: 2px 8px; border-radius: 4px;">âš ï¸ ${t('service_no_longer_available')}</span>`;
            isReadOnlyChat = true; // Mark chat as read-only
        }
    }

	// Determine status
        let statusBadge = '';
        let chatButton = '';

        if (data.isMissedOpportunity) {
    // Read-only chat button
    chatButton = `<button class="btn btn-chat action-btn-compact" style="background: #6c757d;" onclick="openChat('${req.id}', '${currentProfile.user_id}')">${t('view_chat')}</button>`;
} else {
    // Active response - normal buttons with unread badge
    const unreadBadgeHTML = data.unreadCount > 0 ? `<span class="chat-unread-badge">${data.unreadCount}</span>` : '';
    
if (req.status === 'completed') {
    // CHECK WARRANTY FIRST - BEFORE CREATING BUTTON
    if (req.warranty_period === 0 || req.warranty_period === null) {
        const completionDate = new Date(req.warranty_end_date);
        const gracePeriodEndDate = new Date(completionDate);
        gracePeriodEndDate.setDate(gracePeriodEndDate.getDate() + 7);
        const currentDate = new Date();
        
        if (currentDate > gracePeriodEndDate) {
            isReadOnlyChat = true;
        }
    } else if (req.warranty_period > 0) {
        const warrantyEndDate = new Date(req.warranty_end_date);
        const currentDate = new Date();
        
        if (currentDate > warrantyEndDate) {
            isReadOnlyChat = true;
        }
    }
    
    // NOW CREATE BUTTON WITH CORRECT FLAG
    statusBadge = `<span class="status-badge status-completed">âœ… ${t('status_completed')}</span>`;
    chatButton = `<div class="chat-btn-wrapper"><button class="btn ${isReadOnlyChat ? 'btn-view-profile' : 'btn-chat'} action-btn-compact" onclick="openChat('${req.id}', '${currentProfile.user_id}', ${isReadOnlyChat})">${isReadOnlyChat ? t('view_chat') : t('chat')}</button>${isReadOnlyChat ? '' : unreadBadgeHTML}</div>`;
    } else if (req.status === 'pending_completion' && req.selected_provider_id === currentProfile.user_id) {
                statusBadge = `<span class="status-badge" style="background: #fff3cd; color: #856404;">â³ ${t('status_pending_approval')}</span>`;
                chatButton = `<div class="chat-btn-wrapper"><button class="btn ${hasStoppedService ? 'btn-view-profile' : 'btn-chat'} action-btn-compact" onclick="openChat('${req.id}', '${currentProfile.user_id}', ${hasStoppedService})">${hasStoppedService ? t('view_chat') : t('chat')}</button>${hasStoppedService ? '' : unreadBadgeHTML}</div>`;
            } else if (req.status === 'in_progress' && req.selected_provider_id === currentProfile.user_id) {
                statusBadge = `<span class="status-badge" style="background: #cce5ff; color: #004085;">ðŸ”„ ${t('status_in_progress')}</span>`;
                chatButton = `<div class="chat-btn-wrapper"><button class="btn ${hasStoppedService ? 'btn-view-profile' : 'btn-chat'} action-btn-compact" onclick="openChat('${req.id}', '${currentProfile.user_id}', ${hasStoppedService})">${hasStoppedService ? t('view_chat') : t('chat')}</button>${hasStoppedService ? '' : unreadBadgeHTML}</div>`;
            } else if (req.status === 'open') {
                statusBadge = `<span class="status-badge status-open">â³ ${t('status_pending')}</span>`;
                chatButton = `<div class="chat-btn-wrapper"><button class="btn ${hasStoppedService ? 'btn-view-profile' : 'btn-chat'} action-btn-compact" onclick="openChat('${req.id}', '${currentProfile.user_id}', ${hasStoppedService})">${hasStoppedService ? t('view_chat') : t('chat')}</button>${hasStoppedService ? '' : unreadBadgeHTML}</div>`;
            }
        }
        
        // â† ðŸ†• NEW: Show warranty period for pending_completion requests
        let warrantyBadge = '';
        if (req.status === 'pending_completion' && req.warranty_period !== null && req.warranty_period !== undefined) {
            if (req.warranty_period === 0) {
                warrantyBadge = `<span class="info-badge" style="background: #6c757d;">ðŸ›¡ï¸ ${t('no_warranty_offered')}</span>`;
            } else {
                warrantyBadge = `<span class="info-badge" style="background: #17a2b8;">ðŸ›¡ï¸ ${req.warranty_period} ${t('days_warranty_offered')}</span>`;
            }
        }
        
        // Calculate remaining warranty if completed
        if (req.status === 'completed' && req.warranty_end_date) {
            // Only show warranty if this provider is the SELECTED provider who did the work
            if (req.selected_provider_id === currentProfile.user_id) {
                const warrantyEndDate = new Date(req.warranty_end_date);
                const today = new Date();
                const remainingDays = Math.ceil((warrantyEndDate - today) / (1000 * 60 * 60 * 24));
                
                if (remainingDays > 0) {
                    warrantyBadge = `<span class="info-badge" style="background: #28a745;">ðŸ›¡ï¸ ${remainingDays} ${t('days_warranty')}</span>`;
                } else if (remainingDays === 0) {
                    warrantyBadge = `<span class="info-badge" style="background: #ffc107; color: #333;">ðŸ›¡ï¸ ${t('warranty_expires_today')}</span>`;
                } else {
                    warrantyBadge = `<span class="info-badge" style="background: #dc3545;">ðŸ›¡ï¸ ${t('warranty_expired')}</span>`;
                }
            }
        }
        
        const distance = calculateDistance(
            currentProfile.latitude,
            currentProfile.longitude,
            req.request_latitude,
            req.request_longitude
        );
        
       html += `
    <div class="request-card compact">
        <div class="request-card-main">
            <div class="request-card-left">
                <div class="request-title-compact" onclick="toggleRequestDetails(event, 'resp-${req.id}')">
                    <span class="urgency-bubble ${req.urgency}"></span>
                    <span class="request-title-text">${icon} ${req.title}${reactivatedBadge}${serviceStoppedBadge}</span>
                    <span class="request-chevron" id="chevron-resp-${req.id}">â–¼</span>
                </div>
                <div class="request-summary" style="display: flex !important; justify-content: space-between !important; width: 100% !important; align-items: center !important;">
    ${statusBadge}
    ${chatButton}
</div>
                ${warrantyBadge ? `<div class="request-summary">${warrantyBadge}</div>` : ''}
                <div class="request-summary" style="margin-top: 6px; color: #999;">
                    ðŸ‘¤ ${data.seekerName} â€¢ ðŸ“ ${distance} km â€¢ ðŸ•’ ${timeAgo}
                </div>
            </div>
        </div>
                <div class="request-details" id="details-resp-${req.id}">
                    <div class="request-description"><strong>${t('description')}:</strong> ${req.description}</div>
                    <div class="request-location" style="margin-top: 8px;"><strong>${t('location')}:</strong> ${req.request_location_address}</div>
                    <div class="request-meta" style="margin-top: 8px;">
                        <span class="meta-item">ðŸ”§ ${t('service')}: ${req.service_id}</span>
                    </div>
                </div>
            </div>
        `;
    }
    
    container.innerHTML = html;
}

        // Load Nearby Requests (Provider View)
// Load Nearby Requests (Provider View) - WITH DEBUG LOGS
async function loadNearbyRequests() {
    try {
        console.log('ðŸ”µ ========== LOAD NEARBY REQUESTS DEBUG ==========');
        console.log('ðŸ”µ Current Provider ID:', currentProfile.user_id);
        console.log('ðŸ”µ Provider Name:', currentProfile.name);
        console.log('ðŸ”µ Provider Coordinates:', {
            lat: currentProfile.latitude,
            lng: currentProfile.longitude
        });
        
        // Step 1: Get all open requests (sorted by latest first)
const { data: allRequests, error: reqError } = await supabase
    .from('requests')
    .select(`
        *,
        service:services!fk_requests_service(name)
    `)
    .eq('status', 'open')
    .order('created_at', { ascending: false });  // âœ… NEW: Sort by latest first
        
        if (reqError) throw reqError;
        
        console.log('ðŸ”µ Total OPEN requests in database:', allRequests?.length || 0);
        if (allRequests && allRequests.length > 0) {
            console.log('ðŸ”µ All open requests:', allRequests.map(r => ({
                id: r.id,
                title: r.title,
                service: r.service_id,
                location: { lat: r.request_latitude, lng: r.request_longitude },
                address: r.request_location_address
            })));
        }

        // Step 2: Get provider's responses to filter them out
        const { data: myResponses, error: respError } = await supabase
            .from('request_responses')
            .select('request_id')
            .eq('provider_id', currentProfile.user_id);
        
        if (respError) throw respError;
        
        const respondedIds = new Set((myResponses || []).map(r => r.request_id));
        console.log('ðŸ”µ Requests I already responded to:', Array.from(respondedIds));

        const nearby = [];
        
        // Step 3: Get provider's services
        const { data: providerServices, error: servError } = await supabase
            .from('provider_services')
            .select('*')
            .eq('provider_id', currentProfile.user_id);
        
        if (servError) throw servError;
        
        console.log('ðŸ”µ My Services:', providerServices?.map(s => ({
            service: s.service_id,
            radius: s.service_radius
        })) || 'NONE');
        
        if (!providerServices || providerServices.length === 0) {
            console.log('âŒ PROBLEM: Provider has NO services registered!');
            document.getElementById('nearbyRequestsList').innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">âš ï¸</div>
                    <div class="empty-state-text">${t('no_services_added_update_profile')}</div>
                </div>
            `;
            document.getElementById('availableWorkTotal').textContent = '0';
            return;
        }
        
        // Step 4: Filter requests
        for (let req of allRequests || []) {
            console.log('ðŸ”µ --- Checking Request:', req.title);
            
            // Skip if already responded
            if (respondedIds.has(req.id)) {
                console.log('â­ï¸ SKIP: Already responded to this request');
                continue;
            }
            
            // Check if request has valid coordinates
            if (!req.request_latitude || !req.request_longitude) {
                console.log('âŒ SKIP: Request has invalid coordinates');
                continue;
            }
            
            // Calculate distance
            const distance = calculateDistance(
                currentProfile.latitude,
                currentProfile.longitude,
                req.request_latitude,
                req.request_longitude
            );
            
            console.log('ðŸ“ Distance:', distance, 'km');
            
            // Check if provider offers this service
            const matchingService = providerServices.find(s => s.service_id === req.service_id);
            
            if (!matchingService) {
    console.log('âŒ SKIP: Provider does NOT offer service:', req.service_id);
    continue;
}

console.log('âœ… Provider offers this service:', req.service_id);
            console.log('ðŸ“ Service radius:', matchingService.service_radius, 'km');
            
            // Check if within service radius
            if (distance <= matchingService.service_radius) {
                console.log('âœ… MATCH! Request is within radius:', distance, 'km <=', matchingService.service_radius, 'km');
                nearby.push({
    ...req,
    distance: distance,
    serviceRadius: matchingService.service_radius,
    service_name: req.service?.name || req.service_id
});
            } else {
                console.log('âŒ SKIP: Request is OUTSIDE radius:', distance, 'km >', matchingService.service_radius, 'km');
            }
        }

        console.log('ðŸ”µ Total matching requests:', nearby.length);
        console.log('ðŸ”µ ========== END DEBUG ==========');

        // Continue with rest of function (missed opportunities, etc.)
        const { data: allRespondedRequests, error: allReqError } = await supabase
    .from('requests')
    .select('*')
    .in('id', Array.from(respondedIds))
    .order('created_at', { ascending: false });  // âœ… NEW: Sort by latest first

        if (allReqError) throw allReqError;

        const missedOpportunities = [];

// âœ… NEW: Check for deselected requests
const { data: deselectedRequests, error: deselectedError } = await supabase
    .from('request_rejected_providers')
    .select('request_id')
    .eq('provider_id', currentProfile.user_id);

if (deselectedError) {
    console.error('Error fetching deselected requests:', deselectedError);
}

const deselectedRequestIds = new Set((deselectedRequests || []).map(r => r.request_id));

console.log('ðŸ”µ Deselected request IDs:', Array.from(deselectedRequestIds));

for (let req of allRespondedRequests || []) {
    // Check if this is a regular missed opportunity (another provider was selected)
    const isMissed = (req.status === 'in_progress' || req.status === 'completed' || req.status === 'pending_completion') && 
                     req.selected_provider_id !== currentProfile.user_id;
    
    // âœ… NEW: Check if this provider was DESELECTED
    const isDeselected = deselectedRequestIds.has(req.id);
    
    if ((isMissed || isDeselected) && req.request_latitude && req.request_longitude) {
        const distance = calculateDistance(
            currentProfile.latitude,
            currentProfile.longitude,
            req.request_latitude,
            req.request_longitude
        );
        
        console.log('ðŸ“Š Adding to missed opportunities:', {
            id: req.id,
            title: req.title,
            isMissed: isMissed,
            isDeselected: isDeselected
        });
        
        missedOpportunities.push({
            ...req,
            distance: distance,
            isDeselected: isDeselected  // âœ… NEW: Mark deselected requests
        });
    }
}

console.log('ðŸ”µ Total missed opportunities:', missedOpportunities.length);

// âœ… NEW: Calculate new missed opportunities count
const lastMissedOpenedAt = currentProfile.missed_opportunities_last_opened_at;
let newMissedCount = 0;

if (!lastMissedOpenedAt) {
    // Never opened before - all missed opportunities are "new"
    newMissedCount = missedOpportunities.length;
} else {
    // Count missed opportunities that became "missed" after last viewed time
    const lastOpenedDate = new Date(lastMissedOpenedAt);
    newMissedCount = missedOpportunities.filter(r => {
        // A request becomes "missed" when it moves to in_progress/completed with different provider
        // We check if the request was updated (status changed) after last viewed time
        const requestUpdatedAt = new Date(r.updated_at || r.created_at);
        return requestUpdatedAt > lastOpenedDate;
    }).length;
}

console.log('ðŸ”µ New missed opportunities count:', newMissedCount);

        // Update badges
        const availableCount = nearby.length;
        const totalElement = document.getElementById('availableWorkTotal');
        const newElement = document.getElementById('availableWorkNew');

        if (totalElement) totalElement.textContent = availableCount;

        const lastOpenedAt = currentProfile.available_work_last_opened_at;
        let newCount = 0;

        if (!lastOpenedAt) {
            newCount = nearby.length;
        } else {
            const lastOpenedDate = new Date(lastOpenedAt);
            newCount = nearby.filter(r => {
                const requestCreatedAt = new Date(r.created_at);
                return requestCreatedAt > lastOpenedDate;
            }).length;
        }

        if (newElement) {
            if (newCount > 0) {
                newElement.textContent = `ðŸ†• ${newCount}`;
                newElement.classList.remove('hidden');
                newElement.style.display = 'inline-block';
            } else {
                newElement.classList.add('hidden');
                newElement.style.display = 'none';
            }
        }

        displayNearbyRequests(nearby, missedOpportunities, newMissedCount);
        
    } catch (error) {
        console.error('âŒ Error loading nearby requests:', error);
    }
}

// Step 6: Pass both available and missed to display function
async function displayNearbyRequests(availableRequests, missedRequests, newMissedCount) {
    const container = document.getElementById('nearbyRequestsList');
const tabsContainer = document.getElementById('urgencyTabs');

// Handle empty state for both available and missed
if ((!availableRequests || availableRequests.length === 0) && (!missedRequests || missedRequests.length === 0)) {
    container.innerHTML = `
        <div class="empty-state">
            <div class="empty-state-icon">ðŸ’¼</div>
            <div class="empty-state-text">${t('no_work_available')}</div>
        </div>
    `;
    tabsContainer.innerHTML = '';
    document.getElementById('availableWorkTotal').textContent = '0';
    document.getElementById('availableWorkNew').classList.add('hidden');
    return;
}

// Determine which data to show based on current filter
let requests = availableRequests || [];
if (window.currentWorkFilter === 'missed') {
    requests = missedRequests || [];
}

    // Count by urgency for tabs
    const urgentCount = requests.filter(r => r.urgency === 'urgent').length;
    const normalCount = requests.filter(r => r.urgency === 'normal').length;
    const flexibleCount = requests.filter(r => r.urgency === 'low').length;
    const newCount = requests.filter(r => {
        const hoursSince = (new Date() - new Date(r.created_at)) / (1000 * 60 * 60);
        return hoursSince < 2;
    }).length;

    // Update section badges
    document.getElementById('availableWorkTotal').textContent = requests.length;
    if (newCount > 0) {
        document.getElementById('availableWorkNew').textContent = `ðŸ†• ${newCount}`;
        document.getElementById('availableWorkNew').classList.remove('hidden');
    } else {
        document.getElementById('availableWorkNew').classList.add('hidden');
    }

    // Build subtabs for Available Work and Missed Opportunities
const availableCount = availableRequests ? availableRequests.length : 0;
const missedCount = missedRequests ? missedRequests.length : 0;
const currentFilter = window.currentWorkFilter || 'available';

let tabsHTML = '';

// Available Work tab
if (availableCount > 0) {
    tabsHTML += `<button class="sub-tab ${currentFilter === 'available' ? 'active' : ''}" onclick="filterWorkOpportunities('available')">ðŸ“ ${t('available_work')} <span class="count-badge">${availableCount}</span></button>`;
}

// Missed Opportunities tab
if (missedCount > 0) {
    const newMissedBadge = newMissedCount > 0 
        ? `<span class="info-badge" style="background: #dc3545; color: white;" id="missedOpportunitiesNew">ðŸ†• ${newMissedCount}</span>`
        : '';
    
    tabsHTML += `
        <button class="sub-tab ${currentFilter === 'missed' ? 'active' : ''}" onclick="filterWorkOpportunities('missed')">
            <span>â›” ${t('missed_opportunities')}</span>
            <div class="sub-tab-badges">
                <span class="count-badge">${missedCount}</span>
                ${newMissedBadge}
            </div>
        </button>
    `;
}

tabsContainer.innerHTML = tabsHTML;

    // Filter by urgency
    let filteredRequests = requests;
    if (currentUrgencyFilter !== 'all') {
        filteredRequests = requests.filter(r => r.urgency === currentUrgencyFilter);
    }

    if (filteredRequests.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <div class="empty-state-icon">ðŸ“</div>
                <div class="empty-state-text">${t('no_urgency_requests').replace('{urgency}', currentUrgencyFilter)}</div>
            </div>
        `;
        return;
    }

    // Build HTML for requests
    let html = '';
    
    for (let req of filteredRequests) {
        const icon = getServiceIcon(req.service_id);
        const timeAgo = getTimeAgo(new Date(req.created_at));                                         
        const newBadge = ((new Date() - new Date(req.created_at)) / (1000 * 60 * 60)) < 2 ? `<span class="info-badge">ðŸ†• ${t('new_badge')}</span>` : '';
        
        html += `
    <div class="request-card compact">
        <div class="request-card-main">
            <div class="request-card-left">
                <div class="request-title-compact" onclick="toggleRequestDetails(event, 'nearby-${req.id}')">
    <span class="urgency-bubble ${req.urgency}"></span>
    <span class="request-title-text">${icon} ${req.title}</span>
    <span class="request-chevron" id="chevron-nearby-${req.id}">â–¼</span>
</div><div class="request-summary">
    <span class="info-badge">ðŸ“ ${req.distance} km</span>
    ${req.isDeselected ? `<span class="info-badge" style="background: #dc3545; color: white;">âŒ ${t('deselected')}</span>` : ''}
    ${newBadge}
</div>
                        <div class="request-summary" style="margin-top: 6px; color: #999;">
    ðŸ•’ ${timeAgo} â€¢ ðŸ”§ ${req.service_name || req.service_id}
</div>
                    </div>
                    <div class="request-card-right">
    ${window.currentWorkFilter === 'missed' 
        ? `<button class="btn btn-respond action-btn-compact" style="background: #6c757d;" onclick="openChat('${req.id}', '${currentProfile.user_id}', true)">${t('view_chat')}</button>`
        : (currentProfile.email_verified 
            ? `<button class="btn btn-respond action-btn-compact" onclick="respondToRequest('${req.id}')">${t('respond')}</button>`
            : `<button class="btn btn-respond action-btn-compact" style="background: #6c757d; opacity: 0.6; cursor: not-allowed;" onclick="alert('âš ï¸ ${t('verify_email_before_responding')}')">ðŸ”’ ${t('verify_email')}</button>`
          )
    }
</div>
                </div>
                <div class="request-details" id="details-nearby-${req.id}">
                    <div class="request-description"><strong>${t('description')}:</strong> ${req.description}</div>
                    <div class="request-location" style="margin-top: 8px;"><strong>${t('location')}:</strong> ${req.request_location_address}</div>
                    <div class="request-meta" style="margin-top: 8px;">
                        <span class="meta-item">ðŸ“ ${t('distance')}: ${req.distance} km</span>
                    </div>
                </div>
            </div>
        `;
    }
    
    container.innerHTML = html;
}                		

// Respond to Request (Provider)
async function respondToRequest(requestId) {
    const respondBtn = event.target;
    respondBtn.disabled = true;
    respondBtn.textContent = t('checking');
    
    // âœ… CRITICAL FIX: Check if email is verified FIRST
    if (!currentProfile || !currentProfile.email_verified) {
        alert(`âš ï¸ ${t('verify_email_before_responding')}\n\nðŸ“§ ${t('check_inbox')}\n\nðŸ’¡ ${t('check_spam')}`);
        respondBtn.disabled = false;
        respondBtn.textContent = t('respond');
        return;
    }
    
    try {
        // Check if already responded
        const { data: existingResponse, error: checkError } = await supabase
            .from('request_responses')
            .select('id')
            .eq('request_id', requestId)
            .eq('provider_id', currentProfile.user_id);

        if (checkError) throw checkError;

        if (existingResponse && existingResponse.length > 0) {
            alert(`âš ï¸ ${t('already_responded')}`);
            respondBtn.textContent = `âœ… ${t('responded')}`;
            respondBtn.style.background = '#6c757d';
            respondBtn.disabled = false;
            return;
        }

        // ðŸ†• STEP 1: CHECK CREDIT BALANCE
        const currentCredits = currentProfile.credits || 0;
        
        // ðŸ†• STEP 2: DETERMINE COST (50 for first response, 40 for additional)
        const { data: providerResponseCount, error: countError } = await supabase
            .from('request_responses')
            .select('id', { count: 'exact', head: true })
            .eq('provider_id', currentProfile.user_id);
        
        if (countError) throw countError;
        
        const isFirstResponse = !providerResponseCount || providerResponseCount.count === 0;
        const responseCost = isFirstResponse ? 50 : 40;
        
        // ðŸ†• STEP 3: CHECK IF PROVIDER HAS ENOUGH CREDITS
        if (currentCredits < responseCost) {
            alert(`âŒ Insufficient credits!\n\nYou have ${currentCredits} credits.\nYou need ${responseCost} credits to respond.\n\n${isFirstResponse ? '(First response costs 50 credits)' : '(Additional responses cost 40 credits)'}`);
            respondBtn.disabled = false;
            respondBtn.textContent = t('respond');
            return;
        }

        // ðŸ†• STEP 4: INSERT RESPONSE FIRST (to get response ID)
        const { data: newResponse, error: insertError } = await supabase
            .from('request_responses')
            .insert([{
                request_id: requestId,
                provider_id: currentProfile.user_id,
                status: 'pending',
                availability: 'available',
                response_message: `Hi! I am interested in providing this service.`
            }])
            .select()
            .single();

        if (insertError) throw insertError;

        // ðŸ†• STEP 5: DEDUCT CREDITS AFTER SUCCESSFUL RESPONSE
        await deductCredits(
            currentProfile.user_id,
            responseCost,
            `Response to service request (${isFirstResponse ? 'first response' : 'additional response'})`,
            requestId
        );
        
        // ðŸ†• STEP 6: UPDATE LOCAL PROFILE CREDITS
        currentProfile.credits -= responseCost;
        displayCreditBalance();

        alert(`âœ… ${t('response_sent_success')}\n\nðŸ’³ -${responseCost} credits deducted`);

        // Reload dashboard to move request from Available Work to My Responses
        await loadProviderResponses();
        await loadNearbyRequests();

        // Change button to show "Responded"
        respondBtn.textContent = `âœ… ${t('responded')}`;
        respondBtn.style.background = '#6c757d';
        respondBtn.disabled = false;
        
    } catch (error) {
        alert(`âŒ ${t('error')}: ${error.message}`);
        respondBtn.disabled = false;
        respondBtn.textContent = t('');
    }
}

        // Cancel Request
async function cancelRequest(requestId) {
    if (!confirm(`âš ï¸ ${t('confirm_cancel_request')}\n\nðŸ—‘ï¸ ${t('permanent_delete')}`)) return;
    
    try {
        // STEP 1: GET REQUEST DETAILS BEFORE DELETION
        const { data: request, error: fetchError } = await supabase
            .from('requests')
            .select('title, user_id')
            .eq('id', requestId)
            .single();

        if (fetchError) throw fetchError;

                // STEP 2: CHECK IF THERE ARE ANY RESPONSES
        const { data: responses, error: responsesError } = await supabase
            .from('request_responses')
            .select('id, provider_id')
            .eq('request_id', requestId);

        if (responsesError) throw responsesError;

        const hasResponses = responses && responses.length > 0;
        
        // ðŸ†• STEP 2B: REFUND ALL PROVIDERS WHO RESPONDED (before deletion)
        if (hasResponses) {
            console.log('ðŸ”„ Refunding', responses.length, 'providers who responded...');
            
            for (let response of responses) {
                try {
                    // Check if this was their first response ever (50 credits) or additional (40 credits)
                    const { count: totalResponses, error: countError } = await supabase
                        .from('request_responses')
                        .select('id', { count: 'exact', head: true })
                        .eq('provider_id', response.provider_id);
                    
                    if (countError) {
                        console.error('Error counting provider responses:', countError);
                        continue;
                    }
                    
                    // If this is their only response, it was their first (50 credits)
                    // Otherwise it was additional (40 credits)
                    const wasFirstResponse = totalResponses === 1;
                    const refundAmount = wasFirstResponse ? 50 : 40;
                    
                    console.log(`ðŸ’° Refunding ${refundAmount} credits to provider ${response.provider_id}`);
                    
                    await addCredits(
                        response.provider_id,
                        refundAmount,
                        'Full refund: Request cancelled by seeker',
                        requestId,
                        'completed',
                        null
                    );
                    
                    console.log(`âœ… Refunded ${refundAmount} credits to provider ${response.provider_id}`);
                    
                } catch (providerError) {
                    console.error(`âŒ Error refunding provider ${response.provider_id}:`, providerError);
                    // Continue processing other providers even if one fails
                }
            }
            
            console.log('âœ… All provider refunds processed');
        }


        // STEP 3: CALCULATE REFUND (NO SEPARATE PENALTY DEDUCTION)
        let refundAmount, penaltyAmount;
        
        if (hasResponses) {
            // Scenario B: Request has responses
            // Original charge: 25 credits
            // Penalty: 15 credits (kept)
            // Refund: 10 credits (returned)
            refundAmount = 10;
            penaltyAmount = 15;
        } else {
            // Scenario A: No responses yet
            // Original charge: 25 credits
            // Penalty: 5 credits (kept)
            // Refund: 20 credits (returned)
            refundAmount = 20;
            penaltyAmount = 5;
        }

        // STEP 4: PROCESS REFUND ONLY (penalty already taken from original 25)
        await addCredits(
            currentUser.id,
            refundAmount,
            `Refund for cancelled request (penalty: ${penaltyAmount} credits): ${request.title}`,
            requestId,
            'completed',
            null
        );

        // STEP 5: UPDATE LOCAL PROFILE CREDITS
        currentProfile.credits += refundAmount;
        displayCreditBalance();

        // STEP 6: Delete all chat messages for this request
        const { error: chatError } = await supabase
            .from('chats')
            .delete()
            .eq('request_id', requestId);
        
        if (chatError) console.error('Error deleting chats:', chatError);
        
        // STEP 7: Delete all provider responses
        const { error: responseError } = await supabase
            .from('request_responses')
            .delete()
            .eq('request_id', requestId);
        
        if (responseError) console.error('Error deleting responses:', responseError);
        
        // STEP 8: Delete all ratings for this request
        const { error: ratingError } = await supabase
            .from('ratings')
            .delete()
            .eq('request_id', requestId);
        
        if (ratingError) console.error('Error deleting ratings:', ratingError);
        
        // STEP 9: Finally delete the request itself
        const { error: requestError } = await supabase
            .from('requests')
            .delete()
            .eq('id', requestId);
        
        if (requestError) throw requestError;

        // STEP 10: SHOW SUCCESS MESSAGE
        const message = `âœ… ${t('request_cancelled_success')}\n\nðŸ’³ Refund: +${refundAmount} credits\nâš ï¸ Penalty: ${penaltyAmount} credits (from original 25)\nðŸ“Š Total credits returned: ${refundAmount}/25`;
        
        alert(message);
        loadUserRequests();
        
    } catch (error) {
        alert('Error cancelling request: ' + error.message);
    }
}

// Change Provider (Deselect current provider)
async function changeProvider(requestId, currentProviderId) {
    if (!confirm(`ðŸ”„ ${t('change_provider_confirm')}\n\n${t('change_provider_warning')}`)) return;
    
    try {
        console.log('ðŸ”µ STEP 3C: Starting changeProvider with deselection refund...');
        console.log('ðŸ“Š Request ID:', requestId);
        console.log('ðŸ“Š Provider being deselected:', currentProviderId);
        
        // STEP 1: Check if provider paid 50 or 40 credits for their response
        const { data: providerResponseCount, error: countError } = await supabase
            .from('request_responses')
            .select('id', { count: 'exact', head: true })
            .eq('provider_id', currentProviderId);
        
        if (countError) {
            console.error('âŒ Error checking provider response count:', countError);
            throw countError;
        }
        
        // Determine original cost (50 for first response, 40 for additional)
        const wasFirstResponse = providerResponseCount && providerResponseCount.count === 1;
        const originalCost = wasFirstResponse ? 50 : 40;
        const refundAmount = 20; // Fixed deselection refund
        
        console.log(`ðŸ’° Provider originally paid ${originalCost} credits (${wasFirstResponse ? 'first' : 'additional'} response)`);
        console.log(`ðŸ’° Refunding ${refundAmount} credits for deselection`);
        
        // STEP 2: Process deselection refund (+20 credits)
        await addCredits(
            currentProviderId,
            refundAmount,
            'Refund: Deselected by seeker',
            requestId,
            'completed',
            null
        );
        
        console.log(`âœ… Refunded ${refundAmount} credits to deselected provider`);
        
        // STEP 3: Insert into request_rejected_providers table
        const { error: rejectError } = await supabase
            .from('request_rejected_providers')
            .insert([{
                request_id: requestId,
                provider_id: currentProviderId,
                rejected_by: currentUser.id,
                rejection_reason: 'deselected'
            }]);
        
        if (rejectError) {
            console.error('âŒ Error inserting rejection:', rejectError);
            throw rejectError;
        }
        
        console.log('âœ… Provider added to rejection table');
        
        // STEP 4: Update request - set status back to open and clear selected provider
        const { error: updateError } = await supabase
            .from('requests')
            .update({
                selected_provider_id: null,
                status: 'open'
            })
            .eq('id', requestId);
        
        if (updateError) {
            console.error('âŒ Error updating request:', updateError);
            throw updateError;
        }
        
        console.log('âœ… Request status changed to open');
        
        // STEP 5: Add system message to deselected provider's chat
        const { data: deselectedChat } = await supabase
            .from('chats')
            .select('messages')
            .eq('request_id', requestId)
            .eq('provider_id', currentProviderId)
            .maybeSingle();
        
        if (deselectedChat) {
            let messages = deselectedChat.messages || [];
            messages.push({
                sender_id: currentUser.id,
                sender_name: currentProfile.name,
                message: `âŒ ${t('sys_deselected')}\n\nðŸ’³ +${refundAmount} credits refunded`,
                message_type: 'system',
                timestamp: new Date().toISOString()
            });
            
            await supabase
                .from('chats')
                .update({ messages: messages })
                .eq('request_id', requestId)
                .eq('provider_id', currentProviderId);
            
            console.log('âœ… System message sent to deselected provider');
        }
        
        // STEP 6: Notify other providers who responded (reactivate their chats)
        const { data: allResponses } = await supabase
            .from('request_responses')
            .select('provider_id')
            .eq('request_id', requestId)
            .neq('provider_id', currentProviderId);
        
        if (allResponses && allResponses.length > 0) {
            for (let response of allResponses) {
                const { data: otherChat } = await supabase
                    .from('chats')
                    .select('messages')
                    .eq('request_id', requestId)
                    .eq('provider_id', response.provider_id)
                    .maybeSingle();
                
                if (otherChat) {
                    let messages = otherChat.messages || [];
                    messages.push({
                        sender_id: currentUser.id,
                        sender_name: currentProfile.name,
                        message: `ðŸ”„ ${t('sys_request_open_again')}`,
                        message_type: 'system',
                        timestamp: new Date().toISOString()
                    });
                    
                    await supabase
                        .from('chats')
                        .update({ messages: messages })
                        .eq('request_id', requestId)
                        .eq('provider_id', response.provider_id);
                }
            }
            
            console.log('âœ… Other providers notified');
        }
        
        console.log('âœ… STEP 3C COMPLETE: Provider deselected with +20 credit refund');
        
        alert(`âœ… ${t('provider_changed_success')}\n\nðŸ’³ Deselected provider received +${refundAmount} credits refund`);
        
        // Reload dashboard
        await loadUserRequests();
        
    } catch (error) {
        console.error('âŒ STEP 3C ERROR:', error);
        alert('âŒ Error changing provider: ' + error.message);
    }
}

// Reactivate Request (during warranty period)
        async function reactivateRequest(requestId) {
            if (!confirm(`ðŸ”„ ${t('reactivate_confirm')}\n\n${t('reactivate_warning')}`)) return;
            
            try {
                // Get request details to find selected provider
                const { data: request, error: reqError } = await supabase
                    .from('requests')
                    .select('selected_provider_id')
                    .eq('id', requestId)
                    .single();
                
                if (reqError || !request) throw reqError || new Error(t('request_not_found'));
                
                // Update request status
                const { error: updateError } = await supabase
                    .from('requests')
                    .update({
                        status: 'in_progress',
                    })
                    .eq('id', requestId);
                
                if (updateError) throw updateError;
                
                // Add system message to chat
                const { data: existingChat } = await supabase
                    .from('chats')
                    .select('messages')
                    .eq('request_id', requestId)
                    .eq('provider_id', request.selected_provider_id)
                    .single();
                
                let messages = existingChat?.messages || [];
                
                messages.push({
                    sender_id: currentUser.id,
                    sender_name: currentProfile.name,
                    message: `ðŸ”„ ${t('sys_reactivated')}`,
                    message_type: 'system',
                    timestamp: new Date().toISOString()
                });
                
                await supabase
                    .from('chats')
                    .upsert({
                        request_id: requestId,
                        provider_id: request.selected_provider_id,
                        messages: messages
                    }, { onConflict: 'request_id,provider_id' });
                
                alert(`âœ… ${t('request_reactivated_success')}`);
                loadUserRequests();
                
            } catch (error) {
                alert('Error reactivating request: ' + error.message);
            }
        }

// Edit Request - Load form with existing data
        async function editRequest(requestId) {
            try {
                showLoading();
                
                // Check if request has any responses
                const { data: responses } = await supabase
                    .from('request_responses')
                    .select('id')
                    .eq('request_id', requestId);
                
                if (responses && responses.length > 0) {
                    alert(`âš ï¸ ${t('cannot_edit_after_responses')}`);
                    showDashboard();
                    return;
                }
                
                // Load request data
                const { data: request, error } = await supabase
                    .from('requests')
                    .select('*')
                    .eq('id', requestId)
                    .single();
                
                if (error) throw error;
                
                if (request.status !== 'open') {
                    alert(`âš ï¸ ${t('only_open_requests_editable')}`);
                    showDashboard();
                    return;
                }
                
                // Show edit view and populate form
                hideAllViews();
                document.getElementById('editRequestView').classList.remove('hidden');
                
                // Populate form fields
                document.getElementById('editRequestId').value = request.id;
                document.getElementById('editServiceType').value = request.service_id;
                document.getElementById('editRequestTitle').value = request.title;
                document.getElementById('editRequestDescription').value = request.description;
                
                // Update character counters
                document.getElementById('editTitleCounter').textContent = request.title.length;
                document.getElementById('editDescCounter').textContent = request.description.length;
                
                // Set urgency
                document.getElementById('editUrgentRadio').checked = request.urgency === 'urgent';
                document.getElementById('editNormalRadio').checked = request.urgency === 'normal';
                document.getElementById('editLowRadio').checked = request.urgency === 'low';
                
                // Show current location (read-only)
                document.getElementById('currentLocationText').textContent = request.request_location_address;
                
            } catch (error) {
                alert('Error loading request: ' + error.message);
                showDashboard();
            }
        }

// Edit Request Form Submission
        document.getElementById('editRequestForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const errorDiv = document.getElementById('editRequestError');
            const infoDiv = document.getElementById('editRequestInfo');
            const submitBtn = document.getElementById('updateRequestBtn');

            errorDiv.classList.add('hidden');
            infoDiv.classList.add('hidden');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Updating...';

            try {
                const requestId = document.getElementById('editRequestId').value;
                const title = document.getElementById('editRequestTitle').value.trim();
                const description = document.getElementById('editRequestDescription').value.trim();
                const urgency = document.querySelector('input[name="editUrgency"]:checked').value;

                const updateData = {
                    title: title,
                    description: description,
                    urgency: urgency
                };

                infoDiv.textContent = 'ðŸ’¾ Updating request...';
                infoDiv.classList.remove('hidden');
                const { error } = await supabase
                    .from('requests')
                    .update(updateData)
                    .eq('id', requestId);

                if (error) throw error;

                infoDiv.classList.add('hidden');
                alert(`âœ… ${t('request_updated_success')}`);
                showDashboard();
            } catch (error) {
                errorDiv.textContent = error.message;
                errorDiv.classList.remove('hidden');
                submitBtn.disabled = false;
                submitBtn.textContent = 'ðŸ’¾ Update Request';
                infoDiv.classList.add('hidden');
            }
        });

        // Create Request
document.getElementById('createRequestForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    // Validate service selection
const serviceType = document.getElementById('serviceType').value;
const serviceSubtype = document.getElementById('serviceSubtype').value;

if (!serviceType || !serviceSubtype) {
    showError('createRequestError', t('please_select_service_type'));
    document.getElementById('serviceDropdownTrigger').scrollIntoView({ behavior: 'smooth', block: 'center' });
    return;
}
    const errorDiv = document.getElementById('createRequestError');
    const infoDiv = document.getElementById('createRequestInfo');
    const submitBtn = document.getElementById('submitRequestBtn');

    errorDiv.classList.add('hidden');
    infoDiv.classList.add('hidden');
    submitBtn.disabled = true;
    submitBtn.textContent = t('creating');

    try {
        // âœ… CRITICAL FIX: Check if email is verified BEFORE processing
        if (!currentProfile || !currentProfile.email_verified) {
            throw new Error(`âš ï¸ ${t('please_verify_email')}\n\nðŸ“§ ${t('check_inbox')}`);
        }
        
        // ðŸ†• STEP 1: CHECK CREDIT BALANCE BEFORE CREATING REQUEST
        const currentCredits = currentProfile.credits || 0;
        const requiredCredits = 25;
        
        if (currentCredits < requiredCredits) {
            throw new Error(`âŒ Insufficient credits!\n\nYou have ${currentCredits} credits.\nYou need ${requiredCredits} credits to create a request.\n\nPlease wait for pending credits or earn more.`);
        }
        
        const serviceType = document.getElementById('serviceType').value;
        const title = document.getElementById('requestTitle').value.trim();
        const description = document.getElementById('requestDescription').value.trim();
        const urgency = document.querySelector('input[name="urgency"]:checked').value;

        const useDifferentLocation = document.getElementById('differentLocation').checked;
        let locationData;

        if (useDifferentLocation) {
            const customLocation = {
                area_name: document.getElementById('customAreaName').value.trim(),
                landmark: document.getElementById('customLandmark').value.trim() || null,
                city: document.getElementById('customCity').value,
                state: document.getElementById('customState').value,
                pin_code: document.getElementById('customPinCode').value.trim()
            };

            infoDiv.textContent = `ðŸ“ ${t('finding_location')}`;
            infoDiv.classList.remove('hidden');

            const coords = await getCoordinates(customLocation);
            
            locationData = {
                address: [customLocation.area_name, customLocation.landmark, customLocation.city, customLocation.state, customLocation.pin_code].filter(Boolean).join(', '),
                latitude: coords.lat,
                longitude: coords.lng
            };
        } else {
            locationData = {
                address: [currentProfile.area_name, currentProfile.landmark, currentProfile.city, currentProfile.state, currentProfile.pin_code].filter(Boolean).join(', '),
                latitude: currentProfile.latitude,
                longitude: currentProfile.longitude
            };
        }

        infoDiv.textContent = `ðŸ’¾ ${t('creating_request')}`;

        // ðŸ†• STEP 2: CREATE REQUEST FIRST (to get request ID)
        const { data: newRequest, error: insertError } = await supabase
            .from('requests')
            .insert([{
                user_id: currentUser.id,
                service_id: serviceSubtype,
                title: title,
                description: description,
                urgency: urgency,
                request_location_address: locationData.address,
                request_latitude: locationData.latitude,
                request_longitude: locationData.longitude,
                status: 'open',
                chat_status: 'active'
            }])
            .select()
            .single();

        if (insertError) throw insertError;

// ðŸ†• STEP 3: DEDUCT 25 CREDITS AFTER REQUEST CREATION
await deductCredits(
    currentUser.id,
    25,
    `Created service request: ${title}`,
    newRequest.id,  // Link to the newly created request
    'completed',    // Status is completed (immediate deduction)
    null            // No warranty for this transaction
);

// âœ… Reload profile from database
await loadProfile(currentUser.id);
displayCreditBalance();

// âœ… NEW: Award referral bonus to referrer if this is user's first request
await awardReferralFirstRequestBonus(currentUser.id);

infoDiv.classList.add('hidden');
alert(`âœ… ${t('request_created')}\n\nðŸ’³ -25 credits deducted`);
        showDashboard();
        
    } catch (error) {
        errorDiv.textContent = error.message;
        errorDiv.classList.remove('hidden');
        submitBtn.disabled = false;
        submitBtn.textContent = t('create_request');
        infoDiv.classList.add('hidden');
    }
});

// Edit Profile Form Submission
document.getElementById('editProfileForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const errorDiv = document.getElementById('editProfileError');
    const infoDiv = document.getElementById('editProfileInfo');
    const submitBtn = document.getElementById('saveProfileBtn');
    
    errorDiv.classList.add('hidden');
    infoDiv.classList.add('hidden');
    submitBtn.disabled = true;
    submitBtn.textContent = t('saving');
    
    try {
        const formData = {
            name: document.getElementById('editName').value.trim(),
            phone: document.getElementById('editPhone').value.trim(),
            house_number: document.getElementById('editHouseNumber').value.trim() || null,
            area_name: document.getElementById('editAreaName').value.trim(),
            landmark: document.getElementById('editLandmark').value.trim() || null,
            city: document.getElementById('editCity').value,
            state: document.getElementById('editState').value,
            pin_code: document.getElementById('editPinCode').value.trim(),
            is_provider: currentProfile.is_provider,
            radius_km: parseInt(document.getElementById('editRadius').value)
        };
        
        // Handle profile photo update
        const photoFile = document.getElementById('editPhoto').files[0];
        if (photoFile) {
            if (photoFile.size > 2 * 1024 * 1024) {
                throw new Error(t('photo_size_error'));
            }
            infoDiv.textContent = `ðŸ“¸ ${t('uploading_photo')}`;
            infoDiv.classList.remove('hidden');
            formData.profile_photo = await convertImageToBase64(photoFile);
        } else {
            // Don't update photo if no file selected - keep existing
            delete formData.profile_photo;
        }
        
        // Check if address changed
        const addressChanged = 
            formData.house_number !== currentProfile.house_number ||
            formData.area_name !== currentProfile.area_name ||
            formData.landmark !== currentProfile.landmark ||
            formData.city !== currentProfile.city ||
            formData.state !== currentProfile.state ||
            formData.pin_code !== currentProfile.pin_code;
        

        if (addressChanged) {
            infoDiv.textContent = `ðŸ“ ${t('updating_location')}`;
            infoDiv.classList.remove('hidden');
            
            const coords = await getCoordinates(formData);
            formData.latitude = coords.lat;
            formData.longitude = coords.lng;
            
        }
        
        infoDiv.textContent = `ðŸ’¾ ${t('saving_profile')}`;
        infoDiv.classList.remove('hidden');
        
        // Update profile
        const { error: profileError } = await supabase
            .from('profiles')
            .update(formData)
            .eq('user_id', currentProfile.user_id);
        
        if (profileError) throw profileError;
        
        // If provider was toggled OFF, remove all services
        if (!formData.is_provider && currentProfile.is_provider) {
            const { error: deleteError } = await supabase
                .from('provider_services')
                .delete()
                .eq('provider_id', currentProfile.user_id);
            
            if (deleteError) throw deleteError;
        }
        
        // If radius changed, update all existing services
        if (formData.is_provider && formData.radius_km !== currentProfile.radius_km) {
            const { error: updateRadiusError } = await supabase
                .from('provider_services')
                .update({ service_radius: formData.radius_km })
                .eq('provider_id', currentProfile.user_id);
            
            if (updateRadiusError) throw updateRadiusError;
        }
        
        alert(`âœ… ${t('profile_updated')}`);

// Re-enable button before redirect
submitBtn.disabled = false;
submitBtn.textContent = `ðŸ’¾ ${t('save_changes')}`;
infoDiv.classList.add('hidden');

// âœ… NEW: Delete services marked for removal
if (servicesToRemove && servicesToRemove.length > 0) {
    console.log('ðŸ—‘ï¸ Deleting marked services:', servicesToRemove);
    
    for (const serviceId of servicesToRemove) {
        console.log('Deleting service:', serviceId);
        
        // Delete from database
        const { error: deleteError } = await supabase
            .from('provider_services')
            .delete()
            .eq('provider_id', currentProfile.user_id)
            .eq('service_id', serviceId);
        
        if (deleteError) {
            console.error('Error deleting service:', serviceId, deleteError);
        } else {
            console.log('âœ… Service deleted:', serviceId);
        }
        
        // Handle customer notifications based on choice
        if (window.serviceRemovalChoices && window.serviceRemovalChoices[serviceId]) {
            const { choice, existingRequests } = window.serviceRemovalChoices[serviceId];
            
            if (choice === 'stop_immediately' && existingRequests.length > 0) {
                console.log('âš ï¸ Notifying customers for service:', serviceId);
                await notifyAffectedCustomers(serviceId, currentProfile.user_id, existingRequests);
            } else {
                console.log('â„¹ï¸ No notifications needed - provider completing existing work');
            }
        }
    }
    
    // Clear the tracking arrays
    servicesToRemove = [];
    window.serviceRemovalChoices = {};
    console.log('âœ… All marked services processed');
}

// Reload profile data silently (without showing loading screen)
const { data, error } = await supabase.from('profiles').select('*').eq('user_id', currentUser.id).single();
if (!error) {
    currentProfile = data;
}

// âœ… NEW: Check remaining services and convert to seeker if needed
console.log('ðŸ” Checking remaining services...');

const { data: remainingServices, error: servicesError } = await supabase
    .from('provider_services')
    .select('id')
    .eq('provider_id', currentProfile.user_id);

if (!servicesError) {
    console.log('ðŸ“Š Remaining services count:', remainingServices?.length || 0);
    
    // If user is provider but has no services, convert to seeker
    if (currentProfile.is_provider && (!remainingServices || remainingServices.length === 0)) {
        console.log('âš ï¸ No services remaining - converting to seeker');
        
        const { error: updateError } = await supabase
            .from('profiles')
            .update({ 
                is_provider: false,
                radius_km: null
            })
            .eq('user_id', currentProfile.user_id);
        
        if (!updateError) {
            currentProfile.is_provider = false;
            currentProfile.radius_km = null;
            console.log('âœ… Converted to seeker mode');
            
            // Clear dashboard mode
            sessionStorage.removeItem('dashboardMode');
            console.log('âœ… Cleared dashboard mode');
        }
    }
}

// Close edit profile view
const editView = document.getElementById('editProfileView');
if (editView) {
    editView.classList.add('hidden');
    editView.style.display = 'none';
}

// Force seeker dashboard if not provider
if (!currentProfile.is_provider) {
    console.log('ðŸ”„ User is now seeker - forcing seeker view');
    sessionStorage.setItem('dashboardMode', 'seeker');
    
    // Reload the entire page to ensure clean state
    window.location.reload();
} else {
    // Still provider - just reload dashboard normally
    showDashboard();
}       
    } catch (error) {
        errorDiv.textContent = error.message;
        errorDiv.classList.remove('hidden');
        submitBtn.disabled = false;
        submitBtn.textContent = `ðŸ’¾ ${t('save_changes')}`;
        infoDiv.classList.add('hidden');
    }
});

        // Logout
        async function handleLogout() {
            if (!confirm(t('confirm_logout'))) return;
            
            if (chatRefreshInterval) {
    clearInterval(chatRefreshInterval);
}

// âœ… NEW: Cleanup realtime subscriptions on logout
cleanupRealtimeSubscriptions();

await supabase.auth.signOut();
            currentUser = null;
            currentProfile = null;
	sessionStorage.removeItem('dashboardMode');
            location.reload();
        }

// Collapsible Section Management
        let currentRequestFilter = 'no_response'; // Default for OPEN REQUESTS
let currentActiveRequestsFilter = 'in_progress'; // NEW: Default for ACTIVE REQUESTS
let currentUrgencyFilter = 'all';
	
	// User dropdown toggle
function toggleUserDropdown() {
    const dropdown = document.getElementById('userDropdown');
    dropdown.classList.toggle('active');
}

// Show Terms from Dropdown
function showTermsFromDropdown() {
    toggleUserDropdown();
    showTerms();
}

// Show Privacy from Dropdown
function showPrivacyFromDropdown() {
    toggleUserDropdown();
    showPrivacy();
}

// Close dropdown when clicking outside
document.addEventListener('click', function(event) {
    const userMenu = document.querySelector('.user-menu');
    const dropdown = document.getElementById('userDropdown');
    
    if (userMenu && dropdown && !userMenu.contains(event.target)) {
        dropdown.classList.remove('active');
    }
});
        
	async function toggleSection(sectionId) {
            const content = document.getElementById(sectionId + 'Content');
            const icon = document.getElementById(sectionId + 'Icon');
            
            // Check if this section is currently expanded
            const isCurrentlyExpanded = content.classList.contains('expanded');
            
            // List of all collapsible sections
const allSections = ['openRequests', 'activeRequests', 'myResponses', 'availableWork', 'providerOpenRequests'];
            
            // Close ALL sections first (accordion behavior)
            allSections.forEach(section => {
                const sectionContent = document.getElementById(section + 'Content');
                const sectionIcon = document.getElementById(section + 'Icon');
                
                if (sectionContent) sectionContent.classList.remove('expanded');
                if (sectionIcon) sectionIcon.classList.remove('expanded');
            });
            
            // If the clicked section was closed, open it now
            // If it was already open, leave it closed (toggle behavior)
            if (!isCurrentlyExpanded) {
                content.classList.add('expanded');
                icon.classList.add('expanded');
                
                // NEW: If opening "Work Opportunities", mark all requests as seen
                if (sectionId === 'availableWork' && currentProfile && currentProfile.is_provider) {
                    await markAvailableWorkAsSeen();
                }
                
                // FIX: Auto-load content for Active Requests section
if (sectionId === 'activeRequests') {
    // Trigger the default In Progress tab
    setTimeout(() => {
        filterActiveRequests('in_progress');
    }, 100);
}
            }
        }

        function filterMyRequests(filter) {
    currentRequestFilter = filter;
    
    // Update active tab - remove all active classes first
    const allTabs = document.querySelectorAll('#seekerSection .sub-tab');
    if (allTabs && allTabs.length > 0) {
        allTabs.forEach(tab => {
            tab.classList.remove('active');
        });
    }
    
    // Add active class to clicked tab
    if (event && event.target) {
        const clickedButton = event.target.closest('.sub-tab');
        if (clickedButton) {
            clickedButton.classList.add('active');
        }
    }

if (!currentRequestFilter || currentRequestFilter === 'responded') {
    currentRequestFilter = 'in_progress';
}
    
        // Use cached data if available, otherwise reload
    if (window.cachedUserRequests && window.cachedUserRequests.length > 0) {
        requestAnimationFrame(() => {
            displayUserRequests(window.cachedUserRequests);
        });
    } else {
        loadUserRequests();
    }
}

function filterActiveRequests(filter) {
    currentRequestFilter = filter;
    
    // Update active tab - remove all active classes first
    const allTabs = document.querySelectorAll('#activeRequestsContent .sub-tab');
    if (allTabs && allTabs.length > 0) {
        allTabs.forEach(tab => {
            tab.classList.remove('active');
        });
    }
    
    // Add active class to clicked tab OR default to 'responded' tab
    if (event && event.target) {
        const clickedButton = event.target.closest('.sub-tab');
        if (clickedButton) {
            clickedButton.classList.add('active');
        }
    } else {
        // âœ… NEW: If no event (default load), highlight the 'in_progress' tab
        const inProgressTab = Array.from(allTabs).find(tab => 
            tab.textContent.includes('In Progress') || tab.getAttribute('onclick')?.includes("'in_progress'")
        );
        if (inProgressTab) {
            inProgressTab.classList.add('active');
        }
    }
    
        // Use cached data if available, otherwise reload
    if (window.cachedUserRequests && window.cachedUserRequests.length > 0) {
        requestAnimationFrame(() => {
            displayUserRequests(window.cachedUserRequests);
        });
    } else {
        loadUserRequests();
    }
}

        function filterByUrgency(urgency) {
            currentUrgencyFilter = urgency;
            
            // Update active tab
            document.querySelectorAll('#urgencyTabs .sub-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Reload and filter nearby requests
            loadNearbyRequests();
        }

        function filterResponses(filter) {
            currentResponseFilter = filter;
            
            // Update active tab - find tabs within MY RESPONSES section only
            const responsesTabs = document.querySelectorAll('#myResponsesList .sub-tab');
            if (responsesTabs && responsesTabs.length > 0) {
                responsesTabs.forEach(tab => {
                    tab.classList.remove('active');
                });
            }
            
            // Add active class to clicked tab
            if (event && event.target) {
                const clickedButton = event.target.closest('.sub-tab');
                if (clickedButton) {
                    clickedButton.classList.add('active');
                }
            }
            
            // Reload provider responses with new filter
            loadProviderResponses();
        }

        function updateSectionBadges() {
            // This will be called after loading data to update badge counts
        }

	// Mark all available work requests as seen
        async function markAvailableWorkAsSeen() {
            try {
                const now = new Date().toISOString();
                
                // Update profile with current timestamp
                const { error } = await supabase
                    .from('profiles')
                    .update({ available_work_last_opened_at: now })
                    .eq('user_id', currentProfile.user_id);
                
                if (error) throw error;
                
                // Update local profile
                currentProfile.available_work_last_opened_at = now;
                
                // Reload nearby requests to update badge to 0
                await loadNearbyRequests();
                
            } catch (error) {
                console.error('Error marking available work as seen:', error);
            }
        }

	// Filter work opportunities (Available vs Missed)
async function filterWorkOpportunities(filter) {
    window.currentWorkFilter = filter;
    
    // Update active tab
    const tabs = document.querySelectorAll('#urgencyTabs .sub-tab');
    tabs.forEach(tab => tab.classList.remove('active'));
    event.target.classList.add('active');
    
    // âœ… NEW: Mark missed opportunities as viewed when clicked
    if (filter === 'missed') {
        try {
            const now = new Date().toISOString();
            
            const { error } = await supabase
                .from('profiles')
                .update({ missed_opportunities_last_opened_at: now })
                .eq('user_id', currentProfile.user_id);
            
            if (error) throw error;
            
            // Update local profile
            currentProfile.missed_opportunities_last_opened_at = now;
            
            console.log('âœ… Missed opportunities marked as viewed');
            
        } catch (error) {
            console.error('Error marking missed opportunities as viewed:', error);
        }
    }
    
    // Reload nearby requests to refresh display
    await loadNearbyRequests();
}
	
	
        // ========== AUTOCOMPLETE FUNCTIONS ==========
	
        // Debounce function to avoid too many API calls
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Fetch city suggestions from Nominatim
        async function getCitySuggestions(query) {
    if (query.length < 2) return [];
    
    try {
        const url = `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(query)},India&format=json&limit=8&addressdetails=1&accept-language=en`;
                const response = await fetch(url, {
                    headers: { 'User-Agent': 'HelpBuddy/1.0' }
                });
                const data = await response.json();
                
                // Extract unique city names
const cities = [];
const seen = new Set();

// Regex to detect Hindi/Devanagari characters
const hindiRegex = /[\u0900-\u097F]/;

data.forEach(item => {
    const city = item.address?.city || 
                item.address?.town || 
                item.address?.village || 
                item.address?.municipality;
    
    const state = item.address?.state || '';
    
    // Filter out any results with Hindi characters
    if (city && !seen.has(city.toLowerCase()) && !hindiRegex.test(city) && !hindiRegex.test(state)) {
        seen.add(city.toLowerCase());
        cities.push({
            name: city,
            state: state
        });
    }
});

return cities;
            } catch (error) {
                console.error('Error fetching city suggestions:', error);
                return [];
            }
        }

        
        // Setup city autocomplete
        function setupCityAutocomplete() {
    // Setup for SIGNUP form (id="city")
    const cityInput = document.getElementById('city');
    if (cityInput && !cityInput.hasAttribute('data-autocomplete-setup')) {
        setupCityAutocompleteForField(cityInput, 'citySuggestions', 'state');
        cityInput.setAttribute('data-autocomplete-setup', 'true');
    }
    
    // Setup for EDIT PROFILE form (id="editCity")
    const editCityInput = document.getElementById('editCity');
    if (editCityInput && !editCityInput.hasAttribute('data-autocomplete-setup')) {
        setupCityAutocompleteForField(editCityInput, 'editCitySuggestions', 'editState');
        editCityInput.setAttribute('data-autocomplete-setup', 'true');
    }
    
    // Setup for CREATE REQUEST different location (id="customCity")
    const customCityInput = document.getElementById('customCity');
    if (customCityInput && !customCityInput.hasAttribute('data-autocomplete-setup')) {
        setupCityAutocompleteForField(customCityInput, 'customCitySuggestions', 'customState');
        customCityInput.setAttribute('data-autocomplete-setup', 'true');
    }
}

        // Generic setup for any city field
        function setupCityAutocompleteForField(inputElement, suggestionsId, stateFieldId) {
            const debouncedSearch = debounce(async (query) => {
                if (query.length < 2) {
                    document.getElementById(suggestionsId).classList.remove('active');
                    return;
                }
                
                // Show loading
                const container = document.getElementById(suggestionsId);
                if (!container) return;
                
                container.innerHTML = '<div class="suggestion-item loading">Searching...</div>';
                container.classList.add('active');
                
                const suggestions = await getCitySuggestions(query);
                showCitySuggestionsForField(inputElement, suggestions, suggestionsId, stateFieldId);
            }, 300);
            
            inputElement.addEventListener('input', (e) => {
                debouncedSearch(e.target.value.trim());
            });
            
            // Hide suggestions when clicking outside
            document.addEventListener('click', (e) => {
                const suggestionsContainer = document.getElementById(suggestionsId);
                if (suggestionsContainer && !inputElement.contains(e.target) && !suggestionsContainer.contains(e.target)) {
                    suggestionsContainer.classList.remove('active');
                }
            });
        }

        // Show suggestions for specific field
        function showCitySuggestionsForField(inputElement, suggestions, suggestionsId, stateFieldId) {
            const container = document.getElementById(suggestionsId);
            if (!container) return;
            
            if (suggestions.length === 0) {
                container.classList.remove('active');
                return;
            }
            
            let html = '';
            suggestions.forEach(item => {
                const cityName = item.name.replace(/'/g, "\\'");
                const stateName = item.state.replace(/'/g, "\\'");
                html += `
                    <div class="suggestion-item" onclick="selectCityForField('${inputElement.id}', '${cityName}', '${stateFieldId}', '${stateName}', '${suggestionsId}')">
                        ${item.name}${item.state ? ', ' + item.state : ''}
                    </div>
                `;
            });
            
            container.innerHTML = html;
            container.classList.add('active');
        }

        // Select city for specific field
        function selectCityForField(inputId, cityName, stateFieldId, stateName, suggestionsId) {
            const cityInput = document.getElementById(inputId);
            if (cityInput) {
                cityInput.value = cityName;
            }
            
            // Auto-fill state if available
            const stateField = document.getElementById(stateFieldId);
            if (stateName && stateField) {
                if (stateField.tagName === 'SELECT') {
                    // Try to find matching state in dropdown
                    const options = Array.from(stateField.options);
                    const matchingOption = options.find(opt => opt.value === stateName);
                    if (matchingOption) {
                        stateField.value = stateName;
                    }
                } else {
                    // If it's a text input (for future state autocomplete)
                    stateField.value = stateName;
                }
            }
            
            // Hide suggestions
            const container = document.getElementById(suggestionsId);
            if (container) {
                container.classList.remove('active');
            }
        }

	// Rating System Functions
        let currentRatingData = null;
        let selectedRating = 0;

        function openRatingModal(requestId, providerId, providerName) {
            currentRatingData = { requestId, providerId, providerName };
            selectedRating = 0;
            
            document.getElementById('ratingProviderName').textContent = providerName;
            document.getElementById('ratingReview').value = '';
            document.getElementById('reviewCounter').textContent = '0';
            document.getElementById('ratingError').classList.add('hidden');
            document.getElementById('ratingText').textContent = t('select_rating');
            
            // Reset stars
            document.querySelectorAll('.star').forEach(star => {
                star.classList.remove('selected');
                star.textContent = 'â˜†';
            });
            
            document.getElementById('ratingModal').classList.add('active');
        }

        function closeRatingModal() {
            document.getElementById('ratingModal').classList.remove('active');
            currentRatingData = null;
            selectedRating = 0;
        }

	// Contact Details Modal Functions
        async function openContactDetailsModal() {
            try {
                // Get partner's profile
                const { data: partnerProfile, error } = await supabase
                    .from('profiles')
                    .select('*')
                    .eq('user_id', currentChatData.partnerId)
                    .single();
                
                if (error || !partnerProfile) {
                    alert(t('error_loading_contact'));
                    return;
                }
                
                const partnerAddress = [
                    partnerProfile.house_number,
                    partnerProfile.area_name,
                    partnerProfile.landmark,
                    partnerProfile.city,
                    partnerProfile.state,
                    partnerProfile.pin_code
                ].filter(Boolean).join(', ');
                
                document.getElementById('contactDetailsModalContent').innerHTML = `
                    <div style="background: white; padding: 20px; border-radius: 12px;">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="font-size: 48px; margin-bottom: 10px;">ðŸ‘¤</div>
                            <h3 style="color: #333; margin-bottom: 5px;">${partnerProfile.name}</h3>
                        </div>
                        <div style="background: #f8f9fa; padding: 16px; border-radius: 10px; margin-bottom: 15px;">
                            <p style="margin: 12px 0; color: #333; font-size: 15px;"><strong>ðŸ“± ${t('phone')}:</strong> <a href="tel:${partnerProfile.phone}" style="color: #2196f3; text-decoration: none; font-weight: 600;">${partnerProfile.phone}</a></p>
                            <p style="margin: 12px 0; color: #333; font-size: 15px;"><strong>ðŸ“ ${t('address')}:</strong> ${partnerAddress}</p>
                        </div>
                        <p style="font-size: 12px; color: #666; text-align: center; font-style: italic; background: #fff3cd; padding: 10px; border-radius: 6px; margin: 0;">
                            ðŸ”’ ${t('contact_info_visible_note')}
                        </p>
                    </div>
                `;
                
                document.getElementById('contactDetailsModal').classList.add('active');
            } catch (error) {
                alert(`âŒ ${t('error')}: ${error.message}`);
            }
        }

        function closeContactDetailsModal() {
            document.getElementById('contactDetailsModal').classList.remove('active');
        }	

        function selectRating(rating) {
            selectedRating = rating;
            
            const ratingTexts = ['', t('poor'), t('fair'), t('good'), t('very_good'), t('excellent')];
            document.getElementById('ratingText').textContent = ratingTexts[rating];
            
            // Update star display
            document.querySelectorAll('.star').forEach((star, index) => {
                if (index < rating) {
                    star.classList.add('selected');
                    star.textContent = 'â˜…';
                } else {
                    star.classList.remove('selected');
                    star.textContent = 'â˜†';
                }
            });
        }

	async function openChatPartnerProfile() {
    try {
        // Get partner's full profile
        const { data: partnerProfile, error } = await supabase
            .from('profiles')
            .select('*')
            .eq('user_id', currentChatData.partnerId)
            .single();
        
        if (error || !partnerProfile) {
            alert(t('error_loading_profile'));
            return;
        }
        
        // Get partner's services if they are a provider
        let servicesHTML = '';
        if (partnerProfile.is_provider) {
            const { data: services } = await supabase
                .from('provider_services')
                .select('service_id')
                .eq('provider_id', partnerProfile.user_id);
            
            if (services && services.length > 0) {
                const serviceNames = {
    // Electrician subcategories
    electrician_installation: `ðŸ”Œ ${t('electrician')} â†’ ${t('elec_installation')}`,
    electrician_repair: `ðŸ”Œ ${t('electrician')} â†’ ${t('elec_repair')}`,
    electrician_wiring: `ðŸ”Œ ${t('electrician')} â†’ ${t('elec_wiring')}`,
    
    // Plumber subcategories
    plumber_installation: `ðŸš° ${t('plumber')} â†’ ${t('plumb_installation')}`,
    plumber_repair: `ðŸš° ${t('plumber')} â†’ ${t('plumb_repair')}`,
    plumber_new_work: `ðŸš° ${t('plumber')} â†’ ${t('plumb_new_work')}`,
    
    // AC subcategories
    ac_installation: `â„ï¸ ${t('ac_services')} â†’ ${t('ac_installation')}`,
    ac_repair_service: `â„ï¸ ${t('ac_services')} â†’ ${t('ac_repair_service')}`,
    ac_gas_filling: `â„ï¸ ${t('ac_services')} â†’ ${t('ac_gas_filling')}`,
    
    // Carpenter subcategories
    carpenter_repair: `ðŸ”¨ ${t('carpenter')} â†’ ${t('carp_repair')}`,
    carpenter_custom: `ðŸ”¨ ${t('carpenter')} â†’ ${t('carp_custom')}`,
    carpenter_door_window: `ðŸ”¨ ${t('carpenter')} â†’ ${t('carp_door_window')}`,
    
    // Painter subcategories
    painter_house: `ðŸŽ¨ ${t('painter')} â†’ ${t('paint_house')}`,
    painter_furniture: `ðŸŽ¨ ${t('painter')} â†’ ${t('paint_furniture')}`,
    painter_texture: `ðŸŽ¨ ${t('painter')} â†’ ${t('paint_texture')}`,
    
    // Cleaner subcategories
    cleaner_house: `ðŸ§¹ ${t('cleaner')} â†’ ${t('clean_house')}`,
    cleaner_upholstery: `ðŸ§¹ ${t('cleaner')} â†’ ${t('clean_upholstery')}`,
    cleaner_vehicle: `ðŸ§¹ ${t('cleaner')} â†’ ${t('clean_vehicle')}`,
    
    // Appliance subcategories
    appliance_washing: `ðŸ”§ ${t('appliance_repair')} â†’ ${t('app_washing')}`,
    appliance_refrigerator: `ðŸ”§ ${t('appliance_repair')} â†’ ${t('app_refrigerator')}`,
    appliance_tv: `ðŸ”§ ${t('appliance_repair')} â†’ ${t('app_tv')}`,
    appliance_geyser: `ðŸ”§ ${t('appliance_repair')} â†’ ${t('app_geyser')}`,
    appliance_ro: `ðŸ”§ ${t('appliance_repair')} â†’ ${t('app_ro')}`,
    appliance_microwave: `ðŸ”§ ${t('appliance_repair')} â†’ ${t('app_microwave')}`,
    appliance_other: `ðŸ”§ ${t('appliance_repair')} â†’ ${t('app_other')}`
};
                servicesHTML = `<h3 style="margin-top: 20px; margin-bottom: 10px;">${t('services_provided')}:</h3><div style="display: flex; flex-wrap: wrap; gap: 8px;">`;
                services.forEach(s => {
                    servicesHTML += `<span style="background: #667eea; color: white; padding: 6px 12px; border-radius: 20px; font-size: 13px;">${serviceNames[s.service_id] || s.service_id}</span>`;
                });
                servicesHTML += '</div>';
            }
        }
        
        // Get partner's ratings
let ratingsHTML = '';
if (partnerProfile.average_rating && partnerProfile.average_rating > 0 && partnerProfile.total_ratings > 0) {
    const stars = 'â­'.repeat(Math.round(partnerProfile.average_rating));
    const reviewWord = partnerProfile.total_ratings === 1 ? t('review') : t('reviews');
    ratingsHTML = `<h3 style="margin-top: 20px; margin-bottom: 10px;">${t('rating')}: ${stars} ${partnerProfile.average_rating}/5 (${partnerProfile.total_ratings} ${reviewWord})</h3>`;
    
    // âœ… UPDATED: Fetch review details WITH service_type
    const { data: ratings } = await supabase
        .from('ratings')
        .select('rating, review, created_at, service_type')  // â† ADDED service_type
        .eq('provider_id', partnerProfile.user_id)
        .order('created_at', { ascending: false });
    
    if (ratings && ratings.length > 0) {
        // âœ… NEW: Service type icons and names mapping
        const serviceIcons = {
    // Electrician subcategories
    electrician_installation: `ðŸ”Œ ${t('electrician')} â†’ ${t('elec_installation')}`,
    electrician_repair: `ðŸ”Œ ${t('electrician')} â†’ ${t('elec_repair')}`,
    electrician_wiring: `ðŸ”Œ ${t('electrician')} â†’ ${t('elec_wiring')}`,
    
    // Plumber subcategories
    plumber_installation: `ðŸš° ${t('plumber')} â†’ ${t('plumb_installation')}`,
    plumber_repair: `ðŸš° ${t('plumber')} â†’ ${t('plumb_repair')}`,
    plumber_new_work: `ðŸš° ${t('plumber')} â†’ ${t('plumb_new_work')}`,
    
    // AC subcategories
    ac_installation: `â„ï¸ ${t('ac_services')} â†’ ${t('ac_installation')}`,
    ac_repair_service: `â„ï¸ ${t('ac_services')} â†’ ${t('ac_repair_service')}`,
    ac_gas_filling: `â„ï¸ ${t('ac_services')} â†’ ${t('ac_gas_filling')}`,
    
    // Carpenter subcategories
    carpenter_repair: `ðŸ”¨ ${t('carpenter')} â†’ ${t('carp_repair')}`,
    carpenter_custom: `ðŸ”¨ ${t('carpenter')} â†’ ${t('carp_custom')}`,
    carpenter_door_window: `ðŸ”¨ ${t('carpenter')} â†’ ${t('carp_door_window')}`,
    
    // Painter subcategories
    painter_house: `ðŸŽ¨ ${t('painter')} â†’ ${t('paint_house')}`,
    painter_furniture: `ðŸŽ¨ ${t('painter')} â†’ ${t('paint_furniture')}`,
    painter_texture: `ðŸŽ¨ ${t('painter')} â†’ ${t('paint_texture')}`,
    
    // Cleaner subcategories
    cleaner_house: `ðŸ§¹ ${t('cleaner')} â†’ ${t('clean_house')}`,
    cleaner_upholstery: `ðŸ§¹ ${t('cleaner')} â†’ ${t('clean_upholstery')}`,
    cleaner_vehicle: `ðŸ§¹ ${t('cleaner')} â†’ ${t('clean_vehicle')}`,
    
    // Appliance subcategories
    appliance_washing: `ðŸ”§ ${t('appliance_repair')} â†’ ${t('app_washing')}`,
    appliance_refrigerator: `ðŸ”§ ${t('appliance_repair')} â†’ ${t('app_refrigerator')}`,
    appliance_tv: `ðŸ”§ ${t('appliance_repair')} â†’ ${t('app_tv')}`,
    appliance_geyser: `ðŸ”§ ${t('appliance_repair')} â†’ ${t('app_geyser')}`,
    appliance_ro: `ðŸ”§ ${t('appliance_repair')} â†’ ${t('app_ro')}`,
    appliance_microwave: `ðŸ”§ ${t('appliance_repair')} â†’ ${t('app_microwave')}`,
    appliance_other: `ðŸ”§ ${t('appliance_repair')} â†’ ${t('app_other')}`
};
        
        ratingsHTML += '<div style="margin-top: 10px;">';
        ratings.slice(0, 5).forEach(r => {  // â† CHANGED: Show last 5 ratings (was 3)
            const reviewStars = 'â­'.repeat(r.rating);
            const reviewDate = new Date(r.created_at).toLocaleDateString();
            
            // âœ… NEW: Get service name with icon
            const serviceName = r.service_type && serviceIcons[r.service_type] 
                ? serviceIcons[r.service_type] 
                : 'ðŸ”§ Service';  // Fallback if service_type is missing
            
            ratingsHTML += `
                <div style="background: #f5f5f5; padding: 12px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #667eea;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <div style="font-weight: 600; color: #667eea;">${reviewStars} ${r.rating}/5</div>
                        <span style="background: #667eea; color: white; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600;">${serviceName}</span>
                    </div>
                    ${r.review ? `<p style="color: #555; margin-bottom: 5px; font-size: 14px; line-height: 1.5;">"${r.review}"</p>` : ''}
                    <p style="font-size: 12px; color: #999; margin-top: 8px;">ðŸ“… ${reviewDate}</p>
                </div>
            `;
        });
        ratingsHTML += '</div>';
    }
}
        
        // Build full address
        const partnerAddress = [
            partnerProfile.house_number,
            partnerProfile.area_name,
            partnerProfile.landmark,
            partnerProfile.city,
            partnerProfile.state,
            partnerProfile.pin_code
        ].filter(Boolean).join(', ');
        
        // Build profile photo HTML
        const photoHTML = partnerProfile.profile_photo 
            ? `<img src="${partnerProfile.profile_photo}" 
                    onclick="event.stopPropagation(); openImagePreview('${partnerProfile.profile_photo}')" 
                    style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 4px solid #667eea; cursor: pointer; transition: transform 0.2s; margin-bottom: 15px;" 
                    onmouseover="this.style.transform='scale(1.05)'" 
                    onmouseout="this.style.transform='scale(1)'"
                    title="${t('click_photo_to_view')}">`
            : `<div style="width: 120px; height: 120px; border-radius: 50%; background: #e0e0e0; display: inline-flex; align-items: center; justify-content: center; font-size: 48px; border: 4px solid #667eea; margin-bottom: 15px;">ðŸ‘¤</div>`;
        
        // Display in modal
        document.getElementById('profileContent').innerHTML = `
            <div style="text-align: center;">
                ${photoHTML}
                <h2 style="color: #333; margin: 10px 0;">${partnerProfile.name}</h2>
            </div>
            
            <div style="background: #f8f9fa; padding: 16px; border-radius: 10px; margin: 20px 0;">
                <p style="margin: 12px 0; color: #333; font-size: 15px;"><strong>ðŸ“ ${t('address')}:</strong> ${partnerAddress}</p>
                ${partnerProfile.is_provider ? `<p style="margin: 12px 0; color: #333; font-size: 15px;"><strong>ðŸ“ ${t('service_radius')}:</strong> ${partnerProfile.radius_km} km</p>` : ''}
            </div>
            
            ${servicesHTML}
            ${ratingsHTML}
            
            <p style="font-size: 12px; color: #666; text-align: center; font-style: italic; background: #fff3cd; padding: 10px; border-radius: 6px; margin-top: 20px;">
                ðŸ”’ ${t('contact_shared_after_agreement')}
            </p>
        `;
        
        document.getElementById('profileModal').classList.add('active');
    } catch (error) {
        alert(`âŒ ${t('error')}: ${error.message}`);
    }
}	

async function submitRating() {
    if (selectedRating === 0) {
        document.getElementById('ratingError').textContent = t('please_select_rating');
        document.getElementById('ratingError').classList.remove('hidden');
        return;
    }
    
    const submitBtn = document.getElementById('submitRatingBtn');
    submitBtn.disabled = true;
    submitBtn.textContent = t('submitting');
    
    try {
        console.log('ðŸ”µ STEP 3F: Starting rating submission with pending bonuses...');
        console.log('ðŸ“Š Rating:', selectedRating, 'stars');
        console.log('ðŸ“Š Request ID:', currentRatingData.requestId);
        console.log('ðŸ“Š Provider ID:', currentRatingData.providerId);
        
        const review = document.getElementById('ratingReview').value.trim();
        
        // âœ… NEW STEP 1: Get service_id from request first
        const { data: requestData, error: fetchError } = await supabase
            .from('requests')
            .select('service_id, warranty_end_date')  // â† Added service_id here
            .eq('id', currentRatingData.requestId)
            .single();
        
        if (fetchError) throw fetchError;
        
        const serviceType = requestData.service_id;  // â† Get service type
        const warrantyEndDate = requestData.warranty_end_date;
        
        console.log('ðŸ”§ Service type:', serviceType);
        console.log('ðŸ“… Warranty expires:', warrantyEndDate);
        
        // âœ… STEP 2: Insert the rating WITH service_type
        const { error } = await supabase
            .from('ratings')
            .insert([{
                request_id: currentRatingData.requestId,
                seeker_id: currentUser.id,
                provider_id: currentRatingData.providerId,
                rating: selectedRating,
                review: review || null,
                service_type: serviceType,  // â† ADDED THIS LINE
                created_at: new Date().toISOString()
            }]);
        
        if (error) throw error;
        
        console.log('âœ… Rating inserted successfully with service type:', serviceType);
        
        // STEP 3: Add +10 credits for seeker (rest of your code remains the same...)
const seekerRatingBonus = 10;

// Check if seeker already got rating bonus for this request
const { data: existingSeekerRatingBonus, error: seekerBonusCheckError } = await supabase
    .from('credit_transactions')
    .select('id')
    .eq('user_id', currentUser.id)
    .eq('related_request_id', currentRatingData.requestId)
    .like('description', '%Rating submission bonus%')
    .maybeSingle();

if (seekerBonusCheckError) throw seekerBonusCheckError;

if (existingSeekerRatingBonus) {
    console.log('â­ï¸ Seeker already received rating bonus for this request. Skipping...');
} else {
    await addCredits(
        currentUser.id,
        seekerRatingBonus,
        'Rating submission bonus (pending warranty)',
        currentRatingData.requestId,
        'pending',
        warrantyEndDate
    );
    console.log(`âœ… Seeker rating bonus: +${seekerRatingBonus} credits (pending)`);
}
        
        console.log(`âœ… Seeker rating bonus: +${seekerRatingBonus} credits (pending)`);
        
// STEP 4: Calculate AVERAGE rating for THIS REQUEST and determine bonus
const { data: allRatings, error: ratingsError } = await supabase
    .from('ratings')
    .select('rating')
    .eq('request_id', currentRatingData.requestId);
        
        if (ratingsError) throw ratingsError;
        
        // Calculate average rating
        const totalRatings = allRatings.length;
        const sumRatings = allRatings.reduce((sum, r) => sum + r.rating, 0);
        const averageRating = sumRatings / totalRatings;
        
        console.log('ðŸ“Š Provider stats:', {
            totalRatings,
            sumRatings,
            averageRating: averageRating.toFixed(2)
        });
        
        // Determine provider bonus based on average rating
        let providerRatingBonus = 0;
        if (averageRating >= 4.5) {
            providerRatingBonus = 20; // 5 stars average
        } else if (averageRating >= 3.5) {
            providerRatingBonus = 10; // 4 stars average
        } else if (averageRating >= 2.5) {
            providerRatingBonus = 5;  // 3 stars average
        } else {
            providerRatingBonus = 0;  // 1-2 stars average
        }
        
        console.log(`ðŸ’° Provider rating bonus: +${providerRatingBonus} credits (based on ${averageRating.toFixed(2)} avg)`);
        
        // STEP 5: Check if provider already has a pending rating bonus for this request
        const { data: existingBonus, error: bonusCheckError } = await supabase
            .from('credit_transactions')
            .select('id, amount')
            .eq('user_id', currentRatingData.providerId)
            .eq('related_request_id', currentRatingData.requestId)
            .eq('status', 'pending')
            .like('description', '%Rating bonus%')
            .maybeSingle();
        
        if (bonusCheckError) throw bonusCheckError;
        
        if (existingBonus) {
            // Update existing bonus amount (in case rating changed average)
            console.log(`ðŸ”„ Updating existing bonus from ${existingBonus.amount} to ${providerRatingBonus}`);
            
            const { error: updateError } = await supabase
                .from('credit_transactions')
                .update({ amount: providerRatingBonus })
                .eq('id', existingBonus.id);
            
            if (updateError) throw updateError;
            
            console.log('âœ… Provider bonus updated');
        } else {
            // Create new pending bonus for provider
            await addCredits(
                currentRatingData.providerId,
                providerRatingBonus,
`Rating bonus: ${averageRating.toFixed(1)}â­ request avg (pending warranty)`,
                currentRatingData.requestId,
                'pending',
                warrantyEndDate
            );
            
            console.log('âœ… Provider bonus created');
        }
        
        console.log('âœ… STEP 3F COMPLETE: Rating bonuses added (all pending)');
        
        // Show success message with credit info (privacy protected - only seeker sees their bonus)
        alert(`âœ… ${t('rating_submitted')}\n\nðŸ’³ You'll receive +${seekerRatingBonus} credits after warranty period!`);
        
        closeRatingModal();
        await loadUserRequests();
        viewResponses(currentRatingData.requestId);
        
    } catch (error) {
        console.error('âŒ STEP 3F ERROR:', error);
        document.getElementById('ratingError').textContent = 'Error: ' + error.message;
        document.getElementById('ratingError').classList.remove('hidden');
        submitBtn.disabled = false;
        submitBtn.textContent = 'Submit Rating';
    }
}

// ==================== FEEDBACK SYSTEM ====================

// Open Feedback Modal
function openFeedbackModal() {
    // Close user dropdown menu first
    const dropdown = document.getElementById('userDropdown');
    if (dropdown) dropdown.classList.remove('active');
    
    console.log('ðŸ”µ Opening feedback modal...');
    
    const modal = document.getElementById('feedbackModal');
    if (!modal) {
        console.error('âŒ Feedback modal not found');
        return;
    }
    
    const messageInput = document.getElementById('feedbackMessage');
    const emailInput = document.getElementById('feedbackEmail');
    const typeSelect = document.getElementById('feedbackType');
    const errorDiv = document.getElementById('feedbackError');
    const successDiv = document.getElementById('feedbackSuccess');
    const counterSpan = document.getElementById('feedbackCounter');
    
    // Reset form
    if (typeSelect) typeSelect.value = '';
    if (messageInput) {
        messageInput.value = '';
        if (counterSpan) counterSpan.textContent = '0';
    }
    if (emailInput && currentProfile) {
        emailInput.value = currentProfile.email || (currentUser ? currentUser.email : '');
    }
    if (errorDiv) errorDiv.classList.add('hidden');
    if (successDiv) successDiv.classList.add('hidden');
    
    // NUCLEAR FIX: Use setAttribute to override ALL inline styles with !important
modal.setAttribute('style', 'display: flex !important; position: fixed !important; top: 0 !important; left: 0 !important; width: 100vw !important; height: 100vh !important; min-width: 100vw !important; min-height: 100vh !important; max-width: 100vw !important; max-height: 100vh !important; z-index: 999999 !important; visibility: visible !important; opacity: 1 !important; background: rgba(0,0,0,0.5) !important; pointer-events: auto !important; align-items: center !important; justify-content: center !important;');
modal.classList.add('active');
    
    console.log('âœ… Feedback modal opened');
    console.log('Has active class:', modal.classList.contains('active'));
    console.log('Display style:', window.getComputedStyle(modal).display);
}

// Close Feedback Modal
function closeFeedbackModal() {
    const modal = document.getElementById('feedbackModal');
    if (modal) {
        modal.classList.remove('active');
        modal.setAttribute('style', 'display: none; position: fixed !important; top: 0 !important; left: 0 !important; width: 100vw !important; height: 100vh !important; z-index: 999999 !important;');
    }
}

// Submit Feedback
async function submitFeedback() {
    const type = document.getElementById('feedbackType').value;
    const message = document.getElementById('feedbackMessage').value.trim();
    const email = document.getElementById('feedbackEmail').value;
    const errorDiv = document.getElementById('feedbackError');
    const successDiv = document.getElementById('feedbackSuccess');
    const submitBtn = document.getElementById('submitFeedbackBtn');
    
    // Hide previous messages
    errorDiv.classList.add('hidden');
    successDiv.classList.add('hidden');
    
    // Validation
    if (!type) {
        errorDiv.textContent = `âš ï¸ ${t('please_select_feedback_type')}`;
        errorDiv.classList.remove('hidden');
        return;
    }
    
    if (!message || message.length < 10) {
        errorDiv.textContent = `âš ï¸ ${t('feedback_min_length')}`;
        errorDiv.classList.remove('hidden');
        return;
    }
    
    // Disable button
    submitBtn.disabled = true;
    submitBtn.textContent = `ðŸ“¤ ${t('sending')}`;
    
    try {
        // Insert feedback into Supabase
        const { error } = await supabase
            .from('feedback')
            .insert([{
                user_id: currentUser.id,
                user_name: currentProfile.name,
                user_email: email,
                feedback_type: type,
                message: message,
                status: 'new'
            }]);
        
        if (error) throw error;
        
        // Show success popup
        showSuccessPopup(`${t('feedback_success_message_part1')} <strong>${email}</strong> ${t('feedback_success_message_part2')}`);
        
        // Reset form
        resetHelpForm();
        
        // Close modal and popup after 3 seconds
        setTimeout(() => {
            closeGetHelpModal();
            hideSuccessPopup();
        }, 3000);
        
    } catch (error) {
        errorDiv.textContent = `âŒ ${t('error_submitting_feedback')}: ${error.message}`;
        errorDiv.classList.remove('hidden');
    } finally {
        // Re-enable button
        submitBtn.disabled = false;
        submitBtn.textContent = `ðŸ“¤ ${t('send_feedback')}`;
    }
}

// Character counter for feedback message
document.addEventListener('DOMContentLoaded', () => {
    const feedbackInput = document.getElementById('feedbackMessage');
    if (feedbackInput) {
        feedbackInput.addEventListener('input', (e) => {
            const counter = document.getElementById('feedbackCounter');
            if (counter) {
                counter.textContent = e.target.value.length;
            }
        });
    }
});

// Close feedback modal when clicking outside
document.addEventListener('click', function(event) {
    const modal = document.getElementById('feedbackModal');
    const modalContent = modal?.querySelector('.modal-content');
    
    if (modal && modal.classList.contains('active')) {
        // Check if click is on the modal background (not on modal-content or inside it)
        if (event.target === modal) {
            closeFeedbackModal();
        }
    }
});

// Close feedback modal on ESC key
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modal = document.getElementById('feedbackModal');
        if (modal && modal.classList.contains('active')) {
            closeFeedbackModal();
        }
    }
});

// ==================== GET HELP MODAL FUNCTIONS ====================

// FAQ Data
const faqData = [
    {
        icon: 'âŒ',
        title: t('cant_login'),
        solution: t('cant_login_solution')
    },
    {
        icon: 'ðŸ“§',
        title: t('email_not_received'),
        solution: t('email_not_received_solution')
    },
    {
        icon: 'ðŸ”‘',
        title: t('forgot_password'),
        solution: t('forgot_password_solution')
    },
    {
        icon: 'ðŸŒ',
        title: t('slow_loading'),
        solution: t('slow_loading_solution')
    },
    {
        icon: 'ðŸ“±',
        title: t('account_issues'),
        solution: t('account_issues_solution')
    },
    {
        icon: 'ðŸ”’',
        title: t('email_already_registered'),
        solution: t('email_already_registered_solution')
    }
];

// Open Get Help Modal
function openGetHelpModal() {
    console.log('ðŸ”µ Opening Get Help modal...');
    
    const modal = document.getElementById('getHelpModal');
    if (!modal) {
        console.error('âŒ Get Help modal not found');
        return;
    }
    
    // Reset to FAQ screen
    showGetHelpFaq();
    
    // Build FAQ list
    buildFaqList();
    
    // Reset form
    resetHelpForm();
    
    // Show modal
    modal.classList.add('active');
    
    console.log('âœ… Get Help modal opened');
}

// Close Get Help Modal
function closeGetHelpModal() {
    const modal = document.getElementById('getHelpModal');
    if (modal) {
        modal.classList.remove('active');
    }
}

// Open Get Help Modal for Logged-In Users (with Contact Support visible)
function openGetHelpModalForLoggedInUser() {
    openGetHelpModal();
    
    // Show the Contact Support button for logged-in users
    const contactBtn = document.querySelector('.hidden-for-unregistered');
    if (contactBtn) {
        contactBtn.classList.remove('hidden-for-unregistered');
    }
}

// Open Forgot Password Modal
function openForgotPasswordModal() {
    const modal = document.getElementById('forgotPasswordModal');
    const emailInput = document.getElementById('forgotPasswordEmail');
    const errorDiv = document.getElementById('forgotPasswordError');
    const successDiv = document.getElementById('forgotPasswordSuccess');
    
    // Reset form
    if (emailInput) emailInput.value = '';
    if (errorDiv) errorDiv.classList.add('hidden');
    if (successDiv) successDiv.classList.add('hidden');
    
    // Show modal
    if (modal) {
        modal.classList.add('active');
    }
}

// Close Forgot Password Modal
function closeForgotPasswordModal() {
    const modal = document.getElementById('forgotPasswordModal');
    if (modal) {
        modal.classList.remove('active');
    }
}

// Toggle password visibility
function togglePasswordVisibility(inputId, button) {
    const input = document.getElementById(inputId);
    const icon = button.querySelector('.eye-icon');
    
    if (input.type === 'password') {
        // Show password
        input.type = 'text';
        icon.textContent = 'ðŸ‘ï¸'; // Open eye
    } else {
        // Hide password
        input.type = 'password';
        icon.textContent = 'ðŸ‘ï¸â€ðŸ—¨ï¸'; // Closed eye
    }
}

// Send Password Reset Link
async function sendPasswordResetLink() {
    const emailInput = document.getElementById('forgotPasswordEmail');
    const errorDiv = document.getElementById('forgotPasswordError');
    const successDiv = document.getElementById('forgotPasswordSuccess');
    const submitBtn = document.getElementById('sendResetLinkBtn');
    
    const email = emailInput.value.trim();
    
    // Hide previous messages
    errorDiv.classList.add('hidden');
    successDiv.classList.add('hidden');
    
    // Validation
    if (!email) {
        errorDiv.textContent = `âš ï¸ ${t('please_enter_email')}`;
        errorDiv.classList.remove('hidden');
        return;
    }
    
    // Email format validation
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
        errorDiv.textContent = `âš ï¸ ${t('please_enter_valid_email')}`;
        errorDiv.classList.remove('hidden');
        return;
    }
    
    // Disable button
    submitBtn.disabled = true;
    submitBtn.textContent = t('checking');
    
    try {
        // Send reset link (Supabase handles non-existent emails silently)
submitBtn.textContent = t('sending');

const { error: resetError } = await supabase.auth.resetPasswordForEmail(email, {
    redirectTo: `${window.location.origin}`
});

if (resetError) throw resetError;

// Success message (shown even if email doesn't exist - security feature)
successDiv.textContent = `âœ… ${t('password_reset_email_sent')}`;
successDiv.classList.remove('hidden');
emailInput.value = '';
        
    } catch (error) {
        errorDiv.textContent = `âŒ ${t('error')}: ${error.message}`;
        errorDiv.classList.remove('hidden');
    } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = `ðŸ“§ ${t('send_reset_link')}`;
    }
}

// Show FAQ Screen
function showGetHelpFaq() {
    document.getElementById('getHelpFaqScreen').classList.remove('hidden');
    document.getElementById('getHelpFormScreen').classList.add('hidden');
}

// Show Contact Support Form
function showContactSupportForm() {
    document.getElementById('getHelpFaqScreen').classList.add('hidden');
    document.getElementById('getHelpFormScreen').classList.remove('hidden');
    
    // Pre-fill email if user is logged in
    const emailInput = document.getElementById('helpEmail');
    if (currentUser && currentProfile) {
        emailInput.value = currentProfile.email || currentUser.email || '';
        emailInput.readOnly = true;
    } else {
        emailInput.value = '';
        emailInput.readOnly = false;
    }
}

// Build FAQ List
function buildFaqList() {
    const container = document.getElementById('faqList');
    if (!container) return;
    
    let html = '';
    faqData.forEach((faq, index) => {
        html += `
            <div class="faq-item" style="background: #f8f9fa; padding: 16px; border-radius: 10px; margin-bottom: 12px; border-left: 4px solid #667eea;">
                <div class="faq-header" style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px; cursor: pointer;" onclick="toggleFaqItem(${index})">
                    <span style="font-size: 24px;">${faq.icon}</span>
                    <strong style="color: #333; flex: 1;">${faq.title}</strong>
                    <span class="faq-chevron" id="faq-chevron-${index}" style="color: #667eea; font-weight: bold;">â–¼</span>
                </div>
                <div class="faq-solution" id="faq-solution-${index}" style="display: none; color: #555; line-height: 1.6; padding-left: 34px; margin-top: 8px;">
                    ${faq.solution}
                </div>
            </div>
        `;
    });
    
    container.innerHTML = html;
}

// Toggle FAQ Item
function toggleFaqItem(index) {
    const solution = document.getElementById('faq-solution-' + index);
    const chevron = document.getElementById('faq-chevron-' + index);
    
    if (solution.style.display === 'none') {
        solution.style.display = 'block';
        chevron.textContent = 'â–²';
    } else {
        solution.style.display = 'none';
        chevron.textContent = 'â–¼';
    }
}

// Reset Help Form
function resetHelpForm() {
    const issueType = document.getElementById('helpIssueType');
    const message = document.getElementById('helpMessage');
    const email = document.getElementById('helpEmail');
    const counter = document.getElementById('helpMessageCounter');
    const errorDiv = document.getElementById('helpError');
    const successDiv = document.getElementById('helpSuccess');
    
    if (issueType) issueType.value = '';
    if (message) {
        message.value = '';
        if (counter) counter.textContent = '0';
    }
    if (email) email.value = '';
    if (errorDiv) errorDiv.classList.add('hidden');
    if (successDiv) successDiv.classList.add('hidden');
}

// Character counter for help message
document.addEventListener('DOMContentLoaded', () => {
    const helpMessageInput = document.getElementById('helpMessage');
    if (helpMessageInput) {
        helpMessageInput.addEventListener('input', (e) => {
            const counter = document.getElementById('helpMessageCounter');
            if (counter) {
                counter.textContent = e.target.value.length;
            }
        });
    }
});

// Submit Help Request
async function submitHelpRequest() {
    const issueType = document.getElementById('helpIssueType').value;
    const message = document.getElementById('helpMessage').value.trim();
    const email = document.getElementById('helpEmail').value.trim();
    const errorDiv = document.getElementById('helpError');
    const successDiv = document.getElementById('helpSuccess');
    const submitBtn = document.getElementById('submitHelpBtn');
    
    // Hide previous messages
    if (errorDiv) errorDiv.classList.add('hidden');
    if (successDiv) successDiv.classList.add('hidden');
    
    // Validation
    if (!issueType) {
        if (errorDiv) {
            errorDiv.textContent = `âš ï¸ ${t('please_select_issue_type')}`;
            errorDiv.classList.remove('hidden');
        }
        return;
    }
    
    if (!message || message.length < 10) {
        if (errorDiv) {
            errorDiv.textContent = `âš ï¸ ${t('help_message_min_length')}`;
            errorDiv.classList.remove('hidden');
        }
        return;
    }
    
    if (!email) {
        if (errorDiv) {
            errorDiv.textContent = `âš ï¸ ${t('please_provide_email')}`;
            errorDiv.classList.remove('hidden');
        }
        return;
    }
    
    // Email validation regex
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
        if (errorDiv) {
            errorDiv.textContent = `âš ï¸ ${t('please_enter_valid_email')}`;
            errorDiv.classList.remove('hidden');
        }
        return;
    }
    
    // Disable button
    if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.textContent = `ðŸ“¤ ${t('sending')}`;
    }
    
    try {
        console.log('ðŸ”µ Submitting help request to Supabase...');
        
        // Insert help request into Supabase
        const { error } = await supabase
            .from('login_help_requests')
            .insert([{
                user_email: email,
                issue_type: issueType,
                message: message,
                status: 'new'
            }]);
        
        if (error) {
            console.error('âŒ Supabase error:', error);
            throw error;
        }
        
        console.log('âœ… Help request submitted successfully!');
        
        // Show success popup
        console.log('ðŸ”µ Calling showSuccessPopup...');
        showSuccessPopup(`${t('help_request_success_part1')} <strong>${email}</strong> ${t('help_request_success_part2')}`);
        
        // Reset form
        resetHelpForm();
        
        // Close modal and popup after 3 seconds
        setTimeout(() => {
            console.log('ðŸ”µ Closing modal and popup...');
            closeGetHelpModal();
            hideSuccessPopup();
        }, 3000);
        
    } catch (error) {
        console.error('âŒ Error submitting help request:', error);
        if (errorDiv) {
            errorDiv.textContent = `âŒ ${t('error_submitting_request')}: ${error.message}`;
            errorDiv.classList.remove('hidden');
        }
    } finally {
        // Re-enable button
        if (submitBtn) {
            submitBtn.disabled = false;
            submitBtn.textContent = `ðŸ“¤ ${t('send_help_request')}`;
        }
    }
}

// Close modal when clicking outside
document.addEventListener('click', function(event) {
    const modal = document.getElementById('getHelpModal');
    const modalContent = modal?.querySelector('.modal-content');
    
    if (modal && modal.classList.contains('active')) {
        if (event.target === modal) {
            closeGetHelpModal();
        }
    }
});

// Close modal on ESC key
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modal = document.getElementById('getHelpModal');
        if (modal && modal.classList.contains('active')) {
            closeGetHelpModal();
        }
    }
});

// Show Success Popup
function showSuccessPopup(message) {
    const popup = document.getElementById('successPopup');
    const messageEl = document.getElementById('successPopupMessage');
    
    if (messageEl) {
        messageEl.innerHTML = message;
    }
    
    if (popup) {
        popup.classList.add('active');
    }
}

// Hide Success Popup
function hideSuccessPopup() {
    const popup = document.getElementById('successPopup');
    if (popup) {
        popup.classList.remove('active');
    }
}

       // Toggle Send Button based on text input
        function toggleSendButton() {
            const input = document.getElementById('chatMessageInput');
            const sendBtn = document.getElementById('sendBtn');
            const templateBtn = document.getElementById('templateBtn');
            
            if (input.value.trim().length > 0) {
                sendBtn.classList.add('show');
                templateBtn.classList.add('hide');
            } else {
                sendBtn.classList.remove('show');
                templateBtn.classList.remove('hide');
            }
        }

        // Toggle Privacy Notice
        function togglePrivacyNotice() {
            const notice = document.getElementById('privacyNotice');
            notice.classList.toggle('show');
        }

        // Show Attachment Options
        function showAttachmentOptions() {
            document.getElementById('photoInput').click();
        }

// Show Terms & Conditions
function showTerms() {
    console.log('ðŸ”µ Opening Terms & Conditions...');
    
    // Hide all main views first
    hideAllViews();
    
    // âœ… Hide dashboard sections
    const seekerSection = document.getElementById('seekerSection');
    const providerSection = document.getElementById('providerSection');
    const dashboardHeader = document.getElementById('dashboardHeader');
    const createRequestBtn = document.getElementById('createRequestBtn');
    const userMenu = document.querySelector('.user-menu');
    
    if (seekerSection) seekerSection.style.display = 'none';
    if (providerSection) providerSection.style.display = 'none';
    if (createRequestBtn) createRequestBtn.style.display = 'none';
    if (dashboardHeader) dashboardHeader.style.display = 'none';
    if (userMenu) userMenu.style.display = 'none';
    
    // âœ… CRITICAL FIX: Explicitly hide ALL other views
    const loadingView = document.getElementById('loadingView');
    const loginView = document.getElementById('loginView');
    const signupView = document.getElementById('signupView');
    const privacyView = document.getElementById('privacyView');
    const editProfileView = document.getElementById('editProfileView');
    const createRequestView = document.getElementById('createRequestView');
    const chatView = document.getElementById('chatView');
    
    if (loadingView) {
        loadingView.classList.add('hidden');
        loadingView.style.display = 'none';
    }
    if (loginView) {
        loginView.classList.add('hidden');
        loginView.style.display = 'none';
    }
    if (signupView) {
        signupView.classList.add('hidden');
        signupView.style.display = 'none';
    }
    if (privacyView) {
        privacyView.classList.add('hidden');
        privacyView.style.display = 'none';
    }
    if (editProfileView) {
        editProfileView.classList.add('hidden');
        editProfileView.style.display = 'none';
    }
    if (createRequestView) {
        createRequestView.classList.add('hidden');
        createRequestView.style.display = 'none';
    }
    if (chatView) {
        chatView.classList.add('hidden');
        chatView.style.display = 'none';
    }
    
    // Show Terms & Conditions
    const termsView = document.getElementById('termsView');
    if (termsView) {
        termsView.classList.remove('hidden');
        termsView.style.display = 'block';
        termsView.style.visibility = 'visible';
    }
    
    console.log('âœ… Terms & Conditions should now be visible (full-screen)');
}

// Close Terms & Conditions
function closeTermsView() {
    console.log('ðŸ”µ Closing Terms & Conditions...');
    
    const termsView = document.getElementById('termsView');
    if (termsView) {
        termsView.classList.add('hidden');
        termsView.style.display = 'none';
    }
    
    // âœ… CRITICAL FIX: Hide loading view when closing
    const loadingView = document.getElementById('loadingView');
    if (loadingView) {
        loadingView.classList.add('hidden');
        loadingView.style.display = 'none';
    }

const dashboardHeader = document.getElementById('dashboardHeader');
if (dashboardHeader) dashboardHeader.style.display = 'flex';
    
    // Check if user is logged in or not
    if (currentUser && currentProfile) {
        // User is logged in - go back to dashboard
        console.log('âœ… User logged in - showing dashboard');
        showDashboard();
    } else {
        // User not logged in - go back to login
        console.log('âœ… User not logged in - showing login');
        
        // âœ… Explicitly show login view
        const loginView = document.getElementById('loginView');
        if (loginView) {
            loginView.classList.remove('hidden');
            loginView.style.display = 'block';
            loginView.style.visibility = 'visible';
        }
    }
}

// FIXED: Show Privacy Policy
function showPrivacy() {
    console.log('ðŸ”µ Opening Privacy Policy...');
    
    // Hide all main views first
    hideAllViews();
    
    // âœ… FIX 1: Hide ALL views explicitly
    const viewsToHide = [
        'loadingView',
        'loginView', 
        'signupView',
        'termsView',
        'editProfileView',
        'createRequestView',
        'chatView',
        'passwordResetView'
    ];
    
    viewsToHide.forEach(viewId => {
        const view = document.getElementById(viewId);
        if (view) {
            view.classList.add('hidden');
            view.style.display = 'none';
            view.style.visibility = 'hidden';
        }
    });
    
    // âœ… FIX 2: Hide ALL dashboard UI elements (use querySelectorAll for duplicate IDs)
    const dashboardHeaders = document.querySelectorAll('[id="dashboardHeader"]');
    dashboardHeaders.forEach(header => {
        header.style.display = 'none';
        header.style.visibility = 'hidden';
    });
    
    // Hide other dashboard components
    const dashboardElements = [
        'seekerSection',
        'providerSection', 
        'createRequestBtn',
        'modeToggleBtn',
        'appLogo'
    ];
    
    dashboardElements.forEach(elemId => {
        const elem = document.getElementById(elemId);
        if (elem) {
            elem.style.display = 'none';
            elem.style.visibility = 'hidden';
        }
    });
    
    // Hide user menu
    const userMenus = document.querySelectorAll('.user-menu');
    userMenus.forEach(menu => {
        menu.style.display = 'none';
        menu.style.visibility = 'hidden';
    });
    
    // âœ… FIX 3: Hide any floating/sticky buttons (Provider toggle at bottom)
    const floatingButtons = document.querySelectorAll('.btn, button[onclick*="toggleDashboardMode"]');
    floatingButtons.forEach(btn => {
        if (btn.textContent.includes('Provider') || btn.textContent.includes('Seeker')) {
            btn.style.display = 'none';
            btn.style.visibility = 'hidden';
        }
    });
    
    // Keep dashboardView visible (because privacyView is inside it)
    const dashboardView = document.getElementById('dashboardView');
    if (dashboardView) {
        dashboardView.classList.remove('hidden');
        dashboardView.style.display = 'block';
        dashboardView.style.visibility = 'visible';
    }
    
    // Show Privacy Policy
    const privacyView = document.getElementById('privacyView');
    if (privacyView) {
        privacyView.classList.remove('hidden');
        privacyView.style.display = 'block';
        privacyView.style.visibility = 'visible';
        privacyView.style.position = 'relative'; // Ensure it's in normal flow
        privacyView.style.zIndex = '1000'; // Bring to front
    }
    
    console.log('âœ… Privacy Policy should now be visible (full-screen)');
}

// FIXED: Close Privacy Policy
function closePrivacyView() {
    console.log('ðŸ”µ Closing Privacy Policy...');
    
    const privacyView = document.getElementById('privacyView');
    if (privacyView) {
        privacyView.classList.add('hidden');
        privacyView.style.display = 'none';
        privacyView.style.visibility = 'hidden';
    }
    
    // âœ… CRITICAL FIX: Hide loading view when closing
    const loadingView = document.getElementById('loadingView');
    if (loadingView) {
        loadingView.classList.add('hidden');
        loadingView.style.display = 'none';
        loadingView.style.visibility = 'hidden';
    }

    // âœ… FIX 4: Restore ALL dashboard headers properly
    const dashboardHeaders = document.querySelectorAll('[id="dashboardHeader"]');
    dashboardHeaders.forEach(header => {
        header.style.display = 'flex';
        header.style.visibility = 'visible';
    });
    
    // If user is logged in, restore dashboard
    if (currentUser && currentProfile) {
        console.log('âœ… User logged in - showing dashboard');
        
        // Show dashboard UI elements again
        const dashboardElements = [
            'seekerSection',
            'providerSection',
            'createRequestBtn',
            'modeToggleBtn',
            'appLogo'
        ];
        
        dashboardElements.forEach(elemId => {
            const elem = document.getElementById(elemId);
            if (elem) {
                elem.style.display = 'block';
                elem.style.visibility = 'visible';
            }
        });
        
        const userMenus = document.querySelectorAll('.user-menu');
        userMenus.forEach(menu => {
            menu.style.display = 'flex';
            menu.style.visibility = 'visible';
        });
        
        // Restore floating buttons
        const floatingButtons = document.querySelectorAll('.btn, button[onclick*="toggleDashboardMode"]');
        floatingButtons.forEach(btn => {
            if (btn.textContent.includes('Provider') || btn.textContent.includes('Seeker')) {
                btn.style.display = 'flex';
                btn.style.visibility = 'visible';
            }
        });
        
        // Show dashboard
        showDashboard();
    } else {
        // If not logged in, go to login
        console.log('âœ… User not logged in - showing login');
        
        // Hide dashboard view completely
        const dashboardView = document.getElementById('dashboardView');
        if (dashboardView) {
            dashboardView.classList.add('hidden');
            dashboardView.style.display = 'none';
            dashboardView.style.visibility = 'hidden';
        }
        
        // Show login view
        const loginView = document.getElementById('loginView');
        if (loginView) {
            loginView.classList.remove('hidden');
            loginView.style.display = 'block';
            loginView.style.visibility = 'visible';
        }
    }
}

// BONUS FIX: Also fix showPrivacyFromDropdown for consistency
function showPrivacyFromDropdown() {
    // Close dropdown first
    const dropdown = document.getElementById('userDropdown');
    if (dropdown) dropdown.classList.remove('show');
    
    // Then show privacy
    showPrivacy();
}

// Load Provider's Open Requests (Negotiating)
async function loadProviderOpenRequests() {
    try {
        const { data: responses, error: respError } = await supabase
            .from('request_responses')
            .select('*')
            .eq('provider_id', currentProfile.user_id)
            .order('created_at', { ascending: false });
        
        if (respError) throw respError;
        
        if (!responses || responses.length === 0) {
            document.getElementById('providerOpenRequestsList').innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">ðŸ“‹</div>
                    <div class="empty-state-text">No open requests yet</div>
                </div>
            `;
            document.getElementById('providerOpenRequestsTotal').textContent = '0';
            
            // Hide unread badge
            const unreadBadge = document.getElementById('providerOpenRequestsUnread');
            if (unreadBadge) {
                unreadBadge.classList.add('hidden');
                unreadBadge.style.display = 'none';
            }
            return;
        }
        
        const requestIds = responses.map(r => r.request_id);
        const { data: requests, error: reqError } = await supabase
            .from('requests')
            .select('*')
            .in('id', requestIds);
        
        if (reqError) throw reqError;
        
        // Filter only OPEN status (negotiating)
const openRequests = requests.filter(r => r.status === 'open');

// âœ… NEW: Check for deselected providers
const deselectedChecks = await Promise.all(openRequests.map(async (request) => {
    const { data: rejectionCheck } = await supabase
        .from('request_rejected_providers')
        .select('id')
        .eq('request_id', request.id)
        .eq('provider_id', currentProfile.user_id)
        .maybeSingle();
    
    return {
        requestId: request.id,
        isDeselected: !!rejectionCheck
    };
}));

// âœ… NEW: Filter out deselected requests
const nonDeselectedOpenRequests = openRequests.filter(request => {
    const deselectedInfo = deselectedChecks.find(d => d.requestId === request.id);
    if (deselectedInfo && deselectedInfo.isDeselected) {
        console.log('â­ï¸ Hiding deselected open request:', request.id, request.title);
        return false;
    }
    return true;
});

document.getElementById('providerOpenRequestsTotal').textContent = nonDeselectedOpenRequests.length;

if (nonDeselectedOpenRequests.length === 0) {
    document.getElementById('providerOpenRequestsList').innerHTML = `
        <div class="empty-state">
            <div class="empty-state-icon">ðŸ“‹</div>
            <div class="empty-state-text">No open requests yet</div>
        </div>
    `;
    
    // Hide unread badge
    const unreadBadge = document.getElementById('providerOpenRequestsUnread');
    if (unreadBadge) {
        unreadBadge.classList.add('hidden');
        unreadBadge.style.display = 'none';
    }
    return;
}
        
        // Get seeker profiles and chat info
        const userIds = openRequests.map(r => r.user_id);
        const { data: seekers } = await supabase
            .from('profiles')
            .select('user_id, name')
            .in('user_id', userIds);

        // Check for unread messages in each open request chat
        let totalOpenUnread = 0;
        
        const combinedData = await Promise.all(responses
    .filter(response => nonDeselectedOpenRequests.find(r => r.id === response.request_id))
            .map(async (response) => {
    const request = nonDeselectedOpenRequests.find(r => r.id === response.request_id);
                const seeker = seekers?.find(s => s.user_id === request.user_id);
                
                // Check for unread messages
                let unreadCount = 0;
                const { data: chat } = await supabase
                    .from('chats')
                    .select('messages, provider_last_viewed_at')
                    .eq('request_id', response.request_id)
                    .eq('provider_id', currentProfile.user_id)
                    .maybeSingle();
                
                if (chat && chat.messages) {
                    const lastViewedAt = chat.provider_last_viewed_at;
                    
                    const normalizeToUTC = (timestamp) => {
                        if (!timestamp) return null;
                        let normalized = timestamp;
                        if (typeof timestamp === 'string' && !timestamp.endsWith('Z') && !timestamp.includes('+')) {
                            normalized = timestamp + 'Z';
                        }
                        return new Date(normalized).getTime();
                    };
                    
                    unreadCount = chat.messages.filter(m => {
                        if (m.sender_id === currentUser.id) return false;
                        if (!lastViewedAt) return true;
                        
                        const messageTime = normalizeToUTC(m.timestamp);
                        const viewedTime = normalizeToUTC(lastViewedAt);
                        
                        return messageTime > viewedTime;
                    }).length;
                    
                    totalOpenUnread += unreadCount;
                }
                
                return {
                    ...response,
                    request: request,
                    seekerName: seeker?.name || 'Unknown',
                    unreadCount: unreadCount
                };
            }));
        
        // Update Open Requests unread badge
        const openUnreadBadge = document.getElementById('providerOpenRequestsUnread');
        if (openUnreadBadge) {
            if (totalOpenUnread > 0) {
                const badge = openUnreadBadge.querySelector('.unread-badge');
                if (badge) badge.textContent = totalOpenUnread;
                openUnreadBadge.classList.remove('hidden');
                openUnreadBadge.style.display = 'inline-flex';
            } else {
                openUnreadBadge.classList.add('hidden');
                openUnreadBadge.style.display = 'none';
            }
        }

        await displayProviderOpenRequests(combinedData);
        
    } catch (error) {
        console.error('Error loading provider open requests:', error);
    }
}

// Service Accordion Functionality
function initServiceAccordion() {
  const categories = document.querySelectorAll('.service-category');
  const serviceTypeInput = document.getElementById('serviceType');
  const serviceSubtypeInput = document.getElementById('serviceSubtype');
  const selectedDisplay = document.getElementById('selectedServiceDisplay');

  categories.forEach(category => {
    const header = category.querySelector('.service-category-header');
    const subcategories = category.querySelectorAll('.subcategory-item');

    // Toggle accordion
    header.addEventListener('click', () => {
      // Close all other categories
      categories.forEach(c => {
        if (c !== category) c.classList.remove('open');
      });
      // Toggle current category
      category.classList.toggle('open');
    });

    // Subcategory selection
    subcategories.forEach(sub => {
      sub.addEventListener('click', (e) => {
        // Don't trigger if clicking on info bubble
        if (e.target.closest('.info-bubble')) return;

        // Remove selection from all
        document.querySelectorAll('.subcategory-item').forEach(s => s.classList.remove('selected'));
        
        // Add selection to clicked
        sub.classList.add('selected');

        // Get values
        const categoryName = category.dataset.category;
        const subtypeValue = sub.dataset.value;
        const categoryTitle = category.querySelector('.category-title').textContent;
        const subtypeName = sub.querySelector('.subcategory-name').textContent;

        // Set hidden inputs
        serviceTypeInput.value = categoryName;
        serviceSubtypeInput.value = subtypeValue;

        // Show selected service
// selectedDisplay.textContent = `${categoryTitle} â†’ ${subtypeName}`;
// selectedDisplay.style.display = 'block';

        // Close accordion after selection
        category.classList.remove('open');
      });
    });
  });

  // Prevent info bubble click from propagating
  document.querySelectorAll('.info-bubble').forEach(bubble => {
    bubble.addEventListener('click', (e) => {
      e.stopPropagation();
    });
  });
}

// Provider Service Accordion Functionality
function initProviderServiceAccordion() {
    const container = document.getElementById('providerServiceAccordion');
    if (!container) return;
    
    const categories = container.querySelectorAll('.service-category');
    const serviceInput = document.getElementById('newServiceSelect');
    const subtypeInput = document.getElementById('newServiceSubtype');
    const selectedDisplay = document.getElementById('selectedProviderServiceDisplay');

    categories.forEach(category => {
        const header = category.querySelector('.service-category-header');
        const subcategories = category.querySelectorAll('.subcategory-item');

        // Toggle accordion
        header.addEventListener('click', () => {
            // Close all other categories in this accordion
            categories.forEach(c => {
                if (c !== category) c.classList.remove('open');
            });
            category.classList.toggle('open');
        });

        // Subcategory selection
        subcategories.forEach(sub => {
            sub.addEventListener('click', (e) => {
                if (e.target.closest('.info-bubble')) return;

                // Remove selection from all in this accordion
                container.querySelectorAll('.subcategory-item').forEach(s => s.classList.remove('selected'));
                
                sub.classList.add('selected');

                const categoryName = category.dataset.category;
                const subtypeValue = sub.dataset.value;
                const categoryTitle = category.querySelector('.category-title').textContent;
                const subtypeName = sub.querySelector('.subcategory-name').textContent;

                serviceInput.value = categoryName;
                subtypeInput.value = subtypeValue;

                selectedDisplay.textContent = `${categoryTitle} â†’ ${subtypeName}`;
                selectedDisplay.style.display = 'block';

                category.classList.remove('open');
            });
        });
    });

    // Prevent info bubble click from propagating
    container.querySelectorAll('.info-bubble').forEach(bubble => {
        bubble.addEventListener('click', (e) => {
            e.stopPropagation();
        });
    });
}

// Separate function for event binding (can be called multiple times safely)
function initProviderServiceAccordionEvents() {
    const container = document.getElementById('providerServiceAccordion');
    if (!container) return;
    
    const categories = container.querySelectorAll('.service-category');
    const serviceInput = document.getElementById('newServiceSelect');
    const subtypeInput = document.getElementById('newServiceSubtype');
    const selectedDisplay = document.getElementById('selectedProviderServiceDisplay');

    categories.forEach(category => {
        const header = category.querySelector('.service-category-header');
        const subcategories = category.querySelectorAll('.subcategory-item');

        // Remove old listeners by cloning
        const newHeader = header.cloneNode(true);
        header.parentNode.replaceChild(newHeader, header);

        // Toggle accordion
        newHeader.addEventListener('click', () => {
            categories.forEach(c => {
                if (c !== category) c.classList.remove('open');
            });
            category.classList.toggle('open');
        });

        // Subcategory selection
        subcategories.forEach(sub => {
            const newSub = sub.cloneNode(true);
            sub.parentNode.replaceChild(newSub, sub);
            
            newSub.addEventListener('click', (e) => {
                if (e.target.closest('.info-bubble')) return;

                container.querySelectorAll('.subcategory-item').forEach(s => s.classList.remove('selected'));
                newSub.classList.add('selected');

                const categoryName = category.dataset.category;
                const subtypeValue = newSub.dataset.value;
                const categoryTitle = category.querySelector('.category-title').textContent;
                const subtypeName = newSub.querySelector('.subcategory-name').textContent;

                serviceInput.value = categoryName;
                subtypeInput.value = subtypeValue;

                selectedDisplay.textContent = `${categoryTitle} â†’ ${subtypeName}`;
                selectedDisplay.style.display = 'block';

                category.classList.remove('open');
            });
        });
    });

    // Prevent info bubble click from propagating
    container.querySelectorAll('.info-bubble').forEach(bubble => {
        const newBubble = bubble.cloneNode(true);
        bubble.parentNode.replaceChild(newBubble, bubble);
        newBubble.addEventListener('click', (e) => {
            e.stopPropagation();
        });
    });
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    initServiceAccordion();
    initProviderServiceAccordion();
});

// Add this FIRST before everything else
function isUserLoggedIn() {
    // Check if user token exists in localStorage
    const token = localStorage.getItem('userToken');
    const userId = localStorage.getItem('userId');
    return !!(token && userId); // Returns true if both exist
}

</script>

<!-- Feedback Modal -->
<div id="feedbackModal" class="modal" style="display: none; position: fixed !important; top: 0 !important; left: 0 !important; width: 100vw !important; height: 100vh !important; z-index: 999999 !important; pointer-events: none !important;">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h2 class="modal-title">ðŸ’¬ Send Feedback</h2>
            <button class="close-btn" onclick="closeFeedbackModal()">Ã—</button>
        </div>
        <div style="padding: 20px;">
            <p style="color: #666; margin-bottom: 20px; line-height: 1.6;">
                Help us improve HelpBuddy! Share your suggestions, report bugs, or request new features. 
                Your feedback helps us serve you better.
            </p>
            
            <div class="form-group">
                <label>Feedback Type <span class="required">*</span></label>
                <select id="feedbackType" required>
                    <option value="">Select Type</option>
                    <option value="bug">ðŸ› Bug Report</option>
                    <option value="feature">âœ¨ Feature Request</option>
                    <option value="improvement">ðŸ”§ Improvement Suggestion</option>
                    <option value="complaint">ðŸ˜ž Complaint</option>
                    <option value="praise">ðŸŽ‰ Appreciation</option>
                    <option value="other">ðŸ’­ Other</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Your Feedback <span class="required">*</span></label>
                <textarea id="feedbackMessage" rows="6" maxlength="1000" required placeholder="Please describe your feedback in detail. Be specific so we can help you better."></textarea>
                <div class="char-counter"><span id="feedbackCounter">0</span>/1000</div>
            </div>
            
            <div class="form-group">
                <label>Your Email</label>
                <input type="email" id="feedbackEmail" placeholder="We'll reach out if we need more details" readonly>
                <small style="color: #999; font-size: 12px;">Using your registered email</small>
            </div>
            
            <div id="feedbackError" class="error hidden"></div>
            <div id="feedbackSuccess" class="success hidden"></div>
            
            <button class="btn btn-full" onclick="submitFeedback()" id="submitFeedbackBtn">
                ðŸ“¤ Send Feedback
            </button>
        </div>
    </div>
</div>

<!-- Get Help Modal -->
<div id="getHelpModal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h2 class="modal-title">â“ <span data-i18n="get_help">Get Help</span></h2>
            <button class="close-btn" onclick="closeGetHelpModal()" style="color: #dc3545;">Ã—</button>
        </div>
        
        <!-- FAQ Screen (shown by default) -->
        <div id="getHelpFaqScreen" style="padding: 20px;">
            <p style="color: #666; margin-bottom: 20px; line-height: 1.6;">
                <span data-i18n="faq_intro">Find answers to common problems below. If you don't find what you're looking for, you can contact our support team.</span>
            </p>
            
            <div id="faqList">
                <!-- FAQ items will be inserted here by JavaScript -->
            </div>
            
            <button class="btn btn-full hidden-for-unregistered" onclick="showContactSupportForm()" style="margin-top: 20px;">
                ðŸ“§ <span data-i18n="still_need_help">Still need help? Contact Support</span>
            </button>
        </div>
        
        <!-- Contact Support Form (hidden by default) -->
        <div id="getHelpFormScreen" class="hidden" style="padding: 20px;">
            <button class="btn btn-secondary" onclick="showGetHelpFaq()" style="margin-bottom: 20px;">
                â† <span data-i18n="back_to_faq">Back to FAQ</span>
            </button>
            
            <p style="color: #666; margin-bottom: 20px; line-height: 1.6;">
                <span data-i18n="describe_problem_intro">Describe your problem below and we'll get back to you as soon as possible.</span>
            </p>
            
            <div class="form-group">
                <label><span data-i18n="issue_type">Issue Type</span> <span class="required">*</span></label>
                <select id="helpIssueType" required>
                    <option value="" data-i18n="select_issue_type">Select Issue Type</option>
                    <option value="cant_login">âŒ <span data-i18n="cant_login">Can't Login</span></option>
                    <option value="email_verification">ðŸ“§ <span data-i18n="email_verification_not_received">Email Verification Not Received</span></option>
                    <option value="forgot_password">ðŸ”‘ <span data-i18n="forgot_password">Forgot Password</span></option>
                    <option value="page_loading">ðŸŒ <span data-i18n="page_loading_slowly">Page Loading Slowly</span></option>
                    <option value="account_issues">ðŸ“± <span data-i18n="account_issues">Account Issues</span></option>
                    <option value="email_registered">ðŸ”’ <span data-i18n="email_already_registered">Email Already Registered</span></option>
                    <option value="other">ðŸ’­ <span data-i18n="other">Other</span></option>
                </select>
            </div>
            
            <div class="form-group">
                <label><span data-i18n="describe_your_problem">Describe Your Problem</span> <span class="required">*</span></label>
                <textarea id="helpMessage" rows="6" maxlength="1000" required data-i18n-placeholder="describe_problem_placeholder" placeholder="Please describe your problem in detail..."></textarea>
                <div class="char-counter"><span id="helpMessageCounter">0</span>/1000</div>
            </div>
            
            <div class="form-group">
                <label><span data-i18n="your_email">Your Email</span> <span class="required">*</span></label>
                <input type="email" id="helpEmail" required data-i18n-placeholder="email_placeholder" placeholder="your.email@example.com">
            </div>
            
            <div id="helpError" class="error hidden"></div>
            <div id="helpSuccess" class="success hidden"></div>
            
            <button class="btn btn-full" onclick="submitHelpRequest()" id="submitHelpBtn">
                ðŸ“¤ <span data-i18n="send_help_request">Send Help Request</span>
            </button>
        </div>
    </div>
</div>

<!-- Success Popup -->
<div id="successPopup" class="success-popup-overlay">
    <div class="success-popup-content">
        <div class="success-popup-icon">âœ…</div>
        <div class="success-popup-title" data-i18n="request_sent_successfully">Request Sent Successfully!</div>
        <div class="success-popup-message" id="successPopupMessage" data-i18n="help_request_received">
            We've received your help request and will contact you soon.
        </div>
    </div>
</div>

<!-- Forgot Password Modal -->
<div id="forgotPasswordModal" class="modal">
    <div class="modal-content" style="max-width: 500px;">
        <div class="modal-header">
            <h2 class="modal-title">ðŸ”‘ <span data-i18n="reset_password">Reset Password</span></h2>
            <button class="close-btn" onclick="closeForgotPasswordModal()">Ã—</button>
        </div>
        <div style="padding: 20px;">
            <p style="color: #666; margin-bottom: 20px; line-height: 1.6;">
                <span data-i18n="reset_password_intro">Enter your registered email address and we'll send you a link to reset your password.</span>
            </p>
            
            <div class="form-group">
                <label><span data-i18n="email_address">Email Address</span> <span class="required">*</span></label>
                <input type="email" id="forgotPasswordEmail" required data-i18n-placeholder="email_placeholder" placeholder="your.email@example.com" autocomplete="email">
            </div>
            
            <div id="forgotPasswordError" class="error hidden"></div>
            <div id="forgotPasswordSuccess" class="success hidden"></div>
            
            <button class="btn btn-full" onclick="sendPasswordResetLink()" id="sendResetLinkBtn">
                ðŸ“§ <span data-i18n="send_reset_link">Send Reset Link</span>
            </button>
            
            <div style="text-align: center; margin-top: 15px;">
                <a href="#" onclick="closeForgotPasswordModal(); return false;" style="color: #667eea; text-decoration: none; font-size: 14px;">â† <span data-i18n="back_to_login">Back to Login</span></a>
            </div>
        </div>
    </div>
</div>


<!-- ========== NOTIFICATION SOUNDS ========== -->

<!-- 1. New Request Sound (for providers when new request appears) -->
<audio id="newRequestSound" preload="auto">
    <source src="/sounds/notification-loud.mp3" type="audio/mp3">
</audio>

<!-- 2. New Response Sound (for seekers when provider responds) -->
<audio id="newResponseSound" preload="auto">
    <source src="/sounds/notification-loud.mp3" type="audio/mp3">
</audio>

<!-- 3. Soft In-Chat Sound (when viewing the chat - SOFT sound) -->
<audio id="inChatSound" preload="auto">
    <source src="/sounds/notification-soft.mp3" type="audio/mp3">
</audio>

<!-- 4. Loud New Chat Sound (when NOT viewing the chat - LOUD sound) -->
<audio id="newChatSound" preload="auto">
    <source src="/sounds/notification-loud.mp3" type="audio/mp3">
</audio>

</body>
</html>